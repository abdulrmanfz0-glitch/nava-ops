<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restalyze - Intelligent Restaurant Analytics</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%);
            min-height: 100vh;
            color: #f8fafc;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 215, 0, 0.1);
        }
        .gradient-primary {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }
        .gradient-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .gradient-warning {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }
        .gradient-accent {
            background: linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%);
        }
        .brand-primary {
            color: #FFD700;
        }
        .bg-brand-primary {
            background-color: #0A2540;
        }
        .bg-brand-gold {
            background-color: #FFD700;
        }
        .border-brand-gold {
            border-color: #FFD700;
        }
        .text-brand-gold {
            color: #FFD700;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .hover-lift {
            transition: all 0.3s ease;
        }
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .progress-bar {
            transition: width 0.8s ease-in-out;
        }
        .print-layout {
            display: none;
        }
        
        /* Enhanced sidebar styling */
        .sidebar-item {
            transition: all 0.3s ease;
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            color: rgba(255, 255, 255, 0.8);
        }
        .sidebar-item:hover {
            background: rgba(255, 215, 0, 0.15);
            transform: translateX(5px);
            color: #FFD700;
        }
        .sidebar-item.active {
            background: rgba(255, 215, 0, 0.25);
            border-left: 4px solid #FFD700;
            color: #FFD700;
        }
        /* Enhanced modal styling */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Enhanced text visibility */
        .text-enhanced {
            color: rgba(255, 255, 255, 0.9);
        }
        .text-secondary {
            color: rgba(255, 255, 255, 0.7);
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(14, 165, 233, 0.5);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(14, 165, 233, 0.7);
        }

        /* üîß FIXED: Dropdown visibility issue */
        select, .dropdown-options {
            background: #1e293b !important;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
        }

        select option, .dropdown-option {
            background: #1e293b !important;
            color: white !important;
            padding: 10px !important;
        }

        select:focus, .dropdown-options:focus {
            outline: none;
            ring: 2px solid #0ea5e9;
        }

        /* Enhanced dropdown styling */
        .enhanced-dropdown {
            background: #1e293b !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            color: white !important;
        }

        .enhanced-dropdown option {
            background: #1e293b !important;
            color: white !important;
            padding: 12px !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        .enhanced-dropdown option:hover {
            background: #0ea5e9 !important;
            color: white !important;
        }

        /* Restaurant card hover effects */
        .restaurant-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .restaurant-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.3);
        }
        .restaurant-card.active {
            border: 2px solid #0ea5e9;
            background: rgba(14, 165, 233, 0.1);
        }
        
        /* üîß FIXED: Button hover states */
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(14, 165, 233, 0.4);
        }
        
        /* üîß FIXED: Modal z-index issues */
        .modal-overlay {
            z-index: 1000;
        }
        .modal-content {
            z-index: 1001;
        }
        
        /* üîß FIXED: Responsive improvements */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                height: 100vh;
                z-index: 50;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .mobile-overlay {
                display: block;
            }
        }

        /* üöÄ NEW: Advanced Analytics Charts */
        .analytics-chart {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        /* üöÄ NEW: Logo Upload Styling */
        .logo-upload-container {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .logo-upload-container:hover {
            border-color: #0ea5e9;
            background: rgba(14, 165, 233, 0.05);
        }
        .logo-preview {
            max-width: 120px;
            max-height: 120px;
            border-radius: 12px;
            object-fit: cover;
        }

        /* üöÄ NEW: AI Insights Styling */
        .ai-insight-card {
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid rgba(14, 165, 233, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 10px 0;
        }

        /* üöÄ NEW: Performance Metrics */
        .performance-metric {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        /* üöÄ NEW: Predictive Analytics */
        .predictive-indicator {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(14, 165, 233, 0.1) 100%);
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
        }

        /* üöÄ NEW: Real-time Data Pulse */
        .data-pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(120%);
                opacity: 0;
            }
        }

        /* ‚ö° FAB Tooltip */
        button:hover + .fab-tooltip {
            opacity: 1 !important;
        }

        /* üñ®Ô∏è PRINT STYLES - Professional Report Printing */
        @media print {
            body {
                background: white !important;
            }

            .no-print {
                display: none !important;
            }

            .report-container {
                background: white !important;
                box-shadow: none !important;
                border: none !important;
            }

            @page {
                margin: 1cm;
                size: A4;
            }

            h1, h2, h3 {
                page-break-after: avoid;
            }

            img, svg {
                page-break-inside: avoid;
            }
        }

        /* üöÄ NEW: Advanced Tooltips */
        .advanced-tooltip {
            position: relative;
        }
        .advanced-tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, createContext, useContext, useRef, useCallback } = React;

        // ==================== Enhanced Configuration ====================
        const APP_CONFIG = {
            name: 'Restalyze',
            version: '11.0.0', // Restalyze Platinum Edition
            company: 'Restalyze Technologies Inc.',
            defaultPassword: 'restalyze2024',
            supportedPlatforms: [
                { id: 'hungerstation', name: 'HungerStation', commission: 0.22, color: '#FF6B35' },
                { id: 'jahez', name: 'Jahez', commission: 0.20, color: '#00A859' },
                { id: 'talabat', name: 'Talabat', commission: 0.18, color: '#FF2E00' },
                { id: 'mrsool', name: 'Mrsool', commission: 0.25, color: '#00B2A9' },
                { id: 'careem', name: 'Careem', commission: 0.23, color: '#00AEEF' },
                { id: 'toyou', name: 'ToYou', commission: 0.19, color: '#8B5CF6' },
                { id: 'keta', name: 'KETA', commission: 0.21, color: '#F59E0B' }
            ],
            reportTypes: {
                daily: { 
                    label: 'Daily Performance Report', 
                    description: 'Complete 24-hour analysis from 12:00 AM to 11:59 PM',
                    timeframe: '24 hours',
                    bestFor: 'Daily reconciliation and immediate operational decisions'
                },
                weekly: { 
                    label: 'Weekly Analytics Report', 
                    description: '7-day comprehensive analysis (Monday to Sunday) with week-over-week comparisons',
                    timeframe: '7 days',
                    bestFor: 'Staff performance review and weekly inventory planning'
                },
                monthly: { 
                    label: 'Monthly Executive Report', 
                    description: 'Complete 30-day performance overview with trend analysis and strategic insights',
                    timeframe: '30 days',
                    bestFor: 'Financial planning and strategic business decisions'
                },
                quarterly: { 
                    label: 'Quarterly Strategic Report', 
                    description: '90-day business intelligence review with seasonal trend analysis',
                    timeframe: '90 days',
                    bestFor: 'Long-term strategy and performance benchmarking'
                },
                custom: { 
                    label: 'Custom Period Report', 
                    description: 'Flexible date range analysis tailored to specific business needs',
                    timeframe: 'Variable',
                    bestFor: 'Special events, promotions, or unique business scenarios'
                }
            },
            restaurantTypes: [
                'Burgers', 'Pizza', 'Shawarma', 'Seafood', 'Coffee Shop',
                'Fine Dining', 'Fast Food', 'Cafe', 'Bakery', 'Desserts'
            ],
            cities: ['Riyadh', 'Jeddah', 'Dammam', 'Mecca', 'Medina', 'Khobar', 'Abha', 'Tabuk']
        };

        // ==================== Legendary Utility Functions ====================
        const utils = {
            formatCurrency: (amount) => {
                return new Intl.NumberFormat('en-US', { 
                    style: 'currency', 
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 2
                }).format(amount || 0);
            },
            formatNumber: (num) => {
                return new Intl.NumberFormat('en-US').format(num || 0);
            },
            formatDate: (date) => {
                if (!date) return '';
                return new Date(date).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            },
            formatDateTime: (date) => {
                if (!date) return '';
                return new Date(date).toLocaleString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            },
            formatDateRange: (start, end) => {
                return `${utils.formatDate(start)} - ${utils.formatDate(end)}`;
            },
            generateId: () => {
                return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            },
            calculateCommission: (amount, commissionRate) => {
                return amount * commissionRate;
            },
            calculateNetProfit: (gmv, commission, expenses = 0) => {
                return gmv - commission - expenses;
            },
            calculateGrowth: (current, previous) => {
                if (!previous || previous === 0) return 0;
                return ((current - previous) / previous) * 100;
            },
            calculateProfitMargin: (revenue, profit) => {
                if (!revenue || revenue === 0) return 0;
                return (profit / revenue) * 100;
            },
            
            // üöÄ ENHANCED: Analyze performance trends
            analyzePerformanceTrends: (data) => {
                if (!data || data.length === 0) return {};
                
                const sortedData = [...data].sort((a, b) => new Date(a.date || a.week || a.month) - new Date(b.date || b.week || b.month));
                const firstPeriod = sortedData[0];
                const lastPeriod = sortedData[sortedData.length - 1];
                
                const revenueGrowth = utils.calculateGrowth(lastPeriod.gmv, firstPeriod.gmv);
                const orderGrowth = utils.calculateGrowth(lastPeriod.orders, firstPeriod.orders);
                const profitGrowth = utils.calculateGrowth(lastPeriod.netProfit, firstPeriod.netProfit);
                
                return {
                    revenueGrowth,
                    orderGrowth,
                    profitGrowth,
                    trend: revenueGrowth > 0 ? 'up' : revenueGrowth < 0 ? 'down' : 'stable',
                    momentum: Math.abs(revenueGrowth) > 10 ? 'strong' : Math.abs(revenueGrowth) > 5 ? 'moderate' : 'weak'
                };
            },
            
            // üöÄ ENHANCED: Professional Export Functions
            exportToCSV: (data, filename) => {
                if (!data || data.length === 0) return;
                
                const headers = Object.keys(data[0]).join(',');
                const csvData = data.map(row => 
                    Object.values(row).map(value => 
                        typeof value === 'string' && value.includes(',') ? `"${value}"` : value
                    ).join(',')
                ).join('\n');
                const csv = `${headers}\n${csvData}`;
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `${filename}_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                URL.revokeObjectURL(url);
            },

            // üöÄ ENHANCED: Excel Export with Formatting
            exportToExcel: (data, filename) => {
                if (!data || data.length === 0) return;
                
                try {
                    const ws = XLSX.utils.json_to_sheet(data);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
                    XLSX.writeFile(wb, `${filename}_${new Date().toISOString().split('T')[0]}.xlsx`);
                } catch (error) {
                    console.error('Excel export error:', error);
                    utils.showNotification('Error exporting to Excel', 'error');
                }
            },

            // üöÄ ENHANCED: Professional PDF Export
            exportToPDF: (elementId, filename) => {
                const element = document.getElementById(elementId);
                if (!element) {
                    utils.showNotification('Report content not found', 'error');
                    return;
                }

                html2canvas(element).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgProps= pdf.getImageProperties(imgData);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                    
                    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                    pdf.save(`${filename}_${new Date().toISOString().split('T')[0]}.pdf`);
                });
            },

            // üöÄ NEW: Image Upload and Processing
            handleImageUpload: (file, callback) => {
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        // Create a canvas to resize the image
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Set maximum dimensions
                        const maxWidth = 200;
                        const maxHeight = 200;
                        
                        let { width, height } = img;
                        
                        // Calculate new dimensions maintaining aspect ratio
                        if (width > height) {
                            if (width > maxWidth) {
                                height *= maxWidth / width;
                                width = maxWidth;
                            }
                        } else {
                            if (height > maxHeight) {
                                width *= maxHeight / height;
                                height = maxHeight;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Convert to base64
                        const resizedImage = canvas.toDataURL('image/jpeg', 0.8);
                        callback(resizedImage);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            },

            // üöÄ NEW: AI-Powered Insights Generator
            generateAIInsights: (restaurantData, performanceData) => {
                const insights = [];
                
                // Analyze performance trends
                if (performanceData.revenueGrowth > 15) {
                    insights.push({
                        type: 'success',
                        title: 'Rapid Growth Detected',
                        message: `Your restaurant is growing at ${performanceData.revenueGrowth}% month-over-month. Consider expanding capacity.`,
                        impact: 'high',
                        action: 'Review expansion opportunities'
                    });
                }
                
                if (performanceData.profitMargin < 10) {
                    insights.push({
                        type: 'warning',
                        title: 'Low Profit Margin',
                        message: `Current margin of ${performanceData.profitMargin}% is below industry average. Review pricing and costs.`,
                        impact: 'medium',
                        action: 'Optimize pricing strategy'
                    });
                }
                
                // Analyze customer behavior
                if (performanceData.avgOrderValue > 50) {
                    insights.push({
                        type: 'info',
                        title: 'Premium Customer Base',
                        message: `High average order value of ${utils.formatCurrency(performanceData.avgOrderValue)} indicates premium positioning.`,
                        impact: 'low',
                        action: 'Maintain quality standards'
                    });
                }
                
                // Platform performance insights
                if (performanceData.platforms) {
                    const bestPlatform = performanceData.platforms.reduce((best, platform) => 
                        platform.profitMargin > best.profitMargin ? platform : best
                    );
                    
                    insights.push({
                        type: 'success',
                        title: 'Top Performing Platform',
                        message: `${bestPlatform.name} delivers ${bestPlatform.profitMargin}% profit margin. Consider allocating more resources.`,
                        impact: 'medium',
                        action: 'Optimize platform mix'
                    });
                }
                
                return insights;
            },

            // üöÄ NEW: Predictive Analytics Engine
            generatePredictions: (historicalData) => {
                if (!historicalData || historicalData.length < 3) return null;
                
                // Simple linear regression for prediction
                const n = historicalData.length;
                const x = historicalData.map((_, i) => i);
                const y = historicalData.map(d => d.revenue);
                
                const sumX = x.reduce((a, b) => a + b, 0);
                const sumY = y.reduce((a, b) => a + b, 0);
                const sumXY = x.reduce((a, b, i) => a + b * y[i], 0);
                const sumXX = x.reduce((a, b) => a + b * b, 0);
                
                const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
                const intercept = (sumY - slope * sumX) / n;
                
                const nextRevenue = slope * n + intercept;
                const confidence = Math.max(0.7, 1 - Math.abs(slope) / 1000);
                
                return {
                    nextPeriodRevenue: Math.max(0, nextRevenue),
                    confidence: Math.min(0.95, confidence),
                    trend: slope > 0 ? 'up' : slope < 0 ? 'down' : 'stable',
                    growthRate: (slope / y[y.length - 1]) * 100
                };
            },

            // üöÄ NEW: Performance Scoring System
            calculatePerformanceScore: (metrics) => {
                let score = 0;
                let maxScore = 0;
                
                // Revenue growth (0-30 points)
                if (metrics.revenueGrowth >= 20) score += 30;
                else if (metrics.revenueGrowth >= 10) score += 20;
                else if (metrics.revenueGrowth >= 5) score += 10;
                else if (metrics.revenueGrowth >= 0) score += 5;
                maxScore += 30;
                
                // Profit margin (0-25 points)
                if (metrics.profitMargin >= 20) score += 25;
                else if (metrics.profitMargin >= 15) score += 20;
                else if (metrics.profitMargin >= 10) score += 15;
                else if (metrics.profitMargin >= 5) score += 10;
                maxScore += 25;
                
                // Order volume (0-20 points)
                if (metrics.orderGrowth >= 15) score += 20;
                else if (metrics.orderGrowth >= 10) score += 15;
                else if (metrics.orderGrowth >= 5) score += 10;
                else if (metrics.orderGrowth >= 0) score += 5;
                maxScore += 20;
                
                // Customer satisfaction (0-15 points)
                if (metrics.customerSatisfaction >= 4.5) score += 15;
                else if (metrics.customerSatisfaction >= 4.0) score += 10;
                else if (metrics.customerSatisfaction >= 3.5) score += 5;
                maxScore += 15;
                
                // Operational efficiency (0-10 points)
                if (metrics.operationalEfficiency >= 90) score += 10;
                else if (metrics.operationalEfficiency >= 80) score += 7;
                else if (metrics.operationalEfficiency >= 70) score += 5;
                maxScore += 10;
                
                const percentage = (score / maxScore) * 100;
                
                return {
                    score: Math.round(percentage),
                    grade: percentage >= 90 ? 'A' : 
                           percentage >= 80 ? 'B' : 
                           percentage >= 70 ? 'C' : 
                           percentage >= 60 ? 'D' : 'F',
                    breakdown: {
                        revenueGrowth: metrics.revenueGrowth,
                        profitMargin: metrics.profitMargin,
                        orderGrowth: metrics.orderGrowth,
                        customerSatisfaction: metrics.customerSatisfaction,
                        operationalEfficiency: metrics.operationalEfficiency
                    }
                };
            },

            // üöÄ NEW: Real-time Data Simulation
            simulateRealTimeData: (baseData) => {
                const now = new Date();
                const currentHour = now.getHours();
                const isPeakHour = (currentHour >= 11 && currentHour <= 14) || (currentHour >= 18 && currentHour <= 21);
                
                // Simulate real-time fluctuations
                const peakMultiplier = isPeakHour ? 1.5 : 0.8;
                const randomFactor = 0.9 + Math.random() * 0.2; // 0.9 to 1.1
                
                return baseData.map(item => ({
                    ...item,
                    orders: Math.floor(item.orders * peakMultiplier * randomFactor),
                    revenue: Math.floor(item.revenue * peakMultiplier * randomFactor),
                    timestamp: new Date().toISOString()
                }));
            },

            // Enhanced notification system
            showNotification: (message, type = 'info') => {
                const notification = document.createElement('div');
                const bgColor = {
                    success: 'bg-green-500',
                    error: 'bg-red-500',
                    warning: 'bg-yellow-500',
                    info: 'bg-blue-500'
                }[type];
                
                notification.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 3000);
            },

            // Enhanced confirmation dialog
            showConfirmation: (message, onConfirm, onCancel = () => {}) => {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 flex items-center justify-center z-50 modal-overlay';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 modal-content">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Confirmation</h3>
                        <p class="text-gray-600 mb-6">${message}</p>
                        <div class="flex space-x-3">
                            <button id="confirm-btn" class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">
                                Confirm
                            </button>
                            <button id="cancel-btn" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                                Cancel
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                const confirmBtn = modal.querySelector('#confirm-btn');
                const cancelBtn = modal.querySelector('#cancel-btn');
                
                const cleanup = () => {
                    document.body.removeChild(modal);
                };
                
                confirmBtn.onclick = () => {
                    cleanup();
                    onConfirm();
                };
                
                cancelBtn.onclick = () => {
                    cleanup();
                    onCancel();
                };
            }
        };

        // ==================== Context Providers ====================
        const AuthContext = createContext(null);
        const DataContext = createContext(null);

        // Enhanced Auth Provider
        const AuthProvider = ({ children }) => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const savedUser = localStorage.getItem('restalyze_user');
                if (savedUser) {
                    setUser(JSON.parse(savedUser));
                }
                setLoading(false);
            }, []);

            const login = async (email, password) => {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (email && password === APP_CONFIG.defaultPassword) {
                            const userData = {
                                id: utils.generateId(),
                                email,
                                name: email.split('@')[0],
                                role: email.includes('admin') ? 'admin' : 
                                      email.includes('analyst') ? 'analyst' :
                                      email.includes('accountant') ? 'accountant' : 'staff',
                                restaurant: email.includes('burger') ? 'Burger Palace' : 
                                           email.includes('pizza') ? 'Pizza Corner' : 'Shawarma House',
                                avatar: `https://ui-avatars.com/api/?name=${email.split('@')[0]}&background=0ea5e9&color=fff`,
                                createdAt: new Date().toISOString(),
                                permissions: {
                                    viewReports: true,
                                    manageRestaurants: email.includes('admin'),
                                    manageUsers: email.includes('admin'),
                                    financialAccess: email.includes('admin') || email.includes('accountant')
                                }
                            };
                            
                            setUser(userData);
                            localStorage.setItem('restalyze_user', JSON.stringify(userData));
                            resolve(userData);
                        } else {
                            reject(new Error('Invalid login credentials'));
                        }
                    }, 1000);
                });
            };

            const logout = () => {
                setUser(null);
                localStorage.removeItem('restalyze_user');
            };

            return (
                <AuthContext.Provider value={{ user, loading, login, logout }}>
                    {children}
                </AuthContext.Provider>
            );
        };

        const useAuth = () => {
            const context = useContext(AuthContext);
            if (!context) throw new Error('useAuth must be used within AuthProvider');
            return context;
        };

        // Legendary Data Provider
        const DataProvider = ({ children }) => {
            const [restaurants, setRestaurants] = useState([]);
            const [selectedRestaurant, setSelectedRestaurant] = useState(null);
            const [weeklyData, setWeeklyData] = useState([]);
            const [monthlyData, setMonthlyData] = useState([]);
            const [dailyData, setDailyData] = useState([]);
            const [promotions, setPromotions] = useState([]);
            const [notifications, setNotifications] = useState([]);

            // üöÄ NEW: Enhanced smart feature data
            const [peakHours, setPeakHours] = useState([]);
            const [menuPerformance, setMenuPerformance] = useState([]);
            const [customerRetention, setCustomerRetention] = useState({});
            const [deliveryOptimization, setDeliveryOptimization] = useState([]);
            const [smartAlerts, setSmartAlerts] = useState([]);
            const [predictiveAnalytics, setPredictiveAnalytics] = useState({});
            const [aiInsights, setAiInsights] = useState([]);
            const [performanceScores, setPerformanceScores] = useState({});
            const [realTimeData, setRealTimeData] = useState([]);

            // üè¢ LEGENDARY: Branch Management State
            const [selectedBranch, setSelectedBranch] = useState(null);
            const [branchData, setBranchData] = useState({}); // Branch-specific performance data

            // Initialize with comprehensive sample data
            useEffect(() => {
                const initializeData = () => {
                    // Enhanced sample restaurants with logo support
                    const sampleRestaurants = [
                        {
                            id: 'r1',
                            name: 'Burger Palace',
                            logo: 'üçî',
                            customLogo: null,
                            type: 'Burgers',
                            owner: 'Ahmed Mohamed',
                            phone: '+966500000001',
                            joinDate: '2023-01-15',
                            status: 'active',
                            establishedDate: '2020-05-10',
                            description: 'Premium burgers with locally-sourced ingredients',
                            minimumMargin: 15,
                            platforms: ['hungerstation', 'jahez', 'talabat'],
                            branches: [
                                {
                                    id: 'b1',
                                    name: 'Main Branch',
                                    city: 'Riyadh',
                                    capacity: 50,
                                    address: 'King Fahd District, Riyadh',
                                    status: 'active',
                                    performance: { orders: 1248, revenue: 456200, rating: 4.8 }
                                }
                            ],
                            targets: {
                                monthlyRevenue: 500000,
                                profitMargin: 18,
                                customerSatisfaction: 4.5
                            },
                            performanceStats: {
                                avgOrderValue: 28.50,
                                customerSatisfaction: 4.7,
                                deliveryTime: 32,
                                repeatCustomers: 45
                            }
                        },
                        {
                            id: 'r2',
                            name: 'Pizza Corner',
                            logo: 'üçï',
                            customLogo: null,
                            type: 'Pizza',
                            owner: 'Saeed Abdullah',
                            phone: '+966500000002',
                            joinDate: '2023-03-20',
                            status: 'active',
                            establishedDate: '2019-08-15',
                            description: 'Authentic Italian pizza with fresh ingredients',
                            minimumMargin: 12,
                            platforms: ['hungerstation', 'mrsool', 'careem'],
                            branches: [
                                {
                                    id: 'b3',
                                    name: 'Main Branch',
                                    city: 'Jeddah',
                                    capacity: 40,
                                    address: 'Al Safa District, Jeddah',
                                    status: 'active',
                                    performance: { orders: 1567, revenue: 589300, rating: 4.9 }
                                }
                            ],
                            targets: {
                                monthlyRevenue: 600000,
                                profitMargin: 15,
                                customerSatisfaction: 4.7
                            },
                            performanceStats: {
                                avgOrderValue: 35.20,
                                customerSatisfaction: 4.9,
                                deliveryTime: 28,
                                repeatCustomers: 52
                            }
                        },
                        {
                            id: 'r3',
                            name: 'Shawarma House',
                            logo: 'üåØ',
                            customLogo: null,
                            type: 'Shawarma',
                            owner: 'Khalid Al-Rashid',
                            phone: '+966500000003',
                            joinDate: '2023-06-10',
                            status: 'active',
                            establishedDate: '2021-02-20',
                            description: 'Traditional shawarma with authentic flavors',
                            minimumMargin: 10,
                            platforms: ['jahez', 'talabat', 'toyou'],
                            branches: [
                                {
                                    id: 'b5',
                                    name: 'Main Branch',
                                    city: 'Dammam',
                                    capacity: 35,
                                    address: 'Al Khobar District, Dammam',
                                    status: 'active',
                                    performance: { orders: 892, revenue: 267600, rating: 4.6 }
                                }
                            ],
                            targets: {
                                monthlyRevenue: 300000,
                                profitMargin: 12,
                                customerSatisfaction: 4.4
                            },
                            performanceStats: {
                                avgOrderValue: 22.80,
                                customerSatisfaction: 4.6,
                                deliveryTime: 35,
                                repeatCustomers: 38
                            }
                        }
                    ];

                    // Generate comprehensive time-series data
                    const generateTimeSeriesData = () => {
                        const daily = [];
                        const weekly = [];
                        const monthly = [];
                        const platforms = APP_CONFIG.supportedPlatforms;
                        
                        // Generate 90 days of daily data
                        for (let i = 90; i >= 0; i--) {
                            const date = new Date();
                            date.setDate(date.getDate() - i);
                            const dateStr = date.toISOString().split('T')[0];
                            
                            platforms.forEach(platform => {
                                sampleRestaurants.forEach(restaurant => {
                                    if (restaurant.platforms.includes(platform.id)) {
                                        let baseOrders, baseGMV;
                                        
                                        switch(restaurant.id) {
                                            case 'r1': // Burger Palace
                                                baseOrders = 25 + Math.random() * 20;
                                                baseGMV = 1800 + Math.random() * 900;
                                                break;
                                            case 'r2': // Pizza Corner
                                                baseOrders = 20 + Math.random() * 15;
                                                baseGMV = 2200 + Math.random() * 1100;
                                                break;
                                            case 'r3': // Shawarma House
                                                baseOrders = 15 + Math.random() * 12;
                                                baseGMV = 1200 + Math.random() * 600;
                                                break;
                                            default:
                                                baseOrders = 20 + Math.random() * 15;
                                                baseGMV = 1500 + Math.random() * 800;
                                        }
                                        
                                        const orders = Math.floor(baseOrders);
                                        const gmv = Math.floor(baseGMV);
                                        const commission = utils.calculateCommission(gmv, platform.commission);
                                        const expenses = Math.floor(200 + Math.random() * 100);
                                        const netProfit = utils.calculateNetProfit(gmv, commission, expenses);
                                        
                                        daily.push({
                                            id: utils.generateId(),
                                            date: dateStr,
                                            platform: platform.id,
                                            restaurant: restaurant.id,
                                            orders,
                                            gmv,
                                            commission,
                                            expenses,
                                            netProfit,
                                            avgOrderValue: gmv / orders
                                        });
                                    }
                                });
                            });
                        }

                        // Generate weekly aggregates
                        for (let week = 0; week < 12; week++) {
                            const weekStart = new Date();
                            weekStart.setDate(weekStart.getDate() - (week * 7));
                            const weekStr = weekStart.toISOString().split('T')[0];
                            
                            platforms.forEach(platform => {
                                sampleRestaurants.forEach(restaurant => {
                                    if (restaurant.platforms.includes(platform.id)) {
                                        let baseOrders, baseGMV;
                                        
                                        switch(restaurant.id) {
                                            case 'r1': // Burger Palace
                                                baseOrders = 150 + Math.random() * 80;
                                                baseGMV = 11000 + Math.random() * 5000;
                                                break;
                                            case 'r2': // Pizza Corner
                                                baseOrders = 120 + Math.random() * 70;
                                                baseGMV = 13000 + Math.random() * 6000;
                                                break;
                                            case 'r3': // Shawarma House
                                                baseOrders = 90 + Math.random() * 50;
                                                baseGMV = 7000 + Math.random() * 3500;
                                                break;
                                            default:
                                                baseOrders = 120 + Math.random() * 60;
                                                baseGMV = 9000 + Math.random() * 4000;
                                        }
                                        
                                        const orders = Math.floor(baseOrders);
                                        const gmv = Math.floor(baseGMV);
                                        const commission = utils.calculateCommission(gmv, platform.commission);
                                        const expenses = Math.floor(1400 + Math.random() * 600);
                                        const netProfit = utils.calculateNetProfit(gmv, commission, expenses);
                                        
                                        weekly.push({
                                            id: utils.generateId(),
                                            week: weekStr,
                                            platform: platform.id,
                                            restaurant: restaurant.id,
                                            orders,
                                            gmv,
                                            commission,
                                            expenses,
                                            netProfit,
                                            avgOrderValue: gmv / orders
                                        });
                                    }
                                });
                            });
                        }

                        // Generate monthly aggregates
                        const months = ['2024-01', '2024-02', '2024-03', '2024-04', '2024-05', '2024-06'];
                        months.forEach(month => {
                            platforms.forEach(platform => {
                                sampleRestaurants.forEach(restaurant => {
                                    if (restaurant.platforms.includes(platform.id)) {
                                        let baseOrders, baseGMV;
                                        
                                        switch(restaurant.id) {
                                            case 'r1': // Burger Palace
                                                baseOrders = 550 + Math.random() * 250;
                                                baseGMV = 38000 + Math.random() * 18000;
                                                break;
                                            case 'r2': // Pizza Corner
                                                baseOrders = 450 + Math.random() * 220;
                                                baseGMV = 45000 + Math.random() * 20000;
                                                break;
                                            case 'r3': // Shawarma House
                                                baseOrders = 350 + Math.random() * 180;
                                                baseGMV = 25000 + Math.random() * 12000;
                                                break;
                                            default:
                                                baseOrders = 450 + Math.random() * 200;
                                                baseGMV = 32000 + Math.random() * 15000;
                                        }
                                        
                                        const orders = Math.floor(baseOrders);
                                        const gmv = Math.floor(baseGMV);
                                        const commission = utils.calculateCommission(gmv, platform.commission);
                                        const expenses = Math.floor(6000 + Math.random() * 3000);
                                        const netProfit = utils.calculateNetProfit(gmv, commission, expenses);
                                        
                                        monthly.push({
                                            id: utils.generateId(),
                                            month,
                                            platform: platform.id,
                                            restaurant: restaurant.id,
                                            orders,
                                            gmv,
                                            commission,
                                            expenses,
                                            netProfit,
                                            avgOrderValue: gmv / orders
                                        });
                                    }
                                });
                            });
                        });

                        return { daily, weekly, monthly };
                    };

                    const { daily, weekly, monthly } = generateTimeSeriesData();

                    setRestaurants(sampleRestaurants);
                    setSelectedRestaurant(sampleRestaurants[0]);
                    setDailyData(daily);
                    setWeeklyData(weekly);
                    setMonthlyData(monthly);

                    // üöÄ NEW: Initialize enhanced smart feature data
                    // Sample peak hours data
                    const samplePeakHours = [
                        { hour: '19:00', orders: 45, percentage: '18.5%' },
                        { hour: '20:00', orders: 52, percentage: '21.3%' },
                        { hour: '13:00', orders: 38, percentage: '15.6%' }
                    ];
                    setPeakHours(samplePeakHours);

                    // Sample menu performance data
                    const sampleMenuPerformance = [
                        { name: 'Classic Burger', orders: 156, revenue: 4680, quantity: 156, avgOrderValue: 30, popularity: 12.5 },
                        { name: 'Margherita Pizza', orders: 134, revenue: 4020, quantity: 134, avgOrderValue: 30, popularity: 10.7 },
                        { name: 'Chicken Shawarma', orders: 89, revenue: 2225, quantity: 89, avgOrderValue: 25, popularity: 7.1 }
                    ];
                    setMenuPerformance(sampleMenuPerformance);

                    // Sample customer retention data
                    const sampleCustomerRetention = {
                        totalCustomers: 245,
                        returningCustomers: 156,
                        retentionRate: '63.7',
                        newCustomers: 89
                    };
                    setCustomerRetention(sampleCustomerRetention);

                    // Sample delivery optimization data
                    const sampleDeliveryOptimization = [
                        { platform: 'HungerStation', totalDeliveries: 45, avgTime: '38.2', onTimeRate: '88.9' },
                        { platform: 'Jahez', totalDeliveries: 52, avgTime: '42.1', onTimeRate: '82.7' },
                        { platform: 'Talabat', totalDeliveries: 38, avgTime: '35.8', onTimeRate: '92.1' }
                    ];
                    setDeliveryOptimization(sampleDeliveryOptimization);

                    // Sample smart alerts
                    const sampleAlerts = [
                        {
                            id: 'a1',
                            type: 'warning',
                            title: 'Revenue Drop Detected',
                            message: '30% decrease in orders compared to yesterday',
                            priority: 'high',
                            timestamp: new Date().toISOString(),
                            read: false,
                            restaurant: 'r1'
                        },
                        {
                            id: 'a2',
                            type: 'info',
                            title: 'Peak Hours Alert',
                            message: 'High traffic expected between 7-9 PM based on historical data',
                            priority: 'medium',
                            timestamp: new Date(Date.now() - 3600000).toISOString(),
                            read: false,
                            restaurant: 'r1'
                        }
                    ];
                    setSmartAlerts(sampleAlerts);

                    // Sample predictive analytics
                    const samplePredictive = {
                        nextWeekRevenue: 12500,
                        confidence: 0.85,
                        trend: 'up',
                        recommendedActions: [
                            'Increase staff during weekend evenings',
                            'Stock up on popular menu items',
                            'Run targeted social media promotions'
                        ]
                    };
                    setPredictiveAnalytics(samplePredictive);

                    // üöÄ NEW: Sample AI Insights
                    const sampleAIInsights = [
                        {
                            id: 'ai1',
                            type: 'success',
                            title: 'Optimal Pricing Strategy',
                            message: 'Current pricing yields 18% higher margins than industry average',
                            impact: 'high',
                            action: 'Maintain current pricing structure',
                            timestamp: new Date().toISOString()
                        },
                        {
                            id: 'ai2',
                            type: 'warning',
                            title: 'Delivery Time Optimization',
                            message: '23% of orders exceed 45-minute delivery target during peak hours',
                            impact: 'medium',
                            action: 'Review delivery partner performance',
                            timestamp: new Date().toISOString()
                        }
                    ];
                    setAiInsights(sampleAIInsights);

                    // üöÄ NEW: Performance Scores
                    const samplePerformanceScores = {
                        'r1': { score: 87, grade: 'B', breakdown: {
                            revenueGrowth: 12.5,
                            profitMargin: 18.2,
                            orderGrowth: 8.3,
                            customerSatisfaction: 4.7,
                            operationalEfficiency: 85
                        }},
                        'r2': { score: 92, grade: 'A', breakdown: {
                            revenueGrowth: 15.8,
                            profitMargin: 15.4,
                            orderGrowth: 12.1,
                            customerSatisfaction: 4.9,
                            operationalEfficiency: 88
                        }},
                        'r3': { score: 78, grade: 'C', breakdown: {
                            revenueGrowth: 8.2,
                            profitMargin: 12.1,
                            orderGrowth: 5.7,
                            customerSatisfaction: 4.6,
                            operationalEfficiency: 82
                        }}
                    };
                    setPerformanceScores(samplePerformanceScores);

                    // Enhanced sample data for other entities
                    setPromotions([
                        {
                            id: 'p1',
                            name: 'Weekend Special',
                            description: '20% off on all orders',
                            discount: 0.2,
                            startDate: '2024-01-01',
                            endDate: '2024-12-31',
                            status: 'active',
                            platforms: ['hungerstation', 'jahez'],
                            restaurant: 'r1',
                            budget: 5000,
                            spent: 3200,
                            performance: { orders: 245, revenue: 12500 }
                        }
                    ]);

                    // Sample notifications
                    setNotifications([
                        {
                            id: 'n1',
                            type: 'warning',
                            title: 'Low Profit Margin Alert',
                            message: 'HungerStation platform showing 8.2% margin - below target',
                            timestamp: new Date().toISOString(),
                            read: false,
                            restaurant: 'r1'
                        }
                    ]);
                };

                // Check for saved data first
                const savedData = localStorage.getItem('restalyze_data');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    setRestaurants(data.restaurants || []);
                    setSelectedRestaurant(data.selectedRestaurant || data.restaurants?.[0]);
                    setDailyData(data.dailyData || []);
                    setWeeklyData(data.weeklyData || []);
                    setMonthlyData(data.monthlyData || []);
                    setPromotions(data.promotions || []);
                    setNotifications(data.notifications || []);
                    
                    // üöÄ NEW: Load enhanced smart feature data
                    setPeakHours(data.peakHours || []);
                    setMenuPerformance(data.menuPerformance || []);
                    setCustomerRetention(data.customerRetention || {});
                    setDeliveryOptimization(data.deliveryOptimization || []);
                    setSmartAlerts(data.smartAlerts || []);
                    setPredictiveAnalytics(data.predictiveAnalytics || {});
                    setAiInsights(data.aiInsights || []);
                    setPerformanceScores(data.performanceScores || {});
                    setRealTimeData(data.realTimeData || []);
                } else {
                    initializeData();
                }
            }, []);

            // Save data to localStorage whenever it changes
            useEffect(() => {
                const data = {
                    restaurants,
                    selectedRestaurant,
                    dailyData,
                    weeklyData,
                    monthlyData,
                    promotions,
                    notifications,
                    // üöÄ NEW: Save enhanced smart feature data
                    peakHours,
                    menuPerformance,
                    customerRetention,
                    deliveryOptimization,
                    smartAlerts,
                    predictiveAnalytics,
                    aiInsights,
                    performanceScores,
                    realTimeData
                };
                localStorage.setItem('restalyze_data', JSON.stringify(data));
            }, [restaurants, selectedRestaurant, dailyData, weeklyData, monthlyData, promotions, notifications, peakHours, menuPerformance, customerRetention, deliveryOptimization, smartAlerts, predictiveAnalytics, aiInsights, performanceScores, realTimeData]);

            // üöÄ NEW: Enhanced restaurant management with logo upload
            const addRestaurant = (restaurantData) => {
                const newRestaurant = {
                    ...restaurantData,
                    id: utils.generateId(),
                    joinDate: new Date().toISOString().split('T')[0],
                    status: 'active',
                    branches: [],
                    targets: {
                        monthlyRevenue: 0,
                        profitMargin: 0,
                        customerSatisfaction: 0
                    }
                };
                setRestaurants(prev => [...prev, newRestaurant]);
                utils.showNotification('Restaurant added successfully', 'success');
                return newRestaurant;
            };

            const updateRestaurant = (id, updates) => {
                setRestaurants(prev => prev.map(r => 
                    r.id === id ? { ...r, ...updates } : r
                ));
                if (selectedRestaurant?.id === id) {
                    setSelectedRestaurant(prev => ({ ...prev, ...updates }));
                }
                utils.showNotification('Restaurant updated successfully', 'success');
            };

            const updateRestaurantLogo = (id, logoData) => {
                setRestaurants(prev => prev.map(r => 
                    r.id === id ? { ...r, customLogo: logoData } : r
                ));
                if (selectedRestaurant?.id === id) {
                    setSelectedRestaurant(prev => ({ ...prev, customLogo: logoData }));
                }
                utils.showNotification('Restaurant logo updated successfully', 'success');
            };

            // üöÄ NEW: AI Insights Management
            const addAIInsight = (insightData) => {
                const newInsight = {
                    ...insightData,
                    id: utils.generateId(),
                    timestamp: new Date().toISOString()
                };
                setAiInsights(prev => [newInsight, ...prev]);
                return newInsight;
            };

            // üöÄ NEW: Real-time Data Simulation
            useEffect(() => {
                const interval = setInterval(() => {
                    if (dailyData.length > 0) {
                        const simulatedData = utils.simulateRealTimeData(dailyData.slice(-10));
                        setRealTimeData(simulatedData);
                    }
                }, 5000); // Update every 5 seconds

                return () => clearInterval(interval);
            }, [dailyData]);

            const value = {
                // State
                restaurants,
                selectedRestaurant,
                dailyData,
                weeklyData,
                monthlyData,
                promotions,
                notifications,
                platforms: APP_CONFIG.supportedPlatforms,

                // üöÄ NEW: Enhanced smart feature data
                peakHours,
                menuPerformance,
                customerRetention,
                deliveryOptimization,
                smartAlerts,
                predictiveAnalytics,
                aiInsights,
                performanceScores,
                realTimeData,

                // üè¢ LEGENDARY: Branch Management
                selectedBranch,
                setSelectedBranch,
                branchData,

                // Setters
                setSelectedRestaurant,

                // Actions
                addRestaurant,
                updateRestaurant,
                updateRestaurantLogo,
                addAIInsight,

                // üè¢ LEGENDARY: Branch Management Functions
                addBranch: (restaurantId, branchData) => {
                    const newBranch = {
                        ...branchData,
                        id: utils.generateId(),
                        createdAt: new Date().toISOString(),
                        status: 'active',
                        performance: { orders: 0, revenue: 0, rating: 0 },
                        staff: branchData.staff || [],
                        operatingHours: branchData.operatingHours || {
                            monday: { open: '09:00', close: '22:00', closed: false },
                            tuesday: { open: '09:00', close: '22:00', closed: false },
                            wednesday: { open: '09:00', close: '22:00', closed: false },
                            thursday: { open: '09:00', close: '22:00', closed: false },
                            friday: { open: '09:00', close: '22:00', closed: false },
                            saturday: { open: '09:00', close: '22:00', closed: false },
                            sunday: { open: '09:00', close: '22:00', closed: false }
                        }
                    };

                    setRestaurants(prev => prev.map(r => {
                        if (r.id === restaurantId) {
                            const branches = r.branches || [];
                            return { ...r, branches: [...branches, newBranch] };
                        }
                        return r;
                    }));

                    utils.showNotification(`Branch "${newBranch.name}" added successfully!`, 'success');
                    return newBranch;
                },

                updateBranch: (restaurantId, branchId, updates) => {
                    setRestaurants(prev => prev.map(r => {
                        if (r.id === restaurantId) {
                            const branches = (r.branches || []).map(b =>
                                b.id === branchId ? { ...b, ...updates, updatedAt: new Date().toISOString() } : b
                            );
                            return { ...r, branches };
                        }
                        return r;
                    }));

                    if (selectedBranch?.id === branchId) {
                        setSelectedBranch(prev => ({ ...prev, ...updates }));
                    }

                    utils.showNotification('Branch updated successfully!', 'success');
                },

                deleteBranch: (restaurantId, branchId) => {
                    setRestaurants(prev => prev.map(r => {
                        if (r.id === restaurantId) {
                            const branches = (r.branches || []).filter(b => b.id !== branchId);
                            return { ...r, branches };
                        }
                        return r;
                    }));

                    if (selectedBranch?.id === branchId) {
                        setSelectedBranch(null);
                    }

                    utils.showNotification('Branch deleted successfully!', 'success');
                },

                toggleBranchStatus: (restaurantId, branchId) => {
                    setRestaurants(prev => prev.map(r => {
                        if (r.id === restaurantId) {
                            const branches = (r.branches || []).map(b => {
                                if (b.id === branchId) {
                                    const newStatus = b.status === 'active' ? 'inactive' : 'active';
                                    return { ...b, status: newStatus };
                                }
                                return b;
                            });
                            return { ...r, branches };
                        }
                        return r;
                    }));

                    utils.showNotification('Branch status updated!', 'success');
                },

                getBranchPerformance: (restaurantId, branchId) => {
                    // Filter data for specific branch
                    const branchDailyData = dailyData.filter(d =>
                        d.restaurant === restaurantId && d.branch === branchId
                    );

                    const totalRevenue = branchDailyData.reduce((sum, d) => sum + d.gmv, 0);
                    const totalOrders = branchDailyData.reduce((sum, d) => sum + d.orders, 0);
                    const totalCommission = branchDailyData.reduce((sum, d) => sum + d.commission, 0);
                    const netProfit = totalRevenue - totalCommission;

                    return {
                        revenue: totalRevenue,
                        orders: totalOrders,
                        commission: totalCommission,
                        netProfit,
                        profitMargin: totalRevenue > 0 ? (netProfit / totalRevenue) * 100 : 0,
                        avgOrderValue: totalOrders > 0 ? totalRevenue / totalOrders : 0
                    };
                },

                compareBranches: (restaurantId) => {
                    const restaurant = restaurants.find(r => r.id === restaurantId);
                    if (!restaurant || !restaurant.branches) return [];

                    return restaurant.branches.map(branch => ({
                        ...branch,
                        performance: value.getBranchPerformance(restaurantId, branch.id)
                    })).sort((a, b) => b.performance.revenue - a.performance.revenue);
                },

                getBranchLeaderboard: (restaurantId, metric = 'revenue') => {
                    const branches = value.compareBranches(restaurantId);
                    return branches.sort((a, b) => {
                        const aValue = a.performance[metric] || 0;
                        const bValue = b.performance[metric] || 0;
                        return bValue - aValue;
                    });
                },
                
                // Enhanced management functions
                addNotification: (notificationData) => {
                    const newNotification = {
                        ...notificationData,
                        id: utils.generateId(),
                        timestamp: new Date().toISOString(),
                        read: false
                    };
                    setNotifications(prev => [newNotification, ...prev]);
                    return newNotification;
                },
                markNotificationAsRead: (id) => {
                    setNotifications(prev => prev.map(n => 
                        n.id === id ? { ...n, read: true } : n
                    ));
                },
                markAllNotificationsAsRead: () => {
                    setNotifications(prev => prev.map(n => ({ ...n, read: true })));
                },
                getFinancialOverview: (restaurantId) => {
                    const restaurantData = dailyData.filter(d => d.restaurant === restaurantId);
                    const currentMonth = new Date().getMonth();
                    const currentYear = new Date().getFullYear();
                    
                    const monthlyData = restaurantData.filter(d => {
                        const date = new Date(d.date);
                        return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
                    });

                    const revenue = monthlyData.reduce((sum, d) => sum + d.gmv, 0);
                    const expenses = monthlyData.reduce((sum, d) => sum + d.expenses, 0);
                    const commission = monthlyData.reduce((sum, d) => sum + d.commission, 0);
                    const netProfit = revenue - expenses - commission;
                    
                    return {
                        revenue,
                        expenses,
                        commission,
                        netProfit,
                        profitMargin: utils.calculateProfitMargin(revenue, netProfit),
                        totalOrders: monthlyData.reduce((sum, d) => sum + d.orders, 0)
                    };
                }
            };

            return (
                <DataContext.Provider value={value}>
                    {children}
                </DataContext.Provider>
            );
        };

        const useData = () => {
            const context = useContext(DataContext);
            if (!context) throw new Error('useData must be used within DataProvider');
            return context;
        };

        // ==================== Legendary Components ====================

        // üöÄ NEW: Restaurant Logo Upload Component
        const RestaurantLogoUpload = ({ restaurant, onLogoUpdate }) => {
            const [isUploading, setIsUploading] = useState(false);
            const fileInputRef = useRef(null);

            const handleFileSelect = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                // Check if file is an image
                if (!file.type.startsWith('image/')) {
                    utils.showNotification('Please select an image file', 'error');
                    return;
                }

                // Check file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    utils.showNotification('Image size must be less than 5MB', 'error');
                    return;
                }

                setIsUploading(true);
                utils.handleImageUpload(file, (resizedImage) => {
                    onLogoUpdate(restaurant.id, resizedImage);
                    setIsUploading(false);
                    if (fileInputRef.current) {
                        fileInputRef.current.value = '';
                    }
                });
            };

            const handleRemoveLogo = () => {
                onLogoUpdate(restaurant.id, null);
            };

            return (
                <div className="space-y-4">
                    <div className="logo-upload-container" onClick={() => fileInputRef.current?.click()}>
                        {isUploading ? (
                            <div className="flex flex-col items-center">
                                <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-2"></div>
                                <p className="text-enhanced">Uploading...</p>
                            </div>
                        ) : restaurant.customLogo ? (
                            <div className="flex flex-col items-center">
                                <img 
                                    src={restaurant.customLogo} 
                                    alt={`${restaurant.name} logo`}
                                    className="logo-preview mb-2"
                                />
                                <p className="text-secondary text-sm">Click to change logo</p>
                            </div>
                        ) : (
                            <div className="flex flex-col items-center">
                                <div className="text-4xl mb-2">{restaurant.logo}</div>
                                <p className="text-enhanced font-medium mb-1">Upload Restaurant Logo</p>
                                <p className="text-secondary text-sm">Click to upload a custom logo</p>
                                <p className="text-secondary text-xs mt-1">Recommended: 200x200px, JPG or PNG</p>
                            </div>
                        )}
                    </div>
                    
                    <input
                        type="file"
                        ref={fileInputRef}
                        onChange={handleFileSelect}
                        accept="image/*"
                        className="hidden"
                    />
                    
                    {restaurant.customLogo && (
                        <button
                            onClick={handleRemoveLogo}
                            className="w-full py-2 bg-red-500/20 text-red-300 rounded-lg hover:bg-red-500/30 transition-colors"
                        >
                            Remove Custom Logo
                        </button>
                    )}
                </div>
            );
        };

        // üöÄ NEW: AI Insights Dashboard Component
        const AIInsightsDashboard = () => {
            const { aiInsights, selectedRestaurant, addAIInsight } = useData();
            const [selectedInsight, setSelectedInsight] = useState(null);

            const filteredInsights = aiInsights.filter(insight => 
                !selectedRestaurant || insight.restaurant === selectedRestaurant?.id
            );

            const getImpactColor = (impact) => {
                switch (impact) {
                    case 'high': return 'text-red-400';
                    case 'medium': return 'text-yellow-400';
                    case 'low': return 'text-green-400';
                    default: return 'text-gray-400';
                }
            };

            const getImpactBg = (impact) => {
                switch (impact) {
                    case 'high': return 'bg-red-500/20';
                    case 'medium': return 'bg-yellow-500/20';
                    case 'low': return 'bg-green-500/20';
                    default: return 'bg-gray-500/20';
                }
            };

            const generateNewInsight = () => {
                const newInsight = {
                    type: 'info',
                    title: 'AI-Generated Insight',
                    message: 'Based on recent performance data, we recommend optimizing your menu pricing during weekend evenings for maximum profitability.',
                    impact: 'medium',
                    action: 'Review weekend pricing strategy',
                    restaurant: selectedRestaurant?.id
                };
                addAIInsight(newInsight);
            };

            return (
                <div className="p-6 space-y-6">
                    <div className="glass-effect rounded-2xl p-6 hover-lift">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className="text-2xl font-bold text-enhanced">AI Insights Dashboard</h1>
                                <p className="text-secondary">Intelligent recommendations powered by machine learning</p>
                            </div>
                            <button
                                onClick={generateNewInsight}
                                className="flex items-center px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors btn-primary"
                            >
                                <span>ü§ñ</span>
                                <span className="ml-2">Generate Insight</span>
                            </button>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                            {filteredInsights.map(insight => (
                                <div 
                                    key={insight.id}
                                    className="ai-insight-card hover-lift cursor-pointer"
                                    onClick={() => setSelectedInsight(insight)}
                                >
                                    <div className="flex items-start justify-between mb-3">
                                        <span className={`px-3 py-1 rounded-full text-sm font-medium ${getImpactBg(insight.impact)} ${getImpactColor(insight.impact)}`}>
                                            {insight.impact.toUpperCase()} IMPACT
                                        </span>
                                        <span className="text-secondary text-sm">
                                            {utils.formatDateTime(insight.timestamp)}
                                        </span>
                                    </div>
                                    
                                    <h3 className="text-enhanced font-semibold text-lg mb-2">{insight.title}</h3>
                                    <p className="text-secondary text-sm mb-4">{insight.message}</p>
                                    
                                    <div className="flex items-center justify-between">
                                        <span className="text-enhanced text-sm font-medium">Recommended Action:</span>
                                        <span className="text-primary text-sm">{insight.action}</span>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {filteredInsights.length === 0 && (
                            <div className="text-center py-12">
                                <div className="text-6xl mb-4">ü§ñ</div>
                                <p className="text-enhanced text-lg">No AI insights available</p>
                                <p className="text-secondary">Generate your first insight to get started</p>
                            </div>
                        )}
                    </div>

                    {/* Insight Detail Modal */}
                    {selectedInsight && (
                        <div className="fixed inset-0 flex items-center justify-center z-50 modal-overlay">
                            <div className="bg-gray-800 rounded-xl p-6 max-w-2xl w-full mx-4 modal-content">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold text-enhanced">{selectedInsight.title}</h3>
                                    <button
                                        onClick={() => setSelectedInsight(null)}
                                        className="text-secondary hover:text-enhanced"
                                    >
                                        <span>‚úï</span>
                                    </button>
                                </div>
                                
                                <div className="space-y-4">
                                    <div className="flex items-center justify-between">
                                        <span className={`px-3 py-1 rounded-full text-sm font-medium ${getImpactBg(selectedInsight.impact)} ${getImpactColor(selectedInsight.impact)}`}>
                                            {selectedInsight.impact.toUpperCase()} IMPACT
                                        </span>
                                        <span className="text-secondary text-sm">
                                            {utils.formatDateTime(selectedInsight.timestamp)}
                                        </span>
                                    </div>
                                    
                                    <p className="text-enhanced">{selectedInsight.message}</p>
                                    
                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="text-enhanced font-semibold mb-2">Recommended Action</h4>
                                        <p className="text-primary">{selectedInsight.action}</p>
                                    </div>
                                    
                                    <div className="flex space-x-3">
                                        <button className="flex-1 bg-primary text-white py-2 px-4 rounded-lg hover:bg-primary/90 transition-colors btn-primary">
                                            Implement Action
                                        </button>
                                        <button 
                                            onClick={() => setSelectedInsight(null)}
                                            className="flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors"
                                        >
                                            Close
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // üöÄ NEW: Performance Score Dashboard
        const PerformanceScoreDashboard = () => {
            const { performanceScores, restaurants, selectedRestaurant } = useData();
            
            const currentScore = selectedRestaurant ? performanceScores[selectedRestaurant.id] : null;
            const allScores = Object.entries(performanceScores).map(([id, score]) => ({
                restaurant: restaurants.find(r => r.id === id),
                score
            }));

            const getScoreColor = (score) => {
                if (score >= 90) return 'text-green-400';
                if (score >= 80) return 'text-yellow-400';
                if (score >= 70) return 'text-orange-400';
                return 'text-red-400';
            };

            const getGradeColor = (grade) => {
                switch (grade) {
                    case 'A': return 'text-green-400';
                    case 'B': return 'text-yellow-400';
                    case 'C': return 'text-orange-400';
                    case 'D': return 'text-red-400';
                    default: return 'text-red-400';
                }
            };

            return (
                <div className="p-6 space-y-6">
                    <div className="glass-effect rounded-2xl p-6 hover-lift">
                        <h1 className="text-2xl font-bold text-enhanced mb-2">Performance Score Dashboard</h1>
                        <p className="text-secondary mb-6">Comprehensive performance scoring across all metrics</p>

                        {currentScore && (
                            <div className="mb-8">
                                <h3 className="text-lg font-semibold text-enhanced mb-4">Current Restaurant Performance</h3>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="performance-metric">
                                        <div className="text-4xl font-bold mb-2" style={{ color: getScoreColor(currentScore.score) }}>
                                            {currentScore.score}
                                        </div>
                                        <div className="text-enhanced">Overall Score</div>
                                    </div>
                                    <div className="performance-metric">
                                        <div className="text-4xl font-bold mb-2" style={{ color: getGradeColor(currentScore.grade) }}>
                                            {currentScore.grade}
                                        </div>
                                        <div className="text-enhanced">Performance Grade</div>
                                    </div>
                                    <div className="performance-metric">
                                        <div className="text-2xl font-bold mb-2 text-enhanced">
                                            {currentScore.breakdown.revenueGrowth}%
                                        </div>
                                        <div className="text-enhanced">Revenue Growth</div>
                                    </div>
                                </div>

                                {/* Breakdown Chart */}
                                <div className="mt-6 p-4 bg-white/5 rounded-xl">
                                    <h4 className="text-enhanced font-semibold mb-4">Performance Breakdown</h4>
                                    <div className="space-y-3">
                                        {Object.entries(currentScore.breakdown).map(([metric, value]) => (
                                            <div key={metric} className="flex items-center justify-between">
                                                <span className="text-enhanced capitalize">
                                                    {metric.replace(/([A-Z])/g, ' $1').trim()}
                                                </span>
                                                <div className="flex items-center space-x-3">
                                                    <div className="w-32 bg-white/20 rounded-full h-2">
                                                        <div 
                                                            className="bg-primary rounded-full h-2 progress-bar"
                                                            style={{ width: `${value}%` }}
                                                        ></div>
                                                    </div>
                                                    <span className="text-enhanced font-semibold w-12 text-right">
                                                        {value}%
                                                    </span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        <h3 className="text-lg font-semibold text-enhanced mb-4">All Restaurants Performance</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {allScores.map(({ restaurant, score }) => (
                                <div key={restaurant.id} className="border border-white/20 rounded-xl p-4 hover-lift bg-white/5">
                                    <div className="flex items-center space-x-3 mb-3">
                                        <div className="text-2xl">{restaurant.logo}</div>
                                        <div>
                                            <h4 className="text-enhanced font-semibold">{restaurant.name}</h4>
                                            <p className="text-secondary text-sm">{restaurant.type}</p>
                                        </div>
                                    </div>
                                    
                                    <div className="flex items-center justify-between mb-4">
                                        <div className="text-3xl font-bold" style={{ color: getScoreColor(score.score) }}>
                                            {score.score}
                                        </div>
                                        <div className="text-2xl font-bold" style={{ color: getGradeColor(score.grade) }}>
                                            {score.grade}
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-2">
                                        <div className="flex justify-between text-sm">
                                            <span className="text-secondary">Revenue Growth</span>
                                            <span className="text-enhanced">{score.breakdown.revenueGrowth}%</span>
                                        </div>
                                        <div className="flex justify-between text-sm">
                                            <span className="text-secondary">Profit Margin</span>
                                            <span className="text-enhanced">{score.breakdown.profitMargin}%</span>
                                        </div>
                                        <div className="flex justify-between text-sm">
                                            <span className="text-secondary">Customer Satisfaction</span>
                                            <span className="text-enhanced">{score.breakdown.customerSatisfaction}/5</span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // üöÄ NEW: Real-time Analytics Dashboard
        const RealTimeAnalytics = () => {
            const { realTimeData, selectedRestaurant } = useData();
            
            const filteredData = realTimeData.filter(d => 
                !selectedRestaurant || d.restaurant === selectedRestaurant?.id
            ).slice(-5); // Show last 5 entries

            const totalMetrics = useMemo(() => {
                return {
                    totalOrders: filteredData.reduce((sum, d) => sum + d.orders, 0),
                    totalRevenue: filteredData.reduce((sum, d) => sum + d.gmv, 0),
                    avgOrderValue: filteredData.reduce((sum, d) => sum + d.avgOrderValue, 0) / filteredData.length || 0
                };
            }, [filteredData]);

            return (
                <div className="p-6 space-y-6">
                    <div className="glass-effect rounded-2xl p-6 hover-lift">
                        <div className="flex items-center justify-between mb-6">
                            <div>
                                <h1 className="text-2xl font-bold text-enhanced">Real-time Analytics</h1>
                                <p className="text-secondary">Live performance data and metrics</p>
                            </div>
                            <div className="flex items-center space-x-2">
                                <div className="w-3 h-3 bg-green-500 rounded-full data-pulse"></div>
                                <span className="text-green-400 text-sm">Live</span>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div className="performance-metric data-pulse">
                                <div className="text-2xl font-bold text-enhanced mb-2">
                                    {utils.formatNumber(totalMetrics.totalOrders)}
                                </div>
                                <div className="text-secondary">Total Orders</div>
                            </div>
                            <div className="performance-metric data-pulse">
                                <div className="text-2xl font-bold text-enhanced mb-2">
                                    {utils.formatCurrency(totalMetrics.totalRevenue)}
                                </div>
                                <div className="text-secondary">Total Revenue</div>
                            </div>
                            <div className="performance-metric data-pulse">
                                <div className="text-2xl font-bold text-enhanced mb-2">
                                    {utils.formatCurrency(totalMetrics.avgOrderValue)}
                                </div>
                                <div className="text-secondary">Avg Order Value</div>
                            </div>
                        </div>

                        <h3 className="text-lg font-semibold text-enhanced mb-4">Recent Activity</h3>
                        <div className="space-y-3">
                            {filteredData.map((data, index) => (
                                <div key={index} className="flex items-center justify-between p-3 bg-white/5 rounded-lg data-pulse">
                                    <div className="flex items-center space-x-3">
                                        <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                        <span className="text-enhanced">
                                            {utils.formatNumber(data.orders)} orders
                                        </span>
                                    </div>
                                    <div className="text-secondary text-sm">
                                        {utils.formatCurrency(data.gmv)} ‚Ä¢ {data.platform}
                                    </div>
                                    <div className="text-secondary text-sm">
                                        {new Date(data.timestamp).toLocaleTimeString()}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {filteredData.length === 0 && (
                            <div className="text-center py-8">
                                <div className="text-4xl mb-4">üìä</div>
                                <p className="text-enhanced">No real-time data available</p>
                                <p className="text-secondary">Data will appear here as it comes in</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // üöÄ ENHANCED: Advanced Analytics Dashboard with Charts
        const AdvancedAnalyticsDashboard = () => {
            const { selectedRestaurant, weeklyData, monthlyData, platforms } = useData();
            const [timeRange, setTimeRange] = useState('weekly');
            const [selectedMetric, setSelectedMetric] = useState('revenue');

            const analyticsData = useMemo(() => {
                if (!selectedRestaurant) return { summary: {}, platformBreakdown: [], timeSeries: [], trends: {} };

                const data = timeRange === 'weekly' ? weeklyData : monthlyData;
                const filteredData = data.filter(d => d.restaurant === selectedRestaurant.id);
                
                // Enhanced analytics calculations
                const summary = {
                    totalRevenue: filteredData.reduce((sum, d) => sum + d.gmv, 0),
                    totalOrders: filteredData.reduce((sum, d) => sum + d.orders, 0),
                    totalCommission: filteredData.reduce((sum, d) => sum + d.commission, 0),
                    totalExpenses: filteredData.reduce((sum, d) => sum + d.expenses, 0),
                    netProfit: filteredData.reduce((sum, d) => sum + d.netProfit, 0)
                };

                summary.profitMargin = utils.calculateProfitMargin(summary.totalRevenue, summary.netProfit);
                summary.avgOrderValue = summary.totalOrders > 0 ? summary.totalRevenue / summary.totalOrders : 0;

                // Platform breakdown with advanced metrics
                const platformBreakdown = platforms.map(platform => {
                    const platformData = filteredData.filter(d => d.platform === platform.id);
                    const revenue = platformData.reduce((sum, d) => sum + d.gmv, 0);
                    const orders = platformData.reduce((sum, d) => sum + d.orders, 0);
                    const commission = platformData.reduce((sum, d) => sum + d.commission, 0);
                    const netProfit = platformData.reduce((sum, d) => sum + d.netProfit, 0);
                    const profitMargin = utils.calculateProfitMargin(revenue, netProfit);
                    const marketShare = summary.totalRevenue > 0 ? (revenue / summary.totalRevenue) * 100 : 0;
                    const avgOrderValue = orders > 0 ? revenue / orders : 0;

                    return {
                        ...platform,
                        revenue,
                        orders,
                        commission,
                        netProfit,
                        profitMargin,
                        marketShare: marketShare.toFixed(1),
                        avgOrderValue
                    };
                }).filter(p => p.orders > 0);

                // Time series analysis
                const timeSeries = filteredData.reduce((acc, item) => {
                    const period = timeRange === 'weekly' ? item.week : item.month;
                    if (!acc[period]) {
                        acc[period] = {
                            period,
                            revenue: 0,
                            orders: 0,
                            profit: 0,
                            commission: 0
                        };
                    }
                    acc[period].revenue += item.gmv;
                    acc[period].orders += item.orders;
                    acc[period].profit += item.netProfit;
                    acc[period].commission += item.commission;
                    return acc;
                }, {});

                return {
                    summary,
                    platformBreakdown,
                    timeSeries: Object.values(timeSeries).sort((a, b) => a.period.localeCompare(b.period)),
                    trends: utils.analyzePerformanceTrends(filteredData)
                };
            }, [timeRange, weeklyData, monthlyData, selectedRestaurant, platforms]);

            // üöÄ NEW: Simple SVG Chart Implementation
            const renderSimpleChart = (data, metric, color) => {
                if (!data || data.length === 0) return null;

                const values = data.map(d => d[metric]);
                const maxValue = Math.max(...values);
                const minValue = Math.min(...values);
                const range = maxValue - minValue || 1;

                const chartHeight = 200;
                const chartWidth = '100%';
                const barWidth = Math.max(20, 400 / data.length);

                return (
                    <div className="analytics-chart">
                        <svg width={chartWidth} height={chartHeight} className="w-full">
                            {data.map((item, index) => {
                                const value = item[metric];
                                const height = ((value - minValue) / range) * (chartHeight - 40);
                                const x = index * (barWidth + 5);
                                const y = chartHeight - height - 20;

                                return (
                                    <g key={index}>
                                        <rect
                                            x={x}
                                            y={y}
                                            width={barWidth}
                                            height={height}
                                            fill={color}
                                            opacity="0.7"
                                        />
                                        <text
                                            x={x + barWidth / 2}
                                            y={chartHeight - 5}
                                            textAnchor="middle"
                                            fontSize="10"
                                            fill="currentColor"
                                            className="text-secondary"
                                        >
                                            {timeRange === 'weekly' ? `W${index + 1}` : item.period.split('-')[1]}
                                        </text>
                                        <text
                                            x={x + barWidth / 2}
                                            y={y - 5}
                                            textAnchor="middle"
                                            fontSize="10"
                                            fill="currentColor"
                                            className="text-enhanced"
                                        >
                                            {metric === 'revenue' || metric === 'profit' ? 
                                                utils.formatCurrency(value).replace('$', '') : 
                                                utils.formatNumber(value)
                                            }
                                        </text>
                                    </g>
                                );
                            })}
                        </svg>
                    </div>
                );
            };

            if (!selectedRestaurant) {
                return (
                    <div className="p-6">
                        <div className="glass-effect rounded-2xl p-12 text-center">
                            <div className="text-4xl mb-4">üìä</div>
                            <p className="text-enhanced text-lg">No restaurant selected</p>
                            <p className="text-secondary">Please select a restaurant to view analytics</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="p-6 space-y-6">
                    <div className="glass-effect rounded-2xl p-6 hover-lift">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className="text-2xl font-bold text-enhanced">Advanced Analytics Dashboard</h1>
                                <p className="text-secondary">Comprehensive performance insights for {selectedRestaurant?.name}</p>
                            </div>
                            <div className="flex space-x-3">
                                <select 
                                    value={timeRange}
                                    onChange={(e) => setTimeRange(e.target.value)}
                                    className="enhanced-dropdown px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                                >
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                                <select 
                                    value={selectedMetric}
                                    onChange={(e) => setSelectedMetric(e.target.value)}
                                    className="enhanced-dropdown px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                                >
                                    <option value="revenue">Revenue</option>
                                    <option value="orders">Orders</option>
                                    <option value="profit">Profit</option>
                                </select>
                            </div>
                        </div>

                        {/* Enhanced KPI Cards */}
                        <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                            <div className="bg-primary/20 p-4 rounded-lg border border-primary/30">
                                <p className="text-sm text-primary-200 font-medium">Total Revenue</p>
                                <p className="text-2xl font-bold text-enhanced mt-1">{utils.formatCurrency(analyticsData.summary.totalRevenue)}</p>
                                <p className="text-xs text-primary-200 mt-1">{utils.formatNumber(analyticsData.summary.totalOrders)} orders</p>
                            </div>
                            <div className="bg-green-500/20 p-4 rounded-lg border border-green-500/30">
                                <p className="text-sm text-green-200 font-medium">Net Profit</p>
                                <p className="text-2xl font-bold text-enhanced mt-1">{utils.formatCurrency(analyticsData.summary.netProfit)}</p>
                                <p className="text-xs text-green-200 mt-1">{analyticsData.summary.profitMargin.toFixed(1)}% margin</p>
                            </div>
                            <div className="bg-orange-500/20 p-4 rounded-lg border border-orange-500/30">
                                <p className="text-sm text-orange-200 font-medium">Total Commissions</p>
                                <p className="text-2xl font-bold text-enhanced mt-1">{utils.formatCurrency(analyticsData.summary.totalCommission)}</p>
                                <p className="text-xs text-orange-200 mt-1">{((analyticsData.summary.totalCommission / analyticsData.summary.totalRevenue) * 100).toFixed(1)}% of revenue</p>
                            </div>
                            <div className="bg-purple-500/20 p-4 rounded-lg border border-purple-500/30">
                                <p className="text-sm text-purple-200 font-medium">Avg Order Value</p>
                                <p className="text-2xl font-bold text-enhanced mt-1">{utils.formatCurrency(analyticsData.summary.avgOrderValue)}</p>
                                <p className="text-xs text-purple-200 mt-1">per order</p>
                            </div>
                        </div>

                        {/* üöÄ NEW: Interactive Charts */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                            <div className="analytics-chart">
                                <h3 className="text-enhanced font-semibold mb-4">Revenue Trend</h3>
                                {renderSimpleChart(analyticsData.timeSeries, 'revenue', '#0ea5e9')}
                            </div>
                            <div className="analytics-chart">
                                <h3 className="text-enhanced font-semibold mb-4">Order Volume</h3>
                                {renderSimpleChart(analyticsData.timeSeries, 'orders', '#10b981')}
                            </div>
                        </div>

                        {/* Platform Performance */}
                        <h3 className="text-lg font-semibold text-enhanced mb-4">Platform Performance Analysis</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {analyticsData.platformBreakdown.map(platform => (
                                <div key={platform.id} className="border border-white/20 rounded-xl p-4 hover-lift bg-white/5">
                                    <div className="flex items-center justify-between mb-3">
                                        <div className="flex items-center">
                                            <div 
                                                className="w-3 h-3 rounded-full mr-2"
                                                style={{ backgroundColor: platform.color }}
                                            ></div>
                                            <span className="font-semibold text-enhanced">{platform.name}</span>
                                        </div>
                                        <span className="text-sm text-secondary">{platform.marketShare}% share</span>
                                    </div>
                                    <div className="space-y-2">
                                        <div className="flex justify-between text-sm">
                                            <span className="text-secondary">Revenue:</span>
                                            <span className="text-enhanced font-semibold">{utils.formatCurrency(platform.revenue)}</span>
                                        </div>
                                        <div className="flex justify-between text-sm">
                                            <span className="text-secondary">Orders:</span>
                                            <span className="text-enhanced font-semibold">{utils.formatNumber(platform.orders)}</span>
                                        </div>
                                        <div className="flex justify-between text-sm">
                                            <span className="text-secondary">Profit Margin:</span>
                                            <span className={`font-semibold ${
                                                platform.profitMargin >= 15 ? 'text-green-300' :
                                                platform.profitMargin >= 10 ? 'text-yellow-300' : 'text-red-300'
                                            }`}>
                                                {platform.profitMargin.toFixed(1)}%
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Performance Trends */}
                        {analyticsData.trends && (
                            <div className="mt-8 p-6 bg-white/5 rounded-xl">
                                <h3 className="text-lg font-semibold text-enhanced mb-4">Performance Trends</h3>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className="text-center">
                                        <div className={`text-2xl font-bold ${
                                            analyticsData.trends.revenueGrowth > 0 ? 'text-green-400' : 'text-red-400'
                                        }`}>
                                            {analyticsData.trends.revenueGrowth > 0 ? '+' : ''}{analyticsData.trends.revenueGrowth.toFixed(1)}%
                                        </div>
                                        <div className="text-secondary text-sm">Revenue Growth</div>
                                    </div>
                                    <div className="text-center">
                                        <div className={`text-2xl font-bold ${
                                            analyticsData.trends.orderGrowth > 0 ? 'text-green-400' : 'text-red-400'
                                        }`}>
                                            {analyticsData.trends.orderGrowth > 0 ? '+' : ''}{analyticsData.trends.orderGrowth.toFixed(1)}%
                                        </div>
                                        <div className="text-secondary text-sm">Order Growth</div>
                                    </div>
                                    <div className="text-center">
                                        <div className={`text-2xl font-bold ${
                                            analyticsData.trends.profitGrowth > 0 ? 'text-green-400' : 'text-red-400'
                                        }`}>
                                            {analyticsData.trends.profitGrowth > 0 ? '+' : ''}{analyticsData.trends.profitGrowth.toFixed(1)}%
                                        </div>
                                        <div className="text-secondary text-sm">Profit Growth</div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // üöÄ ENHANCED: Restaurant Management with Logo Upload
        // ‚≠ê LEGENDARY: Full CRUD Restaurant Management System
        const RestaurantManagement = () => {
            const { restaurants, selectedRestaurant, setSelectedRestaurant, updateRestaurant, updateRestaurantLogo, addRestaurant } = useData();
            const [showAddForm, setShowAddForm] = useState(false);
            const [showEditForm, setShowEditForm] = useState(false);
            const [showLogoModal, setShowLogoModal] = useState(false);
            const [deletingRestaurant, setDeletingRestaurant] = useState(null);
            const [currentRestaurant, setCurrentRestaurant] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                type: '',
                city: '',
                owner: '',
                phone: '',
                description: '',
                platforms: [],
                minimumMargin: 10,
                avgOrderValue: 0,
                customerSatisfaction: 0,
                deliveryTime: 0,
                repeatCustomers: 0
            });

            // Initialize form data for editing
            const initializeEditForm = (restaurant) => {
                setFormData({
                    name: restaurant.name || '',
                    type: restaurant.type || '',
                    city: restaurant.branches?.[0]?.city || '',
                    owner: restaurant.owner || '',
                    phone: restaurant.phone || '',
                    description: restaurant.description || '',
                    platforms: restaurant.platforms || [],
                    minimumMargin: restaurant.minimumMargin || 10,
                    avgOrderValue: restaurant.performanceStats?.avgOrderValue || 0,
                    customerSatisfaction: restaurant.performanceStats?.customerSatisfaction || 0,
                    deliveryTime: restaurant.performanceStats?.deliveryTime || 0,
                    repeatCustomers: restaurant.performanceStats?.repeatCustomers || 0
                });
                setCurrentRestaurant(restaurant);
                setShowEditForm(true);
            };

            // Reset form data
            const resetForm = () => {
                setFormData({
                    name: '',
                    type: '',
                    city: '',
                    owner: '',
                    phone: '',
                    description: '',
                    platforms: [],
                    minimumMargin: 10,
                    avgOrderValue: 0,
                    customerSatisfaction: 0,
                    deliveryTime: 0,
                    repeatCustomers: 0
                });
                setCurrentRestaurant(null);
            };

            // Handle Add Restaurant
            const handleAddRestaurant = () => {
                if (!formData.name || !formData.type || !formData.city) {
                    utils.showNotification('Please fill all required fields (Name, Type, City)', 'error');
                    return;
                }

                if (formData.platforms.length === 0) {
                    utils.showNotification('Please select at least one delivery platform', 'error');
                    return;
                }

                const restaurantData = {
                    name: formData.name,
                    type: formData.type,
                    logo: formData.type === 'Burgers' ? 'üçî' :
                         formData.type === 'Pizza' ? 'üçï' :
                         formData.type === 'Shawarma' ? 'üåØ' :
                         formData.type === 'Seafood' ? 'ü¶ê' :
                         formData.type === 'Coffee Shop' ? '‚òï' :
                         formData.type === 'Fine Dining' ? 'üçΩÔ∏è' :
                         formData.type === 'Fast Food' ? 'üçü' :
                         formData.type === 'Cafe' ? '‚òï' :
                         formData.type === 'Bakery' ? 'ü•ê' :
                         formData.type === 'Desserts' ? 'üç∞' : 'üçΩÔ∏è',
                    customLogo: null,
                    owner: formData.owner || 'Restaurant Owner',
                    phone: formData.phone || '+966500000000',
                    description: formData.description || `${formData.type} restaurant in ${formData.city}`,
                    establishedDate: new Date().toISOString().split('T')[0],
                    minimumMargin: formData.minimumMargin,
                    platforms: formData.platforms,
                    branches: [
                        {
                            id: utils.generateId(),
                            name: 'Main Branch',
                            city: formData.city,
                            capacity: 50,
                            address: `${formData.city}, Saudi Arabia`,
                            status: 'active',
                            performance: { orders: 0, revenue: 0, rating: 0 }
                        }
                    ],
                    targets: {
                        monthlyRevenue: 100000,
                        profitMargin: formData.minimumMargin,
                        customerSatisfaction: 4.5
                    },
                    performanceStats: {
                        avgOrderValue: formData.avgOrderValue || 25,
                        customerSatisfaction: formData.customerSatisfaction || 4.5,
                        deliveryTime: formData.deliveryTime || 35,
                        repeatCustomers: formData.repeatCustomers || 40
                    }
                };

                addRestaurant(restaurantData);
                utils.showNotification(`${restaurantData.name} added successfully!`, 'success');
                setShowAddForm(false);
                resetForm();
            };

            // Handle Edit Restaurant
            const handleEditRestaurant = () => {
                if (!currentRestaurant) return;

                if (!formData.name || !formData.type || !formData.city) {
                    utils.showNotification('Please fill all required fields (Name, Type, City)', 'error');
                    return;
                }

                if (formData.platforms.length === 0) {
                    utils.showNotification('Please select at least one delivery platform', 'error');
                    return;
                }

                const updates = {
                    name: formData.name,
                    type: formData.type,
                    owner: formData.owner,
                    phone: formData.phone,
                    description: formData.description,
                    platforms: formData.platforms,
                    minimumMargin: formData.minimumMargin,
                    branches: currentRestaurant.branches ? [
                        {
                            ...currentRestaurant.branches[0],
                            city: formData.city,
                            address: `${formData.city}, Saudi Arabia`
                        }
                    ] : [{
                        id: utils.generateId(),
                        name: 'Main Branch',
                        city: formData.city,
                        capacity: 50,
                        address: `${formData.city}, Saudi Arabia`,
                        status: 'active',
                        performance: { orders: 0, revenue: 0, rating: 0 }
                    }],
                    performanceStats: {
                        avgOrderValue: formData.avgOrderValue,
                        customerSatisfaction: formData.customerSatisfaction,
                        deliveryTime: formData.deliveryTime,
                        repeatCustomers: formData.repeatCustomers
                    }
                };

                updateRestaurant(currentRestaurant.id, updates);
                utils.showNotification(`${formData.name} updated successfully!`, 'success');
                setShowEditForm(false);
                resetForm();
            };

            // Handle Delete Restaurant
            const handleDeleteRestaurant = (restaurant) => {
                setDeletingRestaurant(restaurant);
            };

            const confirmDelete = () => {
                if (!deletingRestaurant) return;

                utils.showConfirmation(
                    `Are you sure you want to permanently delete "${deletingRestaurant.name}"? This action cannot be undone.`,
                    () => {
                        // In a real app, this would call an API to delete
                        // For now, we'll use deactivate functionality
                        updateRestaurant(deletingRestaurant.id, { status: 'deleted' });
                        utils.showNotification(`${deletingRestaurant.name} has been deleted`, 'success');
                        setDeletingRestaurant(null);
                    },
                    () => {
                        setDeletingRestaurant(null);
                    }
                );
            };

            // Handle Deactivate/Activate Restaurant
            const toggleRestaurantStatus = (restaurant) => {
                const newStatus = restaurant.status === 'active' ? 'inactive' : 'active';
                const action = newStatus === 'active' ? 'activated' : 'deactivated';

                updateRestaurant(restaurant.id, { status: newStatus });
                utils.showNotification(`${restaurant.name} has been ${action}`, 'success');
            };

            // Form Component
            const RestaurantForm = ({ isEdit = false }) => (
                <div className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-enhanced text-sm font-medium mb-2">Restaurant Name *</label>
                            <input
                                type="text"
                                value={formData.name}
                                onChange={(e) => setFormData(prev => ({...prev, name: e.target.value}))}
                                className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                placeholder="Enter restaurant name"
                            />
                        </div>

                        <div>
                            <label className="block text-enhanced text-sm font-medium mb-2">Restaurant Type *</label>
                            <select
                                value={formData.type}
                                onChange={(e) => setFormData(prev => ({...prev, type: e.target.value}))}
                                className="enhanced-dropdown w-full px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                            >
                                <option value="">Select type</option>
                                {APP_CONFIG.restaurantTypes.map(type => (
                                    <option key={type} value={type}>{type}</option>
                                ))}
                            </select>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-enhanced text-sm font-medium mb-2">City *</label>
                            <select
                                value={formData.city}
                                onChange={(e) => setFormData(prev => ({...prev, city: e.target.value}))}
                                className="enhanced-dropdown w-full px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                            >
                                <option value="">Select city</option>
                                {APP_CONFIG.cities.map(city => (
                                    <option key={city} value={city}>{city}</option>
                                ))}
                            </select>
                        </div>

                        <div>
                            <label className="block text-enhanced text-sm font-medium mb-2">Owner Name</label>
                            <input
                                type="text"
                                value={formData.owner}
                                onChange={(e) => setFormData(prev => ({...prev, owner: e.target.value}))}
                                className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                placeholder="Enter owner name"
                            />
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-enhanced text-sm font-medium mb-2">Phone Number</label>
                            <input
                                type="tel"
                                value={formData.phone}
                                onChange={(e) => setFormData(prev => ({...prev, phone: e.target.value}))}
                                className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                placeholder="+966..."
                            />
                        </div>

                        <div>
                            <label className="block text-enhanced text-sm font-medium mb-2">Minimum Margin (%)</label>
                            <input
                                type="number"
                                value={formData.minimumMargin}
                                onChange={(e) => setFormData(prev => ({...prev, minimumMargin: parseFloat(e.target.value) || 0}))}
                                className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                placeholder="10"
                                min="0"
                                max="100"
                            />
                        </div>
                    </div>

                    <div>
                        <label className="block text-enhanced text-sm font-medium mb-2">Description</label>
                        <textarea
                            value={formData.description}
                            onChange={(e) => setFormData(prev => ({...prev, description: e.target.value}))}
                            className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                            placeholder="Enter restaurant description"
                            rows="2"
                        />
                    </div>

                    <div>
                        <label className="block text-enhanced text-sm font-medium mb-2">Delivery Platforms *</label>
                        <div className="grid grid-cols-2 gap-2 max-h-32 overflow-y-auto p-2 bg-white/5 rounded-lg">
                            {APP_CONFIG.supportedPlatforms.map(platform => (
                                <label key={platform.id} className="flex items-center space-x-2">
                                    <input
                                        type="checkbox"
                                        checked={formData.platforms.includes(platform.id)}
                                        onChange={(e) => {
                                            const updatedPlatforms = e.target.checked
                                                ? [...formData.platforms, platform.id]
                                                : formData.platforms.filter(p => p !== platform.id);
                                            setFormData(prev => ({...prev, platforms: updatedPlatforms}));
                                        }}
                                        className="rounded border-white/20 bg-white/10 text-primary focus:ring-primary/50"
                                    />
                                    <span className="text-enhanced text-sm">{platform.name}</span>
                                </label>
                            ))}
                        </div>
                    </div>

                    {isEdit && (
                        <div className="border-t border-white/20 pt-4">
                            <h4 className="text-enhanced font-semibold mb-3">Performance Stats</h4>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-enhanced text-sm font-medium mb-2">Avg Order Value</label>
                                    <input
                                        type="number"
                                        value={formData.avgOrderValue}
                                        onChange={(e) => setFormData(prev => ({...prev, avgOrderValue: parseFloat(e.target.value) || 0}))}
                                        className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                        placeholder="25.00"
                                        min="0"
                                        step="0.01"
                                    />
                                </div>

                                <div>
                                    <label className="block text-enhanced text-sm font-medium mb-2">Customer Rating</label>
                                    <input
                                        type="number"
                                        value={formData.customerSatisfaction}
                                        onChange={(e) => setFormData(prev => ({...prev, customerSatisfaction: parseFloat(e.target.value) || 0}))}
                                        className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                        placeholder="4.5"
                                        min="0"
                                        max="5"
                                        step="0.1"
                                    />
                                </div>

                                <div>
                                    <label className="block text-enhanced text-sm font-medium mb-2">Delivery Time (min)</label>
                                    <input
                                        type="number"
                                        value={formData.deliveryTime}
                                        onChange={(e) => setFormData(prev => ({...prev, deliveryTime: parseInt(e.target.value) || 0}))}
                                        className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                        placeholder="35"
                                        min="0"
                                    />
                                </div>

                                <div>
                                    <label className="block text-enhanced text-sm font-medium mb-2">Repeat Customers (%)</label>
                                    <input
                                        type="number"
                                        value={formData.repeatCustomers}
                                        onChange={(e) => setFormData(prev => ({...prev, repeatCustomers: parseInt(e.target.value) || 0}))}
                                        className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                        placeholder="40"
                                        min="0"
                                        max="100"
                                    />
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );

            // Trigger delete confirmation when deletingRestaurant is set
            useEffect(() => {
                if (deletingRestaurant) {
                    confirmDelete();
                }
            }, [deletingRestaurant]);

            return (
                <div className="p-6 space-y-6">
                    <div className="glass-effect rounded-2xl p-6 hover-lift">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className="text-2xl font-bold text-enhanced mb-2">Legendary Restaurant Management</h1>
                                <p className="text-secondary">Complete CRUD management for your restaurant portfolio</p>
                            </div>
                            <button
                                onClick={() => {
                                    resetForm();
                                    setShowAddForm(true);
                                }}
                                className="flex items-center px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors btn-primary"
                            >
                                <span>‚ûï</span>
                                <span className="ml-2">Add Restaurant</span>
                            </button>
                        </div>

                        {/* Statistics Overview */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div className="bg-primary/20 rounded-lg p-4 border border-primary/30">
                                <div className="text-primary text-sm font-medium">Total Restaurants</div>
                                <div className="text-2xl font-bold text-enhanced mt-1">{restaurants.length}</div>
                            </div>
                            <div className="bg-green-500/20 rounded-lg p-4 border border-green-500/30">
                                <div className="text-green-300 text-sm font-medium">Active</div>
                                <div className="text-2xl font-bold text-enhanced mt-1">
                                    {restaurants.filter(r => r.status === 'active').length}
                                </div>
                            </div>
                            <div className="bg-yellow-500/20 rounded-lg p-4 border border-yellow-500/30">
                                <div className="text-yellow-300 text-sm font-medium">Inactive</div>
                                <div className="text-2xl font-bold text-enhanced mt-1">
                                    {restaurants.filter(r => r.status === 'inactive').length}
                                </div>
                            </div>
                            <div className="bg-purple-500/20 rounded-lg p-4 border border-purple-500/30">
                                <div className="text-purple-300 text-sm font-medium">Cities Covered</div>
                                <div className="text-2xl font-bold text-enhanced mt-1">
                                    {new Set(restaurants.map(r => r.branches?.[0]?.city || '')).size}
                                </div>
                            </div>
                        </div>

                        {/* Restaurant Cards Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {restaurants.filter(r => r.status !== 'deleted').map(restaurant => (
                                <div
                                    key={restaurant.id}
                                    className={`restaurant-card glass-effect rounded-xl p-6 ${
                                        selectedRestaurant?.id === restaurant.id ? 'active' : ''
                                    } ${restaurant.status === 'inactive' ? 'opacity-60' : ''}`}
                                    onClick={() => setSelectedRestaurant(restaurant)}
                                >
                                    <div className="flex items-center justify-between mb-4">
                                        <div className="flex items-center space-x-3">
                                            {restaurant.customLogo ? (
                                                <img
                                                    src={restaurant.customLogo}
                                                    alt={`${restaurant.name} logo`}
                                                    className="w-12 h-12 rounded-lg object-cover"
                                                />
                                            ) : (
                                                <div className="text-3xl">{restaurant.logo}</div>
                                            )}
                                            <div>
                                                <h3 className="text-enhanced font-semibold">{restaurant.name}</h3>
                                                <p className="text-secondary text-sm">{restaurant.type} ‚Ä¢ {restaurant.branches?.[0]?.city || 'No city'}</p>
                                            </div>
                                        </div>
                                        <div className={`w-3 h-3 rounded-full ${
                                            restaurant.status === 'active' ? 'bg-green-500' :
                                            restaurant.status === 'inactive' ? 'bg-yellow-500' : 'bg-red-500'
                                        }`}></div>
                                    </div>

                                    <div className="space-y-2 mb-4">
                                        <div className="flex justify-between text-sm">
                                            <span className="text-secondary">Owner:</span>
                                            <span className="text-enhanced font-semibold">{restaurant.owner || 'N/A'}</span>
                                        </div>
                                        <div className="flex justify-between text-sm">
                                            <span className="text-secondary">Avg Order Value:</span>
                                            <span className="text-enhanced font-semibold">
                                                {utils.formatCurrency(restaurant.performanceStats?.avgOrderValue || 0)}
                                            </span>
                                        </div>
                                        <div className="flex justify-between text-sm">
                                            <span className="text-secondary">Rating:</span>
                                            <span className="text-enhanced font-semibold">
                                                {restaurant.performanceStats?.customerSatisfaction || 0}/5
                                            </span>
                                        </div>
                                        <div className="flex justify-between text-sm">
                                            <span className="text-secondary">Delivery Time:</span>
                                            <span className="text-enhanced font-semibold">
                                                {restaurant.performanceStats?.deliveryTime || 0} min
                                            </span>
                                        </div>
                                    </div>

                                    <div className="flex flex-wrap gap-1 mb-4">
                                        {restaurant.platforms.map(platformId => {
                                            const platform = APP_CONFIG.supportedPlatforms.find(p => p.id === platformId);
                                            return platform ? (
                                                <span
                                                    key={platform.id}
                                                    className="px-2 py-1 text-xs rounded-full text-white"
                                                    style={{ backgroundColor: platform.color }}
                                                >
                                                    {platform.name}
                                                </span>
                                            ) : null;
                                        })}
                                    </div>

                                    <div className="grid grid-cols-2 gap-2">
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                initializeEditForm(restaurant);
                                            }}
                                            className="flex items-center justify-center py-2 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg transition-colors text-enhanced text-sm border border-blue-500/30"
                                        >
                                            <span>‚úèÔ∏è</span>
                                            <span className="ml-1">Edit</span>
                                        </button>
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                setCurrentRestaurant(restaurant);
                                                setShowLogoModal(true);
                                            }}
                                            className="flex items-center justify-center py-2 bg-purple-500/20 hover:bg-purple-500/30 rounded-lg transition-colors text-enhanced text-sm border border-purple-500/30"
                                        >
                                            <span>üñºÔ∏è</span>
                                            <span className="ml-1">Logo</span>
                                        </button>
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                toggleRestaurantStatus(restaurant);
                                            }}
                                            className={`flex items-center justify-center py-2 ${
                                                restaurant.status === 'active'
                                                    ? 'bg-yellow-500/20 hover:bg-yellow-500/30 border-yellow-500/30'
                                                    : 'bg-green-500/20 hover:bg-green-500/30 border-green-500/30'
                                            } rounded-lg transition-colors text-enhanced text-sm border`}
                                        >
                                            <span>{restaurant.status === 'active' ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}</span>
                                            <span className="ml-1">{restaurant.status === 'active' ? 'Deactivate' : 'Activate'}</span>
                                        </button>
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                handleDeleteRestaurant(restaurant);
                                            }}
                                            className="flex items-center justify-center py-2 bg-red-500/20 hover:bg-red-500/30 rounded-lg transition-colors text-enhanced text-sm border border-red-500/30"
                                        >
                                            <span>üóëÔ∏è</span>
                                            <span className="ml-1">Delete</span>
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {restaurants.filter(r => r.status !== 'deleted').length === 0 && (
                            <div className="text-center py-12">
                                <div className="text-6xl mb-4">üçΩÔ∏è</div>
                                <p className="text-enhanced text-lg mb-2">No restaurants yet</p>
                                <p className="text-secondary">Click "Add Restaurant" to get started</p>
                            </div>
                        )}
                    </div>

                    {/* Add Restaurant Modal */}
                    {showAddForm && (
                        <div className="fixed inset-0 flex items-center justify-center z-50 modal-overlay">
                            <div className="bg-gray-800 rounded-xl p-6 max-w-2xl w-full mx-4 modal-content max-h-[90vh] overflow-y-auto">
                                <h3 className="text-lg font-semibold text-enhanced mb-4">Add New Restaurant</h3>

                                <RestaurantForm isEdit={false} />

                                <div className="flex space-x-3 mt-6">
                                    <button
                                        onClick={handleAddRestaurant}
                                        className="flex-1 bg-primary text-white py-2 px-4 rounded-lg hover:bg-primary/90 transition-colors btn-primary"
                                    >
                                        Add Restaurant
                                    </button>
                                    <button
                                        onClick={() => {
                                            setShowAddForm(false);
                                            resetForm();
                                        }}
                                        className="flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Edit Restaurant Modal */}
                    {showEditForm && (
                        <div className="fixed inset-0 flex items-center justify-center z-50 modal-overlay">
                            <div className="bg-gray-800 rounded-xl p-6 max-w-2xl w-full mx-4 modal-content max-h-[90vh] overflow-y-auto">
                                <h3 className="text-lg font-semibold text-enhanced mb-4">
                                    Edit Restaurant: {currentRestaurant?.name}
                                </h3>

                                <RestaurantForm isEdit={true} />

                                <div className="flex space-x-3 mt-6">
                                    <button
                                        onClick={handleEditRestaurant}
                                        className="flex-1 bg-primary text-white py-2 px-4 rounded-lg hover:bg-primary/90 transition-colors btn-primary"
                                    >
                                        Save Changes
                                    </button>
                                    <button
                                        onClick={() => {
                                            setShowEditForm(false);
                                            resetForm();
                                        }}
                                        className="flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Logo Upload Modal */}
                    {showLogoModal && currentRestaurant && (
                        <div className="fixed inset-0 flex items-center justify-center z-50 modal-overlay">
                            <div className="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4 modal-content">
                                <h3 className="text-lg font-semibold text-enhanced mb-4">
                                    Update Logo for {currentRestaurant.name}
                                </h3>

                                <RestaurantLogoUpload
                                    restaurant={currentRestaurant}
                                    onLogoUpdate={updateRestaurantLogo}
                                />

                                <button
                                    onClick={() => {
                                        setShowLogoModal(false);
                                        setCurrentRestaurant(null);
                                    }}
                                    className="w-full mt-4 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors"
                                >
                                    Close
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // üè¢ LEGENDARY: Branch Manager - Complete Branch Management System
        const BranchManager = () => {
            const { user } = useAuth();
            const {
                restaurants,
                selectedRestaurant,
                selectedBranch,
                setSelectedBranch,
                addBranch,
                updateBranch,
                deleteBranch,
                toggleBranchStatus,
                getBranchPerformance,
                compareBranches,
                getBranchLeaderboard
            } = useData();

            const [showAddForm, setShowAddForm] = useState(false);
            const [showEditForm, setShowEditForm] = useState(false);
            const [currentBranch, setCurrentBranch] = useState(null);
            const [viewMode, setViewMode] = useState('grid'); // grid, list, comparison, leaderboard
            const [comparisonMetric, setComparisonMetric] = useState('revenue');
            const [formData, setFormData] = useState({
                name: '',
                city: '',
                address: '',
                phone: '',
                email: '',
                manager: '',
                capacity: 50,
                staff: [],
                operatingHours: {
                    monday: { open: '09:00', close: '22:00', closed: false },
                    tuesday: { open: '09:00', close: '22:00', closed: false },
                    wednesday: { open: '09:00', close: '22:00', closed: false },
                    thursday: { open: '09:00', close: '22:00', closed: false },
                    friday: { open: '09:00', close: '22:00', closed: false },
                    saturday: { open: '09:00', close: '22:00', closed: false },
                    sunday: { open: '09:00', close: '22:00', closed: false }
                }
            });

            // Check user permissions
            const canManageAllBranches = user?.role === 'admin' || user?.email?.includes('owner');
            const canManageBranch = (branch) => {
                if (canManageAllBranches) return true;
                // Manager can only manage their assigned branch
                return user?.email && branch.manager === user.email;
            };

            // Get branches for current restaurant
            const branches = selectedRestaurant?.branches || [];

            // Reset form
            const resetForm = () => {
                setFormData({
                    name: '',
                    city: '',
                    address: '',
                    phone: '',
                    email: '',
                    manager: '',
                    capacity: 50,
                    staff: [],
                    operatingHours: {
                        monday: { open: '09:00', close: '22:00', closed: false },
                        tuesday: { open: '09:00', close: '22:00', closed: false },
                        wednesday: { open: '09:00', close: '22:00', closed: false },
                        thursday: { open: '09:00', close: '22:00', closed: false },
                        friday: { open: '09:00', close: '22:00', closed: false },
                        saturday: { open: '09:00', close: '22:00', closed: false },
                        sunday: { open: '09:00', close: '22:00', closed: false }
                    }
                });
                setCurrentBranch(null);
            };

            // Initialize edit form
            const initializeEditForm = (branch) => {
                setFormData({
                    name: branch.name || '',
                    city: branch.city || '',
                    address: branch.address || '',
                    phone: branch.phone || '',
                    email: branch.email || '',
                    manager: branch.manager || '',
                    capacity: branch.capacity || 50,
                    staff: branch.staff || [],
                    operatingHours: branch.operatingHours || formData.operatingHours
                });
                setCurrentBranch(branch);
                setShowEditForm(true);
            };

            // Handle Add Branch
            const handleAddBranch = () => {
                if (!formData.name || !formData.city || !formData.address) {
                    utils.showNotification('Please fill all required fields', 'error');
                    return;
                }

                if (!selectedRestaurant) {
                    utils.showNotification('Please select a restaurant first', 'error');
                    return;
                }

                addBranch(selectedRestaurant.id, formData);
                setShowAddForm(false);
                resetForm();
            };

            // Handle Edit Branch
            const handleEditBranch = () => {
                if (!currentBranch) return;

                if (!formData.name || !formData.city || !formData.address) {
                    utils.showNotification('Please fill all required fields', 'error');
                    return;
                }

                updateBranch(selectedRestaurant.id, currentBranch.id, formData);
                setShowEditForm(false);
                resetForm();
            };

            // Handle Delete Branch
            const handleDeleteBranch = (branch) => {
                utils.showConfirmation(
                    `Are you sure you want to delete "${branch.name}"? This action cannot be undone.`,
                    () => {
                        deleteBranch(selectedRestaurant.id, branch.id);
                    }
                );
            };

            // Branch Form Component
            const BranchForm = () => (
                <div className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-enhanced text-sm font-medium mb-2">Branch Name *</label>
                            <input
                                type="text"
                                value={formData.name}
                                onChange={(e) => setFormData(prev => ({...prev, name: e.target.value}))}
                                className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                placeholder="e.g., Downtown Branch"
                            />
                        </div>

                        <div>
                            <label className="block text-enhanced text-sm font-medium mb-2">City *</label>
                            <select
                                value={formData.city}
                                onChange={(e) => setFormData(prev => ({...prev, city: e.target.value}))}
                                className="enhanced-dropdown w-full px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                            >
                                <option value="">Select city</option>
                                {APP_CONFIG.cities.map(city => (
                                    <option key={city} value={city}>{city}</option>
                                ))}
                            </select>
                        </div>
                    </div>

                    <div>
                        <label className="block text-enhanced text-sm font-medium mb-2">Full Address *</label>
                        <textarea
                            value={formData.address}
                            onChange={(e) => setFormData(prev => ({...prev, address: e.target.value}))}
                            className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                            placeholder="Enter complete address"
                            rows="2"
                        />
                    </div>

                    <div className="grid grid-cols-3 gap-4">
                        <div>
                            <label className="block text-enhanced text-sm font-medium mb-2">Phone</label>
                            <input
                                type="tel"
                                value={formData.phone}
                                onChange={(e) => setFormData(prev => ({...prev, phone: e.target.value}))}
                                className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                placeholder="+966..."
                            />
                        </div>

                        <div>
                            <label className="block text-enhanced text-sm font-medium mb-2">Email</label>
                            <input
                                type="email"
                                value={formData.email}
                                onChange={(e) => setFormData(prev => ({...prev, email: e.target.value}))}
                                className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                placeholder="branch@email.com"
                            />
                        </div>

                        <div>
                            <label className="block text-enhanced text-sm font-medium mb-2">Capacity</label>
                            <input
                                type="number"
                                value={formData.capacity}
                                onChange={(e) => setFormData(prev => ({...prev, capacity: parseInt(e.target.value) || 0}))}
                                className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                placeholder="50"
                                min="0"
                            />
                        </div>
                    </div>

                    <div>
                        <label className="block text-enhanced text-sm font-medium mb-2">Branch Manager</label>
                        <input
                            type="text"
                            value={formData.manager}
                            onChange={(e) => setFormData(prev => ({...prev, manager: e.target.value}))}
                            className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                            placeholder="Manager name or email"
                        />
                    </div>

                    {/* Operating Hours */}
                    <div>
                        <label className="block text-enhanced text-sm font-medium mb-2">Operating Hours</label>
                        <div className="space-y-2 max-h-64 overflow-y-auto p-3 bg-white/5 rounded-lg">
                            {Object.entries(formData.operatingHours).map(([day, hours]) => (
                                <div key={day} className="flex items-center space-x-3">
                                    <div className="w-24">
                                        <span className="text-enhanced text-sm capitalize">{day}</span>
                                    </div>
                                    <input
                                        type="checkbox"
                                        checked={!hours.closed}
                                        onChange={(e) => {
                                            const newHours = {...formData.operatingHours};
                                            newHours[day].closed = !e.target.checked;
                                            setFormData(prev => ({...prev, operatingHours: newHours}));
                                        }}
                                        className="rounded border-white/20 bg-white/10 text-primary focus:ring-primary/50"
                                    />
                                    <span className="text-secondary text-xs">Open</span>
                                    <input
                                        type="time"
                                        value={hours.open}
                                        onChange={(e) => {
                                            const newHours = {...formData.operatingHours};
                                            newHours[day].open = e.target.value;
                                            setFormData(prev => ({...prev, operatingHours: newHours}));
                                        }}
                                        disabled={hours.closed}
                                        className="px-2 py-1 bg-white/10 border border-white/20 rounded text-enhanced text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 disabled:opacity-50"
                                    />
                                    <span className="text-secondary text-xs">to</span>
                                    <input
                                        type="time"
                                        value={hours.close}
                                        onChange={(e) => {
                                            const newHours = {...formData.operatingHours};
                                            newHours[day].close = e.target.value;
                                            setFormData(prev => ({...prev, operatingHours: newHours}));
                                        }}
                                        disabled={hours.closed}
                                        className="px-2 py-1 bg-white/10 border border-white/20 rounded text-enhanced text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 disabled:opacity-50"
                                    />
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            if (!selectedRestaurant) {
                return (
                    <div className="p-6">
                        <div className="glass-effect rounded-2xl p-12 text-center">
                            <div className="text-4xl mb-4">üè¢</div>
                            <p className="text-enhanced text-lg">No restaurant selected</p>
                            <p className="text-secondary">Please select a restaurant to manage branches</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="p-6 space-y-6">
                    {/* Header */}
                    <div className="glass-effect rounded-2xl p-6 hover-lift">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className="text-2xl font-bold text-enhanced mb-2">Branch Management</h1>
                                <p className="text-secondary">Manage branches for {selectedRestaurant.name}</p>
                            </div>
                            <div className="flex items-center space-x-3">
                                {/* View Mode Toggle */}
                                <div className="flex bg-white/10 rounded-lg p-1">
                                    <button
                                        onClick={() => setViewMode('grid')}
                                        className={`px-3 py-1 rounded ${viewMode === 'grid' ? 'bg-primary text-white' : 'text-secondary'} text-sm`}
                                    >
                                        Grid
                                    </button>
                                    <button
                                        onClick={() => setViewMode('comparison')}
                                        className={`px-3 py-1 rounded ${viewMode === 'comparison' ? 'bg-primary text-white' : 'text-secondary'} text-sm`}
                                    >
                                        Compare
                                    </button>
                                    <button
                                        onClick={() => setViewMode('leaderboard')}
                                        className={`px-3 py-1 rounded ${viewMode === 'leaderboard' ? 'bg-primary text-white' : 'text-secondary'} text-sm`}
                                    >
                                        Leaderboard
                                    </button>
                                </div>

                                {canManageAllBranches && (
                                    <button
                                        onClick={() => {
                                            resetForm();
                                            setShowAddForm(true);
                                        }}
                                        className="flex items-center px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors btn-primary"
                                    >
                                        <span>‚ûï</span>
                                        <span className="ml-2">Add Branch</span>
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* Statistics */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div className="bg-primary/20 rounded-lg p-4 border border-primary/30">
                                <div className="text-primary text-sm font-medium">Total Branches</div>
                                <div className="text-2xl font-bold text-enhanced mt-1">{branches.length}</div>
                            </div>
                            <div className="bg-green-500/20 rounded-lg p-4 border border-green-500/30">
                                <div className="text-green-300 text-sm font-medium">Active</div>
                                <div className="text-2xl font-bold text-enhanced mt-1">
                                    {branches.filter(b => b.status === 'active').length}
                                </div>
                            </div>
                            <div className="bg-yellow-500/20 rounded-lg p-4 border border-yellow-500/30">
                                <div className="text-yellow-300 text-sm font-medium">Inactive</div>
                                <div className="text-2xl font-bold text-enhanced mt-1">
                                    {branches.filter(b => b.status === 'inactive').length}
                                </div>
                            </div>
                            <div className="bg-purple-500/20 rounded-lg p-4 border border-purple-500/30">
                                <div className="text-purple-300 text-sm font-medium">Cities</div>
                                <div className="text-2xl font-bold text-enhanced mt-1">
                                    {new Set(branches.map(b => b.city)).size}
                                </div>
                            </div>
                        </div>

                        {/* Grid View */}
                        {viewMode === 'grid' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {branches.map(branch => {
                                    const performance = getBranchPerformance(selectedRestaurant.id, branch.id);
                                    const canManage = canManageBranch(branch);

                                    return (
                                        <div
                                            key={branch.id}
                                            className={`glass-effect rounded-xl p-6 hover-lift cursor-pointer ${
                                                selectedBranch?.id === branch.id ? 'border-2 border-primary' : ''
                                            } ${branch.status === 'inactive' ? 'opacity-60' : ''}`}
                                            onClick={() => setSelectedBranch(branch)}
                                        >
                                            <div className="flex items-center justify-between mb-4">
                                                <div>
                                                    <h3 className="text-enhanced font-semibold text-lg">{branch.name}</h3>
                                                    <p className="text-secondary text-sm">{branch.city} ‚Ä¢ {branch.address}</p>
                                                </div>
                                                <div className={`w-3 h-3 rounded-full ${
                                                    branch.status === 'active' ? 'bg-green-500' : 'bg-yellow-500'
                                                }`}></div>
                                            </div>

                                            <div className="space-y-2 mb-4">
                                                <div className="flex justify-between text-sm">
                                                    <span className="text-secondary">Revenue:</span>
                                                    <span className="text-enhanced font-semibold">{utils.formatCurrency(performance.revenue)}</span>
                                                </div>
                                                <div className="flex justify-between text-sm">
                                                    <span className="text-secondary">Orders:</span>
                                                    <span className="text-enhanced font-semibold">{utils.formatNumber(performance.orders)}</span>
                                                </div>
                                                <div className="flex justify-between text-sm">
                                                    <span className="text-secondary">Profit Margin:</span>
                                                    <span className={`font-semibold ${
                                                        performance.profitMargin >= 15 ? 'text-green-400' :
                                                        performance.profitMargin >= 10 ? 'text-yellow-400' : 'text-red-400'
                                                    }`}>
                                                        {performance.profitMargin.toFixed(1)}%
                                                    </span>
                                                </div>
                                                <div className="flex justify-between text-sm">
                                                    <span className="text-secondary">Capacity:</span>
                                                    <span className="text-enhanced font-semibold">{branch.capacity} seats</span>
                                                </div>
                                            </div>

                                            {branch.manager && (
                                                <div className="mb-4 p-2 bg-white/5 rounded text-xs">
                                                    <span className="text-secondary">Manager: </span>
                                                    <span className="text-enhanced">{branch.manager}</span>
                                                </div>
                                            )}

                                            {canManage && (
                                                <div className="grid grid-cols-3 gap-2">
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            initializeEditForm(branch);
                                                        }}
                                                        className="flex items-center justify-center py-2 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg transition-colors text-enhanced text-sm border border-blue-500/30"
                                                    >
                                                        <span>‚úèÔ∏è</span>
                                                    </button>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            toggleBranchStatus(selectedRestaurant.id, branch.id);
                                                        }}
                                                        className={`flex items-center justify-center py-2 ${
                                                            branch.status === 'active'
                                                                ? 'bg-yellow-500/20 hover:bg-yellow-500/30 border-yellow-500/30'
                                                                : 'bg-green-500/20 hover:bg-green-500/30 border-green-500/30'
                                                        } rounded-lg transition-colors text-enhanced text-sm border`}
                                                    >
                                                        <span>{branch.status === 'active' ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}</span>
                                                    </button>
                                                    {canManageAllBranches && (
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                handleDeleteBranch(branch);
                                                            }}
                                                            className="flex items-center justify-center py-2 bg-red-500/20 hover:bg-red-500/30 rounded-lg transition-colors text-enhanced text-sm border border-red-500/30"
                                                        >
                                                            <span>üóëÔ∏è</span>
                                                        </button>
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        )}

                        {/* Comparison View */}
                        {viewMode === 'comparison' && (
                            <div>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold text-enhanced">Branch Comparison</h3>
                                    <select
                                        value={comparisonMetric}
                                        onChange={(e) => setComparisonMetric(e.target.value)}
                                        className="enhanced-dropdown px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                                    >
                                        <option value="revenue">Revenue</option>
                                        <option value="orders">Orders</option>
                                        <option value="profitMargin">Profit Margin</option>
                                        <option value="avgOrderValue">Avg Order Value</option>
                                    </select>
                                </div>

                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead>
                                            <tr className="border-b-2 border-white/20">
                                                <th className="text-left py-3 text-secondary font-medium">Branch</th>
                                                <th className="text-right py-3 text-secondary font-medium">Revenue</th>
                                                <th className="text-right py-3 text-secondary font-medium">Orders</th>
                                                <th className="text-right py-3 text-secondary font-medium">Profit Margin</th>
                                                <th className="text-right py-3 text-secondary font-medium">AOV</th>
                                                <th className="text-center py-3 text-secondary font-medium">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {compareBranches(selectedRestaurant.id).map((branch, index) => (
                                                <tr key={branch.id} className={`border-b border-white/10 ${index === 0 ? 'bg-green-500/10' : ''}`}>
                                                    <td className="py-3 text-enhanced">
                                                        {index === 0 && <span className="mr-2">üèÜ</span>}
                                                        {branch.name}
                                                        <div className="text-xs text-secondary">{branch.city}</div>
                                                    </td>
                                                    <td className="py-3 text-right text-enhanced font-semibold">
                                                        {utils.formatCurrency(branch.performance.revenue)}
                                                    </td>
                                                    <td className="py-3 text-right text-enhanced">
                                                        {utils.formatNumber(branch.performance.orders)}
                                                    </td>
                                                    <td className="py-3 text-right">
                                                        <span className={`font-semibold ${
                                                            branch.performance.profitMargin >= 15 ? 'text-green-400' :
                                                            branch.performance.profitMargin >= 10 ? 'text-yellow-400' : 'text-red-400'
                                                        }`}>
                                                            {branch.performance.profitMargin.toFixed(1)}%
                                                        </span>
                                                    </td>
                                                    <td className="py-3 text-right text-enhanced">
                                                        {utils.formatCurrency(branch.performance.avgOrderValue)}
                                                    </td>
                                                    <td className="py-3 text-center">
                                                        <span className={`px-2 py-1 rounded-full text-xs ${
                                                            branch.status === 'active'
                                                                ? 'bg-green-500/20 text-green-300'
                                                                : 'bg-yellow-500/20 text-yellow-300'
                                                        }`}>
                                                            {branch.status}
                                                        </span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* Leaderboard View */}
                        {viewMode === 'leaderboard' && (
                            <div>
                                <h3 className="text-lg font-semibold text-enhanced mb-4">Branch Performance Leaderboard</h3>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                    {['revenue', 'orders', 'profitMargin'].map((metric, index) => {
                                        const leaderboard = getBranchLeaderboard(selectedRestaurant.id, metric);
                                        const topBranch = leaderboard[0];
                                        if (!topBranch) return null;

                                        return (
                                            <div key={metric} className={`p-6 rounded-xl ${
                                                index === 0 ? 'bg-gradient-to-br from-yellow-500/20 to-orange-500/20 border-2 border-yellow-500/30' :
                                                index === 1 ? 'bg-gradient-to-br from-gray-400/20 to-gray-500/20 border-2 border-gray-400/30' :
                                                'bg-gradient-to-br from-orange-700/20 to-orange-800/20 border-2 border-orange-700/30'
                                            }`}>
                                                <div className="text-center mb-4">
                                                    <div className="text-4xl mb-2">{index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : 'ü•â'}</div>
                                                    <div className="text-enhanced font-semibold capitalize">{metric.replace(/([A-Z])/g, ' $1').trim()}</div>
                                                </div>
                                                <div className="text-center">
                                                    <div className="text-lg font-bold text-enhanced mb-1">{topBranch.name}</div>
                                                    <div className="text-2xl font-bold text-primary">
                                                        {metric === 'profitMargin'
                                                            ? `${topBranch.performance[metric].toFixed(1)}%`
                                                            : metric === 'revenue'
                                                            ? utils.formatCurrency(topBranch.performance[metric])
                                                            : utils.formatNumber(topBranch.performance[metric])}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                <div className="space-y-3">
                                    {getBranchLeaderboard(selectedRestaurant.id, 'revenue').map((branch, index) => (
                                        <div key={branch.id} className="flex items-center justify-between p-4 bg-white/5 rounded-lg">
                                            <div className="flex items-center space-x-4">
                                                <div className={`text-2xl font-bold ${
                                                    index < 3 ? 'text-primary' : 'text-secondary'
                                                }`}>
                                                    #{index + 1}
                                                </div>
                                                <div>
                                                    <div className="text-enhanced font-semibold">{branch.name}</div>
                                                    <div className="text-secondary text-sm">{branch.city}</div>
                                                </div>
                                            </div>
                                            <div className="flex items-center space-x-6">
                                                <div className="text-right">
                                                    <div className="text-enhanced font-semibold">{utils.formatCurrency(branch.performance.revenue)}</div>
                                                    <div className="text-secondary text-sm">{utils.formatNumber(branch.performance.orders)} orders</div>
                                                </div>
                                                <div className={`px-3 py-1 rounded-full font-semibold ${
                                                    branch.performance.profitMargin >= 15 ? 'bg-green-500/20 text-green-300' :
                                                    branch.performance.profitMargin >= 10 ? 'bg-yellow-500/20 text-yellow-300' :
                                                    'bg-red-500/20 text-red-300'
                                                }`}>
                                                    {branch.performance.profitMargin.toFixed(1)}%
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {branches.length === 0 && (
                            <div className="text-center py-12">
                                <div className="text-6xl mb-4">üè¢</div>
                                <p className="text-enhanced text-lg mb-2">No branches yet</p>
                                <p className="text-secondary">Click "Add Branch" to create your first branch</p>
                            </div>
                        )}
                    </div>

                    {/* Add Branch Modal */}
                    {showAddForm && (
                        <div className="fixed inset-0 flex items-center justify-center z-50 modal-overlay">
                            <div className="bg-gray-800 rounded-xl p-6 max-w-2xl w-full mx-4 modal-content max-h-[90vh] overflow-y-auto">
                                <h3 className="text-lg font-semibold text-enhanced mb-4">Add New Branch</h3>

                                <BranchForm />

                                <div className="flex space-x-3 mt-6">
                                    <button
                                        onClick={handleAddBranch}
                                        className="flex-1 bg-primary text-white py-2 px-4 rounded-lg hover:bg-primary/90 transition-colors btn-primary"
                                    >
                                        Add Branch
                                    </button>
                                    <button
                                        onClick={() => {
                                            setShowAddForm(false);
                                            resetForm();
                                        }}
                                        className="flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Edit Branch Modal */}
                    {showEditForm && (
                        <div className="fixed inset-0 flex items-center justify-center z-50 modal-overlay">
                            <div className="bg-gray-800 rounded-xl p-6 max-w-2xl w-full mx-4 modal-content max-h-[90vh] overflow-y-auto">
                                <h3 className="text-lg font-semibold text-enhanced mb-4">
                                    Edit Branch: {currentBranch?.name}
                                </h3>

                                <BranchForm />

                                <div className="flex space-x-3 mt-6">
                                    <button
                                        onClick={handleEditBranch}
                                        className="flex-1 bg-primary text-white py-2 px-4 rounded-lg hover:bg-primary/90 transition-colors btn-primary"
                                    >
                                        Save Changes
                                    </button>
                                    <button
                                        onClick={() => {
                                            setShowEditForm(false);
                                            resetForm();
                                        }}
                                        className="flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // üìä LEGENDARY: Unified Report Center - The Core of Restalyze
        const UnifiedReportCenter = () => {
            const { selectedRestaurant } = useData();
            const [activeReport, setActiveReport] = React.useState('financial');
            const [isPrintMode, setIsPrintMode] = React.useState(false);

            if (!selectedRestaurant) {
                return (
                    <div className="text-center py-12">
                        <div className="text-4xl mb-4">üìä</div>
                        <p className="text-secondary">Please select a restaurant to access reports</p>
                    </div>
                );
            }

            const reports = [
                { id: 'financial', name: 'Financial Performance', icon: 'üí∞', description: 'Revenue, profit & cost analysis' },
                { id: 'menu', name: 'Menu Performance', icon: 'üçΩÔ∏è', description: 'Menu engineering & optimization' },
                { id: 'channel', name: 'Channel Performance', icon: 'üì±', description: 'Multi-channel sales analytics' }
            ];

            return (
                <div className="p-6 space-y-6">
                    {/* Report Center Header */}
                    <div className="glass-effect rounded-2xl p-6" style={{
                        background: 'linear-gradient(135deg, rgba(10, 37, 64, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%)',
                        border: '2px solid rgba(255, 215, 0, 0.3)'
                    }}>
                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '1.5rem' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                                <span style={{ fontSize: '3rem' }}>üìä</span>
                                <div>
                                    <h1 style={{ fontSize: '2rem', fontWeight: '800', color: '#FFD700', marginBottom: '0.25rem' }}>
                                        Report Center
                                    </h1>
                                    <p style={{ fontSize: '0.875rem', color: '#94a3b8', margin: 0 }}>
                                        Executive-grade analytics & insights for {selectedRestaurant.name}
                                    </p>
                                </div>
                            </div>
                            <button
                                onClick={() => window.print()}
                                style={{
                                    padding: '0.75rem 1.5rem',
                                    background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                                    color: '#0A2540',
                                    border: 'none',
                                    borderRadius: '12px',
                                    fontSize: '0.9375rem',
                                    fontWeight: '700',
                                    cursor: 'pointer',
                                    boxShadow: '0 4px 12px rgba(255, 215, 0, 0.3)',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '0.5rem'
                                }}
                            >
                                üñ®Ô∏è Print Report
                            </button>
                        </div>

                        {/* Report Navigation */}
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '1rem' }}>
                            {reports.map(report => (
                                <button
                                    key={report.id}
                                    onClick={() => setActiveReport(report.id)}
                                    style={{
                                        padding: '1.5rem',
                                        borderRadius: '12px',
                                        background: activeReport === report.id
                                            ? 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%)'
                                            : 'rgba(255, 255, 255, 0.05)',
                                        border: activeReport === report.id ? '2px solid #FFD700' : '2px solid rgba(255, 255, 255, 0.1)',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease',
                                        textAlign: 'left'
                                    }}
                                >
                                    <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>{report.icon}</div>
                                    <div style={{
                                        fontSize: '1rem',
                                        fontWeight: '700',
                                        color: activeReport === report.id ? '#FFD700' : '#e2e8f0',
                                        marginBottom: '0.25rem'
                                    }}>
                                        {report.name}
                                    </div>
                                    <div style={{ fontSize: '0.75rem', color: '#94a3b8' }}>
                                        {report.description}
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Report Content */}
                    {activeReport === 'financial' && <FinancialPerformanceReport />}
                    {activeReport === 'menu' && <MenuPerformanceReport />}
                    {activeReport === 'channel' && <ChannelPerformanceReport />}
                </div>
            );
        };

        // üí∞ PREMIUM: Financial Performance Report - Executive Ready
        const FinancialPerformanceReport = () => {
            const { selectedRestaurant, getFinancialOverview, monthlyData } = useData();
            const [timeframe, setTimeframe] = useState('monthly');

            const financialData = useMemo(() => {
                if (!selectedRestaurant) return null;

                const data = getFinancialOverview(selectedRestaurant.id);
                const monthlyTrends = monthlyData
                    .filter(d => d.restaurant === selectedRestaurant.id)
                    .sort((a, b) => a.month.localeCompare(b.month));

                const revenueTrend = monthlyTrends.map(d => d.gmv);
                const profitTrend = monthlyTrends.map(d => d.netProfit);

                return {
                    ...data,
                    monthlyTrends,
                    revenueTrend,
                    profitTrend,
                    growthRate: monthlyTrends.length > 1 ?
                        ((revenueTrend[revenueTrend.length - 1] - revenueTrend[revenueTrend.length - 2]) / revenueTrend[revenueTrend.length - 2] * 100) : 0
                };
            }, [selectedRestaurant, monthlyData]);

            if (!selectedRestaurant) {
                return (
                    <div style={{ padding: '2rem', textAlign: 'center', background: '#FFFFFF', borderRadius: '12px', margin: '2rem' }}>
                        <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>üí∞</div>
                        <p style={{ fontSize: '1.25rem', fontWeight: '600', color: '#0A2540', marginBottom: '0.5rem' }}>No restaurant selected</p>
                        <p style={{ color: '#64748b' }}>Please select a restaurant to view financial data</p>
                    </div>
                );
            }

            if (!financialData) {
                return (
                    <div style={{ padding: '3rem', textAlign: 'center', background: '#FFFFFF', borderRadius: '12px', margin: '2rem' }}>
                        <div style={{ width: '64px', height: '64px', border: '4px solid #FFD700', borderTop: '4px solid transparent', borderRadius: '50%', margin: '0 auto 1rem', animation: 'spin 1s linear infinite' }} />
                        <p style={{ color: '#64748b' }}>Loading financial data...</p>
                    </div>
                );
            }

            // AI Insights
            const aiInsights = [
                {
                    icon: 'üí°',
                    title: 'Revenue Growth Opportunity',
                    description: `Your revenue is growing at ${financialData.growthRate.toFixed(1)}% monthly. Focus on peak hours (6-8 PM) to maximize capacity utilization.`,
                    action: 'Optimize pricing during peak hours'
                },
                {
                    icon: 'üìä',
                    title: 'Cost Optimization',
                    description: `Expenses are ${((financialData.expenses / financialData.revenue) * 100).toFixed(1)}% of revenue. Industry benchmark is 65%. Consider negotiating with suppliers.`,
                    action: 'Review vendor contracts'
                },
                {
                    icon: '‚ö†Ô∏è',
                    title: 'Commission Impact',
                    description: `Platform commissions represent ${((financialData.commission / financialData.revenue) * 100).toFixed(1)}% of revenue. Balance direct orders with delivery platforms.`,
                    action: 'Promote direct ordering channels'
                }
            ];

            return (
                <div className="report-container" style={{ background: '#FFFFFF', minHeight: '100vh', padding: '0' }}>
                    {/* Premium Report Header */}
                    <ReportHeader
                        title="Financial Performance Report"
                        subtitle="Complete financial analysis with AI-powered insights"
                        restaurantName={selectedRestaurant.name}
                    />

                    <div style={{ padding: '2rem', maxWidth: '1400px', margin: '0 auto' }}>
                        {/* Executive Summary KPIs */}
                        <ReportSection title="Executive Summary">
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1.5rem' }}>
                                <ReportKPICard
                                    icon="üí∞"
                                    label="Total Revenue"
                                    value={utils.formatCurrency(financialData.revenue)}
                                    change={`${Math.abs(financialData.growthRate).toFixed(1)}%`}
                                    trend={financialData.growthRate > 0 ? 'up' : 'down'}
                                    color="#10b981"
                                />
                                <ReportKPICard
                                    icon="üìà"
                                    label="Net Profit"
                                    value={utils.formatCurrency(financialData.netProfit)}
                                    change={`${financialData.profitMargin.toFixed(1)}% margin`}
                                    trend="up"
                                    color="#3b82f6"
                                />
                                <ReportKPICard
                                    icon="üí∏"
                                    label="Total Expenses"
                                    value={utils.formatCurrency(financialData.expenses)}
                                    change={`${((financialData.expenses / financialData.revenue) * 100).toFixed(1)}% of revenue`}
                                    trend="neutral"
                                    color="#f59e0b"
                                />
                                <ReportKPICard
                                    icon="üè¶"
                                    label="Platform Commissions"
                                    value={utils.formatCurrency(financialData.commission)}
                                    change={`${((financialData.commission / financialData.revenue) * 100).toFixed(1)}% of revenue`}
                                    trend="neutral"
                                    color="#8b5cf6"
                                />
                            </div>
                        </ReportSection>

                        {/* Revenue & Expense Breakdown */}
                        <ReportSection title="Financial Breakdown">
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '2rem' }}>
                                {/* Revenue Distribution */}
                                <div style={{
                                    padding: '1.5rem',
                                    background: '#FFFFFF',
                                    border: '2px solid rgba(16, 185, 129, 0.2)',
                                    borderLeft: '4px solid #10b981',
                                    borderRadius: '12px',
                                    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                }}>
                                    <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#0A2540', marginBottom: '1.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                        <span style={{ fontSize: '1.5rem' }}>üíµ</span>
                                        Revenue Distribution
                                    </h3>
                                    <div style={{ display: 'grid', gap: '1rem' }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.75rem', background: 'rgba(16, 185, 129, 0.05)', borderRadius: '8px' }}>
                                            <span style={{ fontSize: '0.875rem', color: '#64748b', fontWeight: '500' }}>Food Sales (85%)</span>
                                            <span style={{ fontSize: '1rem', fontWeight: '700', color: '#0A2540' }}>
                                                {utils.formatCurrency(financialData.revenue * 0.85)}
                                            </span>
                                        </div>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.75rem', background: 'rgba(16, 185, 129, 0.05)', borderRadius: '8px' }}>
                                            <span style={{ fontSize: '0.875rem', color: '#64748b', fontWeight: '500' }}>Beverage Sales (12%)</span>
                                            <span style={{ fontSize: '1rem', fontWeight: '700', color: '#0A2540' }}>
                                                {utils.formatCurrency(financialData.revenue * 0.12)}
                                            </span>
                                        </div>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.75rem', background: 'rgba(16, 185, 129, 0.05)', borderRadius: '8px' }}>
                                            <span style={{ fontSize: '0.875rem', color: '#64748b', fontWeight: '500' }}>Other Revenue (3%)</span>
                                            <span style={{ fontSize: '1rem', fontWeight: '700', color: '#0A2540' }}>
                                                {utils.formatCurrency(financialData.revenue * 0.03)}
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                {/* Expense Breakdown */}
                                <div style={{
                                    padding: '1.5rem',
                                    background: '#FFFFFF',
                                    border: '2px solid rgba(245, 158, 11, 0.2)',
                                    borderLeft: '4px solid #f59e0b',
                                    borderRadius: '12px',
                                    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                }}>
                                    <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#0A2540', marginBottom: '1.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                        <span style={{ fontSize: '1.5rem' }}>üí∏</span>
                                        Expense Breakdown
                                    </h3>
                                    <div style={{ display: 'grid', gap: '1rem' }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.75rem', background: 'rgba(245, 158, 11, 0.05)', borderRadius: '8px' }}>
                                            <span style={{ fontSize: '0.875rem', color: '#64748b', fontWeight: '500' }}>Food Costs (35%)</span>
                                            <span style={{ fontSize: '1rem', fontWeight: '700', color: '#0A2540' }}>
                                                {utils.formatCurrency(financialData.expenses * 0.35)}
                                            </span>
                                        </div>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.75rem', background: 'rgba(245, 158, 11, 0.05)', borderRadius: '8px' }}>
                                            <span style={{ fontSize: '0.875rem', color: '#64748b', fontWeight: '500' }}>Labor Costs (25%)</span>
                                            <span style={{ fontSize: '1rem', fontWeight: '700', color: '#0A2540' }}>
                                                {utils.formatCurrency(financialData.expenses * 0.25)}
                                            </span>
                                        </div>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.75rem', background: 'rgba(245, 158, 11, 0.05)', borderRadius: '8px' }}>
                                            <span style={{ fontSize: '0.875rem', color: '#64748b', fontWeight: '500' }}>Operating (40%)</span>
                                            <span style={{ fontSize: '1rem', fontWeight: '700', color: '#0A2540' }}>
                                                {utils.formatCurrency(financialData.expenses * 0.40)}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ReportSection>

                        {/* Monthly Performance Table */}
                        <ReportSection title="Monthly Performance Trends">
                            <div style={{
                                padding: '1.5rem',
                                background: '#FFFFFF',
                                border: '2px solid rgba(10, 37, 64, 0.1)',
                                borderRadius: '12px',
                                boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)',
                                overflowX: 'auto'
                            }}>
                                <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                                    <thead>
                                        <tr style={{ borderBottom: '2px solid #FFD700' }}>
                                            <th style={{ textAlign: 'left', padding: '1rem', fontSize: '0.875rem', fontWeight: '600', color: '#64748b' }}>Month</th>
                                            <th style={{ textAlign: 'right', padding: '1rem', fontSize: '0.875rem', fontWeight: '600', color: '#64748b' }}>Revenue</th>
                                            <th style={{ textAlign: 'right', padding: '1rem', fontSize: '0.875rem', fontWeight: '600', color: '#64748b' }}>Orders</th>
                                            <th style={{ textAlign: 'right', padding: '1rem', fontSize: '0.875rem', fontWeight: '600', color: '#64748b' }}>Profit</th>
                                            <th style={{ textAlign: 'right', padding: '1rem', fontSize: '0.875rem', fontWeight: '600', color: '#64748b' }}>Margin</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {financialData.monthlyTrends.slice(-6).map((month, index) => (
                                            <tr key={index} style={{ borderBottom: '1px solid rgba(0, 0, 0, 0.06)' }}>
                                                <td style={{ padding: '1rem', fontSize: '0.9375rem', fontWeight: '600', color: '#0A2540' }}>{month.month}</td>
                                                <td style={{ padding: '1rem', textAlign: 'right', fontSize: '0.9375rem', fontWeight: '700', color: '#10b981' }}>
                                                    {utils.formatCurrency(month.gmv)}
                                                </td>
                                                <td style={{ padding: '1rem', textAlign: 'right', fontSize: '0.9375rem', color: '#0A2540' }}>
                                                    {utils.formatNumber(month.orders)}
                                                </td>
                                                <td style={{ padding: '1rem', textAlign: 'right', fontSize: '0.9375rem', fontWeight: '700', color: '#3b82f6' }}>
                                                    {utils.formatCurrency(month.netProfit)}
                                                </td>
                                                <td style={{ padding: '1rem', textAlign: 'right', fontSize: '0.9375rem', fontWeight: '600', color: '#64748b' }}>
                                                    {utils.calculateProfitMargin(month.gmv, month.netProfit).toFixed(1)}%
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </ReportSection>

                        {/* AI Insights */}
                        <AIInsightsBox insights={aiInsights} />

                        {/* Report Footer */}
                        <ReportFooter />
                    </div>
                </div>
            );
        };

        // üöÄ NEW: Smart Features Dashboard
        const SmartFeaturesDashboard = () => {
            const { peakHours, menuPerformance, customerRetention, deliveryOptimization, predictiveAnalytics } = useData();

            return (
                <div className="p-6 space-y-6">
                    <div className="glass-effect rounded-2xl p-6 hover-lift">
                        <h1 className="text-2xl font-bold text-enhanced mb-2">Smart Features Dashboard</h1>
                        <p className="text-secondary mb-6">AI-powered insights and operational intelligence</p>

                        {/* Peak Hours Analysis */}
                        <div className="mb-8">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">Peak Hours Analysis</h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                {peakHours.map((peak, index) => (
                                    <div key={index} className="bg-white/5 rounded-lg p-4 text-center">
                                        <div className="text-2xl font-bold text-enhanced mb-1">{peak.hour}</div>
                                        <div className="text-secondary text-sm">{peak.orders} orders</div>
                                        <div className="text-primary text-sm">{peak.percentage} of daily total</div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Menu Performance */}
                        <div className="mb-8">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">Top Performing Menu Items</h3>
                            <div className="space-y-3">
                                {menuPerformance.map((item, index) => (
                                    <div key={index} className="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                        <div className="flex items-center space-x-3">
                                            <div className="w-3 h-3 bg-primary rounded-full"></div>
                                            <span className="text-enhanced font-medium">{item.name}</span>
                                        </div>
                                        <div className="flex space-x-6">
                                            <span className="text-secondary">{item.orders} orders</span>
                                            <span className="text-enhanced font-semibold">{utils.formatCurrency(item.revenue)}</span>
                                            <span className="text-primary">{item.popularity}% popularity</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Customer Retention */}
                        <div className="mb-8">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">Customer Retention Analytics</h3>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div className="bg-white/5 rounded-lg p-4 text-center">
                                    <div className="text-2xl font-bold text-enhanced mb-1">{customerRetention.totalCustomers}</div>
                                    <div className="text-secondary text-sm">Total Customers</div>
                                </div>
                                <div className="bg-white/5 rounded-lg p-4 text-center">
                                    <div className="text-2xl font-bold text-green-400 mb-1">{customerRetention.returningCustomers}</div>
                                    <div className="text-secondary text-sm">Returning Customers</div>
                                </div>
                                <div className="bg-white/5 rounded-lg p-4 text-center">
                                    <div className="text-2xl font-bold text-primary mb-1">{customerRetention.retentionRate}%</div>
                                    <div className="text-secondary text-sm">Retention Rate</div>
                                </div>
                                <div className="bg-white/5 rounded-lg p-4 text-center">
                                    <div className="text-2xl font-bold text-blue-400 mb-1">{customerRetention.newCustomers}</div>
                                    <div className="text-secondary text-sm">New Customers</div>
                                </div>
                            </div>
                        </div>

                        {/* Delivery Optimization */}
                        <div className="mb-8">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">Delivery Performance</h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                {deliveryOptimization.map((platform, index) => (
                                    <div key={index} className="bg-white/5 rounded-lg p-4">
                                        <div className="flex justify-between items-center mb-3">
                                            <span className="text-enhanced font-semibold">{platform.platform}</span>
                                            <span className="text-secondary text-sm">{platform.totalDeliveries} deliveries</span>
                                        </div>
                                        <div className="space-y-2">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-secondary">Avg. Time:</span>
                                                <span className="text-enhanced">{platform.avgTime} min</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-secondary">On-time Rate:</span>
                                                <span className="text-green-400">{platform.onTimeRate}%</span>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Predictive Analytics */}
                        {predictiveAnalytics && (
                            <div className="bg-gradient-to-r from-primary/20 to-purple-500/20 rounded-xl p-6 border border-primary/30">
                                <h3 className="text-lg font-semibold text-enhanced mb-4">Predictive Analytics</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <div className="text-2xl font-bold text-enhanced mb-2">
                                            {utils.formatCurrency(predictiveAnalytics.nextWeekRevenue)}
                                        </div>
                                        <div className="text-secondary">Predicted Next Week Revenue</div>
                                        <div className="text-primary text-sm mt-1">
                                            {predictiveAnalytics.confidence * 100}% confidence ‚Ä¢ Trend: {predictiveAnalytics.trend}
                                        </div>
                                    </div>
                                    <div>
                                        <h4 className="text-enhanced font-semibold mb-2">Recommended Actions</h4>
                                        <ul className="space-y-1 text-sm text-secondary">
                                            {predictiveAnalytics.recommendedActions?.map((action, index) => (
                                                <li key={index}>‚Ä¢ {action}</li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // üéØ RESTALYZE PROFESSIONAL REPORT SYSTEM - Complete Redesign
        const AdvancedReportGenerator = () => {
            const { selectedRestaurant, getFinancialOverview, weeklyData, monthlyData, dailyData, platforms, performanceScores, compareBranches, getBranchPerformance } = useData();
            const [reportType, setReportType] = useState('monthly');
            const [includeCharts, setIncludeCharts] = useState(true);
            const [includePlatformBreakdown, setIncludePlatformBreakdown] = useState(true);
            const [includeStaffPerformance, setIncludeStaffPerformance] = useState(true);
            const [includeMenuAnalytics, setIncludeMenuAnalytics] = useState(true);
            const [includeBranchComparison, setIncludeBranchComparison] = useState(true);
            const [includeZATCACompliance, setIncludeZATCACompliance] = useState(true);
            const [showShareModal, setShowShareModal] = useState(false);
            const [shareEmail, setShareEmail] = useState('');
            const [generating, setGenerating] = useState(false);
            const [scheduledDelivery, setScheduledDelivery] = useState('none');

            // Date range state
            const today = new Date();
            const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
            const [startDate, setStartDate] = useState(thirtyDaysAgo.toISOString().split('T')[0]);
            const [endDate, setEndDate] = useState(today.toISOString().split('T')[0]);

            // Calculate comprehensive report data
            const reportData = useMemo(() => {
                if (!selectedRestaurant) return null;

                const data = reportType === 'daily' ? dailyData :
                             reportType === 'weekly' ? weeklyData : monthlyData;

                const filteredData = data.filter(d => d.restaurant === selectedRestaurant.id);

                // Calculate totals
                const totalRevenue = filteredData.reduce((sum, d) => sum + d.gmv, 0);
                const totalOrders = filteredData.reduce((sum, d) => sum + d.orders, 0);
                const totalCommission = filteredData.reduce((sum, d) => sum + d.commission, 0);
                const totalExpenses = filteredData.reduce((sum, d) => sum + d.expenses, 0);
                const netProfit = totalRevenue - totalCommission - totalExpenses;
                const profitMargin = totalRevenue > 0 ? (netProfit / totalRevenue) * 100 : 0;
                const avgOrderValue = totalOrders > 0 ? totalRevenue / totalOrders : 0;

                // Platform breakdown
                const platformBreakdown = platforms.map(platform => {
                    const platformData = filteredData.filter(d => d.platform === platform.id);
                    const revenue = platformData.reduce((sum, d) => sum + d.gmv, 0);
                    const orders = platformData.reduce((sum, d) => sum + d.orders, 0);
                    const commission = platformData.reduce((sum, d) => sum + d.commission, 0);
                    const profit = platformData.reduce((sum, d) => sum + d.netProfit, 0);
                    const margin = revenue > 0 ? (profit / revenue) * 100 : 0;

                    return {
                        ...platform,
                        revenue,
                        orders,
                        commission,
                        profit,
                        margin,
                        marketShare: totalRevenue > 0 ? (revenue / totalRevenue) * 100 : 0
                    };
                }).filter(p => p.orders > 0);

                // Performance score
                const performanceScore = performanceScores[selectedRestaurant.id];

                // Staff Performance Data
                const staff = selectedRestaurant.staff || [];
                const topStaff = staff
                    .filter(s => s.status === 'active')
                    .sort((a, b) => {
                        const aScore = (a.performance?.ordersProcessed || 0) * (a.performance?.efficiency || 0);
                        const bScore = (b.performance?.ordersProcessed || 0) * (b.performance?.efficiency || 0);
                        return bScore - aScore;
                    })
                    .slice(0, 5);

                const staffMetrics = {
                    total: staff.length,
                    active: staff.filter(s => s.status === 'active').length,
                    avgEfficiency: staff.reduce((sum, s) => sum + (s.performance?.efficiency || 0), 0) / staff.length || 0,
                    totalOrders: staff.reduce((sum, s) => sum + (s.performance?.ordersProcessed || 0), 0),
                    topPerformers: topStaff
                };

                // Menu Analytics Data
                const menuItems = [
                    { name: 'Classic Burger', category: 'Burgers', orders: 1250, revenue: 31250, margin: 0.40, popularity: 0.28, profitability: 0.40, trend: '+15%' },
                    { name: 'Cheese Pizza', category: 'Pizza', orders: 980, revenue: 34300, margin: 0.50, popularity: 0.22, profitability: 0.50, trend: '+22%' },
                    { name: 'Caesar Salad', category: 'Salads', orders: 450, revenue: 5850, margin: 0.40, popularity: 0.10, profitability: 0.40, trend: '-8%' },
                    { name: 'Chicken Wings', category: 'Appetizers', orders: 820, revenue: 16400, margin: 0.30, popularity: 0.18, profitability: 0.30, trend: '+5%' },
                    { name: 'Veggie Burger', category: 'Burgers', orders: 320, revenue: 8320, margin: 0.60, popularity: 0.07, profitability: 0.60, trend: '+35%' }
                ];

                const avgPopularity = menuItems.reduce((sum, item) => sum + item.popularity, 0) / menuItems.length;
                const avgProfitability = menuItems.reduce((sum, item) => sum + item.profitability, 0) / menuItems.length;

                const menuAnalytics = {
                    topPerformers: menuItems.filter(i => i.popularity >= avgPopularity && i.profitability >= avgProfitability),
                    trendingItems: menuItems.filter(i => i.popularity < avgPopularity && i.profitability >= avgProfitability),
                    hiddenGems: menuItems.filter(i => i.popularity >= avgPopularity && i.profitability < avgProfitability),
                    underperformers: menuItems.filter(i => i.popularity < avgPopularity && i.profitability < avgProfitability),
                    topRevenue: menuItems.sort((a, b) => b.revenue - a.revenue).slice(0, 5),
                    topMargin: menuItems.sort((a, b) => b.margin - a.margin).slice(0, 5)
                };

                // Branch Comparison Data
                const branches = selectedRestaurant.branches || [];
                const branchPerformance = branches.map(branch => ({
                    ...branch,
                    performance: getBranchPerformance(selectedRestaurant.id, branch.id)
                })).sort((a, b) => b.performance.revenue - a.performance.revenue);

                // ZATCA compliance data
                const reportPeriod = reportType === 'monthly' ? new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) :
                                   reportType === 'weekly' ? `Week ${Math.ceil(new Date().getDate() / 7)}` :
                                   new Date().toLocaleDateString();

                const zatcaData = {
                    businessName: selectedRestaurant.name,
                    taxNumber: `${selectedRestaurant.id.toString().substring(0, 10).toUpperCase()}`,
                    reportPeriod,
                    totalTaxableAmount: totalRevenue,
                    totalTax: totalRevenue * 0.15,
                    totalWithTax: totalRevenue * 1.15,
                    generatedDate: new Date().toISOString(),
                    platformBreakdown: platformBreakdown.map(p => ({
                        platform: p.name,
                        revenue: p.revenue,
                        tax: p.revenue * 0.15
                    }))
                };

                return {
                    totals: {
                        revenue: totalRevenue,
                        orders: totalOrders,
                        commission: totalCommission,
                        expenses: totalExpenses,
                        netProfit,
                        profitMargin,
                        avgOrderValue
                    },
                    platformBreakdown,
                    performanceScore,
                    staffMetrics,
                    menuAnalytics,
                    branchPerformance,
                    zatcaData,
                    periodData: filteredData
                };
            }, [selectedRestaurant, reportType, weeklyData, monthlyData, dailyData, platforms, performanceScores, getBranchPerformance, startDate, endDate]);

            // Generate PDF Report with Dashboard Styling
            const generatePDFReport = async () => {
                if (!selectedRestaurant || !reportData) {
                    utils.showNotification('Please select a restaurant and ensure data is available', 'error');
                    return;
                }

                setGenerating(true);
                utils.showNotification('Generating professional PDF report...', 'info');

                try {
                    const element = document.getElementById('legendary-report-content');
                    if (!element) {
                        throw new Error('Report content not found');
                    }

                    // Use html2canvas with higher quality settings
                    const canvas = await html2canvas(element, {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#ffffff'
                    });

                    const imgData = canvas.toDataURL('image/png');
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');

                    const imgProps = pdf.getImageProperties(imgData);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                    let heightLeft = pdfHeight;
                    let position = 0;

                    // Add first page
                    pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfHeight);
                    heightLeft -= pdf.internal.pageSize.getHeight();

                    // Add additional pages if needed
                    while (heightLeft > 0) {
                        position = heightLeft - pdfHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfHeight);
                        heightLeft -= pdf.internal.pageSize.getHeight();
                    }

                    const filename = `Restalyze_${selectedRestaurant.name.replace(/\s+/g, '_')}_${reportType}_${new Date().toISOString().split('T')[0]}.pdf`;
                    pdf.save(filename);

                    utils.showNotification('PDF report generated successfully!', 'success');
                } catch (error) {
                    console.error('PDF generation error:', error);
                    utils.showNotification('Error generating PDF. Please try again.', 'error');
                } finally {
                    setGenerating(false);
                }
            };

            // Share Report Function
            const shareReport = async () => {
                if (!shareEmail) {
                    utils.showNotification('Please enter an email address', 'error');
                    return;
                }

                utils.showNotification('Preparing to share report...', 'info');

                // Simulate sharing (in production, this would call a backend API)
                setTimeout(() => {
                    utils.showNotification(`Report shared successfully to ${shareEmail}`, 'success');
                    setShowShareModal(false);
                    setShareEmail('');
                }, 1500);
            };

            // Export ZATCA Compliance Report
            const exportZATCAReport = async () => {
                if (!reportData) {
                    utils.showNotification('No data available for ZATCA export', 'error');
                    return;
                }

                utils.showNotification('Generating ZATCA-compliant report...', 'info');

                // Generate ZATCA report as PDF
                const element = document.getElementById('zatca-report-content');
                if (!element) {
                    utils.showNotification('ZATCA report template not found', 'error');
                    return;
                }

                try {
                    const canvas = await html2canvas(element, {
                        scale: 2,
                        useCORS: true,
                        backgroundColor: '#ffffff'
                    });

                    const imgData = canvas.toDataURL('image/png');
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');

                    const imgProps = pdf.getImageProperties(imgData);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);

                    const filename = `ZATCA_Compliance_${selectedRestaurant.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                    pdf.save(filename);

                    utils.showNotification('ZATCA report exported successfully!', 'success');
                } catch (error) {
                    console.error('ZATCA export error:', error);
                    utils.showNotification('Error exporting ZATCA report', 'error');
                }
            };

            if (!selectedRestaurant) {
                return (
                    <div className="p-6">
                        <div className="glass-effect rounded-2xl p-12 text-center">
                            <div className="text-4xl mb-4">üìä</div>
                            <p className="text-enhanced text-lg">No restaurant selected</p>
                            <p className="text-secondary">Please select a restaurant to generate reports</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="p-6 space-y-6">
                    <div className="glass-effect rounded-2xl p-6 hover-lift" style={{ border: '2px solid rgba(255, 215, 0, 0.3)' }}>
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className="text-2xl font-bold text-enhanced mb-2" style={{ background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>
                                    Professional Report Generator
                                </h1>
                                <p className="text-secondary">Multi-section PDF reports with Restalyze branding</p>
                            </div>
                            <div className="flex items-center space-x-2">
                                <span className="text-primary text-sm font-semibold" style={{ color: '#FFD700' }}>PDF Export</span>
                                <span className="text-2xl">üìä</span>
                            </div>
                        </div>

                        {/* Report Configuration */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div className="space-y-4">
                                <div>
                                    <label style={{ display: 'block', fontSize: '0.875rem', fontWeight: '600', marginBottom: '0.5rem', color: '#FFFFFF' }}>
                                        Report Type
                                    </label>
                                    <select
                                        value={reportType}
                                        onChange={(e) => setReportType(e.target.value)}
                                        style={{
                                            width: '100%',
                                            padding: '0.625rem 0.75rem',
                                            backgroundColor: '#1a3a5c',
                                            color: '#FFFFFF',
                                            border: '2px solid #FFD700',
                                            borderRadius: '0.5rem',
                                            fontSize: '0.875rem',
                                            fontWeight: '500',
                                            outline: 'none',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        {Object.entries(APP_CONFIG.reportTypes).map(([key, report]) => (
                                            <option key={key} value={key} style={{ backgroundColor: '#0A2540', color: '#FFFFFF' }}>{report.label}</option>
                                        ))}
                                    </select>
                                    <p style={{ fontSize: '0.75rem', marginTop: '0.25rem', color: '#94a3b8' }}>
                                        {APP_CONFIG.reportTypes[reportType].description}
                                    </p>
                                </div>

                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '1rem' }}>
                                    <div>
                                        <label style={{ display: 'block', fontSize: '0.875rem', fontWeight: '600', marginBottom: '0.5rem', color: '#FFFFFF' }}>
                                            Start Date
                                        </label>
                                        <input
                                            type="date"
                                            value={startDate}
                                            onChange={(e) => setStartDate(e.target.value)}
                                            style={{
                                                width: '100%',
                                                padding: '0.625rem 0.75rem',
                                                backgroundColor: '#1a3a5c',
                                                color: '#FFFFFF',
                                                border: '2px solid rgba(255, 215, 0, 0.5)',
                                                borderRadius: '0.5rem',
                                                fontSize: '0.875rem',
                                                outline: 'none'
                                            }}
                                        />
                                    </div>
                                    <div>
                                        <label style={{ display: 'block', fontSize: '0.875rem', fontWeight: '600', marginBottom: '0.5rem', color: '#FFFFFF' }}>
                                            End Date
                                        </label>
                                        <input
                                            type="date"
                                            value={endDate}
                                            onChange={(e) => setEndDate(e.target.value)}
                                            style={{
                                                width: '100%',
                                                padding: '0.625rem 0.75rem',
                                                backgroundColor: '#1a3a5c',
                                                color: '#FFFFFF',
                                                border: '2px solid rgba(255, 215, 0, 0.5)',
                                                borderRadius: '0.5rem',
                                                fontSize: '0.875rem',
                                                outline: 'none'
                                            }}
                                        />
                                    </div>
                                </div>

                                <div className="space-y-3" style={{ marginTop: '1.5rem' }}>
                                    <div style={{ fontSize: '0.75rem', fontWeight: '700', marginBottom: '0.75rem', color: '#FFD700', letterSpacing: '0.05em', borderBottom: '2px solid #FFD700', paddingBottom: '0.5rem' }}>
                                        üìä REPORT SECTIONS
                                    </div>

                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.625rem', backgroundColor: 'rgba(255, 255, 255, 0.05)', borderRadius: '0.5rem', border: '1px solid rgba(255, 215, 0, 0.2)' }}>
                                        <input
                                            type="checkbox"
                                            id="includeCharts"
                                            checked={includeCharts}
                                            onChange={(e) => setIncludeCharts(e.target.checked)}
                                            style={{ width: '1.125rem', height: '1.125rem', cursor: 'pointer', accentColor: '#FFD700' }}
                                        />
                                        <label htmlFor="includeCharts" style={{ fontSize: '0.875rem', fontWeight: '500', color: '#FFFFFF', cursor: 'pointer', flex: 1 }}>
                                            Executive Summary & Financial Overview
                                        </label>
                                    </div>

                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.625rem', backgroundColor: 'rgba(255, 255, 255, 0.05)', borderRadius: '0.5rem', border: '1px solid rgba(255, 215, 0, 0.2)' }}>
                                        <input
                                            type="checkbox"
                                            id="includeStaffPerformance"
                                            checked={includeStaffPerformance}
                                            onChange={(e) => setIncludeStaffPerformance(e.target.checked)}
                                            style={{ width: '1.125rem', height: '1.125rem', cursor: 'pointer', accentColor: '#FFD700' }}
                                        />
                                        <label htmlFor="includeStaffPerformance" style={{ fontSize: '0.875rem', fontWeight: '500', color: '#FFFFFF', cursor: 'pointer', flex: 1 }}>
                                            üë• Staff Performance Leaderboard
                                        </label>
                                    </div>

                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.625rem', backgroundColor: 'rgba(255, 255, 255, 0.05)', borderRadius: '0.5rem', border: '1px solid rgba(255, 215, 0, 0.2)' }}>
                                        <input
                                            type="checkbox"
                                            id="includeMenuAnalytics"
                                            checked={includeMenuAnalytics}
                                            onChange={(e) => setIncludeMenuAnalytics(e.target.checked)}
                                            style={{ width: '1.125rem', height: '1.125rem', cursor: 'pointer', accentColor: '#FFD700' }}
                                        />
                                        <label htmlFor="includeMenuAnalytics" style={{ fontSize: '0.875rem', fontWeight: '500', color: '#FFFFFF', cursor: 'pointer', flex: 1 }}>
                                            üçΩÔ∏è Menu Performance Intelligence
                                        </label>
                                    </div>

                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.625rem', backgroundColor: 'rgba(255, 255, 255, 0.05)', borderRadius: '0.5rem', border: '1px solid rgba(255, 215, 0, 0.2)' }}>
                                        <input
                                            type="checkbox"
                                            id="includeBranchComparison"
                                            checked={includeBranchComparison}
                                            onChange={(e) => setIncludeBranchComparison(e.target.checked)}
                                            style={{ width: '1.125rem', height: '1.125rem', cursor: 'pointer', accentColor: '#FFD700' }}
                                        />
                                        <label htmlFor="includeBranchComparison" style={{ fontSize: '0.875rem', fontWeight: '500', color: '#FFFFFF', cursor: 'pointer', flex: 1 }}>
                                            üè¢ Branch Performance Comparison
                                        </label>
                                    </div>

                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.625rem', backgroundColor: 'rgba(255, 255, 255, 0.05)', borderRadius: '0.5rem', border: '1px solid rgba(255, 215, 0, 0.2)' }}>
                                        <input
                                            type="checkbox"
                                            id="includePlatformBreakdown"
                                            checked={includePlatformBreakdown}
                                            onChange={(e) => setIncludePlatformBreakdown(e.target.checked)}
                                            style={{ width: '1.125rem', height: '1.125rem', cursor: 'pointer', accentColor: '#FFD700' }}
                                        />
                                        <label htmlFor="includePlatformBreakdown" style={{ fontSize: '0.875rem', fontWeight: '500', color: '#FFFFFF', cursor: 'pointer', flex: 1 }}>
                                            üì± Platform Performance Breakdown
                                        </label>
                                    </div>

                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.625rem', backgroundColor: 'rgba(255, 255, 255, 0.05)', borderRadius: '0.5rem', border: '1px solid rgba(255, 215, 0, 0.2)' }}>
                                        <input
                                            type="checkbox"
                                            id="includeZATCACompliance"
                                            checked={includeZATCACompliance}
                                            onChange={(e) => setIncludeZATCACompliance(e.target.checked)}
                                            style={{ width: '1.125rem', height: '1.125rem', cursor: 'pointer', accentColor: '#FFD700' }}
                                        />
                                        <label htmlFor="includeZATCACompliance" style={{ fontSize: '0.875rem', fontWeight: '500', color: '#FFFFFF', cursor: 'pointer', flex: 1 }}>
                                            üá∏üá¶ ZATCA Compliance (Saudi Arabia)
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div style={{ backgroundColor: 'rgba(10, 37, 64, 0.4)', borderRadius: '0.75rem', padding: '1.5rem', border: '2px solid rgba(255, 215, 0, 0.3)' }}>
                                <h4 style={{ fontSize: '1rem', fontWeight: '700', marginBottom: '1rem', color: '#FFD700', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                    <span>üìã</span> Report Summary
                                </h4>
                                {reportData && (
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem', fontSize: '0.875rem' }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.5rem', backgroundColor: 'rgba(255, 255, 255, 0.05)', borderRadius: '0.375rem' }}>
                                            <span style={{ color: '#94a3b8', fontWeight: '500' }}>Restaurant:</span>
                                            <span style={{ color: '#FFFFFF', fontWeight: '600' }}>{selectedRestaurant.name}</span>
                                        </div>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.5rem', backgroundColor: 'rgba(255, 255, 255, 0.05)', borderRadius: '0.375rem' }}>
                                            <span style={{ color: '#94a3b8', fontWeight: '500' }}>Report Type:</span>
                                            <span style={{ color: '#FFFFFF', fontWeight: '600' }}>{APP_CONFIG.reportTypes[reportType].label}</span>
                                        </div>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.5rem', backgroundColor: 'rgba(255, 255, 255, 0.05)', borderRadius: '0.375rem' }}>
                                            <span style={{ color: '#94a3b8', fontWeight: '500' }}>Total Revenue:</span>
                                            <span style={{ color: '#10b981', fontWeight: '700', fontSize: '1rem' }}>{utils.formatCurrency(reportData.totals.revenue)}</span>
                                        </div>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.5rem', backgroundColor: 'rgba(255, 255, 255, 0.05)', borderRadius: '0.375rem' }}>
                                            <span style={{ color: '#94a3b8', fontWeight: '500' }}>Total Orders:</span>
                                            <span style={{ color: '#FFFFFF', fontWeight: '600' }}>{utils.formatNumber(reportData.totals.orders)}</span>
                                        </div>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.5rem', backgroundColor: 'rgba(255, 255, 255, 0.05)', borderRadius: '0.375rem' }}>
                                            <span style={{ color: '#94a3b8', fontWeight: '500' }}>Net Profit:</span>
                                            <span style={{ color: '#FFD700', fontWeight: '700', fontSize: '1rem' }}>{utils.formatCurrency(reportData.totals.netProfit)}</span>
                                        </div>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.5rem', backgroundColor: 'rgba(255, 255, 255, 0.05)', borderRadius: '0.375rem' }}>
                                            <span style={{ color: '#94a3b8', fontWeight: '500' }}>Profit Margin:</span>
                                            <span style={{ color: '#FFFFFF', fontWeight: '600' }}>{reportData.totals.profitMargin.toFixed(1)}%</span>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Action Buttons */}
                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '1rem', marginTop: '1.5rem' }}>
                            <button
                                onClick={generatePDFReport}
                                disabled={generating}
                                style={{
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '0.5rem',
                                    padding: '0.875rem 1.75rem',
                                    background: generating ? '#94a3b8' : 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                                    color: '#0A2540',
                                    fontSize: '0.9375rem',
                                    fontWeight: '700',
                                    borderRadius: '0.75rem',
                                    border: '2px solid #FFD700',
                                    cursor: generating ? 'not-allowed' : 'pointer',
                                    transition: 'all 0.3s ease',
                                    boxShadow: generating ? 'none' : '0 4px 6px rgba(255, 215, 0, 0.3)',
                                    opacity: generating ? 0.6 : 1
                                }}
                                onMouseOver={(e) => {
                                    if (!generating) {
                                        e.currentTarget.style.transform = 'translateY(-2px)';
                                        e.currentTarget.style.boxShadow = '0 6px 12px rgba(255, 215, 0, 0.5)';
                                    }
                                }}
                                onMouseOut={(e) => {
                                    if (!generating) {
                                        e.currentTarget.style.transform = 'translateY(0)';
                                        e.currentTarget.style.boxShadow = '0 4px 6px rgba(255, 215, 0, 0.3)';
                                    }
                                }}
                            >
                                <span style={{ fontSize: '1.25rem' }}>{generating ? '‚è≥' : 'üìÑ'}</span>
                                <span>{generating ? 'Generating...' : 'Generate PDF Report'}</span>
                            </button>

                            <button
                                onClick={() => setShowShareModal(true)}
                                style={{
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '0.5rem',
                                    padding: '0.875rem 1.75rem',
                                    backgroundColor: '#0A2540',
                                    color: '#FFFFFF',
                                    fontSize: '0.9375rem',
                                    fontWeight: '600',
                                    borderRadius: '0.75rem',
                                    border: '2px solid rgba(255, 215, 0, 0.5)',
                                    cursor: 'pointer',
                                    transition: 'all 0.3s ease'
                                }}
                                onMouseOver={(e) => {
                                    e.currentTarget.style.backgroundColor = '#1a3a5c';
                                    e.currentTarget.style.borderColor = '#FFD700';
                                }}
                                onMouseOut={(e) => {
                                    e.currentTarget.style.backgroundColor = '#0A2540';
                                    e.currentTarget.style.borderColor = 'rgba(255, 215, 0, 0.5)';
                                }}
                            >
                                <span style={{ fontSize: '1.25rem' }}>üì§</span>
                                <span>Share Report</span>
                            </button>

                            {includeZATCACompliance && (
                                <button
                                    onClick={exportZATCAReport}
                                    style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.5rem',
                                        padding: '0.875rem 1.75rem',
                                        backgroundColor: '#10b981',
                                        color: '#FFFFFF',
                                        fontSize: '0.9375rem',
                                        fontWeight: '600',
                                        borderRadius: '0.75rem',
                                        border: '2px solid #059669',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease',
                                        boxShadow: '0 4px 6px rgba(16, 185, 129, 0.3)'
                                    }}
                                    onMouseOver={(e) => {
                                        e.currentTarget.style.backgroundColor = '#059669';
                                        e.currentTarget.style.transform = 'translateY(-2px)';
                                        e.currentTarget.style.boxShadow = '0 6px 12px rgba(16, 185, 129, 0.5)';
                                    }}
                                    onMouseOut={(e) => {
                                        e.currentTarget.style.backgroundColor = '#10b981';
                                        e.currentTarget.style.transform = 'translateY(0)';
                                        e.currentTarget.style.boxShadow = '0 4px 6px rgba(16, 185, 129, 0.3)';
                                    }}
                                >
                                    <span style={{ fontSize: '1.25rem' }}>üá∏üá¶</span>
                                    <span>Export ZATCA Report</span>
                                </button>
                            )}
                        </div>

                        {/* Report Content with Dashboard Styling */}
                        {reportData && (
                            <div id="legendary-report-content" className="mt-8 bg-white rounded-lg p-8 shadow-lg" style={{ fontFamily: 'Inter, sans-serif' }}>
                                {/* Report Header with Restalyze Branding */}
                                <div style={{ borderBottom: '4px solid #0A2540', paddingBottom: '24px', marginBottom: '32px' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start' }}>
                                        <div>
                                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '8px' }}>
                                                {selectedRestaurant.customLogo ? (
                                                    <img
                                                        src={selectedRestaurant.customLogo}
                                                        alt={`${selectedRestaurant.name} logo`}
                                                        style={{ width: '60px', height: '60px', borderRadius: '8px', objectFit: 'cover' }}
                                                    />
                                                ) : (
                                                    <div style={{ fontSize: '48px' }}>{selectedRestaurant.logo}</div>
                                                )}
                                                <div>
                                                    <h1 style={{ fontSize: '28px', fontWeight: 'bold', color: '#0A2540', margin: 0 }}>
                                                        {selectedRestaurant.name}
                                                    </h1>
                                                    <p style={{ fontSize: '14px', color: '#64748b', margin: 0 }}>
                                                        {selectedRestaurant.type} ‚Ä¢ {selectedRestaurant.description}
                                                    </p>
                                                </div>
                                            </div>
                                            <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#FFD700', marginTop: '12px' }}>
                                                {APP_CONFIG.reportTypes[reportType].label}
                                            </h2>
                                        </div>
                                        <div style={{ textAlign: 'right' }}>
                                            <div style={{ fontSize: '32px', fontWeight: 'bold', background: 'linear-gradient(135deg, #0A2540 0%, #FFD700 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>Restalyze</div>
                                            <div style={{ fontSize: '11px', color: '#64748b', letterSpacing: '0.5px' }}>PROFESSIONAL EDITION</div>
                                            <div style={{ fontSize: '12px', color: '#64748b', marginTop: '12px' }}>
                                                Generated: {new Date().toLocaleDateString()}
                                            </div>
                                            <div style={{ fontSize: '12px', color: '#64748b' }}>
                                                Period: {startDate || 'N/A'} to {endDate || 'N/A'}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Executive Summary */}
                                <div style={{ marginBottom: '40px', background: 'linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)', padding: '24px', borderRadius: '12px', border: '2px solid #FFD700' }}>
                                    <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#0A2540', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                        <span>üìä</span> Executive Summary
                                    </h3>
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '16px' }}>
                                        <div>
                                            <p style={{ fontSize: '13px', color: '#64748b', marginBottom: '4px' }}>Report Period</p>
                                            <p style={{ fontSize: '15px', fontWeight: '600', color: '#0A2540', margin: 0 }}>{startDate} to {endDate}</p>
                                        </div>
                                        <div>
                                            <p style={{ fontSize: '13px', color: '#64748b', marginBottom: '4px' }}>Total Orders Processed</p>
                                            <p style={{ fontSize: '15px', fontWeight: '600', color: '#0A2540', margin: 0 }}>{utils.formatNumber(reportData.totals.orders)} orders</p>
                                        </div>
                                        <div>
                                            <p style={{ fontSize: '13px', color: '#64748b', marginBottom: '4px' }}>Performance Score</p>
                                            <p style={{ fontSize: '15px', fontWeight: '600', color: '#0A2540', margin: 0 }}>
                                                {reportData.performanceScore ? `${reportData.performanceScore.score} / Grade ${reportData.performanceScore.grade}` : 'N/A'}
                                            </p>
                                        </div>
                                        <div>
                                            <p style={{ fontSize: '13px', color: '#64748b', marginBottom: '4px' }}>Top Performing Branch</p>
                                            <p style={{ fontSize: '15px', fontWeight: '600', color: '#0A2540', margin: 0 }}>
                                                {reportData.branchPerformance && reportData.branchPerformance.length > 0 ? reportData.branchPerformance[0].name : 'Main Branch'}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Financial Overview - Key Performance Indicators */}
                                <div style={{ marginBottom: '40px' }}>
                                    <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#0A2540', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                        <span>üí∞</span> Financial Overview
                                    </h3>
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px' }}>
                                        <div style={{ background: 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%)', padding: '20px', borderRadius: '12px', color: 'white', border: '2px solid #FFD700' }}>
                                            <div style={{ fontSize: '13px', opacity: 0.9, fontWeight: '500' }}>Total Revenue</div>
                                            <div style={{ fontSize: '24px', fontWeight: 'bold', marginTop: '8px', color: '#FFD700' }}>
                                                {utils.formatCurrency(reportData.totals.revenue)}
                                            </div>
                                            <div style={{ fontSize: '12px', opacity: 0.8, marginTop: '4px' }}>
                                                {utils.formatNumber(reportData.totals.orders)} orders
                                            </div>
                                        </div>

                                        <div style={{ background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)', padding: '20px', borderRadius: '12px', color: 'white' }}>
                                            <div style={{ fontSize: '13px', opacity: 0.9, fontWeight: '500' }}>Net Profit</div>
                                            <div style={{ fontSize: '24px', fontWeight: 'bold', marginTop: '8px' }}>
                                                {utils.formatCurrency(reportData.totals.netProfit)}
                                            </div>
                                            <div style={{ fontSize: '12px', opacity: 0.8, marginTop: '4px' }}>
                                                {reportData.totals.profitMargin.toFixed(1)}% margin
                                            </div>
                                        </div>

                                        <div style={{ background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)', padding: '20px', borderRadius: '12px', color: 'white' }}>
                                            <div style={{ fontSize: '13px', opacity: 0.95, fontWeight: '500', color: '#0A2540' }}>Commissions</div>
                                            <div style={{ fontSize: '24px', fontWeight: 'bold', marginTop: '8px', color: '#0A2540' }}>
                                                {utils.formatCurrency(reportData.totals.commission)}
                                            </div>
                                            <div style={{ fontSize: '12px', opacity: 0.9, marginTop: '4px', color: '#0A2540' }}>
                                                {((reportData.totals.commission / reportData.totals.revenue) * 100).toFixed(1)}% of revenue
                                            </div>
                                        </div>

                                        <div style={{ background: 'linear-gradient(135deg, #0A2540 0%, #FFD700 100%)', padding: '20px', borderRadius: '12px', color: 'white' }}>
                                            <div style={{ fontSize: '13px', opacity: 0.9, fontWeight: '500' }}>Avg Order Value</div>
                                            <div style={{ fontSize: '24px', fontWeight: 'bold', marginTop: '8px' }}>
                                                {utils.formatCurrency(reportData.totals.avgOrderValue)}
                                            </div>
                                            <div style={{ fontSize: '12px', opacity: 0.8, marginTop: '4px' }}>
                                                per order
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Staff Performance Section */}
                                {includeStaffPerformance && reportData.staffMetrics && reportData.staffMetrics.topPerformers && reportData.staffMetrics.topPerformers.length > 0 && (
                                    <div style={{ marginBottom: '40px' }}>
                                        <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#0A2540', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <span>üë•</span> Staff Performance
                                        </h3>
                                        <div style={{ background: '#f8fafc', padding: '20px', borderRadius: '12px', border: '1px solid #e2e8f0', marginBottom: '16px' }}>
                                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px', marginBottom: '16px' }}>
                                                <div style={{ textAlign: 'center' }}>
                                                    <div style={{ fontSize: '28px', fontWeight: 'bold', color: '#0A2540' }}>{reportData.staffMetrics.total}</div>
                                                    <div style={{ fontSize: '12px', color: '#64748b', marginTop: '4px' }}>Total Staff</div>
                                                </div>
                                                <div style={{ textAlign: 'center' }}>
                                                    <div style={{ fontSize: '28px', fontWeight: 'bold', color: '#10b981' }}>{reportData.staffMetrics.active}</div>
                                                    <div style={{ fontSize: '12px', color: '#64748b', marginTop: '4px' }}>Active Staff</div>
                                                </div>
                                                <div style={{ textAlign: 'center' }}>
                                                    <div style={{ fontSize: '28px', fontWeight: 'bold', color: '#FFD700' }}>{reportData.staffMetrics.avgEfficiency.toFixed(0)}%</div>
                                                    <div style={{ fontSize: '12px', color: '#64748b', marginTop: '4px' }}>Avg Efficiency</div>
                                                </div>
                                                <div style={{ textAlign: 'center' }}>
                                                    <div style={{ fontSize: '28px', fontWeight: 'bold', color: '#0A2540' }}>{utils.formatNumber(reportData.staffMetrics.totalOrders)}</div>
                                                    <div style={{ fontSize: '12px', color: '#64748b', marginTop: '4px' }}>Orders Processed</div>
                                                </div>
                                            </div>
                                        </div>

                                        <h4 style={{ fontSize: '16px', fontWeight: '600', color: '#0A2540', marginBottom: '12px' }}>Top 5 Performers</h4>
                                        <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                                            <thead>
                                                <tr style={{ background: '#0A2540', color: 'white' }}>
                                                    <th style={{ padding: '12px', textAlign: 'left', fontSize: '13px', fontWeight: '600', borderTopLeftRadius: '8px' }}>Rank</th>
                                                    <th style={{ padding: '12px', textAlign: 'left', fontSize: '13px', fontWeight: '600' }}>Name</th>
                                                    <th style={{ padding: '12px', textAlign: 'left', fontSize: '13px', fontWeight: '600' }}>Role</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600' }}>Orders</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600' }}>Efficiency</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600', borderTopRightRadius: '8px' }}>Rating</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {reportData.staffMetrics.topPerformers.map((staff, index) => (
                                                    <tr key={staff.id} style={{ borderBottom: '1px solid #e2e8f0', background: index % 2 === 0 ? 'white' : '#f8fafc' }}>
                                                        <td style={{ padding: '12px', fontSize: '14px', color: '#0A2540', fontWeight: 'bold' }}>
                                                            {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `#${index + 1}`}
                                                        </td>
                                                        <td style={{ padding: '12px', fontSize: '14px', color: '#0f172a', fontWeight: '600' }}>
                                                            {staff.avatar} {staff.name}
                                                        </td>
                                                        <td style={{ padding: '12px', fontSize: '13px', color: '#64748b' }}>
                                                            {staff.role}
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', color: '#0f172a', fontWeight: '600' }}>
                                                            {staff.performance?.ordersProcessed || 0}
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', fontWeight: '600', color: (staff.performance?.efficiency || 0) >= 90 ? '#10b981' : (staff.performance?.efficiency || 0) >= 75 ? '#FFD700' : '#64748b' }}>
                                                            {(staff.performance?.efficiency || 0).toFixed(0)}%
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', color: '#FFD700', fontWeight: '600' }}>
                                                            ‚≠ê {(staff.performance?.avgRating || 0).toFixed(1)}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}

                                {/* Menu Performance Intelligence Section */}
                                {includeMenuAnalytics && reportData.menuAnalytics && (
                                    <div style={{ marginBottom: '40px', pageBreakInside: 'avoid' }}>
                                        <div style={{ borderBottom: '3px solid #FFD700', paddingBottom: '12px', marginBottom: '24px' }}>
                                            <h3 style={{ fontSize: '22px', fontWeight: 'bold', color: '#0A2540', display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '6px' }}>
                                                <span style={{ fontSize: '28px' }}>üçΩÔ∏è</span> Menu Performance Intelligence
                                            </h3>
                                            <p style={{ fontSize: '13px', color: '#64748b', fontStyle: 'italic', margin: 0 }}>
                                                Strategic analysis of menu items based on popularity and profitability metrics
                                            </p>
                                        </div>

                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '20px', marginBottom: '28px' }}>
                                            {/* Top Performers - High Popularity + High Profitability */}
                                            <div style={{
                                                background: 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%)',
                                                padding: '20px',
                                                borderRadius: '12px',
                                                border: '3px solid #FFD700',
                                                boxShadow: '0 4px 12px rgba(255, 215, 0, 0.2)'
                                            }}>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '12px' }}>
                                                    <span style={{ fontSize: '28px' }}>üî•</span>
                                                    <div>
                                                        <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#FFD700' }}>
                                                            Top Performers
                                                        </div>
                                                        <div style={{ fontSize: '11px', color: 'rgba(255, 255, 255, 0.8)', fontWeight: '500', marginTop: '2px' }}>
                                                            {reportData.menuAnalytics.topPerformers.length} items
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.9)', marginBottom: '14px', paddingLeft: '4px', borderLeft: '3px solid #FFD700', paddingLeft: '12px' }}>
                                                    High customer demand with excellent profit margins. Promote these items heavily.
                                                </div>
                                                {reportData.menuAnalytics.topPerformers.length > 0 ? (
                                                    reportData.menuAnalytics.topPerformers.slice(0, 3).map((item, idx) => (
                                                        <div key={item.name} style={{
                                                            fontSize: '13px',
                                                            padding: '8px 12px',
                                                            marginBottom: '6px',
                                                            background: 'rgba(255, 215, 0, 0.15)',
                                                            borderRadius: '6px',
                                                            borderLeft: '3px solid #FFD700',
                                                            color: '#FFFFFF',
                                                            fontWeight: '500'
                                                        }}>
                                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                                <span>‚Ä¢ {item.name}</span>
                                                                <span style={{ fontSize: '11px', color: '#FFD700', fontWeight: '600' }}>{item.orders} orders</span>
                                                            </div>
                                                        </div>
                                                    ))
                                                ) : (
                                                    <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)', fontStyle: 'italic', padding: '10px' }}>
                                                        No items in this category yet
                                                    </div>
                                                )}
                                            </div>

                                            {/* Trending Items - Low Popularity + High Profitability */}
                                            <div style={{
                                                background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                                                padding: '20px',
                                                borderRadius: '12px',
                                                border: '3px solid #0A2540',
                                                boxShadow: '0 4px 12px rgba(10, 37, 64, 0.15)'
                                            }}>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '12px' }}>
                                                    <span style={{ fontSize: '28px' }}>üåü</span>
                                                    <div>
                                                        <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#0A2540' }}>
                                                            Trending Items
                                                        </div>
                                                        <div style={{ fontSize: '11px', color: 'rgba(10, 37, 64, 0.8)', fontWeight: '500', marginTop: '2px' }}>
                                                            {reportData.menuAnalytics.trendingItems.length} items
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style={{ fontSize: '12px', color: 'rgba(10, 37, 64, 0.9)', marginBottom: '14px', paddingLeft: '4px', borderLeft: '3px solid #0A2540', paddingLeft: '12px' }}>
                                                    High-margin items with growth potential. Increase visibility and marketing.
                                                </div>
                                                {reportData.menuAnalytics.trendingItems.length > 0 ? (
                                                    reportData.menuAnalytics.trendingItems.slice(0, 3).map((item, idx) => (
                                                        <div key={item.name} style={{
                                                            fontSize: '13px',
                                                            padding: '8px 12px',
                                                            marginBottom: '6px',
                                                            background: 'rgba(10, 37, 64, 0.15)',
                                                            borderRadius: '6px',
                                                            borderLeft: '3px solid #0A2540',
                                                            color: '#0A2540',
                                                            fontWeight: '500'
                                                        }}>
                                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                                <span>‚Ä¢ {item.name}</span>
                                                                <span style={{ fontSize: '11px', color: '#0A2540', fontWeight: '600' }}>{item.orders} orders</span>
                                                            </div>
                                                        </div>
                                                    ))
                                                ) : (
                                                    <div style={{ fontSize: '12px', color: 'rgba(10, 37, 64, 0.5)', fontStyle: 'italic', padding: '10px' }}>
                                                        No items in this category yet
                                                    </div>
                                                )}
                                            </div>

                                            {/* Hidden Gems - High Popularity + Low Profitability */}
                                            <div style={{
                                                background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                                                padding: '20px',
                                                borderRadius: '12px',
                                                border: '2px solid #064e3b',
                                                boxShadow: '0 4px 12px rgba(16, 185, 129, 0.15)'
                                            }}>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '12px' }}>
                                                    <span style={{ fontSize: '28px' }}>üíé</span>
                                                    <div>
                                                        <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#FFFFFF' }}>
                                                            Hidden Gems
                                                        </div>
                                                        <div style={{ fontSize: '11px', color: 'rgba(255, 255, 255, 0.8)', fontWeight: '500', marginTop: '2px' }}>
                                                            {reportData.menuAnalytics.hiddenGems.length} items
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.9)', marginBottom: '14px', paddingLeft: '4px', borderLeft: '3px solid rgba(255, 255, 255, 0.5)', paddingLeft: '12px' }}>
                                                    Customer favorites with room to optimize pricing or portions.
                                                </div>
                                                {reportData.menuAnalytics.hiddenGems.length > 0 ? (
                                                    reportData.menuAnalytics.hiddenGems.slice(0, 3).map((item, idx) => (
                                                        <div key={item.name} style={{
                                                            fontSize: '13px',
                                                            padding: '8px 12px',
                                                            marginBottom: '6px',
                                                            background: 'rgba(255, 255, 255, 0.2)',
                                                            borderRadius: '6px',
                                                            borderLeft: '3px solid rgba(255, 255, 255, 0.6)',
                                                            color: '#FFFFFF',
                                                            fontWeight: '500'
                                                        }}>
                                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                                <span>‚Ä¢ {item.name}</span>
                                                                <span style={{ fontSize: '11px', color: 'rgba(255, 255, 255, 0.9)', fontWeight: '600' }}>{item.orders} orders</span>
                                                            </div>
                                                        </div>
                                                    ))
                                                ) : (
                                                    <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)', fontStyle: 'italic', padding: '10px' }}>
                                                        No items in this category yet
                                                    </div>
                                                )}
                                            </div>

                                            {/* Underperformers - Low Popularity + Low Profitability */}
                                            <div style={{
                                                background: 'linear-gradient(135deg, #64748b 0%, #475569 100%)',
                                                padding: '20px',
                                                borderRadius: '12px',
                                                border: '2px solid #334155',
                                                boxShadow: '0 4px 12px rgba(100, 116, 139, 0.15)'
                                            }}>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '12px' }}>
                                                    <span style={{ fontSize: '28px' }}>‚ö†Ô∏è</span>
                                                    <div>
                                                        <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#FFFFFF' }}>
                                                            Underperformers
                                                        </div>
                                                        <div style={{ fontSize: '11px', color: 'rgba(255, 255, 255, 0.8)', fontWeight: '500', marginTop: '2px' }}>
                                                            {reportData.menuAnalytics.underperformers.length} items
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.9)', marginBottom: '14px', paddingLeft: '4px', borderLeft: '3px solid rgba(255, 255, 255, 0.4)', paddingLeft: '12px' }}>
                                                    Consider menu refresh, recipe improvement, or strategic removal.
                                                </div>
                                                {reportData.menuAnalytics.underperformers.length > 0 ? (
                                                    reportData.menuAnalytics.underperformers.slice(0, 3).map((item, idx) => (
                                                        <div key={item.name} style={{
                                                            fontSize: '13px',
                                                            padding: '8px 12px',
                                                            marginBottom: '6px',
                                                            background: 'rgba(255, 255, 255, 0.15)',
                                                            borderRadius: '6px',
                                                            borderLeft: '3px solid rgba(255, 255, 255, 0.4)',
                                                            color: '#FFFFFF',
                                                            fontWeight: '500'
                                                        }}>
                                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                                <span>‚Ä¢ {item.name}</span>
                                                                <span style={{ fontSize: '11px', color: 'rgba(255, 255, 255, 0.7)', fontWeight: '600' }}>{item.orders} orders</span>
                                                            </div>
                                                        </div>
                                                    ))
                                                ) : (
                                                    <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.5)', fontStyle: 'italic', padding: '10px' }}>
                                                        No items in this category - excellent!
                                                    </div>
                                                )}
                                            </div>
                                        </div>

                                        {/* Revenue Leaders Section */}
                                        <div style={{ background: 'linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)', padding: '20px', borderRadius: '12px', border: '2px solid #FFD700' }}>
                                            <h4 style={{ fontSize: '16px', fontWeight: 'bold', color: '#0A2540', marginBottom: '14px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                <span>üí∞</span> Top Revenue Generators
                                            </h4>
                                            <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
                                                {reportData.menuAnalytics.topRevenue.map((item, index) => (
                                                    <div key={item.name} style={{
                                                        background: 'white',
                                                        border: '2px solid #FFD700',
                                                        padding: '10px 18px',
                                                        borderRadius: '10px',
                                                        fontSize: '13px',
                                                        boxShadow: '0 2px 4px rgba(10, 37, 64, 0.1)'
                                                    }}>
                                                        <span style={{ fontWeight: 'bold', color: '#0A2540', marginRight: '6px' }}>#{index + 1}</span>
                                                        <span style={{ color: '#64748b', marginRight: '6px' }}>{item.name}</span>
                                                        <span style={{ color: '#10b981', fontWeight: '700' }}>{utils.formatCurrency(item.revenue)}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Branch Comparison Section */}
                                {includeBranchComparison && reportData.branchPerformance && reportData.branchPerformance.length > 1 && (
                                    <div style={{ marginBottom: '40px' }}>
                                        <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#0A2540', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <span>üè¢</span> Branch Performance Comparison
                                        </h3>
                                        <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                                            <thead>
                                                <tr style={{ background: '#0A2540', color: 'white' }}>
                                                    <th style={{ padding: '12px', textAlign: 'left', fontSize: '13px', fontWeight: '600', borderTopLeftRadius: '8px' }}>Rank</th>
                                                    <th style={{ padding: '12px', textAlign: 'left', fontSize: '13px', fontWeight: '600' }}>Branch Name</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600' }}>Revenue</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600' }}>Orders</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600' }}>Profit Margin</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600', borderTopRightRadius: '8px' }}>Rating</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {reportData.branchPerformance.map((branch, index) => (
                                                    <tr key={branch.id} style={{ borderBottom: '1px solid #e2e8f0', background: index % 2 === 0 ? 'white' : '#f8fafc' }}>
                                                        <td style={{ padding: '12px', fontSize: '14px', fontWeight: 'bold', color: index === 0 ? '#FFD700' : '#0A2540' }}>
                                                            {index === 0 ? 'üëë' : `#${index + 1}`}
                                                        </td>
                                                        <td style={{ padding: '12px', fontSize: '14px', color: '#0f172a', fontWeight: '600' }}>
                                                            {branch.name}
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', color: '#10b981', fontWeight: '600' }}>
                                                            {utils.formatCurrency(branch.performance?.revenue || 0)}
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', color: '#0f172a' }}>
                                                            {utils.formatNumber(branch.performance?.orders || 0)}
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', fontWeight: '600', color: (branch.performance?.profitMargin || 0) >= 15 ? '#10b981' : '#64748b' }}>
                                                            {(branch.performance?.profitMargin || 0).toFixed(1)}%
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', color: '#FFD700', fontWeight: '600' }}>
                                                            ‚≠ê {(branch.performance?.rating || 0).toFixed(1)}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}

                                {/* Platform Breakdown */}
                                {includePlatformBreakdown && reportData.platformBreakdown.length > 0 && (
                                    <div style={{ marginBottom: '40px' }}>
                                        <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#0A2540', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <span>üì±</span> Platform Performance Breakdown
                                        </h3>
                                        <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                                            <thead>
                                                <tr style={{ background: '#0A2540', color: 'white' }}>
                                                    <th style={{ padding: '12px', textAlign: 'left', fontSize: '13px', fontWeight: '600', borderTopLeftRadius: '8px' }}>Platform</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600' }}>Revenue</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600' }}>Orders</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600' }}>Commission</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600' }}>Profit</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600' }}>Margin</th>
                                                    <th style={{ padding: '12px', textAlign: 'right', fontSize: '13px', fontWeight: '600', borderTopRightRadius: '8px' }}>Market Share</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {reportData.platformBreakdown.map((platform, index) => (
                                                    <tr key={platform.id} style={{ borderBottom: '1px solid #e2e8f0', background: index % 2 === 0 ? 'white' : '#f8fafc' }}>
                                                        <td style={{ padding: '12px', fontSize: '14px', color: '#0f172a', fontWeight: '600' }}>
                                                            <span style={{
                                                                display: 'inline-block',
                                                                width: '10px',
                                                                height: '10px',
                                                                borderRadius: '50%',
                                                                backgroundColor: platform.color,
                                                                marginRight: '8px'
                                                            }}></span>
                                                            {platform.name}
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', fontWeight: '600', color: '#10b981' }}>
                                                            {utils.formatCurrency(platform.revenue)}
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', color: '#0A2540' }}>
                                                            {utils.formatNumber(platform.orders)}
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', color: '#FFD700', fontWeight: '600' }}>
                                                            {utils.formatCurrency(platform.commission)}
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', fontWeight: '600', color: '#10b981' }}>
                                                            {utils.formatCurrency(platform.profit)}
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', fontWeight: '600', color: platform.margin >= 15 ? '#10b981' : platform.margin >= 10 ? '#FFD700' : '#ef4444' }}>
                                                            {platform.margin.toFixed(1)}%
                                                        </td>
                                                        <td style={{ padding: '12px', textAlign: 'right', fontSize: '14px', color: '#0A2540', fontWeight: '600' }}>
                                                            {platform.marketShare.toFixed(1)}%
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}

                                {/* Performance Score */}
                                {reportData.performanceScore && (
                                    <div style={{ marginBottom: '40px' }}>
                                        <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#0A2540', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <span>üéØ</span> Overall Performance Score
                                        </h3>
                                        <div style={{ display: 'flex', gap: '24px', alignItems: 'center' }}>
                                            <div style={{
                                                width: '140px',
                                                height: '140px',
                                                borderRadius: '50%',
                                                background: 'linear-gradient(135deg, #0A2540 0%, #FFD700 100%)',
                                                display: 'flex',
                                                alignItems: 'center',
                                                justifyContent: 'center',
                                                color: 'white',
                                                border: '4px solid #FFD700'
                                            }}>
                                                <div style={{ textAlign: 'center' }}>
                                                    <div style={{ fontSize: '42px', fontWeight: 'bold', color: '#FFD700' }}>{reportData.performanceScore.score}</div>
                                                    <div style={{ fontSize: '16px', fontWeight: '600', letterSpacing: '1px' }}>GRADE {reportData.performanceScore.grade}</div>
                                                </div>
                                            </div>
                                            <div style={{ flex: 1 }}>
                                                <div style={{ marginBottom: '12px' }}>
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '14px', marginBottom: '6px' }}>
                                                        <span style={{ color: '#64748b', fontWeight: '500' }}>Revenue Growth</span>
                                                        <span style={{ fontWeight: 'bold', color: '#0A2540' }}>{reportData.performanceScore.breakdown.revenueGrowth}%</span>
                                                    </div>
                                                    <div style={{ height: '10px', background: '#e2e8f0', borderRadius: '5px', overflow: 'hidden' }}>
                                                        <div style={{
                                                            width: `${reportData.performanceScore.breakdown.revenueGrowth}%`,
                                                            height: '100%',
                                                            background: 'linear-gradient(90deg, #0A2540, #1a3a5c)',
                                                            transition: 'width 0.8s ease'
                                                        }}></div>
                                                    </div>
                                                </div>
                                                <div style={{ marginBottom: '12px' }}>
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '14px', marginBottom: '6px' }}>
                                                        <span style={{ color: '#64748b', fontWeight: '500' }}>Profit Margin</span>
                                                        <span style={{ fontWeight: 'bold', color: '#0A2540' }}>{reportData.performanceScore.breakdown.profitMargin}%</span>
                                                    </div>
                                                    <div style={{ height: '10px', background: '#e2e8f0', borderRadius: '5px', overflow: 'hidden' }}>
                                                        <div style={{
                                                            width: `${reportData.performanceScore.breakdown.profitMargin}%`,
                                                            height: '100%',
                                                            background: 'linear-gradient(90deg, #10b981, #059669)',
                                                            transition: 'width 0.8s ease'
                                                        }}></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '14px', marginBottom: '6px' }}>
                                                        <span style={{ color: '#64748b', fontWeight: '500' }}>Customer Satisfaction</span>
                                                        <span style={{ fontWeight: 'bold', color: '#0A2540' }}>{reportData.performanceScore.breakdown.customerSatisfaction}/5</span>
                                                    </div>
                                                    <div style={{ height: '10px', background: '#e2e8f0', borderRadius: '5px', overflow: 'hidden' }}>
                                                        <div style={{
                                                            width: `${(reportData.performanceScore.breakdown.customerSatisfaction / 5) * 100}%`,
                                                            height: '100%',
                                                            background: 'linear-gradient(90deg, #FFD700, #FFA500)',
                                                            transition: 'width 0.8s ease'
                                                        }}></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Footer */}
                                <div style={{ marginTop: '48px', paddingTop: '24px', borderTop: '4px solid #0A2540', background: 'linear-gradient(135deg, #f8fafc 0%, #ffffff 100%)', padding: '20px', borderRadius: '8px' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                        <div>
                                            <div style={{ fontSize: '14px', fontWeight: 'bold', color: '#0A2540', marginBottom: '4px' }}>
                                                üî• Generated by Restalyze Professional Edition
                                            </div>
                                            <div style={{ fontSize: '12px', color: '#64748b' }}>
                                                {new Date().toLocaleString()} ‚Ä¢ Powered by Restalyze Technologies Inc.
                                            </div>
                                            <div style={{ fontSize: '11px', color: '#FFD700', fontWeight: '600', marginTop: '4px' }}>
                                                www.restalyze.com ‚Ä¢ Premium Analytics Platform
                                            </div>
                                        </div>
                                        <div style={{ textAlign: 'right' }}>
                                            <div style={{ fontSize: '11px', color: '#64748b', marginBottom: '4px' }}>Report ID: {utils.generateId()}</div>
                                            <div style={{ fontSize: '12px', fontWeight: 'bold', color: '#0A2540' }}>¬© {new Date().getFullYear()} Restalyze Technologies</div>
                                            <div style={{ fontSize: '10px', color: '#64748b', marginTop: '4px' }}>Certified Analytics Solution</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ZATCA Compliance Report (Hidden, only used for export) */}
                        {includeZATCACompliance && reportData && (
                            <div id="zatca-report-content" style={{ display: 'none' }}>
                                <div style={{ background: 'white', padding: '40px', fontFamily: 'Inter, sans-serif' }}>
                                    {/* ZATCA Header with Restalyze Branding */}
                                    <div style={{ borderBottom: '4px solid #0A2540', paddingBottom: '20px', marginBottom: '30px', background: 'linear-gradient(135deg, #f8fafc 0%, #ffffff 100%)', padding: '20px', borderRadius: '8px' }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                            <div>
                                                <div style={{ fontSize: '28px', fontWeight: 'bold', background: 'linear-gradient(135deg, #0A2540 0%, #FFD700 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', marginBottom: '8px' }}>
                                                    Restalyze
                                                </div>
                                                <h1 style={{ fontSize: '22px', fontWeight: 'bold', color: '#0A2540', margin: 0 }}>
                                                    ZATCA TAX COMPLIANCE REPORT
                                                </h1>
                                                <p style={{ fontSize: '13px', color: '#64748b', margin: '4px 0 0 0' }}>
                                                    Kingdom of Saudi Arabia ‚Ä¢ Zakat, Tax and Customs Authority
                                                </p>
                                            </div>
                                            <div style={{ textAlign: 'right' }}>
                                                <div style={{ fontSize: '32px', marginBottom: '8px' }}>üá∏üá¶</div>
                                                <div style={{ fontSize: '12px', color: '#64748b' }}>
                                                    Report Date: {new Date().toLocaleDateString('en-US')}
                                                </div>
                                                <div style={{ fontSize: '11px', color: '#FFD700', fontWeight: '600', marginTop: '4px' }}>
                                                    ZATCA COMPLIANT
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Business Information */}
                                    <div style={{ marginBottom: '30px', background: '#f8fafc', padding: '20px', borderRadius: '8px', border: '2px solid #FFD700' }}>
                                        <h2 style={{ fontSize: '18px', fontWeight: 'bold', color: '#0A2540', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <span>üè¢</span> Business Information
                                        </h2>
                                        <table style={{ width: '100%', fontSize: '14px' }}>
                                            <tbody>
                                                <tr>
                                                    <td style={{ padding: '8px', color: '#64748b', width: '40%', fontWeight: '500' }}>Business Name:</td>
                                                    <td style={{ padding: '8px', color: '#0A2540', fontWeight: 'bold' }}>{reportData.zatcaData.businessName}</td>
                                                </tr>
                                                <tr>
                                                    <td style={{ padding: '8px', color: '#64748b', fontWeight: '500' }}>Tax Registration Number:</td>
                                                    <td style={{ padding: '8px', color: '#0A2540', fontWeight: 'bold' }}>{reportData.zatcaData.taxNumber}</td>
                                                </tr>
                                                <tr>
                                                    <td style={{ padding: '8px', color: '#64748b', fontWeight: '500' }}>Report Period:</td>
                                                    <td style={{ padding: '8px', color: '#0A2540', fontWeight: 'bold' }}>{reportData.zatcaData.reportPeriod}</td>
                                                </tr>
                                                <tr>
                                                    <td style={{ padding: '8px', color: '#64748b', fontWeight: '500' }}>Generated By:</td>
                                                    <td style={{ padding: '8px', color: '#FFD700', fontWeight: 'bold' }}>Restalyze Professional Edition</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    {/* Tax Summary */}
                                    <div style={{ marginBottom: '30px' }}>
                                        <h2 style={{ fontSize: '18px', fontWeight: 'bold', color: '#0A2540', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <span>üí∞</span> Tax Summary
                                        </h2>
                                        <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '14px' }}>
                                            <thead>
                                                <tr style={{ background: '#0A2540', color: 'white' }}>
                                                    <th style={{ padding: '14px', textAlign: 'left', fontWeight: '600', borderTopLeftRadius: '8px' }}>Description</th>
                                                    <th style={{ padding: '14px', textAlign: 'right', fontWeight: '600', borderTopRightRadius: '8px' }}>Amount (SAR)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr style={{ borderBottom: '1px solid #e2e8f0', background: 'white' }}>
                                                    <td style={{ padding: '14px', color: '#64748b', fontWeight: '500' }}>Total Taxable Amount</td>
                                                    <td style={{ padding: '14px', textAlign: 'right', color: '#0A2540', fontWeight: 'bold', fontSize: '15px' }}>
                                                        {utils.formatCurrency(reportData.zatcaData.totalTaxableAmount)}
                                                    </td>
                                                </tr>
                                                <tr style={{ borderBottom: '1px solid #e2e8f0', background: '#f8fafc' }}>
                                                    <td style={{ padding: '14px', color: '#64748b', fontWeight: '500' }}>VAT (15%)</td>
                                                    <td style={{ padding: '14px', textAlign: 'right', color: '#FFD700', fontWeight: 'bold', fontSize: '15px' }}>
                                                        {utils.formatCurrency(reportData.zatcaData.totalTax)}
                                                    </td>
                                                </tr>
                                                <tr style={{ background: 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%)', color: 'white' }}>
                                                    <td style={{ padding: '16px', fontWeight: 'bold', fontSize: '15px' }}>Total Amount Including VAT</td>
                                                    <td style={{ padding: '16px', textAlign: 'right', color: '#FFD700', fontSize: '20px', fontWeight: 'bold' }}>
                                                        {utils.formatCurrency(reportData.zatcaData.totalWithTax)}
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    {/* Platform Breakdown for ZATCA */}
                                    {reportData.zatcaData.platformBreakdown && reportData.zatcaData.platformBreakdown.length > 0 && (
                                        <div style={{ marginBottom: '30px' }}>
                                            <h2 style={{ fontSize: '18px', fontWeight: 'bold', color: '#0A2540', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                <span>üì±</span> Revenue Breakdown by Platform
                                            </h2>
                                            <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '14px' }}>
                                                <thead>
                                                    <tr style={{ background: '#0A2540', color: 'white' }}>
                                                        <th style={{ padding: '12px', textAlign: 'left', fontWeight: '600', borderTopLeftRadius: '8px' }}>Platform</th>
                                                        <th style={{ padding: '12px', textAlign: 'right', fontWeight: '600' }}>Revenue (SAR)</th>
                                                        <th style={{ padding: '12px', textAlign: 'right', fontWeight: '600', borderTopRightRadius: '8px' }}>VAT (15%)</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {reportData.zatcaData.platformBreakdown.map((platform, index) => (
                                                        <tr key={platform.platform} style={{ borderBottom: '1px solid #e2e8f0', background: index % 2 === 0 ? 'white' : '#f8fafc' }}>
                                                            <td style={{ padding: '12px', color: '#0A2540', fontWeight: '600' }}>{platform.platform}</td>
                                                            <td style={{ padding: '12px', textAlign: 'right', color: '#10b981', fontWeight: '600' }}>
                                                                {utils.formatCurrency(platform.revenue)}
                                                            </td>
                                                            <td style={{ padding: '12px', textAlign: 'right', color: '#FFD700', fontWeight: '600' }}>
                                                                {utils.formatCurrency(platform.tax)}
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    )}

                                    {/* Compliance Statement */}
                                    <div style={{ background: 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)', padding: '24px', borderRadius: '12px', border: '3px solid #10b981', marginTop: '30px' }}>
                                        <h3 style={{ fontSize: '17px', fontWeight: 'bold', color: '#059669', marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <span>‚úÖ</span> ZATCA Compliance Statement
                                        </h3>
                                        <p style={{ fontSize: '14px', color: '#064e3b', lineHeight: '1.7', margin: 0 }}>
                                            This report has been generated by <strong>Restalyze Professional Edition</strong> in accordance with the
                                            Zakat, Tax and Customs Authority (ZATCA) regulations for the Kingdom of Saudi Arabia. All transactions
                                            have been recorded and reported in full compliance with VAT regulations (15%). This report serves as
                                            an official record for tax purposes and meets all ZATCA requirements for digital tax reporting.
                                        </p>
                                    </div>

                                    {/* Footer */}
                                    <div style={{ marginTop: '40px', paddingTop: '24px', borderTop: '4px solid #0A2540', background: 'linear-gradient(135deg, #f8fafc 0%, #ffffff 100%)', padding: '20px', borderRadius: '8px' }}>
                                        <div style={{ textAlign: 'center' }}>
                                            <div style={{ fontSize: '14px', fontWeight: 'bold', color: '#0A2540', marginBottom: '8px' }}>
                                                Generated by Restalyze Professional Edition
                                            </div>
                                            <div style={{ fontSize: '12px', color: '#64748b', marginBottom: '8px' }}>
                                                {new Date().toLocaleString()} ‚Ä¢ Report ID: {utils.generateId()}
                                            </div>
                                            <div style={{ fontSize: '11px', color: '#64748b', marginBottom: '8px' }}>
                                                ZATCA Compliant ‚Ä¢ Kingdom of Saudi Arabia ‚Ä¢ VAT Registration System
                                            </div>
                                            <div style={{ fontSize: '12px', fontWeight: 'bold', color: '#0A2540', marginTop: '12px' }}>
                                                ¬© {new Date().getFullYear()} Restalyze Technologies Inc.
                                            </div>
                                            <div style={{ fontSize: '11px', color: '#FFD700', fontWeight: '600', marginTop: '4px' }}>
                                                www.restalyze.com ‚Ä¢ Certified Tax Reporting Solution
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Share Modal */}
                    {showShareModal && (
                        <div className="fixed inset-0 flex items-center justify-center z-50 modal-overlay">
                            <div className="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4 modal-content">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold text-enhanced">Share Report</h3>
                                    <button
                                        onClick={() => setShowShareModal(false)}
                                        className="text-secondary hover:text-enhanced"
                                    >
                                        <span>‚úï</span>
                                    </button>
                                </div>

                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-enhanced text-sm font-medium mb-2">
                                            Email Address
                                        </label>
                                        <input
                                            type="email"
                                            value={shareEmail}
                                            onChange={(e) => setShareEmail(e.target.value)}
                                            className="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-enhanced focus:outline-none focus:ring-2 focus:ring-primary/50"
                                            placeholder="Enter email address"
                                        />
                                        <p className="text-secondary text-xs mt-1">
                                            Report will be sent as a PDF attachment
                                        </p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-3">
                                        <p className="text-enhanced text-sm mb-2">Share Options:</p>
                                        <div className="space-y-2 text-sm">
                                            <div className="flex items-center space-x-2">
                                                <input type="radio" name="shareOption" defaultChecked />
                                                <span className="text-secondary">Email (PDF attachment)</span>
                                            </div>
                                            <div className="flex items-center space-x-2">
                                                <input type="radio" name="shareOption" />
                                                <span className="text-secondary">Google Drive (Coming soon)</span>
                                            </div>
                                            <div className="flex items-center space-x-2">
                                                <input type="radio" name="shareOption" />
                                                <span className="text-secondary">Dropbox (Coming soon)</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex space-x-3 mt-6">
                                    <button
                                        onClick={shareReport}
                                        className="flex-1 bg-primary text-white py-2 px-4 rounded-lg hover:bg-primary/90 transition-colors btn-primary"
                                    >
                                        Send Report
                                    </button>
                                    <button
                                        onClick={() => setShowShareModal(false)}
                                        className="flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // üåü LEGENDARY: Comprehensive Dashboard Enhancements Module
        const DashboardEnhancements = () => {
            const {
                selectedRestaurant,
                restaurants,
                dailyData,
                weeklyData,
                monthlyData,
                getBranchPerformance,
                compareBranches,
                getFinancialOverview
            } = useData();

            const [viewMode, setViewMode] = useState('kpi'); // kpi, branches, alerts, predictive, reports
            const [timeRange, setTimeRange] = useState('daily'); // daily, weekly, monthly
            const [selectedMetric, setSelectedMetric] = useState('orders');

            // üìä KPI Board Component
            const KPIBoard = () => {
                if (!selectedRestaurant) {
                    return (
                        <div className="text-center py-12">
                            <div className="text-4xl mb-4">üìä</div>
                            <p className="text-secondary">Please select a restaurant to view KPI metrics</p>
                        </div>
                    );
                }

                // Calculate metrics based on time range
                const calculateMetrics = () => {
                    let data = [];
                    if (timeRange === 'daily') {
                        data = dailyData.filter(d => d.restaurant === selectedRestaurant.id);
                        data = data.slice(-30); // Last 30 days
                    } else if (timeRange === 'weekly') {
                        data = weeklyData.filter(d => d.restaurant === selectedRestaurant.id);
                        data = data.slice(-12); // Last 12 weeks
                    } else {
                        data = monthlyData.filter(d => d.restaurant === selectedRestaurant.id);
                        data = data.slice(-6); // Last 6 months
                    }

                    const totalOrders = data.reduce((sum, d) => sum + d.orders, 0);
                    const totalRevenue = data.reduce((sum, d) => sum + d.gmv, 0);
                    const avgDeliveryTime = selectedRestaurant.performanceStats?.deliveryTime || 32;
                    const customerSatisfaction = selectedRestaurant.performanceStats?.customerSatisfaction || 4.5;

                    // Top 5 selling items (simulated)
                    const topItems = [
                        { name: 'Classic Burger', orders: Math.floor(totalOrders * 0.22), revenue: Math.floor(totalRevenue * 0.25), trend: '+15%' },
                        { name: 'Cheese Pizza', orders: Math.floor(totalOrders * 0.18), revenue: Math.floor(totalRevenue * 0.20), trend: '+12%' },
                        { name: 'Chicken Shawarma', orders: Math.floor(totalOrders * 0.15), revenue: Math.floor(totalRevenue * 0.16), trend: '+8%' },
                        { name: 'BBQ Wings', orders: Math.floor(totalOrders * 0.12), revenue: Math.floor(totalRevenue * 0.14), trend: '+5%' },
                        { name: 'Caesar Salad', orders: Math.floor(totalOrders * 0.10), revenue: Math.floor(totalRevenue * 0.12), trend: '+3%' }
                    ];

                    return { totalOrders, totalRevenue, avgDeliveryTime, customerSatisfaction, topItems, trendData: data };
                };

                const metrics = calculateMetrics();

                return (
                    <div className="space-y-6">
                        {/* Time Range Selector */}
                        <div className="flex items-center justify-between">
                            <h2 className="text-2xl font-bold text-enhanced">üìä KPI Performance Board</h2>
                            <div className="flex space-x-2">
                                {['daily', 'weekly', 'monthly'].map(range => (
                                    <button
                                        key={range}
                                        onClick={() => setTimeRange(range)}
                                        className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                            timeRange === range
                                                ? 'bg-primary text-white'
                                                : 'bg-white/10 text-secondary hover:bg-white/20'
                                        }`}
                                    >
                                        {range.charAt(0).toUpperCase() + range.slice(1)}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Key Metrics Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div className="glass-effect rounded-xl p-6 hover-lift">
                                <div className="flex items-center justify-between mb-3">
                                    <div className="text-3xl">üì¶</div>
                                    <div className="text-green-400 text-sm font-medium bg-green-400/10 px-2 py-1 rounded">
                                        +12.5%
                                    </div>
                                </div>
                                <div className="text-enhanced text-sm mb-1">Total Orders</div>
                                <div className="text-2xl font-bold text-enhanced">
                                    {utils.formatNumber(metrics.totalOrders)}
                                </div>
                                <div className="text-secondary text-xs mt-2">
                                    {timeRange === 'daily' ? 'Last 30 days' : timeRange === 'weekly' ? 'Last 12 weeks' : 'Last 6 months'}
                                </div>
                            </div>

                            <div className="glass-effect rounded-xl p-6 hover-lift">
                                <div className="flex items-center justify-between mb-3">
                                    <div className="text-3xl">üöö</div>
                                    <div className="text-green-400 text-sm font-medium bg-green-400/10 px-2 py-1 rounded">
                                        -3 min
                                    </div>
                                </div>
                                <div className="text-enhanced text-sm mb-1">Avg Delivery Time</div>
                                <div className="text-2xl font-bold text-enhanced">
                                    {metrics.avgDeliveryTime} min
                                </div>
                                <div className="text-secondary text-xs mt-2">
                                    Target: ‚â§ 30 minutes
                                </div>
                            </div>

                            <div className="glass-effect rounded-xl p-6 hover-lift">
                                <div className="flex items-center justify-between mb-3">
                                    <div className="text-3xl">‚≠ê</div>
                                    <div className="text-green-400 text-sm font-medium bg-green-400/10 px-2 py-1 rounded">
                                        +0.3
                                    </div>
                                </div>
                                <div className="text-enhanced text-sm mb-1">Customer Satisfaction</div>
                                <div className="text-2xl font-bold text-enhanced">
                                    {metrics.customerSatisfaction.toFixed(1)}/5.0
                                </div>
                                <div className="text-secondary text-xs mt-2">
                                    {metrics.customerSatisfaction >= 4.5 ? 'Excellent!' : 'Good performance'}
                                </div>
                            </div>

                            <div className="glass-effect rounded-xl p-6 hover-lift">
                                <div className="flex items-center justify-between mb-3">
                                    <div className="text-3xl">üí∞</div>
                                    <div className="text-green-400 text-sm font-medium bg-green-400/10 px-2 py-1 rounded">
                                        +18.2%
                                    </div>
                                </div>
                                <div className="text-enhanced text-sm mb-1">Total Revenue</div>
                                <div className="text-2xl font-bold text-enhanced">
                                    {utils.formatCurrency(metrics.totalRevenue)}
                                </div>
                                <div className="text-secondary text-xs mt-2">
                                    AOV: {utils.formatCurrency(metrics.totalOrders > 0 ? metrics.totalRevenue / metrics.totalOrders : 0)}
                                </div>
                            </div>
                        </div>

                        {/* Trend Chart */}
                        <div className="glass-effect rounded-xl p-6">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">üìà Performance Trends</h3>
                            <div className="bg-white/5 rounded-lg p-4" style={{ height: '300px' }}>
                                <div className="h-full flex items-end justify-between space-x-2">
                                    {metrics.trendData.slice(-10).map((data, index) => {
                                        const maxValue = Math.max(...metrics.trendData.map(d => d[selectedMetric === 'orders' ? 'orders' : 'gmv']));
                                        const value = selectedMetric === 'orders' ? data.orders : data.gmv;
                                        const height = (value / maxValue) * 100;

                                        return (
                                            <div key={index} className="flex-1 flex flex-col items-center">
                                                <div
                                                    className="w-full bg-gradient-primary rounded-t transition-all hover:opacity-80 cursor-pointer"
                                                    style={{ height: `${height}%` }}
                                                    title={`${utils.formatNumber(value)}`}
                                                ></div>
                                                <div className="text-secondary text-xs mt-2 transform -rotate-45 origin-top-left">
                                                    {timeRange === 'daily' ? new Date(data.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) :
                                                     timeRange === 'weekly' ? `W${index + 1}` :
                                                     data.month?.substring(0, 3)}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                            <div className="flex items-center justify-center space-x-4 mt-4">
                                <button
                                    onClick={() => setSelectedMetric('orders')}
                                    className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                                        selectedMetric === 'orders' ? 'bg-primary text-white' : 'bg-white/10 text-secondary hover:bg-white/20'
                                    }`}
                                >
                                    Orders
                                </button>
                                <button
                                    onClick={() => setSelectedMetric('revenue')}
                                    className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                                        selectedMetric === 'revenue' ? 'bg-primary text-white' : 'bg-white/10 text-secondary hover:bg-white/20'
                                    }`}
                                >
                                    Revenue
                                </button>
                            </div>
                        </div>

                        {/* Top 5 Selling Items */}
                        <div className="glass-effect rounded-xl p-6">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">üèÜ Top 5 Selling Items</h3>
                            <div className="space-y-3">
                                {metrics.topItems.map((item, index) => (
                                    <div key={index} className="bg-white/5 rounded-lg p-4 hover:bg-white/10 transition-colors">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center space-x-3">
                                                <div className="text-2xl font-bold text-primary">
                                                    {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `#${index + 1}`}
                                                </div>
                                                <div>
                                                    <div className="text-enhanced font-medium">{item.name}</div>
                                                    <div className="text-secondary text-sm">
                                                        {utils.formatNumber(item.orders)} orders ‚Ä¢ {utils.formatCurrency(item.revenue)}
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="text-green-400 font-medium">{item.trend}</div>
                                        </div>
                                        <div className="mt-2 bg-white/5 rounded-full h-2 overflow-hidden">
                                            <div
                                                className="bg-gradient-primary h-full transition-all"
                                                style={{ width: `${(item.orders / metrics.topItems[0].orders) * 100}%` }}
                                            ></div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            // üè¢ Branch Comparison Component
            const BranchComparison = () => {
                if (!selectedRestaurant) {
                    return (
                        <div className="text-center py-12">
                            <div className="text-4xl mb-4">üè¢</div>
                            <p className="text-secondary">Please select a restaurant to compare branches</p>
                        </div>
                    );
                }

                const branches = selectedRestaurant.branches || [];

                if (branches.length === 0) {
                    return (
                        <div className="text-center py-12">
                            <div className="text-4xl mb-4">üè¢</div>
                            <p className="text-secondary">No branches found for this restaurant</p>
                        </div>
                    );
                }

                const branchesWithPerformance = branches.map(branch => ({
                    ...branch,
                    performance: getBranchPerformance(selectedRestaurant.id, branch.id)
                })).sort((a, b) => b.performance.revenue - a.performance.revenue);

                return (
                    <div className="space-y-6">
                        <h2 className="text-2xl font-bold text-enhanced">üè¢ Branch Performance Comparison</h2>

                        {/* Branch Cards with Visual Comparison */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {branchesWithPerformance.map((branch, index) => (
                                <div key={branch.id} className={`glass-effect rounded-xl p-6 hover-lift ${index === 0 ? 'border-2 border-green-500/50' : ''}`}>
                                    {index === 0 && (
                                        <div className="mb-3 flex items-center space-x-2">
                                            <span className="text-2xl">üèÜ</span>
                                            <span className="text-green-400 font-semibold text-sm">Top Performer</span>
                                        </div>
                                    )}
                                    <h3 className="text-lg font-bold text-enhanced mb-2">{branch.name}</h3>
                                    <p className="text-secondary text-sm mb-4">{branch.city} ‚Ä¢ {branch.address}</p>

                                    <div className="space-y-3">
                                        <div className="bg-white/5 rounded-lg p-3">
                                            <div className="text-secondary text-xs mb-1">Revenue</div>
                                            <div className="text-enhanced font-bold text-lg">
                                                {utils.formatCurrency(branch.performance.revenue)}
                                            </div>
                                            <div className="mt-2 bg-white/5 rounded-full h-2 overflow-hidden">
                                                <div
                                                    className="bg-gradient-success h-full transition-all"
                                                    style={{ width: `${(branch.performance.revenue / branchesWithPerformance[0].performance.revenue) * 100}%` }}
                                                ></div>
                                            </div>
                                        </div>

                                        <div className="bg-white/5 rounded-lg p-3">
                                            <div className="text-secondary text-xs mb-1">Orders</div>
                                            <div className="text-enhanced font-bold text-lg">
                                                {utils.formatNumber(branch.performance.orders)}
                                            </div>
                                            <div className="mt-2 bg-white/5 rounded-full h-2 overflow-hidden">
                                                <div
                                                    className="bg-gradient-primary h-full transition-all"
                                                    style={{ width: `${(branch.performance.orders / branchesWithPerformance[0].performance.orders) * 100}%` }}
                                                ></div>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="bg-white/5 rounded-lg p-2 text-center">
                                                <div className="text-secondary text-xs">Profit Margin</div>
                                                <div className="text-enhanced font-semibold">{branch.performance.profitMargin.toFixed(1)}%</div>
                                            </div>
                                            <div className="bg-white/5 rounded-lg p-2 text-center">
                                                <div className="text-secondary text-xs">AOV</div>
                                                <div className="text-enhanced font-semibold">{utils.formatCurrency(branch.performance.avgOrderValue)}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Comparison Table */}
                        <div className="glass-effect rounded-xl p-6">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">üìã Detailed Comparison Table</h3>
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead>
                                        <tr className="border-b border-white/10">
                                            <th className="text-left text-enhanced py-3 px-4">Rank</th>
                                            <th className="text-left text-enhanced py-3 px-4">Branch</th>
                                            <th className="text-right text-enhanced py-3 px-4">Revenue</th>
                                            <th className="text-right text-enhanced py-3 px-4">Orders</th>
                                            <th className="text-right text-enhanced py-3 px-4">Profit Margin</th>
                                            <th className="text-right text-enhanced py-3 px-4">AOV</th>
                                            <th className="text-center text-enhanced py-3 px-4">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {branchesWithPerformance.map((branch, index) => (
                                            <tr key={branch.id} className={`border-b border-white/5 hover:bg-white/5 transition-colors ${index === 0 ? 'bg-green-500/10' : ''}`}>
                                                <td className="py-3 px-4">
                                                    <span className="text-lg">
                                                        {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `#${index + 1}`}
                                                    </span>
                                                </td>
                                                <td className="py-3 px-4">
                                                    <div className="text-enhanced font-medium">{branch.name}</div>
                                                    <div className="text-secondary text-xs">{branch.city}</div>
                                                </td>
                                                <td className="py-3 px-4 text-right text-enhanced font-semibold">
                                                    {utils.formatCurrency(branch.performance.revenue)}
                                                </td>
                                                <td className="py-3 px-4 text-right text-enhanced">
                                                    {utils.formatNumber(branch.performance.orders)}
                                                </td>
                                                <td className="py-3 px-4 text-right">
                                                    <span className={branch.performance.profitMargin >= 15 ? 'text-green-400' : 'text-yellow-400'}>
                                                        {branch.performance.profitMargin.toFixed(1)}%
                                                    </span>
                                                </td>
                                                <td className="py-3 px-4 text-right text-enhanced">
                                                    {utils.formatCurrency(branch.performance.avgOrderValue)}
                                                </td>
                                                <td className="py-3 px-4 text-center">
                                                    <span className={`px-2 py-1 rounded text-xs font-medium ${
                                                        branch.status === 'active'
                                                            ? 'bg-green-500/20 text-green-400'
                                                            : 'bg-gray-500/20 text-gray-400'
                                                    }`}>
                                                        {branch.status}
                                                    </span>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Branch Performance Chart */}
                        <div className="glass-effect rounded-xl p-6">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">üìä Branch Revenue Chart</h3>
                            <div className="bg-white/5 rounded-lg p-4" style={{ height: '300px' }}>
                                <div className="h-full flex items-end justify-between space-x-4">
                                    {branchesWithPerformance.map((branch, index) => {
                                        const maxRevenue = branchesWithPerformance[0].performance.revenue;
                                        const height = (branch.performance.revenue / maxRevenue) * 100;

                                        return (
                                            <div key={branch.id} className="flex-1 flex flex-col items-center">
                                                <div className="text-enhanced text-sm font-medium mb-2">
                                                    {utils.formatCurrency(branch.performance.revenue)}
                                                </div>
                                                <div
                                                    className={`w-full rounded-t transition-all hover:opacity-80 cursor-pointer ${
                                                        index === 0 ? 'bg-gradient-success' :
                                                        index === 1 ? 'bg-gradient-primary' :
                                                        'bg-gradient-warning'
                                                    }`}
                                                    style={{ height: `${height}%` }}
                                                    title={branch.name}
                                                ></div>
                                                <div className="text-secondary text-xs mt-2 text-center">
                                                    {branch.name}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // üö® Smart Alerts Component
            const SmartAlerts = () => {
                const [alerts, setAlerts] = useState([]);

                useEffect(() => {
                    if (!selectedRestaurant) return;

                    const generatedAlerts = [];
                    const financialData = getFinancialOverview(selectedRestaurant.id);
                    const branches = selectedRestaurant.branches || [];

                    // Check performance drops
                    if (financialData && financialData.profitMargin < 10) {
                        generatedAlerts.push({
                            id: 'alert-1',
                            type: 'warning',
                            icon: '‚ö†Ô∏è',
                            title: 'Low Profit Margin Alert',
                            message: `Profit margin is ${financialData.profitMargin.toFixed(1)}%, below the 10% threshold. Review pricing and costs.`,
                            priority: 'high',
                            timestamp: new Date().toISOString(),
                            action: 'Review Financial Overview'
                        });
                    }

                    // Check branch limit (5 branches max for Restalyze Standard)
                    if (branches.length >= 5) {
                        generatedAlerts.push({
                            id: 'alert-2',
                            type: 'info',
                            icon: 'üè¢',
                            title: 'Branch Limit Reached',
                            message: `You have reached the maximum of 5 branches (${branches.length}/5) for your Restalyze Standard package.`,
                            priority: 'medium',
                            timestamp: new Date().toISOString(),
                            action: 'Upgrade Package'
                        });
                    } else if (branches.length === 4) {
                        generatedAlerts.push({
                            id: 'alert-2b',
                            type: 'warning',
                            icon: 'üè¢',
                            title: 'Approaching Branch Limit',
                            message: `You have 4 out of 5 branches. One slot remaining in your Restalyze Standard package.`,
                            priority: 'low',
                            timestamp: new Date().toISOString(),
                            action: 'View Branches'
                        });
                    }

                    // Check subscription renewal (simulated)
                    const subscriptionDate = new Date(selectedRestaurant.joinDate);
                    const nextRenewal = new Date(subscriptionDate);
                    nextRenewal.setMonth(nextRenewal.getMonth() + 12);
                    const daysUntilRenewal = Math.ceil((nextRenewal - new Date()) / (1000 * 60 * 60 * 24));

                    if (daysUntilRenewal <= 30 && daysUntilRenewal > 0) {
                        generatedAlerts.push({
                            id: 'alert-3',
                            type: 'info',
                            icon: 'üìÖ',
                            title: 'Subscription Renewal Due',
                            message: `Your Restalyze Standard subscription renews in ${daysUntilRenewal} days. Renew now to avoid service interruption.`,
                            priority: 'medium',
                            timestamp: new Date().toISOString(),
                            action: 'Renew Subscription'
                        });
                    }

                    // Check delivery time performance
                    const avgDeliveryTime = selectedRestaurant.performanceStats?.deliveryTime || 30;
                    if (avgDeliveryTime > 35) {
                        generatedAlerts.push({
                            id: 'alert-4',
                            type: 'warning',
                            icon: 'üöö',
                            title: 'Slow Delivery Times',
                            message: `Average delivery time is ${avgDeliveryTime} minutes, above the 35-minute threshold. Customer satisfaction may be affected.`,
                            priority: 'high',
                            timestamp: new Date().toISOString(),
                            action: 'Optimize Operations'
                        });
                    }

                    // Check customer satisfaction
                    const satisfaction = selectedRestaurant.performanceStats?.customerSatisfaction || 4.5;
                    if (satisfaction < 4.0) {
                        generatedAlerts.push({
                            id: 'alert-5',
                            type: 'error',
                            icon: '‚≠ê',
                            title: 'Customer Satisfaction Drop',
                            message: `Customer satisfaction is ${satisfaction.toFixed(1)}/5.0, below the 4.0 threshold. Immediate attention required.`,
                            priority: 'critical',
                            timestamp: new Date().toISOString(),
                            action: 'Review Feedback'
                        });
                    }

                    // Sort by priority
                    const priorityOrder = { critical: 0, high: 1, medium: 2, low: 3 };
                    generatedAlerts.sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]);

                    setAlerts(generatedAlerts);
                }, [selectedRestaurant]);

                if (!selectedRestaurant) {
                    return (
                        <div className="text-center py-12">
                            <div className="text-4xl mb-4">üö®</div>
                            <p className="text-secondary">Please select a restaurant to view alerts</p>
                        </div>
                    );
                }

                return (
                    <div className="space-y-6">
                        <div className="flex items-center justify-between">
                            <h2 className="text-2xl font-bold text-enhanced">üö® Smart Alerts & Notifications</h2>
                            <div className="flex items-center space-x-2">
                                <div className="w-3 h-3 bg-green-500 rounded-full data-pulse"></div>
                                <span className="text-green-400 text-sm">Monitoring Active</span>
                            </div>
                        </div>

                        {/* Alerts Summary */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div className="glass-effect rounded-xl p-4 text-center">
                                <div className="text-2xl mb-2">üî¥</div>
                                <div className="text-enhanced font-bold text-lg">
                                    {alerts.filter(a => a.priority === 'critical').length}
                                </div>
                                <div className="text-secondary text-sm">Critical</div>
                            </div>
                            <div className="glass-effect rounded-xl p-4 text-center">
                                <div className="text-2xl mb-2">üü†</div>
                                <div className="text-enhanced font-bold text-lg">
                                    {alerts.filter(a => a.priority === 'high').length}
                                </div>
                                <div className="text-secondary text-sm">High Priority</div>
                            </div>
                            <div className="glass-effect rounded-xl p-4 text-center">
                                <div className="text-2xl mb-2">üü°</div>
                                <div className="text-enhanced font-bold text-lg">
                                    {alerts.filter(a => a.priority === 'medium').length}
                                </div>
                                <div className="text-secondary text-sm">Medium</div>
                            </div>
                            <div className="glass-effect rounded-xl p-4 text-center">
                                <div className="text-2xl mb-2">üü¢</div>
                                <div className="text-enhanced font-bold text-lg">
                                    {alerts.filter(a => a.priority === 'low').length}
                                </div>
                                <div className="text-secondary text-sm">Low Priority</div>
                            </div>
                        </div>

                        {/* Alerts List */}
                        <div className="space-y-4">
                            {alerts.length === 0 ? (
                                <div className="glass-effect rounded-xl p-12 text-center">
                                    <div className="text-4xl mb-4">‚úÖ</div>
                                    <h3 className="text-enhanced font-semibold text-lg mb-2">All Clear!</h3>
                                    <p className="text-secondary">No alerts at this time. Your restaurant is performing well.</p>
                                </div>
                            ) : (
                                alerts.map(alert => (
                                    <div
                                        key={alert.id}
                                        className={`glass-effect rounded-xl p-6 border-l-4 hover-lift ${
                                            alert.priority === 'critical' ? 'border-red-500' :
                                            alert.priority === 'high' ? 'border-orange-500' :
                                            alert.priority === 'medium' ? 'border-yellow-500' :
                                            'border-blue-500'
                                        }`}
                                    >
                                        <div className="flex items-start justify-between">
                                            <div className="flex items-start space-x-4">
                                                <div className="text-3xl">{alert.icon}</div>
                                                <div className="flex-1">
                                                    <div className="flex items-center space-x-3 mb-2">
                                                        <h3 className="text-enhanced font-semibold text-lg">{alert.title}</h3>
                                                        <span className={`px-2 py-1 rounded text-xs font-medium ${
                                                            alert.priority === 'critical' ? 'bg-red-500/20 text-red-400' :
                                                            alert.priority === 'high' ? 'bg-orange-500/20 text-orange-400' :
                                                            alert.priority === 'medium' ? 'bg-yellow-500/20 text-yellow-400' :
                                                            'bg-blue-500/20 text-blue-400'
                                                        }`}>
                                                            {alert.priority.toUpperCase()}
                                                        </span>
                                                    </div>
                                                    <p className="text-secondary mb-3">{alert.message}</p>
                                                    <div className="text-secondary text-xs">
                                                        {new Date(alert.timestamp).toLocaleString()}
                                                    </div>
                                                </div>
                                            </div>
                                            <button className="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors text-sm font-medium whitespace-nowrap">
                                                {alert.action}
                                            </button>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                );
            };

            // üîÆ Predictive Analytics Component
            const PredictiveAnalytics = () => {
                if (!selectedRestaurant) {
                    return (
                        <div className="text-center py-12">
                            <div className="text-4xl mb-4">üîÆ</div>
                            <p className="text-secondary">Please select a restaurant to view predictive analytics</p>
                        </div>
                    );
                }

                // Calculate predictions based on historical data
                const historicalData = dailyData
                    .filter(d => d.restaurant === selectedRestaurant.id)
                    .slice(-30)
                    .reduce((acc, d) => {
                        const existing = acc.find(a => a.date === d.date);
                        if (existing) {
                            existing.orders += d.orders;
                            existing.revenue += d.gmv;
                        } else {
                            acc.push({ date: d.date, orders: d.orders, revenue: d.gmv });
                        }
                        return acc;
                    }, []);

                const avgDailyOrders = historicalData.reduce((sum, d) => sum + d.orders, 0) / historicalData.length;
                const avgDailyRevenue = historicalData.reduce((sum, d) => sum + d.revenue, 0) / historicalData.length;

                // Simple trend calculation
                const recentOrders = historicalData.slice(-7).reduce((sum, d) => sum + d.orders, 0) / 7;
                const olderOrders = historicalData.slice(0, 7).reduce((sum, d) => sum + d.orders, 0) / 7;
                const orderTrend = ((recentOrders - olderOrders) / olderOrders) * 100;

                // Forecast next 7 days
                const forecast = [];
                for (let i = 1; i <= 7; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() + i);
                    const trendMultiplier = 1 + (orderTrend / 100) * (i / 7);
                    forecast.push({
                        day: date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),
                        orders: Math.floor(avgDailyOrders * trendMultiplier * (0.9 + Math.random() * 0.2)),
                        revenue: Math.floor(avgDailyRevenue * trendMultiplier * (0.9 + Math.random() * 0.2)),
                        confidence: 85 - i * 2 // Confidence decreases with time
                    });
                }

                // Menu item predictions (simulated)
                const menuPredictions = [
                    { item: 'Spicy Chicken Burger', currentOrders: 120, predictedIncrease: 25, reason: 'Trending on social media' },
                    { item: 'Vegan Pizza', currentOrders: 85, predictedIncrease: 40, reason: 'Growing health trends' },
                    { item: 'Loaded Fries', currentOrders: 95, predictedIncrease: 15, reason: 'Popular side dish combo' },
                    { item: 'Fresh Juice Bar', currentOrders: 60, predictedIncrease: 35, reason: 'Summer season demand' }
                ];

                // Customer retention forecast
                const currentRetention = selectedRestaurant.performanceStats?.repeatCustomers || 45;
                const retentionForecast = {
                    current: currentRetention,
                    next30Days: Math.min(100, currentRetention + 3 + Math.random() * 5),
                    next60Days: Math.min(100, currentRetention + 5 + Math.random() * 8),
                    next90Days: Math.min(100, currentRetention + 8 + Math.random() * 10),
                    recommendation: currentRetention < 50 ? 'Implement loyalty program' : 'Maintain quality standards'
                };

                return (
                    <div className="space-y-6">
                        <h2 className="text-2xl font-bold text-enhanced">üîÆ Predictive Analytics & Forecasting</h2>

                        {/* Overview Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div className="glass-effect rounded-xl p-6">
                                <div className="text-2xl mb-3">üìà</div>
                                <div className="text-secondary text-sm mb-1">Order Trend</div>
                                <div className={`text-2xl font-bold mb-2 ${orderTrend >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                    {orderTrend >= 0 ? '+' : ''}{orderTrend.toFixed(1)}%
                                </div>
                                <div className="text-secondary text-xs">
                                    {orderTrend >= 0 ? 'Growing demand' : 'Declining trend - action needed'}
                                </div>
                            </div>

                            <div className="glass-effect rounded-xl p-6">
                                <div className="text-2xl mb-3">üéØ</div>
                                <div className="text-secondary text-sm mb-1">Forecast Accuracy</div>
                                <div className="text-2xl font-bold text-enhanced mb-2">87%</div>
                                <div className="text-secondary text-xs">Based on 30-day historical data</div>
                            </div>

                            <div className="glass-effect rounded-xl p-6">
                                <div className="text-2xl mb-3">üí°</div>
                                <div className="text-secondary text-sm mb-1">Insights Generated</div>
                                <div className="text-2xl font-bold text-enhanced mb-2">12</div>
                                <div className="text-secondary text-xs">Actionable recommendations</div>
                            </div>
                        </div>

                        {/* 7-Day Order Forecast */}
                        <div className="glass-effect rounded-xl p-6">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">üìä 7-Day Order Forecast</h3>
                            <div className="space-y-3">
                                {forecast.map((day, index) => (
                                    <div key={index} className="bg-white/5 rounded-lg p-4">
                                        <div className="flex items-center justify-between mb-2">
                                            <div>
                                                <div className="text-enhanced font-medium">{day.day}</div>
                                                <div className="text-secondary text-sm">
                                                    Predicted: {utils.formatNumber(day.orders)} orders ‚Ä¢ {utils.formatCurrency(day.revenue)}
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <div className="text-green-400 font-medium">
                                                    {day.confidence}% confidence
                                                </div>
                                            </div>
                                        </div>
                                        <div className="bg-white/5 rounded-full h-2 overflow-hidden">
                                            <div
                                                className="bg-gradient-primary h-full transition-all"
                                                style={{ width: `${day.confidence}%` }}
                                            ></div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <div className="mt-4 bg-blue-500/10 border border-blue-500/30 rounded-lg p-3">
                                <p className="text-blue-300 text-sm">
                                    üí° <strong>Insight:</strong> Expected total orders next week: {utils.formatNumber(forecast.reduce((sum, d) => sum + d.orders, 0))}
                                    ({orderTrend >= 0 ? '+' : ''}{orderTrend.toFixed(1)}% from last week)
                                </p>
                            </div>
                        </div>

                        {/* Menu Item Predictions */}
                        <div className="glass-effect rounded-xl p-6">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">üçî Menu Items Likely to Increase in Sales</h3>
                            <div className="space-y-3">
                                {menuPredictions.map((item, index) => (
                                    <div key={index} className="bg-white/5 rounded-lg p-4 hover:bg-white/10 transition-colors">
                                        <div className="flex items-center justify-between mb-2">
                                            <div className="flex-1">
                                                <div className="text-enhanced font-medium">{item.item}</div>
                                                <div className="text-secondary text-sm">Current: {item.currentOrders} orders/week</div>
                                            </div>
                                            <div className="text-right">
                                                <div className="text-green-400 font-bold text-lg">+{item.predictedIncrease}%</div>
                                                <div className="text-secondary text-xs">predicted increase</div>
                                            </div>
                                        </div>
                                        <div className="bg-yellow-500/10 border border-yellow-500/30 rounded p-2 mt-2">
                                            <p className="text-yellow-300 text-xs">
                                                üìå <strong>Reason:</strong> {item.reason}
                                            </p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Customer Retention Forecast */}
                        <div className="glass-effect rounded-xl p-6">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">üîÑ Customer Retention Rate Forecast</h3>
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                                <div className="bg-white/5 rounded-lg p-4 text-center">
                                    <div className="text-secondary text-xs mb-1">Current</div>
                                    <div className="text-enhanced font-bold text-xl">{retentionForecast.current.toFixed(1)}%</div>
                                </div>
                                <div className="bg-white/5 rounded-lg p-4 text-center">
                                    <div className="text-secondary text-xs mb-1">30 Days</div>
                                    <div className="text-green-400 font-bold text-xl">{retentionForecast.next30Days.toFixed(1)}%</div>
                                </div>
                                <div className="bg-white/5 rounded-lg p-4 text-center">
                                    <div className="text-secondary text-xs mb-1">60 Days</div>
                                    <div className="text-green-400 font-bold text-xl">{retentionForecast.next60Days.toFixed(1)}%</div>
                                </div>
                                <div className="bg-white/5 rounded-lg p-4 text-center">
                                    <div className="text-secondary text-xs mb-1">90 Days</div>
                                    <div className="text-green-400 font-bold text-xl">{retentionForecast.next90Days.toFixed(1)}%</div>
                                </div>
                            </div>
                            <div className="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
                                <p className="text-green-300 text-sm">
                                    ‚úÖ <strong>Recommendation:</strong> {retentionForecast.recommendation}
                                </p>
                            </div>
                        </div>
                    </div>
                );
            };

            // üìã Enhanced Reports Hub Component
            const ReportsHub = () => {
                if (!selectedRestaurant) {
                    return (
                        <div className="text-center py-12">
                            <div className="text-4xl mb-4">üìã</div>
                            <p className="text-secondary">Please select a restaurant to access reports</p>
                        </div>
                    );
                }

                const reportTypes = [
                    {
                        id: 'comprehensive',
                        icon: 'üìä',
                        title: 'Comprehensive Analytics Report',
                        description: 'Complete KPIs, branch comparisons, and predictive insights',
                        includes: ['KPIs', 'Branch Data', 'Trends', 'Forecasts', 'ZATCA Compliance'],
                        color: 'primary'
                    },
                    {
                        id: 'branch',
                        icon: 'üè¢',
                        title: 'Branch-Specific Report',
                        description: 'Detailed performance report for individual branches',
                        includes: ['Branch KPIs', 'Revenue Breakdown', 'Staff Performance', 'ZATCA Export'],
                        color: 'success'
                    },
                    {
                        id: 'financial',
                        icon: 'üí∞',
                        title: 'Financial Overview Report',
                        description: 'Revenue, costs, profit margins, and platform breakdowns',
                        includes: ['Revenue', 'Costs', 'Profit', 'Platform Analytics', 'Tax Summary'],
                        color: 'warning'
                    },
                    {
                        id: 'zatca',
                        icon: 'üìÑ',
                        title: 'ZATCA Compliance Export',
                        description: 'Saudi Arabia tax compliance report (15% VAT)',
                        includes: ['VAT Calculations', 'Platform Breakdown', 'Tax Summary', 'Compliance Check'],
                        color: 'accent'
                    }
                ];

                return (
                    <div className="space-y-6">
                        <div className="flex items-center justify-between">
                            <h2 className="text-2xl font-bold text-enhanced">üìã Reports Hub</h2>
                            <div className="flex items-center space-x-3">
                                {selectedRestaurant.customLogo ? (
                                    <img
                                        src={selectedRestaurant.customLogo}
                                        alt="Logo"
                                        className="w-10 h-10 rounded-lg object-cover"
                                    />
                                ) : (
                                    <div className="text-3xl">{selectedRestaurant.logo}</div>
                                )}
                                <div className="text-enhanced font-medium">{selectedRestaurant.name}</div>
                            </div>
                        </div>

                        {/* Report Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {reportTypes.map(report => (
                                <div key={report.id} className="glass-effect rounded-xl p-6 hover-lift cursor-pointer">
                                    <div className="flex items-start space-x-4">
                                        <div className="text-4xl">{report.icon}</div>
                                        <div className="flex-1">
                                            <h3 className="text-enhanced font-semibold text-lg mb-2">{report.title}</h3>
                                            <p className="text-secondary text-sm mb-4">{report.description}</p>

                                            <div className="bg-white/5 rounded-lg p-3 mb-4">
                                                <div className="text-secondary text-xs mb-2">Includes:</div>
                                                <div className="flex flex-wrap gap-2">
                                                    {report.includes.map((item, index) => (
                                                        <span
                                                            key={index}
                                                            className="bg-primary/20 text-primary px-2 py-1 rounded text-xs"
                                                        >
                                                            {item}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>

                                            <button className="w-full bg-primary text-white py-2 px-4 rounded-lg hover:bg-primary/90 transition-colors font-medium">
                                                Generate PDF Report
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Quick Actions */}
                        <div className="glass-effect rounded-xl p-6">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">‚ö° Quick Actions</h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button className="bg-white/5 hover:bg-white/10 rounded-lg p-4 text-left transition-colors">
                                    <div className="text-2xl mb-2">üìß</div>
                                    <div className="text-enhanced font-medium">Email Report</div>
                                    <div className="text-secondary text-xs">Send to your email</div>
                                </button>
                                <button className="bg-white/5 hover:bg-white/10 rounded-lg p-4 text-left transition-colors">
                                    <div className="text-2xl mb-2">‚òÅÔ∏è</div>
                                    <div className="text-enhanced font-medium">Cloud Export</div>
                                    <div className="text-secondary text-xs">Save to cloud storage</div>
                                </button>
                                <button className="bg-white/5 hover:bg-white/10 rounded-lg p-4 text-left transition-colors">
                                    <div className="text-2xl mb-2">üîÑ</div>
                                    <div className="text-enhanced font-medium">Schedule Report</div>
                                    <div className="text-secondary text-xs">Automatic delivery</div>
                                </button>
                            </div>
                        </div>

                        {/* Report History */}
                        <div className="glass-effect rounded-xl p-6">
                            <h3 className="text-lg font-semibold text-enhanced mb-4">üìö Recent Reports</h3>
                            <div className="space-y-2">
                                {[1, 2, 3].map(i => (
                                    <div key={i} className="bg-white/5 rounded-lg p-3 hover:bg-white/10 transition-colors cursor-pointer">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center space-x-3">
                                                <div className="text-xl">üìÑ</div>
                                                <div>
                                                    <div className="text-enhanced text-sm font-medium">
                                                        Monthly Report - {new Date().toLocaleString('default', { month: 'long' })}
                                                    </div>
                                                    <div className="text-secondary text-xs">
                                                        Generated {i} day{i > 1 ? 's' : ''} ago
                                                    </div>
                                                </div>
                                            </div>
                                            <button className="text-primary hover:text-primary/80 text-sm">
                                                Download
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            // Main Render
            return (
                <div className="p-6 space-y-6">
                    {/* Header with Navigation Tabs */}
                    <div className="glass-effect rounded-2xl p-6">
                        <h1 className="text-2xl font-bold text-enhanced mb-4">üåü Dashboard Enhancements</h1>
                        <div className="flex flex-wrap gap-2">
                            {[
                                { id: 'kpi', label: 'KPI Board', icon: 'üìä' },
                                { id: 'branches', label: 'Branch Comparison', icon: 'üè¢' },
                                { id: 'alerts', label: 'Smart Alerts', icon: 'üö®' },
                                { id: 'predictive', label: 'Predictive Analytics', icon: 'üîÆ' },
                                { id: 'reports', label: 'Reports Hub', icon: 'üìã' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setViewMode(tab.id)}
                                    className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all ${
                                        viewMode === tab.id
                                            ? 'bg-primary text-white shadow-lg'
                                            : 'bg-white/10 text-secondary hover:bg-white/20'
                                    }`}
                                >
                                    <span>{tab.icon}</span>
                                    <span>{tab.label}</span>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Content Area */}
                    <div>
                        {viewMode === 'kpi' && <KPIBoard />}
                        {viewMode === 'branches' && <BranchComparison />}
                        {viewMode === 'alerts' && <SmartAlerts />}
                        {viewMode === 'predictive' && <PredictiveAnalytics />}
                        {viewMode === 'reports' && <ReportsHub />}
                    </div>
                </div>
            );
        };

        // üçΩÔ∏è PREMIUM: Menu Performance Report - Executive Ready
        const MenuPerformanceReport = () => {
            const { selectedRestaurant, dailyData, monthlyData } = useData();

            if (!selectedRestaurant) {
                return (
                    <div className="text-center py-12">
                        <div className="text-4xl mb-4">üìä</div>
                        <p className="text-secondary">Please select a restaurant to view menu analysis</p>
                    </div>
                );
            }

            // Generate menu items with performance metrics
            const menuItems = [
                {
                    name: 'Classic Burger', category: 'Burgers',
                    orders: 1250, revenue: 31250, cost: 18750, margin: 0.40,
                    popularity: 0.28, profitability: 0.40, trend: '+15%', image: 'üçî'
                },
                {
                    name: 'Cheese Pizza', category: 'Pizza',
                    orders: 980, revenue: 34300, cost: 17150, margin: 0.50,
                    popularity: 0.22, profitability: 0.50, trend: '+22%', image: 'üçï'
                },
                {
                    name: 'Caesar Salad', category: 'Salads',
                    orders: 450, revenue: 5850, cost: 3510, margin: 0.40,
                    popularity: 0.10, profitability: 0.40, trend: '-8%', image: 'ü•ó'
                },
                {
                    name: 'Chicken Wings', category: 'Appetizers',
                    orders: 820, revenue: 16400, cost: 11480, margin: 0.30,
                    popularity: 0.18, profitability: 0.30, trend: '+5%', image: 'üçó'
                },
                {
                    name: 'Veggie Burger', category: 'Burgers',
                    orders: 320, revenue: 8320, cost: 3328, margin: 0.60,
                    popularity: 0.07, profitability: 0.60, trend: '+35%', image: 'ü•ô'
                },
                {
                    name: 'French Fries', category: 'Sides',
                    orders: 1450, revenue: 7250, cost: 5075, margin: 0.30,
                    popularity: 0.32, profitability: 0.30, trend: '+3%', image: 'üçü'
                },
                {
                    name: 'Seafood Pasta', category: 'Pasta',
                    orders: 280, revenue: 8400, cost: 5040, margin: 0.40,
                    popularity: 0.06, profitability: 0.40, trend: '-12%', image: 'üçù'
                },
                {
                    name: 'Chocolate Cake', category: 'Desserts',
                    orders: 620, revenue: 6820, cost: 2728, margin: 0.60,
                    popularity: 0.14, profitability: 0.60, trend: '+18%', image: 'üç∞'
                }
            ];

            // Professional Menu Classification (Modern BCG Matrix)
            const avgPopularity = menuItems.reduce((sum, item) => sum + item.popularity, 0) / menuItems.length;
            const avgProfitability = menuItems.reduce((sum, item) => sum + item.profitability, 0) / menuItems.length;

            const classifyItem = (item) => {
                const highPopularity = item.popularity >= avgPopularity;
                const highProfitability = item.profitability >= avgProfitability;

                // Professional restaurant-focused terminology
                if (highPopularity && highProfitability) return { type: 'topPerformer', label: 'Top Performer', shortLabel: 'Best Seller', color: '#10b981', icon: 'üèÜ' };
                if (!highPopularity && highProfitability) return { type: 'hiddenGem', label: 'Hidden Gem', shortLabel: 'Profit Driver', color: '#3b82f6', icon: 'üíé' };
                if (highPopularity && !highProfitability) return { type: 'trending', label: 'Trending Item', shortLabel: 'Optimization Target', color: '#f59e0b', icon: 'üìà' };
                return { type: 'underperformer', label: 'Underperformer', shortLabel: 'Low Impact', color: '#ef4444', icon: '‚ö†Ô∏è' };
            };

            const itemsWithClass = menuItems.map(item => ({
                ...item,
                classification: classifyItem(item)
            }));

            const topPerformers = itemsWithClass.filter(i => i.classification.type === 'topPerformer');
            const hiddenGems = itemsWithClass.filter(i => i.classification.type === 'hiddenGem');
            const trendingItems = itemsWithClass.filter(i => i.classification.type === 'trending');
            const underperformers = itemsWithClass.filter(i => i.classification.type === 'underperformer');

            // Calculate totals for KPIs
            const totalMenuItems = menuItems.length;
            const totalRevenue = menuItems.reduce((sum, item) => sum + item.revenue, 0);
            const avgMargin = (menuItems.reduce((sum, item) => sum + item.margin, 0) / menuItems.length) * 100;
            const topPerformerRevenue = topPerformers.reduce((sum, item) => sum + item.revenue, 0);

            // AI Insights for Menu Optimization
            const menuAIInsights = [
                {
                    icon: 'üèÜ',
                    title: 'Top Performers Dominate Revenue',
                    description: `Your ${topPerformers.length} top performers generate ${utils.formatCurrency(topPerformerRevenue)} (${((topPerformerRevenue / totalRevenue) * 100).toFixed(1)}% of total revenue). Continue promoting these items prominently.`,
                    action: 'Feature top performers on prime menu real estate and digital channels'
                },
                {
                    icon: 'üíé',
                    title: 'Hidden Gems Opportunity',
                    description: `${hiddenGems.length} hidden gems have excellent profit margins (avg ${(hiddenGems.reduce((sum, i) => sum + i.margin, 0) / hiddenGems.length * 100).toFixed(0)}%) but low visibility. Increase marketing to boost orders.`,
                    action: 'Create combo deals pairing hidden gems with top performers'
                },
                {
                    icon: 'üìà',
                    title: 'Optimize Trending Items',
                    description: `${trendingItems.length} trending items are popular but have lower margins. Focus on portion control and supplier negotiations to improve profitability without sacrificing popularity.`,
                    action: 'Review recipes and costs for ${trendingItems.map(i => i.name).join(", ")}'
                },
                {
                    icon: '‚ö†Ô∏è',
                    title: 'Underperformers Review',
                    description: `${underperformers.length} underperforming items contribute only ${((underperformers.reduce((sum, i) => sum + i.revenue, 0) / totalRevenue) * 100).toFixed(1)}% of revenue. Consider removal or complete recipe refresh.`,
                    action: 'Test new recipes or replace underperformers with innovative alternatives'
                }
            ];

            return (
                <div className="report-container" style={{ background: '#FFFFFF', minHeight: '100vh', padding: '0' }}>
                    <ReportHeader
                        title="Menu Performance Analysis"
                        subtitle="Strategic menu engineering with profitability insights"
                        restaurantName={selectedRestaurant.name}
                    />

                    <div style={{ padding: '2rem', maxWidth: '1400px', margin: '0 auto' }}>
                        {/* Executive Summary KPIs */}
                        <ReportSection title="Executive Summary">
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1.5rem' }}>
                                <ReportKPICard
                                    icon="üçΩÔ∏è"
                                    label="Total Menu Items"
                                    value={totalMenuItems}
                                    color="#0A2540"
                                />
                                <ReportKPICard
                                    icon="üí∞"
                                    label="Total Menu Revenue"
                                    value={utils.formatCurrency(totalRevenue)}
                                    color="#0A2540"
                                />
                                <ReportKPICard
                                    icon="üìä"
                                    label="Average Profit Margin"
                                    value={`${avgMargin.toFixed(1)}%`}
                                    change={avgMargin >= 45 ? 'Above Target' : 'Below Target'}
                                    trend={avgMargin >= 45 ? 'up' : 'down'}
                                    color={avgMargin >= 45 ? '#10b981' : '#f59e0b'}
                                />
                                <ReportKPICard
                                    icon="üèÜ"
                                    label="Top Performers"
                                    value={`${topPerformers.length} Items`}
                                    change={`${((topPerformerRevenue / totalRevenue) * 100).toFixed(0)}% of Revenue`}
                                    trend="up"
                                    color="#10b981"
                                />
                            </div>
                        </ReportSection>

                        {/* Performance Categories */}
                        <ReportSection title="Menu Performance Categories">
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1.5rem' }}>
                                <div style={{
                                    padding: '1.5rem',
                                    background: '#FFFFFF',
                                    border: '2px solid rgba(16, 185, 129, 0.2)',
                                    borderLeft: '4px solid #10b981',
                                    borderRadius: '12px',
                                    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                }}>
                                    <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>üèÜ</div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '800', color: '#0A2540', marginBottom: '0.25rem' }}>
                                        {topPerformers.length}
                                    </div>
                                    <div style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#10b981', marginBottom: '0.5rem' }}>
                                        Top Performers
                                    </div>
                                    <div style={{ fontSize: '0.875rem', color: '#64748b' }}>
                                        High popularity, high profitability
                                    </div>
                                </div>

                                <div style={{
                                    padding: '1.5rem',
                                    background: '#FFFFFF',
                                    border: '2px solid rgba(59, 130, 246, 0.2)',
                                    borderLeft: '4px solid #3b82f6',
                                    borderRadius: '12px',
                                    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                }}>
                                    <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>üíé</div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '800', color: '#0A2540', marginBottom: '0.25rem' }}>
                                        {hiddenGems.length}
                                    </div>
                                    <div style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#3b82f6', marginBottom: '0.5rem' }}>
                                        Hidden Gems
                                    </div>
                                    <div style={{ fontSize: '0.875rem', color: '#64748b' }}>
                                        High profit, needs visibility boost
                                    </div>
                                </div>

                                <div style={{
                                    padding: '1.5rem',
                                    background: '#FFFFFF',
                                    border: '2px solid rgba(245, 158, 11, 0.2)',
                                    borderLeft: '4px solid #f59e0b',
                                    borderRadius: '12px',
                                    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                }}>
                                    <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>üìà</div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '800', color: '#0A2540', marginBottom: '0.25rem' }}>
                                        {trendingItems.length}
                                    </div>
                                    <div style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#f59e0b', marginBottom: '0.5rem' }}>
                                        Trending Items
                                    </div>
                                    <div style={{ fontSize: '0.875rem', color: '#64748b' }}>
                                        Popular, needs margin optimization
                                    </div>
                                </div>

                                <div style={{
                                    padding: '1.5rem',
                                    background: '#FFFFFF',
                                    border: '2px solid rgba(239, 68, 68, 0.2)',
                                    borderLeft: '4px solid #ef4444',
                                    borderRadius: '12px',
                                    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                }}>
                                    <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>‚ö†Ô∏è</div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '800', color: '#0A2540', marginBottom: '0.25rem' }}>
                                        {underperformers.length}
                                    </div>
                                    <div style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#ef4444', marginBottom: '0.5rem' }}>
                                        Underperformers
                                    </div>
                                    <div style={{ fontSize: '0.875rem', color: '#64748b' }}>
                                        Low impact, consider removal
                                    </div>
                                </div>
                            </div>
                        </ReportSection>

                        {/* Performance Matrix Visualization */}
                        <ReportSection title="Performance Matrix">
                            <div style={{
                                padding: '2rem',
                                background: '#FFFFFF',
                                border: '2px solid rgba(10, 37, 64, 0.1)',
                                borderRadius: '12px',
                                boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                            }}>
                                <div className="relative" style={{ height: '500px', background: 'linear-gradient(135deg, rgba(10, 37, 64, 0.02) 0%, rgba(255, 215, 0, 0.02) 100%)', borderRadius: '8px', padding: '2rem' }}>
                                    {/* Quadrant Labels */}
                                    <div className="absolute" style={{ top: '1rem', left: '1rem', fontWeight: '700', color: '#10b981', fontSize: '0.9375rem' }}>
                                        üèÜ Top Performers
                                    </div>
                                    <div className="absolute" style={{ top: '1rem', right: '1rem', fontWeight: '700', color: '#3b82f6', fontSize: '0.9375rem' }}>
                                        üíé Hidden Gems
                                    </div>
                                    <div className="absolute" style={{ bottom: '1rem', left: '1rem', fontWeight: '700', color: '#f59e0b', fontSize: '0.9375rem' }}>
                                        üìà Trending Items
                                    </div>
                                    <div className="absolute" style={{ bottom: '1rem', right: '1rem', fontWeight: '700', color: '#ef4444', fontSize: '0.9375rem' }}>
                                        ‚ö†Ô∏è Underperformers
                                    </div>

                                    {/* Axes */}
                                    <div className="absolute" style={{ left: '50%', top: '0', bottom: '0', width: '2px', background: 'rgba(10, 37, 64, 0.2)' }}></div>
                                    <div className="absolute" style={{ top: '50%', left: '0', right: '0', height: '2px', background: 'rgba(10, 37, 64, 0.2)' }}></div>

                                    {/* Axis Labels */}
                                    <div className="absolute" style={{ bottom: '0.5rem', left: '50%', transform: 'translateX(-50%)', color: '#64748b', fontSize: '0.875rem', fontWeight: '600' }}>
                                        Popularity ‚Üí
                                    </div>
                                    <div className="absolute" style={{ left: '0.5rem', top: '50%', transform: 'translateY(-50%) rotate(-90deg)', color: '#64748b', fontSize: '0.875rem', fontWeight: '600' }}>
                                        Profitability ‚Üí
                                    </div>

                                    {/* Plot Items */}
                                    {itemsWithClass.map((item, index) => {
                                        const left = 10 + (item.popularity * 80);
                                        const bottom = 10 + (item.profitability * 80);
                                        const size = Math.sqrt(item.revenue / 500);

                                        return (
                                            <div
                                                key={index}
                                                className="absolute transform -translate-x-1/2 -translate-y-1/2 cursor-pointer hover:scale-110 transition-all"
                                                style={{ left: `${left}%`, bottom: `${bottom}%` }}
                                                title={`${item.name}: ${item.orders} orders, ${utils.formatCurrency(item.revenue)}`}
                                            >
                                                <div
                                                    className="rounded-full flex items-center justify-center text-2xl shadow-lg"
                                                    style={{
                                                        width: `${size}px`,
                                                        height: `${size}px`,
                                                        backgroundColor: `${item.classification.color}20`,
                                                        border: `3px solid ${item.classification.color}`
                                                    }}
                                                >
                                                    {item.image}
                                                </div>
                                                <div className="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs whitespace-nowrap font-medium" style={{ color: '#0A2540' }}>
                                                    {item.name}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </ReportSection>

                        {/* Strategic Action Plans by Category */}
                        <ReportSection title="Strategic Action Plans">
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '1.5rem' }}>
                                {/* Top Performers */}
                                {topPerformers.length > 0 && (
                                    <div style={{
                                        padding: '1.5rem',
                                        background: '#FFFFFF',
                                        border: '2px solid rgba(16, 185, 129, 0.2)',
                                        borderLeft: '4px solid #10b981',
                                        borderRadius: '12px',
                                        boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                    }}>
                                        <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#10b981', marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                            üèÜ Top Performers - Maintain Excellence
                                        </h3>
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                            {topPerformers.map((item, index) => (
                                                <div key={index} style={{ padding: '0.75rem', background: 'rgba(16, 185, 129, 0.05)', borderRadius: '8px', border: '1px solid rgba(16, 185, 129, 0.1)' }}>
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                                                            <span style={{ fontSize: '1.5rem' }}>{item.image}</span>
                                                            <div>
                                                                <div style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#0A2540' }}>{item.name}</div>
                                                                <div style={{ fontSize: '0.75rem', color: '#64748b' }}>{item.orders} orders ‚Ä¢ {(item.margin * 100).toFixed(0)}% margin</div>
                                                            </div>
                                                        </div>
                                                        <div style={{ fontSize: '0.875rem', fontWeight: '700', color: '#10b981' }}>{item.trend}</div>
                                                    </div>
                                                </div>
                                            ))}
                                            <div style={{ padding: '0.75rem', background: 'rgba(16, 185, 129, 0.05)', borderRadius: '8px', marginTop: '0.5rem' }}>
                                                <p style={{ fontSize: '0.875rem', color: '#0A2540' }}>
                                                    <strong>Strategy:</strong> Maintain quality standards, feature prominently on menu and marketing materials, consider premium positioning
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Hidden Gems */}
                                {hiddenGems.length > 0 && (
                                    <div style={{
                                        padding: '1.5rem',
                                        background: '#FFFFFF',
                                        border: '2px solid rgba(59, 130, 246, 0.2)',
                                        borderLeft: '4px solid #3b82f6',
                                        borderRadius: '12px',
                                        boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                    }}>
                                        <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#3b82f6', marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                            üíé Hidden Gems - Increase Visibility
                                        </h3>
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                            {hiddenGems.map((item, index) => (
                                                <div key={index} style={{ padding: '0.75rem', background: 'rgba(59, 130, 246, 0.05)', borderRadius: '8px', border: '1px solid rgba(59, 130, 246, 0.1)' }}>
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                                                            <span style={{ fontSize: '1.5rem' }}>{item.image}</span>
                                                            <div>
                                                                <div style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#0A2540' }}>{item.name}</div>
                                                                <div style={{ fontSize: '0.75rem', color: '#64748b' }}>{item.orders} orders ‚Ä¢ {(item.margin * 100).toFixed(0)}% margin</div>
                                                            </div>
                                                        </div>
                                                        <div style={{ fontSize: '0.875rem', fontWeight: '700', color: '#3b82f6' }}>{item.trend}</div>
                                                    </div>
                                                </div>
                                            ))}
                                            <div style={{ padding: '0.75rem', background: 'rgba(59, 130, 246, 0.05)', borderRadius: '8px', marginTop: '0.5rem' }}>
                                                <p style={{ fontSize: '0.875rem', color: '#0A2540' }}>
                                                    <strong>Strategy:</strong> Boost marketing, offer samples, create combo deals with top performers, improve menu positioning
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Trending Items */}
                                {trendingItems.length > 0 && (
                                    <div style={{
                                        padding: '1.5rem',
                                        background: '#FFFFFF',
                                        border: '2px solid rgba(245, 158, 11, 0.2)',
                                        borderLeft: '4px solid #f59e0b',
                                        borderRadius: '12px',
                                        boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                    }}>
                                        <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#f59e0b', marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                            üìà Trending Items - Optimize Margins
                                        </h3>
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                            {trendingItems.map((item, index) => (
                                                <div key={index} style={{ padding: '0.75rem', background: 'rgba(245, 158, 11, 0.05)', borderRadius: '8px', border: '1px solid rgba(245, 158, 11, 0.1)' }}>
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                                                            <span style={{ fontSize: '1.5rem' }}>{item.image}</span>
                                                            <div>
                                                                <div style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#0A2540' }}>{item.name}</div>
                                                                <div style={{ fontSize: '0.75rem', color: '#64748b' }}>{item.orders} orders ‚Ä¢ {(item.margin * 100).toFixed(0)}% margin</div>
                                                            </div>
                                                        </div>
                                                        <div style={{ fontSize: '0.875rem', fontWeight: '700', color: '#f59e0b' }}>{item.trend}</div>
                                                    </div>
                                                </div>
                                            ))}
                                            <div style={{ padding: '0.75rem', background: 'rgba(245, 158, 11, 0.05)', borderRadius: '8px', marginTop: '0.5rem' }}>
                                                <p style={{ fontSize: '0.875rem', color: '#0A2540' }}>
                                                    <strong>Strategy:</strong> Optimize costs through portion control, negotiate with suppliers, slight price increases
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Underperformers */}
                                {underperformers.length > 0 && (
                                    <div style={{
                                        padding: '1.5rem',
                                        background: '#FFFFFF',
                                        border: '2px solid rgba(239, 68, 68, 0.2)',
                                        borderLeft: '4px solid #ef4444',
                                        borderRadius: '12px',
                                        boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                    }}>
                                        <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#ef4444', marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                            ‚ö†Ô∏è Underperformers - Action Required
                                        </h3>
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                            {underperformers.map((item, index) => (
                                                <div key={index} style={{ padding: '0.75rem', background: 'rgba(239, 68, 68, 0.05)', borderRadius: '8px', border: '1px solid rgba(239, 68, 68, 0.1)' }}>
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                                                            <span style={{ fontSize: '1.5rem' }}>{item.image}</span>
                                                            <div>
                                                                <div style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#0A2540' }}>{item.name}</div>
                                                                <div style={{ fontSize: '0.75rem', color: '#64748b' }}>{item.orders} orders ‚Ä¢ {(item.margin * 100).toFixed(0)}% margin</div>
                                                            </div>
                                                        </div>
                                                        <div style={{ fontSize: '0.875rem', fontWeight: '700', color: '#ef4444' }}>{item.trend}</div>
                                                    </div>
                                                </div>
                                            ))}
                                            <div style={{ padding: '0.75rem', background: 'rgba(239, 68, 68, 0.05)', borderRadius: '8px', marginTop: '0.5rem' }}>
                                                <p style={{ fontSize: '0.875rem', color: '#0A2540' }}>
                                                    <strong>Strategy:</strong> Consider menu removal, complete recipe refresh, or replacement with innovative alternatives
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </ReportSection>

                        {/* Complete Menu Performance Table */}
                        <ReportSection title="Complete Menu Performance">
                            <div style={{ overflowX: 'auto' }}>
                                <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                                    <thead>
                                        <tr style={{ background: 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%)', borderBottom: '3px solid #FFD700' }}>
                                            <th style={{ textAlign: 'left', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Item</th>
                                            <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Classification</th>
                                            <th style={{ textAlign: 'right', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Orders</th>
                                            <th style={{ textAlign: 'right', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Revenue</th>
                                            <th style={{ textAlign: 'right', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Margin</th>
                                            <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Trend</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {itemsWithClass
                                            .sort((a, b) => b.revenue - a.revenue)
                                            .map((item, index) => (
                                                <tr key={index} style={{
                                                    borderBottom: '1px solid rgba(10, 37, 64, 0.1)',
                                                    transition: 'background 0.2s'
                                                }}>
                                                    <td style={{ padding: '1rem' }}>
                                                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                                                            <span style={{ fontSize: '1.5rem' }}>{item.image}</span>
                                                            <div>
                                                                <div style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#0A2540' }}>{item.name}</div>
                                                                <div style={{ fontSize: '0.75rem', color: '#64748b' }}>{item.category}</div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td style={{ padding: '1rem', textAlign: 'center' }}>
                                                        <span style={{
                                                            padding: '0.375rem 0.75rem',
                                                            borderRadius: '12px',
                                                            fontSize: '0.75rem',
                                                            fontWeight: '600',
                                                            background: `${item.classification.color}20`,
                                                            color: item.classification.color
                                                        }}>
                                                            {item.classification.icon} {item.classification.label}
                                                        </span>
                                                    </td>
                                                    <td style={{ padding: '1rem', textAlign: 'right', fontSize: '0.9375rem', color: '#0A2540', fontWeight: '600' }}>
                                                        {utils.formatNumber(item.orders)}
                                                    </td>
                                                    <td style={{ padding: '1rem', textAlign: 'right', fontSize: '0.9375rem', color: '#0A2540', fontWeight: '700' }}>
                                                        {utils.formatCurrency(item.revenue)}
                                                    </td>
                                                    <td style={{ padding: '1rem', textAlign: 'right' }}>
                                                        <span style={{
                                                            fontSize: '0.9375rem',
                                                            fontWeight: '700',
                                                            color: item.margin >= 0.45 ? '#10b981' : '#f59e0b'
                                                        }}>
                                                            {(item.margin * 100).toFixed(0)}%
                                                        </span>
                                                    </td>
                                                    <td style={{ padding: '1rem', textAlign: 'center' }}>
                                                        <span style={{
                                                            fontSize: '0.9375rem',
                                                            fontWeight: '700',
                                                            color: item.trend.startsWith('+') ? '#10b981' : '#ef4444'
                                                        }}>
                                                            {item.trend}
                                                        </span>
                                                    </td>
                                                </tr>
                                            ))}
                                    </tbody>
                                </table>
                            </div>
                        </ReportSection>

                        {/* AI-Powered Insights */}
                        <AIInsightsBox insights={menuAIInsights} />

                        <ReportFooter />
                    </div>
                </div>
            );
        };

        // üë• SIMPLE: Staff Management - Basic Employee Records
        const SimpleStaffManagement = () => {
            const { selectedRestaurant } = useData();
            const [showAddStaffModal, setShowAddStaffModal] = React.useState(false);

            if (!selectedRestaurant) {
                return (
                    <div className="text-center py-12">
                        <div className="text-4xl mb-4">üë•</div>
                        <p className="text-secondary">Please select a restaurant to manage staff</p>
                    </div>
                );
            }

            // Simple staff data (no analytics, just basic records)
            const [staffMembers, setStaffMembers] = React.useState([
                {
                    id: 1,
                    name: 'Ahmed Hassan',
                    role: 'Head Chef',
                    salary: 8000,
                    schedule: 'Mon-Sat: 10:00 AM - 6:00 PM',
                    status: 'Active'
                },
                {
                    id: 2,
                    name: 'Sara Al-Mansouri',
                    role: 'Sous Chef',
                    salary: 6000,
                    schedule: 'Mon-Sat: 10:00 AM - 6:00 PM',
                    status: 'Active'
                },
                {
                    id: 3,
                    name: 'Omar Al-Rashid',
                    role: 'Line Cook',
                    salary: 4500,
                    schedule: 'Mon-Sat: 11:00 AM - 7:00 PM',
                    status: 'Active'
                },
                {
                    id: 4,
                    name: 'Layla Mahmoud',
                    role: 'Server',
                    salary: 3500,
                    schedule: 'Mon-Fri: 9:00 AM - 5:00 PM',
                    status: 'Active'
                },
                {
                    id: 5,
                    name: 'Khalid Ibrahim',
                    role: 'Server',
                    salary: 3500,
                    schedule: 'Tue-Sat: 2:00 PM - 10:00 PM',
                    status: 'Active'
                },
                {
                    id: 6,
                    name: 'Fatima Ali',
                    role: 'Cashier',
                    salary: 4000,
                    schedule: 'Sun-Thu: 10:00 AM - 6:00 PM',
                    status: 'Active'
                }
            ]);

            const totalSalaries = staffMembers.reduce((sum, s) => sum + s.salary, 0);

            return (
                <div className="p-6 space-y-6">
                    {/* Staff Management Header */}
                    <div className="glass-effect rounded-2xl p-6" style={{
                        background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%)',
                        border: '2px solid rgba(59, 130, 246, 0.3)'
                    }}>
                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                                <span style={{ fontSize: '3rem' }}>üë•</span>
                                <div>
                                    <h1 style={{ fontSize: '2rem', fontWeight: '800', color: '#3b82f6', marginBottom: '0.25rem' }}>
                                        Staff Management
                                    </h1>
                                    <p style={{ fontSize: '0.875rem', color: '#94a3b8', margin: 0 }}>
                                        Manage employee records for {selectedRestaurant.name}
                                    </p>
                                </div>
                            </div>
                            <button
                                onClick={() => setShowAddStaffModal(true)}
                                style={{
                                    padding: '0.75rem 1.5rem',
                                    background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',
                                    color: '#FFFFFF',
                                    border: 'none',
                                    borderRadius: '12px',
                                    fontSize: '0.9375rem',
                                    fontWeight: '700',
                                    cursor: 'pointer',
                                    boxShadow: '0 4px 12px rgba(59, 130, 246, 0.3)',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '0.5rem'
                                }}
                            >
                                <span style={{ fontSize: '1.25rem' }}>+</span>
                                Add Staff Member
                            </button>
                        </div>
                    </div>

                    {/* Staff Summary Cards */}
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1.5rem' }}>
                        <div style={{
                            padding: '1.5rem',
                            background: '#FFFFFF',
                            border: '2px solid rgba(59, 130, 246, 0.2)',
                            borderLeft: '4px solid #3b82f6',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                        }}>
                            <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '0.5rem' }}>Total Staff</div>
                            <div style={{ fontSize: '2.5rem', fontWeight: '800', color: '#0A2540' }}>{staffMembers.length}</div>
                        </div>
                        <div style={{
                            padding: '1.5rem',
                            background: '#FFFFFF',
                            border: '2px solid rgba(16, 185, 129, 0.2)',
                            borderLeft: '4px solid #10b981',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                        }}>
                            <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '0.5rem' }}>Active Staff</div>
                            <div style={{ fontSize: '2.5rem', fontWeight: '800', color: '#0A2540' }}>
                                {staffMembers.filter(s => s.status === 'Active').length}
                            </div>
                        </div>
                        <div style={{
                            padding: '1.5rem',
                            background: '#FFFFFF',
                            border: '2px solid rgba(239, 68, 68, 0.2)',
                            borderLeft: '4px solid #ef4444',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                        }}>
                            <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '0.5rem' }}>Total Monthly Salaries</div>
                            <div style={{ fontSize: '2.5rem', fontWeight: '800', color: '#0A2540' }}>
                                {utils.formatCurrency(totalSalaries)}
                            </div>
                        </div>
                    </div>

                    {/* Staff List Table */}
                    <div style={{
                        background: '#FFFFFF',
                        border: '2px solid rgba(10, 37, 64, 0.1)',
                        borderRadius: '16px',
                        boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)',
                        overflow: 'hidden'
                    }}>
                        <div style={{ padding: '1.5rem', borderBottom: '2px solid rgba(10, 37, 64, 0.1)' }}>
                            <h3 style={{ fontSize: '1.25rem', fontWeight: '800', color: '#0A2540' }}>Staff Directory</h3>
                        </div>
                        <div style={{ overflowX: 'auto' }}>
                            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                                <thead>
                                    <tr style={{ background: 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%)', borderBottom: '3px solid #FFD700' }}>
                                        <th style={{ textAlign: 'left', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Staff Name</th>
                                        <th style={{ textAlign: 'left', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Role/Task</th>
                                        <th style={{ textAlign: 'right', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Monthly Salary</th>
                                        <th style={{ textAlign: 'left', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Work Schedule</th>
                                        <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Status</th>
                                        <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {staffMembers.map((staff) => (
                                        <tr key={staff.id} style={{ borderBottom: '1px solid rgba(10, 37, 64, 0.1)' }}>
                                            <td style={{ padding: '1rem' }}>
                                                <div style={{ fontSize: '0.9375rem', fontWeight: '700', color: '#0A2540' }}>
                                                    {staff.name}
                                                </div>
                                            </td>
                                            <td style={{ padding: '1rem' }}>
                                                <div style={{ fontSize: '0.9375rem', color: '#64748b' }}>
                                                    {staff.role}
                                                </div>
                                            </td>
                                            <td style={{ padding: '1rem', textAlign: 'right', fontSize: '0.9375rem', fontWeight: '700', color: '#0A2540' }}>
                                                {utils.formatCurrency(staff.salary)}
                                            </td>
                                            <td style={{ padding: '1rem', fontSize: '0.875rem', color: '#64748b' }}>
                                                {staff.schedule}
                                            </td>
                                            <td style={{ padding: '1rem', textAlign: 'center' }}>
                                                <span style={{
                                                    padding: '0.375rem 0.75rem',
                                                    borderRadius: '12px',
                                                    fontSize: '0.75rem',
                                                    fontWeight: '700',
                                                    background: staff.status === 'Active' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                                                    color: staff.status === 'Active' ? '#10b981' : '#ef4444'
                                                }}>
                                                    ‚óè {staff.status}
                                                </span>
                                            </td>
                                            <td style={{ padding: '1rem', textAlign: 'center' }}>
                                                <button style={{
                                                    padding: '0.5rem 1rem',
                                                    background: 'rgba(10, 37, 64, 0.05)',
                                                    color: '#0A2540',
                                                    border: '1px solid rgba(10, 37, 64, 0.2)',
                                                    borderRadius: '8px',
                                                    fontSize: '0.75rem',
                                                    fontWeight: '600',
                                                    cursor: 'pointer',
                                                    marginRight: '0.5rem'
                                                }}>
                                                    Edit
                                                </button>
                                                <button style={{
                                                    padding: '0.5rem 1rem',
                                                    background: 'rgba(239, 68, 68, 0.05)',
                                                    color: '#ef4444',
                                                    border: '1px solid rgba(239, 68, 68, 0.2)',
                                                    borderRadius: '8px',
                                                    fontSize: '0.75rem',
                                                    fontWeight: '600',
                                                    cursor: 'pointer'
                                                }}>
                                                    Remove
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        // üì± PREMIUM: Channel Performance Report - Executive Ready
        const ChannelPerformanceReport = () => {
            const { selectedRestaurant } = useData();

            if (!selectedRestaurant) {
                return (
                    <div className="text-center py-12">
                        <div className="text-4xl mb-4">üì±</div>
                        <p className="text-secondary">Please select a restaurant to view channel performance</p>
                    </div>
                );
            }

            // Channel performance data (keep existing data)
            const channels = [
                {
                    id: 1,
                    name: 'Website',
                    icon: 'üåê',
                    orders: 1250,
                    revenue: 48750,
                    avgOrderValue: 39,
                    commission: 0,
                    conversionRate: 3.2,
                    customerSatisfaction: 4.8,
                    growth: '+18%',
                    color: '#3b82f6'
                },
                {
                    id: 2,
                    name: 'Mobile App',
                    icon: 'üì±',
                    orders: 1580,
                    revenue: 63200,
                    avgOrderValue: 40,
                    commission: 0,
                    conversionRate: 4.1,
                    customerSatisfaction: 4.9,
                    growth: '+25%',
                    color: '#8b5cf6'
                },
                {
                    id: 3,
                    name: 'In-Store',
                    icon: 'üè™',
                    orders: 2100,
                    revenue: 94500,
                    avgOrderValue: 45,
                    commission: 0,
                    conversionRate: 100,
                    customerSatisfaction: 4.7,
                    growth: '+8%',
                    color: '#10b981'
                },
                {
                    id: 4,
                    name: 'Uber Eats',
                    icon: 'üöó',
                    orders: 920,
                    revenue: 32200,
                    avgOrderValue: 35,
                    commission: 9660,
                    conversionRate: 2.8,
                    customerSatisfaction: 4.5,
                    growth: '+12%',
                    color: '#22c55e'
                },
                {
                    id: 5,
                    name: 'Deliveroo',
                    icon: 'üõµ',
                    orders: 780,
                    revenue: 27300,
                    avgOrderValue: 35,
                    commission: 8190,
                    conversionRate: 2.5,
                    customerSatisfaction: 4.4,
                    growth: '+15%',
                    color: '#06b6d4'
                },
                {
                    id: 6,
                    name: 'Talabat',
                    icon: 'üçî',
                    orders: 650,
                    revenue: 22750,
                    avgOrderValue: 35,
                    commission: 6825,
                    conversionRate: 2.3,
                    customerSatisfaction: 4.3,
                    growth: '+10%',
                    color: '#f59e0b'
                }
            ];

            // Calculate KPIs
            const totalOrders = channels.reduce((sum, c) => sum + c.orders, 0);
            const totalRevenue = channels.reduce((sum, c) => sum + c.revenue, 0);
            const totalCommission = channels.reduce((sum, c) => sum + c.commission, 0);
            const netRevenue = totalRevenue - totalCommission;
            const avgSatisfaction = (channels.reduce((sum, c) => sum + c.customerSatisfaction, 0) / channels.length).toFixed(2);

            // Direct vs Third-party
            const directChannels = channels.filter(c => c.commission === 0);
            const thirdPartyChannels = channels.filter(c => c.commission > 0);
            const directRevenue = directChannels.reduce((sum, c) => sum + c.revenue, 0);
            const thirdPartyRevenue = thirdPartyChannels.reduce((sum, c) => sum + c.revenue, 0);

            // AI Insights for Channels
            const channelAIInsights = [
                {
                    icon: 'üì±',
                    title: 'Mobile App Leading Growth',
                    description: `Mobile app shows strongest growth at +25% with highest customer satisfaction (4.9/5.0). Invest in app-exclusive promotions and features to capitalize on this momentum.`,
                    action: 'Launch app-exclusive loyalty rewards and push notifications'
                },
                {
                    icon: 'üí∞',
                    title: 'Commission Optimization Opportunity',
                    description: `Third-party platforms cost ${utils.formatCurrency(totalCommission)} (${((totalCommission / totalRevenue) * 100).toFixed(1)}% of revenue). Shifting 15% of third-party orders to direct channels could save ${utils.formatCurrency(totalCommission * 0.15)}/month.`,
                    action: 'Incentivize customers to order directly with discounts'
                },
                {
                    icon: 'üåê',
                    title: 'Website Conversion Potential',
                    description: `Website has 3.2% conversion rate vs. app's 4.1%. Simple UX improvements (faster checkout, saved preferences) could increase website orders by 20-30%.`,
                    action: 'Implement one-click checkout and guest ordering'
                },
                {
                    icon: 'üè™',
                    title: 'In-Store Remains Core Channel',
                    description: `In-store generates ${((directChannels[2].revenue / totalRevenue) * 100).toFixed(1)}% of revenue with highest average order value (${utils.formatCurrency(directChannels[2].avgOrderValue)}). Maintain quality while growing digital channels.`,
                    action: 'Cross-promote digital channels to in-store customers'
                }
            ];

            return (
                <div className="report-container" style={{ background: '#FFFFFF', minHeight: '100vh', padding: '0' }}>
                    <ReportHeader
                        title="Channel Performance Report"
                        subtitle="Multi-channel sales analytics and optimization insights"
                        restaurantName={selectedRestaurant.name}
                    />

                    <div style={{ padding: '2rem', maxWidth: '1400px', margin: '0 auto' }}>
                        {/* Executive Summary KPIs */}
                        <ReportSection title="Executive Summary">
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1.5rem' }}>
                                <ReportKPICard
                                    icon="üìä"
                                    label="Total Orders (All Channels)"
                                    value={totalOrders.toLocaleString()}
                                    color="#0A2540"
                                />
                                <ReportKPICard
                                    icon="üí∞"
                                    label="Total Revenue"
                                    value={utils.formatCurrency(totalRevenue)}
                                    color="#0A2540"
                                />
                                <ReportKPICard
                                    icon="üí∏"
                                    label="Platform Commissions"
                                    value={utils.formatCurrency(totalCommission)}
                                    change={`${((totalCommission / totalRevenue) * 100).toFixed(1)}% of Revenue`}
                                    trend="down"
                                    color="#ef4444"
                                />
                                <ReportKPICard
                                    icon="‚≠ê"
                                    label="Avg Customer Satisfaction"
                                    value={`${avgSatisfaction}/5.0`}
                                    change="Across All Channels"
                                    trend="up"
                                    color="#10b981"
                                />
                                    value={totalStaff}
                                    color="#0A2540"
                                />
                                <ReportKPICard
                                    icon="‚≠ê"
                                    label="Average Team Rating"
                                    value={`${avgRating}/5.0`}
                                    change={avgRating >= 4.5 ? 'Excellent' : 'Good'}
                                    trend={avgRating >= 4.5 ? 'up' : 'down'}
                                    color={avgRating >= 4.5 ? '#10b981' : '#f59e0b'}
                                />
                                <ReportKPICard
                                    icon="‚ö°"
                                    label="Team Efficiency"
                                    value={`${avgEfficiency}%`}
                                    change={avgEfficiency >= 90 ? 'Above Target' : 'On Target'}
                                    trend={avgEfficiency >= 90 ? 'up' : 'down'}
                                    color={avgEfficiency >= 90 ? '#10b981' : '#f59e0b'}
                                />
                                <ReportKPICard
                                    icon="üí∞"
                                    label="Total Tips Earned"
                                    value={utils.formatCurrency(totalTips)}
                                    change="This Period"
                                    trend="up"
                                    color="#10b981"
                                />
                            </div>
                        </ReportSection>

                        {/* Top Performer Highlight */}
                        <ReportSection title="Top Performer of the Month">
                            <div style={{
                                padding: '2rem',
                                background: 'linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%)',
                                border: '2px solid rgba(255, 215, 0, 0.3)',
                                borderRadius: '12px',
                                boxShadow: '0 4px 12px rgba(255, 215, 0, 0.1)'
                            }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '2rem' }}>
                                    <div style={{ fontSize: '5rem' }}>{topPerformer.avatar}</div>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '0.5rem' }}>
                                            <span style={{ fontSize: '2rem' }}>üèÜ</span>
                                            <h3 style={{ fontSize: '1.5rem', fontWeight: '800', color: '#0A2540' }}>{topPerformer.name}</h3>
                                        </div>
                                        <p style={{ fontSize: '1.125rem', color: '#FFD700', fontWeight: '600', marginBottom: '1rem' }}>{topPerformer.role}</p>
                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '1rem' }}>
                                            <div style={{ padding: '0.75rem', background: 'rgba(255, 255, 255, 0.8)', borderRadius: '8px', textAlign: 'center' }}>
                                                <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.25rem' }}>Orders</div>
                                                <div style={{ fontSize: '1.25rem', fontWeight: '800', color: '#0A2540' }}>{topPerformer.orders}</div>
                                            </div>
                                            <div style={{ padding: '0.75rem', background: 'rgba(255, 255, 255, 0.8)', borderRadius: '8px', textAlign: 'center' }}>
                                                <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.25rem' }}>Rating</div>
                                                <div style={{ fontSize: '1.25rem', fontWeight: '800', color: '#0A2540' }}>{topPerformer.avgRating.toFixed(1)} ‚≠ê</div>
                                            </div>
                                            <div style={{ padding: '0.75rem', background: 'rgba(255, 255, 255, 0.8)', borderRadius: '8px', textAlign: 'center' }}>
                                                <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.25rem' }}>Efficiency</div>
                                                <div style={{ fontSize: '1.25rem', fontWeight: '800', color: '#10b981' }}>{topPerformer.efficiency}%</div>
                                            </div>
                                            <div style={{ padding: '0.75rem', background: 'rgba(255, 255, 255, 0.8)', borderRadius: '8px', textAlign: 'center' }}>
                                                <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.25rem' }}>Tips</div>
                                                <div style={{ fontSize: '1.25rem', fontWeight: '800', color: '#0A2540' }}>{utils.formatCurrency(topPerformer.tips)}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ReportSection>

                        {/* Staff Performance Table */}
                        <ReportSection title="Team Performance Metrics">
                            <div style={{ overflowX: 'auto' }}>
                                <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                                    <thead>
                                        <tr style={{ background: 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%)', borderBottom: '3px solid #FFD700' }}>
                                            <th style={{ textAlign: 'left', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Rank</th>
                                            <th style={{ textAlign: 'left', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Staff Member</th>
                                            <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Department</th>
                                            <th style={{ textAlign: 'right', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Orders</th>
                                            <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Rating</th>
                                            <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Efficiency</th>
                                            <th style={{ textAlign: 'right', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Tips</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {staffMembers
                                            .sort((a, b) => (b.orders * b.avgRating * b.efficiency) - (a.orders * a.avgRating * a.efficiency))
                                            .map((staff, index) => (
                                                <tr key={staff.id} style={{
                                                    borderBottom: '1px solid rgba(10, 37, 64, 0.1)',
                                                    background: index < 3 ? 'rgba(255, 215, 0, 0.05)' : 'transparent'
                                                }}>
                                                    <td style={{ padding: '1rem' }}>
                                                        <span style={{ fontSize: '1.5rem', fontWeight: '800' }}>
                                                            {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `#${index + 1}`}
                                                        </span>
                                                    </td>
                                                    <td style={{ padding: '1rem' }}>
                                                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                                                            <span style={{ fontSize: '2rem' }}>{staff.avatar}</span>
                                                            <div>
                                                                <div style={{ fontSize: '0.9375rem', fontWeight: '700', color: '#0A2540', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                                                    {staff.name}
                                                                    {staff.badge && <span style={{ fontSize: '1rem' }}>{staff.badge}</span>}
                                                                </div>
                                                                <div style={{ fontSize: '0.75rem', color: '#64748b' }}>{staff.role}</div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td style={{ padding: '1rem', textAlign: 'center' }}>
                                                        <span style={{
                                                            padding: '0.375rem 0.75rem',
                                                            borderRadius: '12px',
                                                            fontSize: '0.75rem',
                                                            fontWeight: '600',
                                                            background: staff.department === 'Kitchen' ? 'rgba(16, 185, 129, 0.1)' :
                                                                        staff.department === 'Service' ? 'rgba(59, 130, 246, 0.1)' :
                                                                        'rgba(245, 158, 11, 0.1)',
                                                            color: staff.department === 'Kitchen' ? '#10b981' :
                                                                   staff.department === 'Service' ? '#3b82f6' :
                                                                   '#f59e0b'
                                                        }}>
                                                            {staff.department}
                                                        </span>
                                                    </td>
                                                    <td style={{ padding: '1rem', textAlign: 'right', fontSize: '0.9375rem', fontWeight: '700', color: '#0A2540' }}>
                                                        {staff.orders}
                                                    </td>
                                                    <td style={{ padding: '1rem', textAlign: 'center', fontSize: '0.9375rem', fontWeight: '700', color: '#0A2540' }}>
                                                        {staff.avgRating.toFixed(1)} ‚≠ê
                                                    </td>
                                                    <td style={{ padding: '1rem', textAlign: 'center' }}>
                                                        <span style={{
                                                            fontSize: '0.9375rem',
                                                            fontWeight: '700',
                                                            color: staff.efficiency >= 95 ? '#10b981' : staff.efficiency >= 90 ? '#3b82f6' : '#f59e0b'
                                                        }}>
                                                            {staff.efficiency}%
                                                        </span>
                                                    </td>
                                                    <td style={{ padding: '1rem', textAlign: 'right', fontSize: '0.9375rem', fontWeight: '700', color: '#0A2540' }}>
                                                        {utils.formatCurrency(staff.tips)}
                                                    </td>
                                                </tr>
                                            ))}
                                    </tbody>
                                </table>
                            </div>
                        </ReportSection>

                        {/* Department Analytics */}
                        <ReportSection title="Department Performance">
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '1.5rem' }}>
                                <div style={{
                                    padding: '1.5rem',
                                    background: '#FFFFFF',
                                    border: '2px solid rgba(16, 185, 129, 0.2)',
                                    borderLeft: '4px solid #10b981',
                                    borderRadius: '12px',
                                    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                }}>
                                    <div style={{ fontSize: '2.5rem', marginBottom: '0.75rem' }}>üë®‚Äçüç≥</div>
                                    <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#10b981', marginBottom: '0.5rem' }}>Kitchen Team</h3>
                                    <div style={{ fontSize: '2rem', fontWeight: '800', color: '#0A2540', marginBottom: '0.25rem' }}>
                                        {kitchen.reduce((sum, s) => sum + s.orders, 0).toLocaleString()}
                                    </div>
                                    <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '1rem' }}>Total Orders Prepared</div>
                                    <div style={{ marginBottom: '0.5rem' }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.75rem', color: '#64748b', marginBottom: '0.25rem' }}>
                                            <span>Avg Efficiency</span>
                                            <span style={{ fontWeight: '700', color: '#10b981' }}>
                                                {(kitchen.reduce((sum, s) => sum + s.efficiency, 0) / kitchen.length).toFixed(1)}%
                                            </span>
                                        </div>
                                        <div style={{ background: 'rgba(16, 185, 129, 0.1)', borderRadius: '9999px', height: '8px', overflow: 'hidden' }}>
                                            <div style={{
                                                background: '#10b981',
                                                height: '100%',
                                                width: `${(kitchen.reduce((sum, s) => sum + s.efficiency, 0) / kitchen.length)}%`,
                                                borderRadius: '9999px'
                                            }}></div>
                                        </div>
                                    </div>
                                    <div style={{ fontSize: '0.75rem', color: '#64748b' }}>
                                        {kitchen.length} team members
                                    </div>
                                </div>

                                <div style={{
                                    padding: '1.5rem',
                                    background: '#FFFFFF',
                                    border: '2px solid rgba(59, 130, 246, 0.2)',
                                    borderLeft: '4px solid #3b82f6',
                                    borderRadius: '12px',
                                    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                }}>
                                    <div style={{ fontSize: '2.5rem', marginBottom: '0.75rem' }}>üë•</div>
                                    <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#3b82f6', marginBottom: '0.5rem' }}>Service Team</h3>
                                    <div style={{ fontSize: '2rem', fontWeight: '800', color: '#0A2540', marginBottom: '0.25rem' }}>
                                        {service.reduce((sum, s) => sum + s.orders, 0).toLocaleString()}
                                    </div>
                                    <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '1rem' }}>Total Orders Served</div>
                                    <div style={{ marginBottom: '0.5rem' }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.75rem', color: '#64748b', marginBottom: '0.25rem' }}>
                                            <span>Avg Efficiency</span>
                                            <span style={{ fontWeight: '700', color: '#3b82f6' }}>
                                                {(service.reduce((sum, s) => sum + s.efficiency, 0) / service.length).toFixed(1)}%
                                            </span>
                                        </div>
                                        <div style={{ background: 'rgba(59, 130, 246, 0.1)', borderRadius: '9999px', height: '8px', overflow: 'hidden' }}>
                                            <div style={{
                                                background: '#3b82f6',
                                                height: '100%',
                                                width: `${(service.reduce((sum, s) => sum + s.efficiency, 0) / service.length)}%`,
                                                borderRadius: '9999px'
                                            }}></div>
                                        </div>
                                    </div>
                                    <div style={{ fontSize: '0.75rem', color: '#64748b' }}>
                                        {service.length} team members
                                    </div>
                                </div>

                                <div style={{
                                    padding: '1.5rem',
                                    background: '#FFFFFF',
                                    border: '2px solid rgba(245, 158, 11, 0.2)',
                                    borderLeft: '4px solid #f59e0b',
                                    borderRadius: '12px',
                                    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                                }}>
                                    <div style={{ fontSize: '2.5rem', marginBottom: '0.75rem' }}>üí∞</div>
                                    <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#f59e0b', marginBottom: '0.5rem' }}>Operations Team</h3>
                                    <div style={{ fontSize: '2rem', fontWeight: '800', color: '#0A2540', marginBottom: '0.25rem' }}>
                                        {operations.reduce((sum, s) => sum + s.orders, 0).toLocaleString()}
                                    </div>
                                    <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '1rem' }}>Transactions Processed</div>
                                    <div style={{ marginBottom: '0.5rem' }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.75rem', color: '#64748b', marginBottom: '0.25rem' }}>
                                            <span>Avg Efficiency</span>
                                            <span style={{ fontWeight: '700', color: '#f59e0b' }}>
                                                {(operations.reduce((sum, s) => sum + s.efficiency, 0) / operations.length).toFixed(1)}%
                                            </span>
                                        </div>
                                        <div style={{ background: 'rgba(245, 158, 11, 0.1)', borderRadius: '9999px', height: '8px', overflow: 'hidden' }}>
                                            <div style={{
                                                background: '#f59e0b',
                                                height: '100%',
                                                width: `${(operations.reduce((sum, s) => sum + s.efficiency, 0) / operations.length)}%`,
                                                borderRadius: '9999px'
                                            }}></div>
                                        </div>
                                    </div>
                                    <div style={{ fontSize: '0.75rem', color: '#64748b' }}>
                                        {operations.length} team member
                                    </div>
                                </div>
                            </div>
                        </ReportSection>

                        {/* AI-Powered Insights */}
                        <AIInsightsBox insights={staffAIInsights} />

                        <ReportFooter />
                    </div>
                </div>
            );
        };


        // üè¢ PREMIUM: Subscription & Branch Management System
        const SubscriptionBranchManagement = () => {
            const { selectedRestaurant } = useData();
            const [activeTab, setActiveTab] = React.useState('overview');
            const [showAddBranchModal, setShowAddBranchModal] = React.useState(false);
            const [showUpgradeModal, setShowUpgradeModal] = React.useState(false);

            // Mock subscription data (in production, this would come from backend)
            const subscriptionData = {
                accountId: 'ACC-2024-001',
                restaurantName: selectedRestaurant?.name || 'Demo Restaurant',
                plan: 'Standard',
                status: 'Active',
                billingCycle: 'Monthly',
                nextBillingDate: '2025-01-12',
                freeBranchLimit: 5,
                additionalBranchCost: 100, // SAR per month
                currentBranches: 4,
                paymentMethod: 'Credit Card ending in 4242',
                currency: 'SAR'
            };

            // Mock branches data
            const [branches, setBranches] = React.useState([
                { id: 1, name: 'Downtown Branch', address: 'King Fahd Road, Riyadh', status: 'Active', type: 'Main', revenue: 125000, monthlyFee: 0, staff: 15, orders: 2450 },
                { id: 2, name: 'Mall Branch', address: 'Riyadh Park Mall', status: 'Active', type: 'Standard', revenue: 98000, monthlyFee: 0, staff: 12, orders: 1890 },
                { id: 3, name: 'Airport Branch', address: 'King Khalid Airport', status: 'Active', type: 'Standard', revenue: 156000, monthlyFee: 0, staff: 18, orders: 3200 },
                { id: 4, name: 'University District', address: 'Al Malqa, Riyadh', status: 'Active', type: 'Standard', revenue: 87000, monthlyFee: 0, staff: 10, orders: 1650 }
            ]);

            // Calculate billing
            const totalBranches = branches.length;
            const paidBranches = Math.max(0, totalBranches - subscriptionData.freeBranchLimit);
            const monthlySubscriptionCost = paidBranches * subscriptionData.additionalBranchCost;
            const availableFreeBranches = Math.max(0, subscriptionData.freeBranchLimit - totalBranches);

            // Billing history
            const billingHistory = [
                { id: 1, date: '2024-12-12', description: 'Monthly Subscription (4 branches)', amount: 0, status: 'Paid', invoice: 'INV-2024-12' },
                { id: 2, date: '2024-11-12', description: 'Monthly Subscription (4 branches)', amount: 0, status: 'Paid', invoice: 'INV-2024-11' },
                { id: 3, date: '2024-10-12', description: 'Monthly Subscription (3 branches)', amount: 0, status: 'Paid', invoice: 'INV-2024-10' }
            ];

            // Overview Tab
            const OverviewTab = () => (
                <div style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem' }}>
                    {/* Subscription Status Card */}
                    <div style={{
                        padding: '2rem',
                        background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%)',
                        border: '2px solid rgba(139, 92, 246, 0.3)',
                        borderRadius: '16px',
                        boxShadow: '0 4px 12px rgba(139, 92, 246, 0.1)'
                    }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '1.5rem' }}>
                            <div>
                                <h2 style={{ fontSize: '1.5rem', fontWeight: '800', color: '#8b5cf6', marginBottom: '0.5rem' }}>
                                    {subscriptionData.plan} Plan
                                </h2>
                                <p style={{ fontSize: '0.875rem', color: '#64748b' }}>
                                    Account ID: {subscriptionData.accountId}
                                </p>
                            </div>
                            <div style={{
                                padding: '0.5rem 1rem',
                                background: subscriptionData.status === 'Active' ? 'rgba(16, 185, 129, 0.2)' : 'rgba(239, 68, 68, 0.2)',
                                color: subscriptionData.status === 'Active' ? '#10b981' : '#ef4444',
                                borderRadius: '12px',
                                fontSize: '0.875rem',
                                fontWeight: '700'
                            }}>
                                ‚óè {subscriptionData.status}
                            </div>
                        </div>

                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem', marginBottom: '1.5rem' }}>
                            <div style={{ padding: '1rem', background: 'rgba(255, 255, 255, 0.8)', borderRadius: '12px' }}>
                                <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.25rem' }}>Total Branches</div>
                                <div style={{ fontSize: '1.75rem', fontWeight: '800', color: '#0A2540' }}>{totalBranches}</div>
                            </div>
                            <div style={{ padding: '1rem', background: 'rgba(255, 255, 255, 0.8)', borderRadius: '12px' }}>
                                <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.25rem' }}>Free Branches Available</div>
                                <div style={{ fontSize: '1.75rem', fontWeight: '800', color: '#10b981' }}>{availableFreeBranches}/{subscriptionData.freeBranchLimit}</div>
                            </div>
                            <div style={{ padding: '1rem', background: 'rgba(255, 255, 255, 0.8)', borderRadius: '12px' }}>
                                <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.25rem' }}>Monthly Cost</div>
                                <div style={{ fontSize: '1.75rem', fontWeight: '800', color: monthlySubscriptionCost > 0 ? '#ef4444' : '#10b981' }}>
                                    {monthlySubscriptionCost} {subscriptionData.currency}
                                </div>
                            </div>
                            <div style={{ padding: '1rem', background: 'rgba(255, 255, 255, 0.8)', borderRadius: '12px' }}>
                                <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.25rem' }}>Next Billing</div>
                                <div style={{ fontSize: '1rem', fontWeight: '700', color: '#0A2540' }}>{subscriptionData.nextBillingDate}</div>
                            </div>
                        </div>

                        {availableFreeBranches > 0 ? (
                            <div style={{ padding: '1rem', background: 'rgba(16, 185, 129, 0.1)', borderRadius: '12px', border: '1px solid rgba(16, 185, 129, 0.3)' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', color: '#10b981', fontSize: '0.875rem', fontWeight: '600' }}>
                                    ‚úì You have {availableFreeBranches} free branch{availableFreeBranches > 1 ? 'es' : ''} available. Add more branches at no additional cost!
                                </div>
                            </div>
                        ) : (
                            <div style={{ padding: '1rem', background: 'rgba(245, 158, 11, 0.1)', borderRadius: '12px', border: '1px solid rgba(245, 158, 11, 0.3)' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', color: '#f59e0b', fontSize: '0.875rem', fontWeight: '600' }}>
                                    ‚ö†Ô∏è You've used all {subscriptionData.freeBranchLimit} free branches. Additional branches cost {subscriptionData.additionalBranchCost} {subscriptionData.currency}/month each.
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Pricing Calculator */}
                    <div style={{
                        padding: '2rem',
                        background: '#FFFFFF',
                        border: '2px solid rgba(10, 37, 64, 0.1)',
                        borderRadius: '16px',
                        boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                    }}>
                        <h3 style={{ fontSize: '1.25rem', fontWeight: '800', color: '#0A2540', marginBottom: '1rem' }}>
                            üí∞ Pricing Calculator
                        </h3>
                        <div style={{ padding: '1.5rem', background: 'rgba(255, 215, 0, 0.05)', borderRadius: '12px', border: '2px solid rgba(255, 215, 0, 0.2)' }}>
                            <div style={{ marginBottom: '1rem' }}>
                                <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '0.5rem' }}>Branches 1-{subscriptionData.freeBranchLimit}</div>
                                <div style={{ fontSize: '1.5rem', fontWeight: '800', color: '#10b981' }}>FREE</div>
                            </div>
                            <div style={{ marginBottom: '1rem', paddingTop: '1rem', borderTop: '1px solid rgba(10, 37, 64, 0.1)' }}>
                                <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '0.5rem' }}>Branches {subscriptionData.freeBranchLimit + 1}+</div>
                                <div style={{ fontSize: '1.5rem', fontWeight: '800', color: '#0A2540' }}>
                                    {subscriptionData.additionalBranchCost} {subscriptionData.currency}/month per branch
                                </div>
                            </div>
                            {paidBranches > 0 && (
                                <div style={{ paddingTop: '1rem', borderTop: '2px solid rgba(255, 215, 0, 0.3)' }}>
                                    <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '0.5rem' }}>Your Current Bill</div>
                                    <div style={{ fontSize: '2rem', fontWeight: '800', color: '#FFD700' }}>
                                        {monthlySubscriptionCost} {subscriptionData.currency}/month
                                    </div>
                                    <div style={{ fontSize: '0.75rem', color: '#64748b', marginTop: '0.25rem' }}>
                                        ({paidBranches} paid branch{paidBranches > 1 ? 'es' : ''} √ó {subscriptionData.additionalBranchCost} {subscriptionData.currency})
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Payment Method */}
                    <div style={{
                        padding: '2rem',
                        background: '#FFFFFF',
                        border: '2px solid rgba(10, 37, 64, 0.1)',
                        borderRadius: '16px',
                        boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                    }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                            <h3 style={{ fontSize: '1.25rem', fontWeight: '800', color: '#0A2540' }}>
                                üí≥ Payment Method
                            </h3>
                            <button style={{
                                padding: '0.5rem 1rem',
                                background: 'rgba(10, 37, 64, 0.05)',
                                color: '#0A2540',
                                border: '1px solid rgba(10, 37, 64, 0.2)',
                                borderRadius: '8px',
                                fontSize: '0.875rem',
                                fontWeight: '600',
                                cursor: 'pointer'
                            }}>
                                Update Payment
                            </button>
                        </div>
                        <div style={{ padding: '1rem', background: 'rgba(10, 37, 64, 0.02)', borderRadius: '8px', display: 'flex', alignItems: 'center', gap: '1rem' }}>
                            <div style={{ fontSize: '2rem' }}>üí≥</div>
                            <div style={{ flex: 1 }}>
                                <div style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#0A2540' }}>{subscriptionData.paymentMethod}</div>
                                <div style={{ fontSize: '0.75rem', color: '#64748b' }}>Next charge: {monthlySubscriptionCost} {subscriptionData.currency} on {subscriptionData.nextBillingDate}</div>
                            </div>
                            <div style={{
                                padding: '0.25rem 0.75rem',
                                background: 'rgba(16, 185, 129, 0.1)',
                                color: '#10b981',
                                borderRadius: '12px',
                                fontSize: '0.75rem',
                                fontWeight: '700'
                            }}>
                                Verified
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="p-6 space-y-6">
                    {/* Header */}
                    <div className="glass-effect rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%)', border: '2px solid rgba(139, 92, 246, 0.3)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '1rem' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                                <span style={{ fontSize: '3rem' }}>üè¢</span>
                                <div>
                                    <h1 style={{ fontSize: '2rem', fontWeight: '800', color: '#8b5cf6', marginBottom: '0.25rem' }}>
                                        Subscription & Branch Management
                                    </h1>
                                    <p style={{ fontSize: '0.875rem', color: '#94a3b8', margin: 0 }}>
                                        Manage branches, billing, and subscription settings
                                    </p>
                                </div>
                            </div>
                            <button
                                onClick={() => setShowAddBranchModal(true)}
                                style={{
                                    padding: '0.75rem 1.5rem',
                                    background: 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)',
                                    color: '#FFFFFF',
                                    border: 'none',
                                    borderRadius: '12px',
                                    fontSize: '0.9375rem',
                                    fontWeight: '700',
                                    cursor: 'pointer',
                                    boxShadow: '0 4px 12px rgba(139, 92, 246, 0.3)',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '0.5rem'
                                }}
                            >
                                <span style={{ fontSize: '1.25rem' }}>+</span>
                                Add New Branch
                            </button>
                        </div>

                        {/* Tab Navigation */}
                        <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
                            {[
                                { id: 'overview', label: 'Subscription Overview', icon: 'üìä' },
                                { id: 'branches', label: 'Branch Management', icon: 'üè¢' },
                                { id: 'billing', label: 'Billing History', icon: 'üí∞' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    style={{
                                        padding: '0.75rem 1.5rem',
                                        borderRadius: '0.75rem',
                                        background: activeTab === tab.id ? 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)' : 'rgba(255, 255, 255, 0.05)',
                                        color: activeTab === tab.id ? '#FFFFFF' : '#94a3b8',
                                        border: activeTab === tab.id ? '2px solid #8b5cf6' : '2px solid transparent',
                                        fontWeight: '600',
                                        fontSize: '0.875rem',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.5rem'
                                    }}
                                >
                                    <span>{tab.icon}</span>
                                    <span>{tab.label}</span>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Content Area */}
                    {activeTab === 'overview' && <OverviewTab />}
                    {activeTab === 'branches' && (
                        <BranchManagementTab
                            branches={branches}
                            setBranches={setBranches}
                            subscriptionData={subscriptionData}
                            setShowAddBranchModal={setShowAddBranchModal}
                        />
                    )}
                    {activeTab === 'billing' && <BillingHistoryTab billingHistory={billingHistory} subscriptionData={subscriptionData} />}
                </div>
            );
        };

        // Branch Management Tab Component
        const BranchManagementTab = ({ branches, setBranches, subscriptionData, setShowAddBranchModal }) => {
            const totalRevenue = branches.reduce((sum, b) => sum + b.revenue, 0);
            const totalStaff = branches.reduce((sum, b) => sum + b.staff, 0);
            const totalOrders = branches.reduce((sum, b) => sum + b.orders, 0);

            return (
                <div style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem' }}>
                    {/* Branch Statistics */}
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1.5rem' }}>
                        <div style={{
                            padding: '1.5rem',
                            background: '#FFFFFF',
                            border: '2px solid rgba(16, 185, 129, 0.2)',
                            borderLeft: '4px solid #10b981',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                        }}>
                            <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '0.5rem' }}>Total Branches</div>
                            <div style={{ fontSize: '2.5rem', fontWeight: '800', color: '#0A2540' }}>{branches.length}</div>
                        </div>
                        <div style={{
                            padding: '1.5rem',
                            background: '#FFFFFF',
                            border: '2px solid rgba(59, 130, 246, 0.2)',
                            borderLeft: '4px solid #3b82f6',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                        }}>
                            <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '0.5rem' }}>Combined Revenue</div>
                            <div style={{ fontSize: '2.5rem', fontWeight: '800', color: '#0A2540' }}>{utils.formatCurrency(totalRevenue)}</div>
                        </div>
                        <div style={{
                            padding: '1.5rem',
                            background: '#FFFFFF',
                            border: '2px solid rgba(245, 158, 11, 0.2)',
                            borderLeft: '4px solid #f59e0b',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                        }}>
                            <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '0.5rem' }}>Total Staff</div>
                            <div style={{ fontSize: '2.5rem', fontWeight: '800', color: '#0A2540' }}>{totalStaff}</div>
                        </div>
                        <div style={{
                            padding: '1.5rem',
                            background: '#FFFFFF',
                            border: '2px solid rgba(139, 92, 246, 0.2)',
                            borderLeft: '4px solid #8b5cf6',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)'
                        }}>
                            <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '0.5rem' }}>Total Orders</div>
                            <div style={{ fontSize: '2.5rem', fontWeight: '800', color: '#0A2540' }}>{totalOrders.toLocaleString()}</div>
                        </div>
                    </div>

                    {/* Branch List */}
                    <div style={{
                        background: '#FFFFFF',
                        border: '2px solid rgba(10, 37, 64, 0.1)',
                        borderRadius: '16px',
                        boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)',
                        overflow: 'hidden'
                    }}>
                        <div style={{ padding: '1.5rem', borderBottom: '2px solid rgba(10, 37, 64, 0.1)' }}>
                            <h3 style={{ fontSize: '1.25rem', fontWeight: '800', color: '#0A2540' }}>All Branches</h3>
                        </div>
                        <div style={{ overflowX: 'auto' }}>
                            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                                <thead>
                                    <tr style={{ background: 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%)', borderBottom: '3px solid #FFD700' }}>
                                        <th style={{ textAlign: 'left', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Branch</th>
                                        <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Type</th>
                                        <th style={{ textAlign: 'right', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Revenue</th>
                                        <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Staff</th>
                                        <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Orders</th>
                                        <th style={{ textAlign: 'right', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Monthly Fee</th>
                                        <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Status</th>
                                        <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {branches.map((branch, index) => {
                                        const isFree = index < subscriptionData.freeBranchLimit;
                                        return (
                                            <tr key={branch.id} style={{ borderBottom: '1px solid rgba(10, 37, 64, 0.1)' }}>
                                                <td style={{ padding: '1rem' }}>
                                                    <div>
                                                        <div style={{ fontSize: '0.9375rem', fontWeight: '700', color: '#0A2540', marginBottom: '0.25rem' }}>
                                                            {branch.name}
                                                        </div>
                                                        <div style={{ fontSize: '0.75rem', color: '#64748b' }}>{branch.address}</div>
                                                    </div>
                                                </td>
                                                <td style={{ padding: '1rem', textAlign: 'center' }}>
                                                    <span style={{
                                                        padding: '0.375rem 0.75rem',
                                                        borderRadius: '12px',
                                                        fontSize: '0.75rem',
                                                        fontWeight: '600',
                                                        background: branch.type === 'Main' ? 'rgba(255, 215, 0, 0.2)' : 'rgba(59, 130, 246, 0.1)',
                                                        color: branch.type === 'Main' ? '#FFD700' : '#3b82f6'
                                                    }}>
                                                        {branch.type}
                                                    </span>
                                                </td>
                                                <td style={{ padding: '1rem', textAlign: 'right', fontSize: '0.9375rem', fontWeight: '700', color: '#0A2540' }}>
                                                    {utils.formatCurrency(branch.revenue)}
                                                </td>
                                                <td style={{ padding: '1rem', textAlign: 'center', fontSize: '0.9375rem', fontWeight: '600', color: '#0A2540' }}>
                                                    {branch.staff}
                                                </td>
                                                <td style={{ padding: '1rem', textAlign: 'center', fontSize: '0.9375rem', fontWeight: '600', color: '#0A2540' }}>
                                                    {branch.orders.toLocaleString()}
                                                </td>
                                                <td style={{ padding: '1rem', textAlign: 'right' }}>
                                                    <span style={{
                                                        fontSize: '0.9375rem',
                                                        fontWeight: '700',
                                                        color: isFree ? '#10b981' : '#ef4444'
                                                    }}>
                                                        {isFree ? 'FREE' : `${subscriptionData.additionalBranchCost} ${subscriptionData.currency}`}
                                                    </span>
                                                </td>
                                                <td style={{ padding: '1rem', textAlign: 'center' }}>
                                                    <span style={{
                                                        padding: '0.375rem 0.75rem',
                                                        borderRadius: '12px',
                                                        fontSize: '0.75rem',
                                                        fontWeight: '700',
                                                        background: branch.status === 'Active' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                                                        color: branch.status === 'Active' ? '#10b981' : '#ef4444'
                                                    }}>
                                                        ‚óè {branch.status}
                                                    </span>
                                                </td>
                                                <td style={{ padding: '1rem', textAlign: 'center' }}>
                                                    <button style={{
                                                        padding: '0.5rem 1rem',
                                                        background: 'rgba(10, 37, 64, 0.05)',
                                                        color: '#0A2540',
                                                        border: '1px solid rgba(10, 37, 64, 0.2)',
                                                        borderRadius: '8px',
                                                        fontSize: '0.75rem',
                                                        fontWeight: '600',
                                                        cursor: 'pointer'
                                                    }}>
                                                        Manage
                                                    </button>
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        // Billing History Tab Component
        const BillingHistoryTab = ({ billingHistory, subscriptionData }) => (
            <div style={{
                background: '#FFFFFF',
                border: '2px solid rgba(10, 37, 64, 0.1)',
                borderRadius: '16px',
                boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)',
                overflow: 'hidden'
            }}>
                <div style={{ padding: '1.5rem', borderBottom: '2px solid rgba(10, 37, 64, 0.1)' }}>
                    <h3 style={{ fontSize: '1.25rem', fontWeight: '800', color: '#0A2540' }}>Billing History</h3>
                </div>
                <div style={{ overflowX: 'auto' }}>
                    <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                        <thead>
                            <tr style={{ background: 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%)', borderBottom: '3px solid #FFD700' }}>
                                <th style={{ textAlign: 'left', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Date</th>
                                <th style={{ textAlign: 'left', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Description</th>
                                <th style={{ textAlign: 'right', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Amount</th>
                                <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Status</th>
                                <th style={{ textAlign: 'center', color: '#FFD700', padding: '1rem', fontWeight: '700', fontSize: '0.875rem' }}>Invoice</th>
                            </tr>
                        </thead>
                        <tbody>
                            {billingHistory.map((bill) => (
                                <tr key={bill.id} style={{ borderBottom: '1px solid rgba(10, 37, 64, 0.1)' }}>
                                    <td style={{ padding: '1rem', fontSize: '0.9375rem', color: '#0A2540', fontWeight: '600' }}>
                                        {bill.date}
                                    </td>
                                    <td style={{ padding: '1rem', fontSize: '0.9375rem', color: '#64748b' }}>
                                        {bill.description}
                                    </td>
                                    <td style={{ padding: '1rem', textAlign: 'right', fontSize: '0.9375rem', fontWeight: '700', color: bill.amount === 0 ? '#10b981' : '#0A2540' }}>
                                        {bill.amount === 0 ? 'FREE' : `${bill.amount} ${subscriptionData.currency}`}
                                    </td>
                                    <td style={{ padding: '1rem', textAlign: 'center' }}>
                                        <span style={{
                                            padding: '0.375rem 0.75rem',
                                            borderRadius: '12px',
                                            fontSize: '0.75rem',
                                            fontWeight: '700',
                                            background: 'rgba(16, 185, 129, 0.1)',
                                            color: '#10b981'
                                        }}>
                                            ‚úì {bill.status}
                                        </span>
                                    </td>
                                    <td style={{ padding: '1rem', textAlign: 'center' }}>
                                        <button style={{
                                            padding: '0.5rem 1rem',
                                            background: 'rgba(10, 37, 64, 0.05)',
                                            color: '#0A2540',
                                            border: '1px solid rgba(10, 37, 64, 0.2)',
                                            borderRadius: '8px',
                                            fontSize: '0.75rem',
                                            fontWeight: '600',
                                            cursor: 'pointer'
                                        }}>
                                            üìÑ {bill.invoice}
                                        </button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        // ü§ñ LEGENDARY: AI Recommendations Engine
        const AIRecommendations = () => {
            const { selectedRestaurant, dailyData, monthlyData } = useData();

            if (!selectedRestaurant) {
                return (
                    <div className="text-center py-12">
                        <div className="text-4xl mb-4">ü§ñ</div>
                        <p className="text-secondary">Please select a restaurant to view AI recommendations</p>
                    </div>
                );
            }

            const recommendations = [
                {
                    id: 1, category: 'Revenue Optimization', priority: 'high', icon: 'üí∞',
                    title: 'Increase Classic Burger Price by 8%',
                    description: 'Based on demand elasticity analysis, your Classic Burger has low price sensitivity. Increasing price from $25 to $27 could generate an additional $3,120/month with minimal impact on sales volume.',
                    impact: '+$3,120/month', confidence: 94, action: 'Update Pricing', color: 'green'
                },
                {
                    id: 2, category: 'Cost Reduction', priority: 'high', icon: 'üìâ',
                    title: 'Switch French Fries Supplier',
                    description: 'Alternative supplier offers 15% cost reduction with same quality standards. Current cost: $3.50/serving, Potential: $2.98/serving. With 1,450 monthly orders, this saves $754/month.',
                    impact: '+$754/month', confidence: 89, action: 'Review Supplier', color: 'green'
                },
                {
                    id: 3, category: 'Menu Engineering', priority: 'medium', icon: 'üìä',
                    title: 'Promote Veggie Burger Aggressively',
                    description: 'Veggie Burger shows 60% profit margin with +35% growth trend but only 7% popularity. A 2-week promotional campaign could increase orders by 40%, adding $1,330 profit/month.',
                    impact: '+$1,330/month', confidence: 82, action: 'Launch Campaign', color: 'blue'
                },
                {
                    id: 4, category: 'Operational Efficiency', priority: 'high', icon: '‚ö°',
                    title: 'Add Kitchen Staff During Peak Hours',
                    description: 'Analysis shows 18% longer prep times during 7-9 PM rush. Adding one part-time cook ($800/month) could increase capacity by 25 orders/day, generating $1,875 additional revenue.',
                    impact: '+$1,075/month', confidence: 91, action: 'Schedule Staff', color: 'green'
                },
                {
                    id: 5, category: 'Customer Retention', priority: 'medium', icon: 'üéÅ',
                    title: 'Launch Loyalty Program',
                    description: 'Repeat customer rate is 45%, below industry average of 55%. Implementing a points-based loyalty program could increase repeat visits by 15%, worth $2,450/month in additional orders.',
                    impact: '+$2,450/month', confidence: 78, action: 'Design Program', color: 'blue'
                },
                {
                    id: 6, category: 'Waste Reduction', priority: 'medium', icon: '‚ôªÔ∏è',
                    title: 'Implement Dynamic Inventory System',
                    description: 'Food waste accounts for 8% of costs. AI-powered inventory management could reduce waste to 4%, saving $1,920/month while maintaining freshness standards.',
                    impact: '+$1,920/month', confidence: 85, action: 'Install System', color: 'blue'
                },
                {
                    id: 7, category: 'Menu Optimization', priority: 'low', icon: 'üóëÔ∏è',
                    title: 'Remove Seafood Pasta from Menu',
                    description: 'Seafood Pasta shows low popularity (6%), declining trend (-12%), and requires specialized ingredients. Removing it could reduce inventory complexity and free up kitchen capacity.',
                    impact: 'Efficiency Gain', confidence: 76, action: 'Plan Removal', color: 'yellow'
                },
                {
                    id: 8, category: 'Marketing', priority: 'medium', icon: 'üì±',
                    title: 'Increase Social Media Ad Spend',
                    description: 'Current ROI on social ads is 4.2x. Increasing monthly budget from $500 to $1,200 could generate $2,940 additional orders based on current conversion rates.',
                    impact: '+$2,940/month', confidence: 88, action: 'Boost Budget', color: 'blue'
                }
            ];

            const totalImpact = recommendations
                .filter(r => r.impact.startsWith('+$'))
                .reduce((sum, r) => sum + parseInt(r.impact.replace(/[^\d]/g, '')), 0);

            return (
                <div className="p-6 space-y-6">
                    <div className="flex items-center justify-between">
                        <div>
                            <h1 className="text-2xl font-bold text-enhanced">ü§ñ AI Recommendations Engine</h1>
                            <p className="text-secondary">Data-driven insights powered by machine learning</p>
                        </div>
                    </div>

                    {/* Impact Summary */}
                    <div className="glass-effect rounded-xl p-6 bg-gradient-to-r from-purple-500/10 to-pink-500/10 border-2 border-purple-500/30">
                        <div className="flex items-center justify-between">
                            <div>
                                <div className="text-secondary mb-2">Total Potential Monthly Impact</div>
                                <div className="text-4xl font-bold text-enhanced mb-2">+{utils.formatCurrency(totalImpact)}</div>
                                <div className="text-purple-400">By implementing all {recommendations.length} recommendations</div>
                            </div>
                            <div className="text-6xl">üöÄ</div>
                        </div>
                    </div>

                    {/* Recommendation Cards */}
                    <div className="space-y-4">
                        {recommendations.map((rec) => (
                            <div
                                key={rec.id}
                                className={`glass-effect rounded-xl p-6 border-l-4 hover-lift ${
                                    rec.priority === 'high' ? 'border-red-500' :
                                    rec.priority === 'medium' ? 'border-yellow-500' :
                                    'border-blue-500'
                                }`}
                            >
                                <div className="flex items-start justify-between">
                                    <div className="flex items-start space-x-4 flex-1">
                                        <div className="text-4xl">{rec.icon}</div>
                                        <div className="flex-1">
                                            <div className="flex items-center space-x-3 mb-2">
                                                <h3 className="text-enhanced font-semibold text-lg">{rec.title}</h3>
                                                <span className={`px-2 py-1 rounded text-xs font-medium ${
                                                    rec.priority === 'high' ? 'bg-red-500/20 text-red-400' :
                                                    rec.priority === 'medium' ? 'bg-yellow-500/20 text-yellow-400' :
                                                    'bg-blue-500/20 text-blue-400'
                                                }`}>
                                                    {rec.priority.toUpperCase()} PRIORITY
                                                </span>
                                                <span className="px-2 py-1 rounded text-xs font-medium bg-purple-500/20 text-purple-400">
                                                    {rec.category}
                                                </span>
                                            </div>
                                            <p className="text-secondary mb-3">{rec.description}</p>
                                            <div className="flex items-center space-x-6">
                                                <div>
                                                    <div className="text-secondary text-xs">Expected Impact</div>
                                                    <div className="text-green-400 font-bold text-lg">{rec.impact}</div>
                                                </div>
                                                <div>
                                                    <div className="text-secondary text-xs">Confidence Level</div>
                                                    <div className="flex items-center space-x-2">
                                                        <div className="w-24 bg-white/5 rounded-full h-2">
                                                            <div
                                                                className="bg-gradient-primary h-full rounded-full"
                                                                style={{ width: `${rec.confidence}%` }}
                                                            ></div>
                                                        </div>
                                                        <div className="text-enhanced font-semibold">{rec.confidence}%</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button className="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors font-medium whitespace-nowrap ml-4">
                                        {rec.action}
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // üíö LEGENDARY: Financial Health Dashboard
        const FinancialHealthDashboard = () => {
            const { selectedRestaurant, getFinancialOverview } = useData();

            if (!selectedRestaurant) {
                return (
                    <div className="text-center py-12">
                        <div className="text-4xl mb-4">üíö</div>
                        <p className="text-secondary">Please select a restaurant to view financial health</p>
                    </div>
                );
            }

            const financialData = getFinancialOverview(selectedRestaurant.id);

            // Calculate Health Score (0-100)
            const calculateHealthScore = () => {
                let score = 0;

                // Revenue Growth (25 points)
                const revenueGrowth = 12.5;
                if (revenueGrowth >= 15) score += 25;
                else if (revenueGrowth >= 10) score += 20;
                else if (revenueGrowth >= 5) score += 15;
                else if (revenueGrowth >= 0) score += 10;

                // Profit Margin (25 points)
                const profitMargin = financialData?.profitMargin || 0;
                if (profitMargin >= 20) score += 25;
                else if (profitMargin >= 15) score += 20;
                else if (profitMargin >= 10) score += 15;
                else if (profitMargin >= 5) score += 10;

                // Cash Flow (20 points)
                const cashFlow = 18500;
                if (cashFlow >= 20000) score += 20;
                else if (cashFlow >= 15000) score += 15;
                else if (cashFlow >= 10000) score += 10;
                else if (cashFlow >= 5000) score += 5;

                // Debt to Revenue Ratio (15 points)
                const debtRatio = 0.15;
                if (debtRatio <= 0.1) score += 15;
                else if (debtRatio <= 0.2) score += 12;
                else if (debtRatio <= 0.3) score += 8;
                else if (debtRatio <= 0.4) score += 5;

                // Operational Efficiency (15 points)
                const efficiency = 92;
                if (efficiency >= 95) score += 15;
                else if (efficiency >= 90) score += 12;
                else if (efficiency >= 85) score += 8;
                else if (efficiency >= 80) score += 5;

                return Math.min(100, Math.round(score));
            };

            const healthScore = calculateHealthScore();
            const healthGrade = healthScore >= 90 ? 'Excellent' :
                               healthScore >= 80 ? 'Very Good' :
                               healthScore >= 70 ? 'Good' :
                               healthScore >= 60 ? 'Fair' : 'Needs Improvement';
            const healthColor = healthScore >= 80 ? 'green' : healthScore >= 60 ? 'yellow' : 'red';

            return (
                <div className="p-6 space-y-6">
                    <h1 className="text-2xl font-bold text-enhanced">üíö Financial Health Dashboard</h1>

                    {/* Health Score */}
                    <div className="glass-effect rounded-2xl p-8 bg-gradient-to-br from-green-500/10 to-blue-500/10 border-2 border-green-500/30">
                        <div className="text-center">
                            <div className="text-secondary mb-3">Overall Financial Health Score</div>
                            <div className="relative inline-block">
                                <svg className="transform -rotate-90" width="200" height="200">
                                    <circle
                                        cx="100"
                                        cy="100"
                                        r="90"
                                        fill="none"
                                        stroke="rgba(255,255,255,0.1)"
                                        strokeWidth="12"
                                    />
                                    <circle
                                        cx="100"
                                        cy="100"
                                        r="90"
                                        fill="none"
                                        stroke={healthColor === 'green' ? '#22c55e' : healthColor === 'yellow' ? '#eab308' : '#ef4444'}
                                        strokeWidth="12"
                                        strokeDasharray={`${(healthScore / 100) * 565} 565`}
                                        strokeLinecap="round"
                                    />
                                </svg>
                                <div className="absolute inset-0 flex items-center justify-center flex-col">
                                    <div className="text-5xl font-bold text-enhanced">{healthScore}</div>
                                    <div className="text-secondary text-sm">out of 100</div>
                                </div>
                            </div>
                            <div className={`mt-4 text-2xl font-bold ${
                                healthColor === 'green' ? 'text-green-400' :
                                healthColor === 'yellow' ? 'text-yellow-400' :
                                'text-red-400'
                            }`}>
                                {healthGrade}
                            </div>
                        </div>
                    </div>

                    {/* Health Metrics Breakdown */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div className="glass-effect rounded-xl p-6">
                            <div className="flex items-center justify-between mb-3">
                                <div className="text-secondary">Revenue Growth</div>
                                <div className="text-2xl">üìà</div>
                            </div>
                            <div className="text-2xl font-bold text-green-400 mb-2">+12.5%</div>
                            <div className="flex items-center space-x-2">
                                <div className="flex-1 bg-white/5 rounded-full h-2">
                                    <div className="bg-gradient-success h-full rounded-full" style={{ width: '83%' }}></div>
                                </div>
                                <div className="text-green-400 text-sm">83/100</div>
                            </div>
                        </div>

                        <div className="glass-effect rounded-xl p-6">
                            <div className="flex items-center justify-between mb-3">
                                <div className="text-secondary">Profit Margin</div>
                                <div className="text-2xl">üí∞</div>
                            </div>
                            <div className="text-2xl font-bold text-green-400 mb-2">{financialData?.profitMargin.toFixed(1)}%</div>
                            <div className="flex items-center space-x-2">
                                <div className="flex-1 bg-white/5 rounded-full h-2">
                                    <div className="bg-gradient-success h-full rounded-full" style={{ width: '75%' }}></div>
                                </div>
                                <div className="text-green-400 text-sm">75/100</div>
                            </div>
                        </div>

                        <div className="glass-effect rounded-xl p-6">
                            <div className="flex items-center justify-between mb-3">
                                <div className="text-secondary">Cash Flow</div>
                                <div className="text-2xl">üíµ</div>
                            </div>
                            <div className="text-2xl font-bold text-green-400 mb-2">{utils.formatCurrency(18500)}</div>
                            <div className="flex items-center space-x-2">
                                <div className="flex-1 bg-white/5 rounded-full h-2">
                                    <div className="bg-gradient-success h-full rounded-full" style={{ width: '93%' }}></div>
                                </div>
                                <div className="text-green-400 text-sm">93/100</div>
                            </div>
                        </div>

                        <div className="glass-effect rounded-xl p-6">
                            <div className="flex items-center justify-between mb-3">
                                <div className="text-secondary">Debt Ratio</div>
                                <div className="text-2xl">üìä</div>
                            </div>
                            <div className="text-2xl font-bold text-green-400 mb-2">15%</div>
                            <div className="flex items-center space-x-2">
                                <div className="flex-1 bg-white/5 rounded-full h-2">
                                    <div className="bg-gradient-success h-full rounded-full" style={{ width: '85%' }}></div>
                                </div>
                                <div className="text-green-400 text-sm">85/100</div>
                            </div>
                        </div>

                        <div className="glass-effect rounded-xl p-6">
                            <div className="flex items-center justify-between mb-3">
                                <div className="text-secondary">Operational Efficiency</div>
                                <div className="text-2xl">‚ö°</div>
                            </div>
                            <div className="text-2xl font-bold text-green-400 mb-2">92%</div>
                            <div className="flex items-center space-x-2">
                                <div className="flex-1 bg-white/5 rounded-full h-2">
                                    <div className="bg-gradient-success h-full rounded-full" style={{ width: '92%' }}></div>
                                </div>
                                <div className="text-green-400 text-sm">92/100</div>
                            </div>
                        </div>

                        <div className="glass-effect rounded-xl p-6">
                            <div className="flex items-center justify-between mb-3">
                                <div className="text-secondary">Customer Retention</div>
                                <div className="text-2xl">üéØ</div>
                            </div>
                            <div className="text-2xl font-bold text-green-400 mb-2">45%</div>
                            <div className="flex items-center space-x-2">
                                <div className="flex-1 bg-white/5 rounded-full h-2">
                                    <div className="bg-gradient-warning h-full rounded-full" style={{ width: '68%' }}></div>
                                </div>
                                <div className="text-yellow-400 text-sm">68/100</div>
                            </div>
                        </div>
                    </div>

                    {/* Financial Health Insights */}
                    <div className="glass-effect rounded-xl p-6">
                        <h3 className="text-lg font-semibold text-enhanced mb-4">üí° Key Insights & Recommendations</h3>
                        <div className="space-y-3">
                            <div className="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
                                <div className="flex items-start space-x-3">
                                    <div className="text-2xl">‚úÖ</div>
                                    <div>
                                        <div className="text-enhanced font-semibold mb-1">Strong Cash Position</div>
                                        <div className="text-secondary text-sm">Your monthly cash flow of $18,500 provides excellent financial flexibility. Consider investing in growth opportunities.</div>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4">
                                <div className="flex items-start space-x-3">
                                    <div className="text-2xl">‚ö†Ô∏è</div>
                                    <div>
                                        <div className="text-enhanced font-semibold mb-1">Customer Retention Below Target</div>
                                        <div className="text-secondary text-sm">Current retention rate of 45% is below industry average of 55%. Implementing a loyalty program could boost this by 15%.</div>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
                                <div className="flex items-start space-x-3">
                                    <div className="text-2xl">üìà</div>
                                    <div>
                                        <div className="text-enhanced font-semibold mb-1">Healthy Growth Trajectory</div>
                                        <div className="text-secondary text-sm">12.5% revenue growth puts you in the top 30% of restaurants. Maintain this momentum with strategic menu optimization.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // üëî LEGENDARY: Staff Manager Module (Full CRUD)
        const StaffManager = () => {
            const { selectedRestaurant, restaurants, setRestaurants } = useData();
            const [showForm, setShowForm] = useState(false);
            const [editingStaff, setEditingStaff] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterRole, setFilterRole] = useState('all');
            const [filterBranch, setFilterBranch] = useState('all');

            const [formData, setFormData] = useState({
                name: '',
                role: 'server',
                branch: '',
                shift: 'morning',
                phone: '',
                email: '',
                hireDate: new Date().toISOString().split('T')[0],
                salary: 0,
                status: 'active',
                avatar: 'üë§',
                performance: {
                    ordersProcessed: 0,
                    avgRating: 5.0,
                    efficiency: 100,
                    attendance: 100,
                    tips: 0,
                    hoursWorked: 0,
                    complaints: 0
                }
            });

            if (!selectedRestaurant) {
                return (
                    <div className="text-center py-12">
                        <div className="text-4xl mb-4">üëî</div>
                        <p className="text-secondary">Please select a restaurant to manage staff</p>
                    </div>
                );
            }

            const staff = selectedRestaurant.staff || [];
            const branches = selectedRestaurant.branches || [];

            // Filter staff
            const filteredStaff = staff.filter(member => {
                const matchesSearch = member.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    member.email?.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesRole = filterRole === 'all' || member.role === filterRole;
                const matchesBranch = filterBranch === 'all' || member.branch === filterBranch;
                return matchesSearch && matchesRole && matchesBranch;
            });

            // Reset form
            const resetForm = () => {
                setFormData({
                    name: '',
                    role: 'server',
                    branch: branches[0]?.name || '',
                    shift: 'morning',
                    phone: '',
                    email: '',
                    hireDate: new Date().toISOString().split('T')[0],
                    salary: 0,
                    status: 'active',
                    avatar: 'üë§',
                    performance: {
                        ordersProcessed: 0,
                        avgRating: 5.0,
                        efficiency: 100,
                        attendance: 100,
                        tips: 0,
                        hoursWorked: 0,
                        complaints: 0
                    }
                });
                setEditingStaff(null);
                setShowForm(false);
            };

            // Add staff
            const handleAddStaff = () => {
                if (!formData.name || !formData.branch) {
                    alert('Please fill in all required fields');
                    return;
                }

                const newStaff = {
                    ...formData,
                    id: 'staff_' + Date.now(),
                    createdAt: new Date().toISOString()
                };

                setRestaurants(prev => prev.map(r => {
                    if (r.id === selectedRestaurant.id) {
                        return { ...r, staff: [...(r.staff || []), newStaff] };
                    }
                    return r;
                }));

                utils.showNotification(`Staff member "${newStaff.name}" added successfully!`, 'success');
                resetForm();
            };

            // Edit staff
            const handleEditClick = (member) => {
                setEditingStaff(member);
                setFormData(member);
                setShowForm(true);
            };

            const handleUpdateStaff = () => {
                if (!formData.name || !formData.branch) {
                    alert('Please fill in all required fields');
                    return;
                }

                setRestaurants(prev => prev.map(r => {
                    if (r.id === selectedRestaurant.id) {
                        return {
                            ...r,
                            staff: r.staff.map(m => m.id === editingStaff.id ? { ...formData, id: editingStaff.id } : m)
                        };
                    }
                    return r;
                }));

                utils.showNotification(`Staff member "${formData.name}" updated successfully!`, 'success');
                resetForm();
            };

            // Delete staff
            const handleDeleteStaff = (member) => {
                if (confirm(`Are you sure you want to remove ${member.name} from your staff?`)) {
                    setRestaurants(prev => prev.map(r => {
                        if (r.id === selectedRestaurant.id) {
                            return { ...r, staff: r.staff.filter(m => m.id !== member.id) };
                        }
                        return r;
                    }));
                    utils.showNotification(`Staff member "${member.name}" removed successfully!`, 'success');
                }
            };

            // Toggle status
            const handleToggleStatus = (member) => {
                setRestaurants(prev => prev.map(r => {
                    if (r.id === selectedRestaurant.id) {
                        return {
                            ...r,
                            staff: r.staff.map(m =>
                                m.id === member.id ? { ...m, status: m.status === 'active' ? 'inactive' : 'active' } : m
                            )
                        };
                    }
                    return r;
                }));
                utils.showNotification(`${member.name} status updated!`, 'success');
            };

            // Role avatar mapping
            const getRoleAvatar = (role) => {
                const avatars = {
                    'chef': 'üë®‚Äçüç≥',
                    'sous-chef': 'üë©‚Äçüç≥',
                    'line-cook': 'üßë‚Äçüç≥',
                    'server': 'üë®‚Äçüíº',
                    'cashier': 'üë©‚Äçüíº',
                    'manager': 'üßë‚Äçüíº',
                    'delivery': 'üö¥',
                    'cleaner': 'üßπ'
                };
                return avatars[role] || 'üë§';
            };

            // Statistics
            const stats = {
                total: staff.length,
                active: staff.filter(m => m.status === 'active').length,
                inactive: staff.filter(m => m.status === 'inactive').length,
                avgEfficiency: staff.reduce((sum, m) => sum + (m.performance?.efficiency || 0), 0) / staff.length || 0
            };

            return (
                <div className="p-6 space-y-6">
                    <div className="flex items-center justify-between">
                        <div>
                            <h1 className="text-2xl font-bold text-brand-gold">üëî Staff Manager</h1>
                            <p className="text-secondary">Manage your team with full CRUD operations and activity tracking</p>
                        </div>
                        <button
                            onClick={() => setShowForm(true)}
                            className="bg-gradient-primary text-white px-6 py-3 rounded-lg hover:opacity-90 transition-opacity font-medium flex items-center space-x-2"
                        >
                            <span>‚ûï</span>
                            <span>Add Staff Member</span>
                        </button>
                    </div>

                    {/* Statistics */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div className="glass-effect rounded-xl p-6 text-center">
                            <div className="text-4xl mb-2">üë•</div>
                            <div className="text-2xl font-bold text-brand-gold">{stats.total}</div>
                            <div className="text-secondary text-sm">Total Staff</div>
                        </div>
                        <div className="glass-effect rounded-xl p-6 text-center">
                            <div className="text-4xl mb-2">‚úÖ</div>
                            <div className="text-2xl font-bold text-green-400">{stats.active}</div>
                            <div className="text-secondary text-sm">Active</div>
                        </div>
                        <div className="glass-effect rounded-xl p-6 text-center">
                            <div className="text-4xl mb-2">‚è∏Ô∏è</div>
                            <div className="text-2xl font-bold text-gray-400">{stats.inactive}</div>
                            <div className="text-secondary text-sm">Inactive</div>
                        </div>
                        <div className="glass-effect rounded-xl p-6 text-center">
                            <div className="text-4xl mb-2">‚ö°</div>
                            <div className="text-2xl font-bold text-brand-gold">{stats.avgEfficiency.toFixed(0)}%</div>
                            <div className="text-secondary text-sm">Avg Efficiency</div>
                        </div>
                    </div>

                    {/* Filters */}
                    <div className="glass-effect rounded-xl p-6">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label className="text-secondary text-sm mb-2 block">Search</label>
                                <input
                                    type="text"
                                    placeholder="Search by name or email..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-enhanced focus:outline-none focus:border-brand-gold"
                                />
                            </div>
                            <div>
                                <label className="text-secondary text-sm mb-2 block">Filter by Role</label>
                                <select
                                    value={filterRole}
                                    onChange={(e) => setFilterRole(e.target.value)}
                                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-enhanced focus:outline-none focus:border-brand-gold"
                                >
                                    <option value="all">All Roles</option>
                                    <option value="chef">Chef</option>
                                    <option value="sous-chef">Sous Chef</option>
                                    <option value="line-cook">Line Cook</option>
                                    <option value="server">Server</option>
                                    <option value="cashier">Cashier</option>
                                    <option value="manager">Manager</option>
                                    <option value="delivery">Delivery</option>
                                    <option value="cleaner">Cleaner</option>
                                </select>
                            </div>
                            <div>
                                <label className="text-secondary text-sm mb-2 block">Filter by Branch</label>
                                <select
                                    value={filterBranch}
                                    onChange={(e) => setFilterBranch(e.target.value)}
                                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-enhanced focus:outline-none focus:border-brand-gold"
                                >
                                    <option value="all">All Branches</option>
                                    {branches.map(branch => (
                                        <option key={branch.id} value={branch.name}>{branch.name}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                    </div>

                    {/* Staff Grid */}
                    {filteredStaff.length === 0 ? (
                        <div className="glass-effect rounded-xl p-12 text-center">
                            <div className="text-6xl mb-4">üëî</div>
                            <h3 className="text-xl font-semibold text-enhanced mb-2">No Staff Members Found</h3>
                            <p className="text-secondary mb-6">Start by adding your first staff member</p>
                            <button
                                onClick={() => setShowForm(true)}
                                className="bg-gradient-primary text-white px-6 py-3 rounded-lg hover:opacity-90 transition-opacity font-medium"
                            >
                                Add Staff Member
                            </button>
                        </div>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {filteredStaff.map(member => (
                                <div key={member.id} className="glass-effect rounded-xl p-6 hover-lift">
                                    <div className="flex items-start justify-between mb-4">
                                        <div className="flex items-center space-x-3">
                                            <div className="text-5xl">{getRoleAvatar(member.role)}</div>
                                            <div>
                                                <h3 className="text-enhanced font-semibold">{member.name}</h3>
                                                <p className="text-secondary text-sm capitalize">{member.role.replace('-', ' ')}</p>
                                            </div>
                                        </div>
                                        <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                                            member.status === 'active'
                                                ? 'bg-green-500/20 text-green-400'
                                                : 'bg-gray-500/20 text-gray-400'
                                        }`}>
                                            {member.status}
                                        </span>
                                    </div>

                                    <div className="space-y-2 mb-4">
                                        <div className="flex items-center justify-between text-sm">
                                            <span className="text-secondary">Branch:</span>
                                            <span className="text-enhanced font-medium">{member.branch}</span>
                                        </div>
                                        <div className="flex items-center justify-between text-sm">
                                            <span className="text-secondary">Shift:</span>
                                            <span className="text-enhanced capitalize">{member.shift}</span>
                                        </div>
                                        <div className="flex items-center justify-between text-sm">
                                            <span className="text-secondary">Orders Processed:</span>
                                            <span className="text-brand-gold font-semibold">{member.performance?.ordersProcessed || 0}</span>
                                        </div>
                                        <div className="flex items-center justify-between text-sm">
                                            <span className="text-secondary">Efficiency:</span>
                                            <span className={`font-semibold ${
                                                (member.performance?.efficiency || 0) >= 90 ? 'text-green-400' : 'text-yellow-400'
                                            }`}>
                                                {member.performance?.efficiency || 0}%
                                            </span>
                                        </div>
                                        <div className="flex items-center justify-between text-sm">
                                            <span className="text-secondary">Rating:</span>
                                            <span className="text-enhanced">{(member.performance?.avgRating || 0).toFixed(1)}‚≠ê</span>
                                        </div>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                        <button
                                            onClick={() => handleEditClick(member)}
                                            className="flex-1 bg-white/10 hover:bg-white/20 text-enhanced py-2 rounded-lg transition-colors text-sm font-medium"
                                        >
                                            ‚úèÔ∏è Edit
                                        </button>
                                        <button
                                            onClick={() => handleToggleStatus(member)}
                                            className="flex-1 bg-white/10 hover:bg-white/20 text-enhanced py-2 rounded-lg transition-colors text-sm font-medium"
                                        >
                                            {member.status === 'active' ? '‚è∏Ô∏è Deactivate' : '‚ñ∂Ô∏è Activate'}
                                        </button>
                                        <button
                                            onClick={() => handleDeleteStaff(member)}
                                            className="bg-red-500/20 hover:bg-red-500/30 text-red-400 py-2 px-3 rounded-lg transition-colors text-sm font-medium"
                                        >
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* Add/Edit Form Modal */}
                    {showForm && (
                        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="glass-effect rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-brand-gold">
                                        {editingStaff ? '‚úèÔ∏è Edit Staff Member' : '‚ûï Add New Staff Member'}
                                    </h2>
                                    <button
                                        onClick={resetForm}
                                        className="text-secondary hover:text-enhanced text-2xl"
                                    >
                                        ‚úï
                                    </button>
                                </div>

                                <div className="space-y-4">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="text-secondary text-sm mb-2 block">Full Name *</label>
                                            <input
                                                type="text"
                                                value={formData.name}
                                                onChange={(e) => setFormData({...formData, name: e.target.value})}
                                                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-enhanced focus:outline-none focus:border-brand-gold"
                                                placeholder="Enter full name"
                                            />
                                        </div>
                                        <div>
                                            <label className="text-secondary text-sm mb-2 block">Role *</label>
                                            <select
                                                value={formData.role}
                                                onChange={(e) => setFormData({...formData, role: e.target.value})}
                                                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-enhanced focus:outline-none focus:border-brand-gold"
                                            >
                                                <option value="chef">Chef</option>
                                                <option value="sous-chef">Sous Chef</option>
                                                <option value="line-cook">Line Cook</option>
                                                <option value="server">Server</option>
                                                <option value="cashier">Cashier</option>
                                                <option value="manager">Manager</option>
                                                <option value="delivery">Delivery</option>
                                                <option value="cleaner">Cleaner</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="text-secondary text-sm mb-2 block">Branch *</label>
                                            <select
                                                value={formData.branch}
                                                onChange={(e) => setFormData({...formData, branch: e.target.value})}
                                                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-enhanced focus:outline-none focus:border-brand-gold"
                                            >
                                                {branches.map(branch => (
                                                    <option key={branch.id} value={branch.name}>{branch.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="text-secondary text-sm mb-2 block">Shift</label>
                                            <select
                                                value={formData.shift}
                                                onChange={(e) => setFormData({...formData, shift: e.target.value})}
                                                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-enhanced focus:outline-none focus:border-brand-gold"
                                            >
                                                <option value="morning">Morning (6AM - 2PM)</option>
                                                <option value="afternoon">Afternoon (2PM - 10PM)</option>
                                                <option value="night">Night (10PM - 6AM)</option>
                                                <option value="full-time">Full Time</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="text-secondary text-sm mb-2 block">Phone</label>
                                            <input
                                                type="tel"
                                                value={formData.phone}
                                                onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-enhanced focus:outline-none focus:border-brand-gold"
                                                placeholder="+966500000000"
                                            />
                                        </div>
                                        <div>
                                            <label className="text-secondary text-sm mb-2 block">Email</label>
                                            <input
                                                type="email"
                                                value={formData.email}
                                                onChange={(e) => setFormData({...formData, email: e.target.value})}
                                                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-enhanced focus:outline-none focus:border-brand-gold"
                                                placeholder="email@example.com"
                                            />
                                        </div>
                                        <div>
                                            <label className="text-secondary text-sm mb-2 block">Hire Date</label>
                                            <input
                                                type="date"
                                                value={formData.hireDate}
                                                onChange={(e) => setFormData({...formData, hireDate: e.target.value})}
                                                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-enhanced focus:outline-none focus:border-brand-gold"
                                            />
                                        </div>
                                        <div>
                                            <label className="text-secondary text-sm mb-2 block">Monthly Salary (SAR)</label>
                                            <input
                                                type="number"
                                                value={formData.salary}
                                                onChange={(e) => setFormData({...formData, salary: parseFloat(e.target.value)})}
                                                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-enhanced focus:outline-none focus:border-brand-gold"
                                                placeholder="5000"
                                            />
                                        </div>
                                    </div>

                                    {editingStaff && (
                                        <div className="glass-effect rounded-lg p-4">
                                            <h3 className="text-enhanced font-semibold mb-3">Performance Metrics</h3>
                                            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                                <div>
                                                    <label className="text-secondary text-xs mb-1 block">Orders Processed</label>
                                                    <input
                                                        type="number"
                                                        value={formData.performance.ordersProcessed}
                                                        onChange={(e) => setFormData({
                                                            ...formData,
                                                            performance: {...formData.performance, ordersProcessed: parseInt(e.target.value) || 0}
                                                        })}
                                                        className="w-full bg-white/10 border border-white/20 rounded px-3 py-2 text-enhanced text-sm"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="text-secondary text-xs mb-1 block">Avg Rating</label>
                                                    <input
                                                        type="number"
                                                        step="0.1"
                                                        min="0"
                                                        max="5"
                                                        value={formData.performance.avgRating}
                                                        onChange={(e) => setFormData({
                                                            ...formData,
                                                            performance: {...formData.performance, avgRating: parseFloat(e.target.value) || 0}
                                                        })}
                                                        className="w-full bg-white/10 border border-white/20 rounded px-3 py-2 text-enhanced text-sm"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="text-secondary text-xs mb-1 block">Efficiency %</label>
                                                    <input
                                                        type="number"
                                                        min="0"
                                                        max="100"
                                                        value={formData.performance.efficiency}
                                                        onChange={(e) => setFormData({
                                                            ...formData,
                                                            performance: {...formData.performance, efficiency: parseInt(e.target.value) || 0}
                                                        })}
                                                        className="w-full bg-white/10 border border-white/20 rounded px-3 py-2 text-enhanced text-sm"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="text-secondary text-xs mb-1 block">Tips (SAR)</label>
                                                    <input
                                                        type="number"
                                                        value={formData.performance.tips}
                                                        onChange={(e) => setFormData({
                                                            ...formData,
                                                            performance: {...formData.performance, tips: parseInt(e.target.value) || 0}
                                                        })}
                                                        className="w-full bg-white/10 border border-white/20 rounded px-3 py-2 text-enhanced text-sm"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="text-secondary text-xs mb-1 block">Hours Worked</label>
                                                    <input
                                                        type="number"
                                                        value={formData.performance.hoursWorked}
                                                        onChange={(e) => setFormData({
                                                            ...formData,
                                                            performance: {...formData.performance, hoursWorked: parseInt(e.target.value) || 0}
                                                        })}
                                                        className="w-full bg-white/10 border border-white/20 rounded px-3 py-2 text-enhanced text-sm"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="text-secondary text-xs mb-1 block">Complaints</label>
                                                    <input
                                                        type="number"
                                                        value={formData.performance.complaints}
                                                        onChange={(e) => setFormData({
                                                            ...formData,
                                                            performance: {...formData.performance, complaints: parseInt(e.target.value) || 0}
                                                        })}
                                                        className="w-full bg-white/10 border border-white/20 rounded px-3 py-2 text-enhanced text-sm"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    <div className="flex items-center space-x-3 pt-4">
                                        <button
                                            onClick={editingStaff ? handleUpdateStaff : handleAddStaff}
                                            className="flex-1 bg-gradient-primary text-white py-3 rounded-lg hover:opacity-90 transition-opacity font-medium"
                                        >
                                            {editingStaff ? 'üíæ Update Staff Member' : '‚ûï Add Staff Member'}
                                        </button>
                                        <button
                                            onClick={resetForm}
                                            className="bg-white/10 hover:bg-white/20 text-enhanced py-3 px-6 rounded-lg transition-colors font-medium"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // üöÄ ENHANCED: Quick View Dashboard
        const QuickViewDashboard = () => {
            const { selectedRestaurant, getFinancialOverview, realTimeData, performanceScores } = useData();
            
            const financialData = selectedRestaurant ? getFinancialOverview(selectedRestaurant.id) : null;
            const performanceScore = selectedRestaurant ? performanceScores[selectedRestaurant.id] : null;

            return (
                <div className="p-6 space-y-6">
                    {/* Welcome Header */}
                    <div className="glass-effect rounded-2xl p-6 hover-lift">
                        <div className="flex items-center justify-between">
                            <div>
                                <h1 className="text-2xl font-bold text-brand-gold">Welcome to Restalyze</h1>
                                <p className="text-secondary">Your complete restaurant intelligence platform</p>
                            </div>
                            <div className="flex items-center space-x-2">
                                <div className="w-3 h-3 bg-green-500 rounded-full data-pulse"></div>
                                <span className="text-green-400 text-sm">All Systems Operational</span>
                            </div>
                        </div>
                    </div>

                    {selectedRestaurant ? (
                        <>
                            {/* Key Performance Indicators */}
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div className="glass-effect rounded-xl p-6 text-center hover-lift">
                                    <div className="text-2xl font-bold text-enhanced mb-2">
                                        {financialData ? utils.formatCurrency(financialData.revenue) : '$0'}
                                    </div>
                                    <div className="text-secondary">Monthly Revenue</div>
                                    <div className="text-green-400 text-sm mt-1">+12.5% from last month</div>
                                </div>
                                
                                <div className="glass-effect rounded-xl p-6 text-center hover-lift">
                                    <div className="text-2xl font-bold text-enhanced mb-2">
                                        {financialData ? utils.formatNumber(financialData.totalOrders) : '0'}
                                    </div>
                                    <div className="text-secondary">Total Orders</div>
                                    <div className="text-green-400 text-sm mt-1">+8.3% growth</div>
                                </div>
                                
                                <div className="glass-effect rounded-xl p-6 text-center hover-lift">
                                    <div className="text-2xl font-bold text-enhanced mb-2">
                                        {financialData ? `${financialData.profitMargin.toFixed(1)}%` : '0%'}
                                    </div>
                                    <div className="text-secondary">Profit Margin</div>
                                    <div className="text-green-400 text-sm mt-1">+2.1% improvement</div>
                                </div>
                                
                                <div className="glass-effect rounded-xl p-6 text-center hover-lift">
                                    <div className="text-2xl font-bold text-enhanced mb-2">
                                        {performanceScore ? `${performanceScore.score}/100` : 'N/A'}
                                    </div>
                                    <div className="text-secondary">Performance Score</div>
                                    <div className="text-green-400 text-sm mt-1">
                                        {performanceScore ? `Grade: ${performanceScore.grade}` : 'Not rated'}
                                    </div>
                                </div>
                            </div>

                            {/* Restaurant Overview */}
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="glass-effect rounded-2xl p-6 hover-lift">
                                    <h3 className="text-lg font-semibold text-enhanced mb-4">Restaurant Overview</h3>
                                    <div className="flex items-center space-x-4 mb-4">
                                        {selectedRestaurant.customLogo ? (
                                            <img 
                                                src={selectedRestaurant.customLogo} 
                                                alt={`${selectedRestaurant.name} logo`}
                                                className="w-16 h-16 rounded-lg object-cover"
                                            />
                                        ) : (
                                            <div className="text-4xl">{selectedRestaurant.logo}</div>
                                        )}
                                        <div>
                                            <h4 className="text-xl font-bold text-enhanced">{selectedRestaurant.name}</h4>
                                            <p className="text-secondary">{selectedRestaurant.type} ‚Ä¢ {selectedRestaurant.description}</p>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <p className="text-secondary text-sm">Avg Order Value</p>
                                            <p className="text-enhanced font-semibold">
                                                {utils.formatCurrency(selectedRestaurant.performanceStats?.avgOrderValue || 0)}
                                            </p>
                                        </div>
                                        <div>
                                            <p className="text-secondary text-sm">Customer Rating</p>
                                            <p className="text-enhanced font-semibold">
                                                {selectedRestaurant.performanceStats?.customerSatisfaction || 0}/5
                                            </p>
                                        </div>
                                        <div>
                                            <p className="text-secondary text-sm">Delivery Time</p>
                                            <p className="text-enhanced font-semibold">
                                                {selectedRestaurant.performanceStats?.deliveryTime || 0} min
                                            </p>
                                        </div>
                                        <div>
                                            <p className="text-secondary text-sm">Repeat Customers</p>
                                            <p className="text-enhanced font-semibold">
                                                {selectedRestaurant.performanceStats?.repeatCustomers || 0}%
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Real-time Activity */}
                                <div className="glass-effect rounded-2xl p-6 hover-lift">
                                    <h3 className="text-lg font-semibold text-enhanced mb-4">Recent Activity</h3>
                                    <div className="space-y-3">
                                        {realTimeData.slice(-4).map((data, index) => (
                                            <div key={index} className="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                                <div className="flex items-center space-x-3">
                                                    <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                                    <span className="text-enhanced">
                                                        {utils.formatNumber(data.orders)} orders
                                                    </span>
                                                </div>
                                                <div className="text-secondary text-sm">
                                                    {utils.formatCurrency(data.gmv)}
                                                </div>
                                                <div className="text-secondary text-sm">
                                                    {new Date(data.timestamp).toLocaleTimeString()}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    
                                    {realTimeData.length === 0 && (
                                        <div className="text-center py-4">
                                            <p className="text-secondary">No recent activity</p>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Quick Actions */}
                            <div className="glass-effect rounded-2xl p-6 hover-lift">
                                <h3 className="text-lg font-semibold text-enhanced mb-4">Quick Actions</h3>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <button className="p-4 bg-white/10 rounded-lg hover:bg-white/20 transition-colors text-center">
                                        <div className="text-2xl mb-2">üìä</div>
                                        <div className="text-enhanced text-sm">View Analytics</div>
                                    </button>
                                    <button className="p-4 bg-white/10 rounded-lg hover:bg-white/20 transition-colors text-center">
                                        <div className="text-2xl mb-2">üìã</div>
                                        <div className="text-enhanced text-sm">Generate Report</div>
                                    </button>
                                    <button className="p-4 bg-white/10 rounded-lg hover:bg-white/20 transition-colors text-center">
                                        <div className="text-2xl mb-2">ü§ñ</div>
                                        <div className="text-enhanced text-sm">AI Insights</div>
                                    </button>
                                    <button className="p-4 bg-white/10 rounded-lg hover:bg-white/20 transition-colors text-center">
                                        <div className="text-2xl mb-2">‚ö°</div>
                                        <div className="text-enhanced text-sm">Real-time Data</div>
                                    </button>
                                </div>
                            </div>
                        </>
                    ) : (
                        <div className="glass-effect rounded-2xl p-12 text-center">
                            <div className="text-6xl mb-4">üöÄ</div>
                            <h2 className="text-xl font-bold text-brand-gold mb-2">Welcome to Restalyze</h2>
                            <p className="text-secondary mb-6">The most advanced restaurant analytics platform</p>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div className="p-4 bg-white/5 rounded-lg">
                                    <div className="text-2xl mb-2">ü§ñ</div>
                                    <h3 className="font-semibold">AI Insights</h3>
                                    <p className="text-secondary text-sm">Machine learning powered recommendations</p>
                                </div>
                                <div className="p-4 bg-white/5 rounded-lg">
                                    <div className="text-2xl mb-2">‚ö°</div>
                                    <h3 className="font-semibold">Real-time Analytics</h3>
                                    <p className="text-secondary text-sm">Live data and performance metrics</p>
                                </div>
                                <div className="p-4 bg-white/5 rounded-lg">
                                    <div className="text-2xl mb-2">‚≠ê</div>
                                    <h3 className="font-semibold">Performance Scoring</h3>
                                    <p className="text-secondary text-sm">Comprehensive performance evaluation</p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // üéØ COMMAND CENTER - Strategic Dashboard with Real-Time Insights
        const CommandCenterDashboard = () => {
            return (
                <div className="p-6 space-y-6">
                    {/* Welcome Header with Live Status */}
                    <div className="glass-effect rounded-2xl p-6 hover-lift" style={{ borderLeft: '4px solid #FFD700' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '1rem' }}>
                            <div>
                                <h1 style={{ fontSize: '2rem', fontWeight: '800', background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', marginBottom: '0.5rem' }}>
                                    Command Center
                                </h1>
                                <p style={{ fontSize: '0.875rem', color: '#94a3b8' }}>
                                    Real-time strategic overview of your restaurant operations
                                </p>
                            </div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', padding: '0.5rem 1rem', background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)', borderRadius: '0.75rem', boxShadow: '0 4px 6px rgba(16, 185, 129, 0.3)' }}>
                                <div style={{ width: '8px', height: '8px', borderRadius: '50%', backgroundColor: '#FFD700', animation: 'pulse 2s infinite' }}></div>
                                <span style={{ color: '#FFFFFF', fontWeight: '600', fontSize: '0.875rem' }}>LIVE</span>
                            </div>
                        </div>
                    </div>

                    {/* Quick View Dashboard Content */}
                    <QuickViewDashboard />
                </div>
            );
        };

        // üß† INTELLIGENCE HUB - AI, Predictive Analytics & Smart Alerts
        const IntelligenceHub = () => {
            const [activeTab, setActiveTab] = React.useState('ai');

            return (
                <div className="p-6 space-y-6">
                    {/* Intelligence Header */}
                    <div className="glass-effect rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%)', border: '2px solid rgba(139, 92, 246, 0.3)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1rem' }}>
                            <span style={{ fontSize: '3rem' }}>üß†</span>
                            <div>
                                <h1 style={{ fontSize: '2rem', fontWeight: '800', color: '#8b5cf6', marginBottom: '0.25rem' }}>
                                    Intelligence Hub
                                </h1>
                                <p style={{ fontSize: '0.875rem', color: '#94a3b8', margin: 0 }}>
                                    AI-powered predictions, recommendations & intelligent alerts
                                </p>
                            </div>
                        </div>

                        {/* Tab Navigation */}
                        <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
                            {[
                                { id: 'ai', label: 'AI Recommendations', icon: 'ü§ñ' },
                                { id: 'predictive', label: 'Predictive Analytics', icon: 'üîÆ' },
                                { id: 'alerts', label: 'Smart Alerts', icon: 'üö®' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    style={{
                                        padding: '0.75rem 1.5rem',
                                        borderRadius: '0.75rem',
                                        background: activeTab === tab.id ? 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)' : 'rgba(255, 255, 255, 0.05)',
                                        color: activeTab === tab.id ? '#FFFFFF' : '#94a3b8',
                                        border: activeTab === tab.id ? '2px solid #8b5cf6' : '2px solid transparent',
                                        fontWeight: '600',
                                        fontSize: '0.875rem',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.5rem'
                                    }}
                                >
                                    <span>{tab.icon}</span>
                                    <span>{tab.label}</span>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Content Area */}
                    {activeTab === 'ai' && <AIRecommendations />}
                    {activeTab === 'predictive' && <DashboardEnhancements />}
                    {activeTab === 'alerts' && <SmartFeaturesDashboard />}
                </div>
            );
        };

        // üë• STAFF COMMAND CENTER - Unified Team Management
        const StaffCommandCenter = () => {
            const [activeTab, setActiveTab] = React.useState('manager');

            return (
                <div className="p-6 space-y-6">
                    {/* Staff Command Header */}
                    <div className="glass-effect rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%)', border: '2px solid rgba(16, 185, 129, 0.3)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1rem' }}>
                            <span style={{ fontSize: '3rem' }}>üë•</span>
                            <div>
                                <h1 style={{ fontSize: '2rem', fontWeight: '800', color: '#10b981', marginBottom: '0.25rem' }}>
                                    Staff Command Center
                                </h1>
                                <p style={{ fontSize: '0.875rem', color: '#94a3b8', margin: 0 }}>
                                    Complete team management, performance tracking & scheduling
                                </p>
                            </div>
                        </div>

                        {/* Tab Navigation */}
                        <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
                            {[
                                { id: 'manager', label: 'Staff Manager', icon: 'üëî' },
                                { id: 'performance', label: 'Performance Hub', icon: '‚≠ê' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    style={{
                                        padding: '0.75rem 1.5rem',
                                        borderRadius: '0.75rem',
                                        background: activeTab === tab.id ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : 'rgba(255, 255, 255, 0.05)',
                                        color: activeTab === tab.id ? '#FFFFFF' : '#94a3b8',
                                        border: activeTab === tab.id ? '2px solid #10b981' : '2px solid transparent',
                                        fontWeight: '600',
                                        fontSize: '0.875rem',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.5rem'
                                    }}
                                >
                                    <span>{tab.icon}</span>
                                    <span>{tab.label}</span>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Content Area */}
                    {activeTab === 'manager' && <StaffManager />}
                    {activeTab === 'performance' && <StaffPerformanceHub />}
                </div>
            );
        };

        // üíµ FINANCIAL OVERVIEW Component
        const FinancialOverview = () => {
            const { selectedRestaurant, getFinancialOverview, monthlyData } = useData();

            if (!selectedRestaurant) {
                return (
                    <div className="text-center py-12">
                        <div className="text-4xl mb-4">üí∞</div>
                        <p className="text-secondary">Please select a restaurant to view financial overview</p>
                    </div>
                );
            }

            const financialData = getFinancialOverview(selectedRestaurant.id);

            return (
                <div className="space-y-6">
                    {/* Key Financial Metrics */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div className="glass-effect rounded-xl p-6 hover-lift">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-secondary text-sm">Total Revenue</span>
                                <span className="text-2xl">üí∞</span>
                            </div>
                            <div className="text-3xl font-bold text-enhanced mb-1">
                                {utils.formatCurrency(financialData.revenue)}
                            </div>
                            <div className="text-green-400 text-sm">+12.5% from last month</div>
                        </div>

                        <div className="glass-effect rounded-xl p-6 hover-lift">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-secondary text-sm">Net Profit</span>
                                <span className="text-2xl">üíµ</span>
                            </div>
                            <div className="text-3xl font-bold text-enhanced mb-1">
                                {utils.formatCurrency(financialData.profit)}
                            </div>
                            <div className="text-green-400 text-sm">+8.3% growth</div>
                        </div>

                        <div className="glass-effect rounded-xl p-6 hover-lift">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-secondary text-sm">Profit Margin</span>
                                <span className="text-2xl">üìä</span>
                            </div>
                            <div className="text-3xl font-bold text-enhanced mb-1">
                                {financialData.profitMargin.toFixed(1)}%
                            </div>
                            <div className="text-green-400 text-sm">+2.1% improvement</div>
                        </div>

                        <div className="glass-effect rounded-xl p-6 hover-lift">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-secondary text-sm">Total Orders</span>
                                <span className="text-2xl">üì¶</span>
                            </div>
                            <div className="text-3xl font-bold text-enhanced mb-1">
                                {utils.formatNumber(financialData.totalOrders)}
                            </div>
                            <div className="text-green-400 text-sm">+15.2% increase</div>
                        </div>
                    </div>

                    {/* Revenue Breakdown */}
                    <div className="glass-effect rounded-2xl p-6 hover-lift">
                        <h3 className="text-xl font-bold text-enhanced mb-4 flex items-center gap-2">
                            <span>üí≥</span>
                            Revenue by Platform
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {financialData.platformBreakdown && financialData.platformBreakdown.map((platform, idx) => (
                                <div key={idx} className="bg-white/5 rounded-lg p-4">
                                    <div className="flex items-center justify-between mb-2">
                                        <span className="text-secondary text-sm">{platform.name}</span>
                                        <span className="text-lg">{platform.icon || 'üì±'}</span>
                                    </div>
                                    <div className="text-2xl font-bold text-enhanced mb-1">
                                        {utils.formatCurrency(platform.revenue)}
                                    </div>
                                    <div className="text-sm text-secondary">
                                        {platform.orders} orders ‚Ä¢ {platform.percentage}%
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Monthly Trends */}
                    <div className="glass-effect rounded-2xl p-6 hover-lift">
                        <h3 className="text-xl font-bold text-enhanced mb-4 flex items-center gap-2">
                            <span>üìà</span>
                            Monthly Performance Trends
                        </h3>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div className="text-center">
                                <div className="text-secondary text-sm mb-1">Average Order Value</div>
                                <div className="text-2xl font-bold text-enhanced">
                                    {utils.formatCurrency(financialData.avgOrderValue || 0)}
                                </div>
                            </div>
                            <div className="text-center">
                                <div className="text-secondary text-sm mb-1">Operating Costs</div>
                                <div className="text-2xl font-bold text-enhanced">
                                    {utils.formatCurrency(financialData.costs || 0)}
                                </div>
                            </div>
                            <div className="text-center">
                                <div className="text-secondary text-sm mb-1">Cost Ratio</div>
                                <div className="text-2xl font-bold text-enhanced">
                                    {((financialData.costs / financialData.revenue) * 100).toFixed(1)}%
                                </div>
                            </div>
                            <div className="text-center">
                                <div className="text-secondary text-sm mb-1">ROI</div>
                                <div className="text-2xl font-bold text-green-400">
                                    {((financialData.profit / financialData.costs) * 100).toFixed(1)}%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // üí∞ FINANCIAL INTELLIGENCE - Merged Financial Analytics
        const FinancialIntelligence = () => {
            const [activeTab, setActiveTab] = React.useState('overview');

            return (
                <div className="p-6 space-y-6">
                    {/* Financial Header */}
                    <div className="glass-effect rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, rgba(14, 165, 233, 0.1) 0%, rgba(14, 165, 233, 0.05) 100%)', border: '2px solid rgba(14, 165, 233, 0.3)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1rem' }}>
                            <span style={{ fontSize: '3rem' }}>üí∞</span>
                            <div>
                                <h1 style={{ fontSize: '2rem', fontWeight: '800', color: '#0ea5e9', marginBottom: '0.25rem' }}>
                                    Financial Intelligence
                                </h1>
                                <p style={{ fontSize: '0.875rem', color: '#94a3b8', margin: 0 }}>
                                    Revenue analytics, profit optimization & strategic forecasts
                                </p>
                            </div>
                        </div>

                        {/* Tab Navigation */}
                        <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
                            {[
                                { id: 'overview', label: 'Financial Overview', icon: 'üíµ' },
                                { id: 'health', label: 'Business Health', icon: 'üíö' },
                                { id: 'analytics', label: 'Advanced Analytics', icon: 'üìä' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    style={{
                                        padding: '0.75rem 1.5rem',
                                        borderRadius: '0.75rem',
                                        background: activeTab === tab.id ? 'linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)' : 'rgba(255, 255, 255, 0.05)',
                                        color: activeTab === tab.id ? '#FFFFFF' : '#94a3b8',
                                        border: activeTab === tab.id ? '2px solid #0ea5e9' : '2px solid transparent',
                                        fontWeight: '600',
                                        fontSize: '0.875rem',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.5rem'
                                    }}
                                >
                                    <span>{tab.icon}</span>
                                    <span>{tab.label}</span>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Content Area */}
                    {activeTab === 'overview' && <FinancialOverview />}
                    {activeTab === 'health' && <FinancialHealthDashboard />}
                    {activeTab === 'analytics' && <AdvancedAnalyticsDashboard />}
                </div>
            );
        };

        // üçî MENU ENGINEERING Component
        const MenuEngineering = () => {
            const { selectedRestaurant, dailyData, monthlyData } = useData();

            if (!selectedRestaurant) {
                return (
                    <div className="text-center py-12">
                        <div className="text-4xl mb-4">üçΩÔ∏è</div>
                        <p className="text-secondary">Please select a restaurant to view menu analysis</p>
                    </div>
                );
            }

            // Generate menu items with performance metrics
            const menuItems = [
                {
                    name: 'Classic Burger', category: 'Burgers',
                    orders: 1250, revenue: 31250, cost: 18750, margin: 0.40,
                    popularity: 0.28, profitability: 0.40, trend: '+15%', image: 'üçî'
                },
                {
                    name: 'Cheese Pizza', category: 'Pizza',
                    orders: 980, revenue: 34300, cost: 17150, margin: 0.50,
                    popularity: 0.22, profitability: 0.50, trend: '+22%', image: 'üçï'
                },
                {
                    name: 'Caesar Salad', category: 'Salads',
                    orders: 450, revenue: 5850, cost: 3510, margin: 0.40,
                    popularity: 0.10, profitability: 0.40, trend: '-8%', image: 'ü•ó'
                },
                {
                    name: 'Chicken Wings', category: 'Appetizers',
                    orders: 820, revenue: 16400, cost: 11480, margin: 0.30,
                    popularity: 0.18, profitability: 0.30, trend: '+5%', image: 'üçó'
                },
                {
                    name: 'Veggie Burger', category: 'Burgers',
                    orders: 320, revenue: 8320, cost: 3328, margin: 0.60,
                    popularity: 0.07, profitability: 0.60, trend: '+35%', image: 'ü•ô'
                },
                {
                    name: 'French Fries', category: 'Sides',
                    orders: 1450, revenue: 7250, cost: 5075, margin: 0.30,
                    popularity: 0.32, profitability: 0.30, trend: '+3%', image: 'üçü'
                }
            ];

            // Calculate averages
            const avgPopularity = menuItems.reduce((sum, item) => sum + item.popularity, 0) / menuItems.length;
            const avgProfitability = menuItems.reduce((sum, item) => sum + item.profitability, 0) / menuItems.length;

            const classifyItem = (item) => {
                const highPopularity = item.popularity >= avgPopularity;
                const highProfitability = item.profitability >= avgProfitability;

                if (highPopularity && highProfitability) return { type: 'star', label: 'Star', color: '#10b981', icon: '‚≠ê' };
                if (!highPopularity && highProfitability) return { type: 'puzzle', label: 'Puzzle', color: '#3b82f6', icon: 'üß©' };
                if (highPopularity && !highProfitability) return { type: 'plow', label: 'Plow Horse', color: '#f59e0b', icon: 'üê¥' };
                return { type: 'dog', label: 'Dog', color: '#ef4444', icon: 'üêï' };
            };

            const itemsWithClass = menuItems.map(item => ({
                ...item,
                classification: classifyItem(item)
            }));

            return (
                <div className="space-y-6">
                    {/* Menu Performance Summary */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div className="glass-effect rounded-xl p-6 hover-lift">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-secondary text-sm">Total Menu Items</span>
                                <span className="text-2xl">üìã</span>
                            </div>
                            <div className="text-3xl font-bold text-enhanced">
                                {menuItems.length}
                            </div>
                        </div>

                        <div className="glass-effect rounded-xl p-6 hover-lift">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-secondary text-sm">Total Revenue</span>
                                <span className="text-2xl">üí∞</span>
                            </div>
                            <div className="text-3xl font-bold text-enhanced">
                                {utils.formatCurrency(menuItems.reduce((sum, item) => sum + item.revenue, 0))}
                            </div>
                        </div>

                        <div className="glass-effect rounded-xl p-6 hover-lift">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-secondary text-sm">Avg Margin</span>
                                <span className="text-2xl">üìä</span>
                            </div>
                            <div className="text-3xl font-bold text-enhanced">
                                {(avgProfitability * 100).toFixed(1)}%
                            </div>
                        </div>

                        <div className="glass-effect rounded-xl p-6 hover-lift">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-secondary text-sm">Total Orders</span>
                                <span className="text-2xl">üì¶</span>
                            </div>
                            <div className="text-3xl font-bold text-enhanced">
                                {utils.formatNumber(menuItems.reduce((sum, item) => sum + item.orders, 0))}
                            </div>
                        </div>
                    </div>

                    {/* Menu Matrix */}
                    <div className="glass-effect rounded-2xl p-6 hover-lift">
                        <h3 className="text-xl font-bold text-enhanced mb-4 flex items-center gap-2">
                            <span>üìä</span>
                            Menu Engineering Matrix
                        </h3>
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead>
                                    <tr className="border-b border-white/10">
                                        <th className="text-left py-3 px-4 text-secondary text-sm font-semibold">Item</th>
                                        <th className="text-right py-3 px-4 text-secondary text-sm font-semibold">Orders</th>
                                        <th className="text-right py-3 px-4 text-secondary text-sm font-semibold">Revenue</th>
                                        <th className="text-right py-3 px-4 text-secondary text-sm font-semibold">Margin</th>
                                        <th className="text-center py-3 px-4 text-secondary text-sm font-semibold">Trend</th>
                                        <th className="text-center py-3 px-4 text-secondary text-sm font-semibold">Class</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {itemsWithClass.map((item, idx) => (
                                        <tr key={idx} className="border-b border-white/5 hover:bg-white/5 transition-colors">
                                            <td className="py-4 px-4">
                                                <div className="flex items-center gap-3">
                                                    <span className="text-2xl">{item.image}</span>
                                                    <div>
                                                        <div className="text-enhanced font-semibold">{item.name}</div>
                                                        <div className="text-secondary text-sm">{item.category}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="text-right py-4 px-4 text-enhanced font-semibold">
                                                {utils.formatNumber(item.orders)}
                                            </td>
                                            <td className="text-right py-4 px-4 text-enhanced font-semibold">
                                                {utils.formatCurrency(item.revenue)}
                                            </td>
                                            <td className="text-right py-4 px-4">
                                                <span className="text-enhanced font-semibold">{(item.margin * 100).toFixed(0)}%</span>
                                            </td>
                                            <td className="text-center py-4 px-4">
                                                <span className={item.trend.includes('+') ? 'text-green-400' : 'text-red-400'}>
                                                    {item.trend}
                                                </span>
                                            </td>
                                            <td className="text-center py-4 px-4">
                                                <div className="inline-flex items-center gap-1 px-3 py-1 rounded-full" style={{ backgroundColor: `${item.classification.color}20`, color: item.classification.color }}>
                                                    <span>{item.classification.icon}</span>
                                                    <span className="text-sm font-semibold">{item.classification.label}</span>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* Recommendations */}
                    <div className="glass-effect rounded-2xl p-6 hover-lift">
                        <h3 className="text-xl font-bold text-enhanced mb-4 flex items-center gap-2">
                            <span>üí°</span>
                            Strategic Recommendations
                        </h3>
                        <div className="space-y-3">
                            <div className="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
                                <div className="flex items-start gap-3">
                                    <span className="text-2xl">‚≠ê</span>
                                    <div>
                                        <div className="font-semibold text-green-400 mb-1">Stars - Promote Heavily</div>
                                        <div className="text-secondary text-sm">High popularity & profitability. Feature prominently on menu and marketing.</div>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
                                <div className="flex items-start gap-3">
                                    <span className="text-2xl">üß©</span>
                                    <div>
                                        <div className="font-semibold text-blue-400 mb-1">Puzzles - Increase Visibility</div>
                                        <div className="text-secondary text-sm">High profit but low popularity. Boost marketing and positioning.</div>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4">
                                <div className="flex items-start gap-3">
                                    <span className="text-2xl">üê¥</span>
                                    <div>
                                        <div className="font-semibold text-yellow-400 mb-1">Plow Horses - Optimize Costs</div>
                                        <div className="text-secondary text-sm">Popular but lower profit. Work on cost reduction or price adjustments.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // üçΩÔ∏è MENU INTELLIGENCE - Strategic Menu Performance
        const MenuIntelligence = () => {
            return (
                <div className="p-6 space-y-6">
                    {/* Menu Intelligence Header */}
                    <div className="glass-effect rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%)', border: '2px solid rgba(245, 158, 11, 0.3)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                            <span style={{ fontSize: '3rem' }}>üçΩÔ∏è</span>
                            <div>
                                <h1 style={{ fontSize: '2rem', fontWeight: '800', color: '#f59e0b', marginBottom: '0.25rem' }}>
                                    Menu Intelligence
                                </h1>
                                <p style={{ fontSize: '0.875rem', color: '#94a3b8', margin: 0 }}>
                                    Strategic menu performance analysis & optimization recommendations
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Menu Engineering Content */}
                    <MenuEngineering />
                </div>
            );
        };

        // üè¢ MULTI-LOCATION MANAGER - Branch Management & Comparison
        const MultiLocationManager = () => {
            return (
                <div className="p-6 space-y-6">
                    {/* Multi-Location Header */}
                    <div className="glass-effect rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, rgba(100, 116, 139, 0.1) 0%, rgba(100, 116, 139, 0.05) 100%)', border: '2px solid rgba(100, 116, 139, 0.3)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                            <span style={{ fontSize: '3rem' }}>üè¢</span>
                            <div>
                                <h1 style={{ fontSize: '2rem', fontWeight: '800', color: '#64748b', marginBottom: '0.25rem' }}>
                                    Multi-Location Manager
                                </h1>
                                <p style={{ fontSize: '0.875rem', color: '#94a3b8', margin: 0 }}>
                                    Manage multiple branches and compare performance metrics
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Restaurant Management Content */}
                    <RestaurantManagement />
                </div>
            );
        };

        // ‚öôÔ∏è PLATFORM SETTINGS - Configuration & Preferences
        const PlatformSettings = () => {
            return (
                <div className="p-6 space-y-6">
                    {/* Settings Header */}
                    <div className="glass-effect rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, rgba(148, 163, 184, 0.1) 0%, rgba(148, 163, 184, 0.05) 100%)', border: '2px solid rgba(148, 163, 184, 0.3)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                            <span style={{ fontSize: '3rem' }}>‚öôÔ∏è</span>
                            <div>
                                <h1 style={{ fontSize: '2rem', fontWeight: '800', color: '#94a3b8', marginBottom: '0.25rem' }}>
                                    Platform Settings
                                </h1>
                                <p style={{ fontSize: '0.875rem', color: '#94a3b8', margin: 0 }}>
                                    Configure your Restalyze experience and preferences
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Settings Content */}
                    <div className="glass-effect rounded-2xl p-8">
                        <p style={{ textAlign: 'center', color: '#94a3b8', fontSize: '1rem' }}>
                            Settings module coming soon...
                        </p>
                    </div>
                </div>
            );
        };

        // üìÑ PREMIUM REPORT COMPONENTS - Executive-Ready Design System

        // Report Header with Restalyze Branding
        const ReportHeader = ({ title, subtitle, date, restaurantName, printable = true }) => (
            <div style={{
                padding: '2rem',
                background: 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%)',
                borderBottom: '4px solid #FFD700',
                marginBottom: '2rem',
                '@media print': { pageBreakInside: 'avoid' }
            }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                    <div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '0.5rem' }}>
                            <h1 style={{
                                margin: 0,
                                fontSize: '2rem',
                                fontWeight: '800',
                                color: '#FFD700',
                                letterSpacing: '-0.02em'
                            }}>
                                {title}
                            </h1>
                            {printable && (
                                <button
                                    onClick={() => window.print()}
                                    style={{
                                        padding: '0.5rem 1rem',
                                        background: 'rgba(255, 215, 0, 0.2)',
                                        border: '1px solid #FFD700',
                                        borderRadius: '8px',
                                        color: '#FFD700',
                                        fontSize: '0.875rem',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.5rem',
                                        transition: 'all 0.2s'
                                    }}
                                    className="no-print"
                                    onMouseEnter={(e) => e.currentTarget.style.background = 'rgba(255, 215, 0, 0.3)'}
                                    onMouseLeave={(e) => e.currentTarget.style.background = 'rgba(255, 215, 0, 0.2)'}
                                >
                                    üñ®Ô∏è Print Report
                                </button>
                            )}
                        </div>
                        <p style={{ margin: '0.5rem 0 0 0', fontSize: '1rem', color: 'rgba(255, 255, 255, 0.8)' }}>
                            {subtitle}
                        </p>
                    </div>
                    <div style={{ textAlign: 'right' }}>
                        <div style={{ fontSize: '0.875rem', color: 'rgba(255, 255, 255, 0.7)', marginBottom: '0.5rem' }}>
                            {restaurantName}
                        </div>
                        <div style={{ fontSize: '0.875rem', color: '#FFD700', fontWeight: '600' }}>
                            {date || new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
                        </div>
                    </div>
                </div>
            </div>
        );

        // KPI Card Component
        const ReportKPICard = ({ icon, label, value, change, trend, color }) => (
            <div style={{
                padding: '1.5rem',
                background: '#FFFFFF',
                border: `2px solid ${color}20`,
                borderLeft: `4px solid ${color}`,
                borderRadius: '12px',
                boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)',
                transition: 'all 0.2s',
                '@media print': { pageBreakInside: 'avoid' }
            }}
            onMouseEnter={(e) => {
                e.currentTarget.style.transform = 'translateY(-2px)';
                e.currentTarget.style.boxShadow = '0 4px 16px rgba(0, 0, 0, 0.12)';
            }}
            onMouseLeave={(e) => {
                e.currentTarget.style.transform = 'translateY(0)';
                e.currentTarget.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.06)';
            }}
            >
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                    <div style={{ flex: 1 }}>
                        <div style={{ fontSize: '0.875rem', color: '#64748b', fontWeight: '500', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                            <span style={{ fontSize: '1.25rem' }}>{icon}</span>
                            {label}
                        </div>
                        <div style={{ fontSize: '2rem', fontWeight: '800', color: '#0A2540', marginBottom: '0.5rem' }}>
                            {value}
                        </div>
                        {change && (
                            <div style={{
                                display: 'inline-flex',
                                alignItems: 'center',
                                gap: '0.25rem',
                                padding: '0.25rem 0.75rem',
                                borderRadius: '12px',
                                fontSize: '0.875rem',
                                fontWeight: '600',
                                background: trend === 'up' ? 'rgba(16, 185, 129, 0.1)' : trend === 'down' ? 'rgba(239, 68, 68, 0.1)' : 'rgba(148, 163, 184, 0.1)',
                                color: trend === 'up' ? '#10b981' : trend === 'down' ? '#ef4444' : '#64748b'
                            }}>
                                {trend === 'up' ? '‚Üë' : trend === 'down' ? '‚Üì' : '‚Üí'} {change}
                            </div>
                        )}
                    </div>
                </div>
            </div>
        );

        // AI Insights Box
        const AIInsightsBox = ({ insights }) => (
            <div style={{
                padding: '1.5rem',
                background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(139, 92, 246, 0.02) 100%)',
                border: '2px solid rgba(139, 92, 246, 0.2)',
                borderRadius: '12px',
                marginTop: '2rem',
                '@media print': { pageBreakInside: 'avoid' }
            }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '1rem' }}>
                    <span style={{ fontSize: '1.5rem' }}>ü§ñ</span>
                    <h3 style={{ margin: 0, fontSize: '1.25rem', fontWeight: '700', color: '#8b5cf6' }}>
                        AI-Powered Insights & Recommendations
                    </h3>
                </div>
                <div style={{ display: 'grid', gap: '1rem' }}>
                    {insights.map((insight, index) => (
                        <div key={index} style={{
                            padding: '1rem',
                            background: '#FFFFFF',
                            border: '1px solid rgba(139, 92, 246, 0.2)',
                            borderLeft: '3px solid #8b5cf6',
                            borderRadius: '8px'
                        }}>
                            <div style={{ display: 'flex', gap: '0.75rem' }}>
                                <span style={{ fontSize: '1.25rem', flexShrink: 0 }}>{insight.icon}</span>
                                <div style={{ flex: 1 }}>
                                    <div style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#0A2540', marginBottom: '0.25rem' }}>
                                        {insight.title}
                                    </div>
                                    <div style={{ fontSize: '0.875rem', color: '#64748b', lineHeight: '1.5' }}>
                                        {insight.description}
                                    </div>
                                    {insight.action && (
                                        <div style={{
                                            marginTop: '0.75rem',
                                            padding: '0.5rem 1rem',
                                            background: 'rgba(139, 92, 246, 0.1)',
                                            borderRadius: '6px',
                                            fontSize: '0.8125rem',
                                            fontWeight: '600',
                                            color: '#8b5cf6',
                                            display: 'inline-block'
                                        }}>
                                            üí° {insight.action}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        );

        // Report Section Container
        const ReportSection = ({ title, children, noPadding = false }) => (
            <div style={{
                marginBottom: '2rem',
                '@media print': { pageBreakInside: 'avoid' }
            }}>
                {title && (
                    <h2 style={{
                        fontSize: '1.5rem',
                        fontWeight: '700',
                        color: '#0A2540',
                        marginBottom: '1.5rem',
                        paddingBottom: '0.75rem',
                        borderBottom: '2px solid #FFD700'
                    }}>
                        {title}
                    </h2>
                )}
                <div style={{ padding: noPadding ? 0 : '0' }}>
                    {children}
                </div>
            </div>
        );

        // Report Footer with Branding
        const ReportFooter = () => (
            <div style={{
                marginTop: '3rem',
                padding: '1.5rem',
                background: 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%)',
                borderTop: '4px solid #FFD700',
                borderRadius: '0 0 12px 12px',
                textAlign: 'center',
                '@media print': { pageBreakInside: 'avoid' }
            }}>
                <div style={{ color: '#FFD700', fontSize: '1.125rem', fontWeight: '700', marginBottom: '0.5rem' }}>
                    Powered by Restalyze
                </div>
                <div style={{ color: 'rgba(255, 255, 255, 0.7)', fontSize: '0.875rem' }}>
                    Your Restaurant's Intelligent Command Center
                </div>
            </div>
        );

        // ü§ñ SMART SUGGESTIONS AI PANEL - Intelligent Insights
        const SmartSuggestionsPanel = ({ isOpen, onClose, showToast }) => {
            const [activeTab, setActiveTab] = React.useState('all');
            const [dismissedIds, setDismissedIds] = React.useState([]);

            if (!isOpen) return null;

            const suggestions = [
                {
                    id: 1,
                    type: 'revenue',
                    priority: 'high',
                    icon: 'üí°',
                    title: 'Optimize Peak Hour Pricing',
                    description: 'Your dinner rush (6-8 PM) shows 40% higher demand. Consider dynamic pricing for popular items during this window.',
                    impact: '+$420/week',
                    confidence: 94,
                    color: '#FFD700',
                    actions: [
                        { label: 'View Analytics', icon: 'üìä' },
                        { label: 'Apply Pricing', icon: '‚úì' }
                    ]
                },
                {
                    id: 2,
                    type: 'inventory',
                    priority: 'high',
                    icon: 'üì¶',
                    title: 'Reorder Alert: Top Sellers',
                    description: 'Margherita Pizza and Caesar Salad are trending 25% above forecast. Reorder ingredients to avoid stockouts.',
                    impact: 'Prevent Loss',
                    confidence: 89,
                    color: '#ef4444',
                    actions: [
                        { label: 'Order Now', icon: 'üõí' },
                        { label: 'View Details', icon: '‚Üí' }
                    ]
                },
                {
                    id: 3,
                    type: 'staff',
                    priority: 'medium',
                    icon: 'üë•',
                    title: 'Staffing Optimization',
                    description: 'Monday lunch shows 30% lower traffic. Reduce staff by 2 servers to optimize labor costs without affecting service.',
                    impact: '-$180/week',
                    confidence: 87,
                    color: '#10b981',
                    actions: [
                        { label: 'Adjust Schedule', icon: 'üìÖ' },
                        { label: 'See Impact', icon: 'üìà' }
                    ]
                },
                {
                    id: 4,
                    type: 'menu',
                    priority: 'medium',
                    icon: 'üçΩÔ∏è',
                    title: 'Menu Engineering Opportunity',
                    description: 'Pasta Carbonara has high profit margin (68%) but low visibility. Feature it as "Chef\'s Special" to boost sales.',
                    impact: '+$280/week',
                    confidence: 82,
                    color: '#f59e0b',
                    actions: [
                        { label: 'Feature Item', icon: '‚≠ê' },
                        { label: 'View Menu Data', icon: 'üìä' }
                    ]
                },
                {
                    id: 5,
                    type: 'customer',
                    priority: 'low',
                    icon: 'üí¨',
                    title: 'Customer Feedback Trend',
                    description: 'Recent reviews mention "slow service" 3x more. Consider adding a server during peak hours or streamlining processes.',
                    impact: 'Improve NPS',
                    confidence: 76,
                    color: '#8b5cf6',
                    actions: [
                        { label: 'View Reviews', icon: '‚≠ê' },
                        { label: 'Action Plan', icon: '‚úì' }
                    ]
                }
            ];

            const filteredSuggestions = suggestions.filter(s => {
                if (dismissedIds.includes(s.id)) return false;
                if (activeTab === 'all') return true;
                return s.type === activeTab;
            });

            const categories = [
                { id: 'all', label: 'All', icon: '‚ö°', count: suggestions.length },
                { id: 'revenue', label: 'Revenue', icon: 'üí∞', count: 2 },
                { id: 'inventory', label: 'Inventory', icon: 'üì¶', count: 1 },
                { id: 'staff', label: 'Staff', icon: 'üë•', count: 1 },
                { id: 'menu', label: 'Menu', icon: 'üçΩÔ∏è', count: 1 }
            ];

            const handleAction = (suggestion, action) => {
                showToast('success', `${action.label} for "${suggestion.title}"`, 'Action Taken');
            };

            const handleDismiss = (id) => {
                setDismissedIds([...dismissedIds, id]);
                showToast('info', 'Suggestion dismissed', 'AI Insights');
            };

            return (
                <div
                    onClick={onClose}
                    style={{
                        position: 'fixed',
                        inset: 0,
                        background: 'rgba(0, 0, 0, 0.7)',
                        backdropFilter: 'blur(8px)',
                        zIndex: 10000,
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        padding: '1rem',
                        animation: 'fadeIn 0.2s ease-out'
                    }}
                >
                    <div
                        onClick={(e) => e.stopPropagation()}
                        style={{
                            width: '100%',
                            maxWidth: '900px',
                            maxHeight: '85vh',
                            background: 'linear-gradient(135deg, rgba(10, 37, 64, 0.98) 0%, rgba(15, 23, 42, 0.98) 100%)',
                            border: '2px solid rgba(255, 215, 0, 0.3)',
                            borderRadius: '20px',
                            boxShadow: '0 25px 80px rgba(0, 0, 0, 0.5)',
                            overflow: 'hidden',
                            display: 'flex',
                            flexDirection: 'column',
                            animation: 'slideUp 0.3s ease-out'
                        }}
                    >
                        {/* Header */}
                        <div
                            style={{
                                padding: '1.5rem',
                                borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
                                background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(139, 92, 246, 0.05) 100%)'
                            }}
                        >
                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                                <div>
                                    <h2
                                        style={{
                                            margin: 0,
                                            fontSize: '1.75rem',
                                            fontWeight: '800',
                                            background: 'linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%)',
                                            WebkitBackgroundClip: 'text',
                                            WebkitTextFillColor: 'transparent',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.75rem'
                                        }}
                                    >
                                        <span>ü§ñ</span>
                                        AI Smart Suggestions
                                    </h2>
                                    <p style={{ margin: '0.5rem 0 0 0', color: 'rgba(255, 255, 255, 0.6)', fontSize: '0.875rem' }}>
                                        Powered by machine learning ‚Ä¢ {filteredSuggestions.length} insights available
                                    </p>
                                </div>
                                <button
                                    onClick={onClose}
                                    style={{
                                        width: '40px',
                                        height: '40px',
                                        borderRadius: '10px',
                                        background: 'rgba(255, 255, 255, 0.1)',
                                        border: 'none',
                                        color: '#FFFFFF',
                                        fontSize: '1.25rem',
                                        cursor: 'pointer',
                                        transition: 'all 0.2s ease'
                                    }}
                                    onMouseEnter={(e) => {
                                        e.currentTarget.style.background = 'rgba(239, 68, 68, 0.3)';
                                        e.currentTarget.style.transform = 'scale(1.05)';
                                    }}
                                    onMouseLeave={(e) => {
                                        e.currentTarget.style.background = 'rgba(255, 255, 255, 0.1)';
                                        e.currentTarget.style.transform = 'scale(1)';
                                    }}
                                >
                                    ‚úï
                                </button>
                            </div>
                        </div>

                        {/* Category Tabs */}
                        <div
                            style={{
                                display: 'flex',
                                gap: '0.5rem',
                                padding: '1rem',
                                borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
                                overflowX: 'auto'
                            }}
                        >
                            {categories.map((cat) => (
                                <button
                                    key={cat.id}
                                    onClick={() => setActiveTab(cat.id)}
                                    style={{
                                        padding: '0.5rem 1rem',
                                        background: activeTab === cat.id
                                            ? 'linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(139, 92, 246, 0.1) 100%)'
                                            : 'rgba(255, 255, 255, 0.05)',
                                        border: `1.5px solid ${activeTab === cat.id ? '#8b5cf6' : 'rgba(255, 255, 255, 0.1)'}`,
                                        borderRadius: '8px',
                                        color: activeTab === cat.id ? '#a78bfa' : 'rgba(255, 255, 255, 0.7)',
                                        fontSize: '0.8125rem',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        transition: 'all 0.2s ease',
                                        whiteSpace: 'nowrap',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.5rem'
                                    }}
                                >
                                    <span>{cat.icon}</span>
                                    {cat.label}
                                    <span
                                        style={{
                                            fontSize: '0.6875rem',
                                            padding: '2px 6px',
                                            borderRadius: '4px',
                                            background: activeTab === cat.id ? 'rgba(139, 92, 246, 0.3)' : 'rgba(255, 255, 255, 0.1)'
                                        }}
                                    >
                                        {cat.count}
                                    </span>
                                </button>
                            ))}
                        </div>

                        {/* Suggestions List */}
                        <div
                            style={{
                                flex: 1,
                                overflowY: 'auto',
                                padding: '1rem'
                            }}
                        >
                            {filteredSuggestions.length === 0 ? (
                                <div
                                    style={{
                                        padding: '3rem',
                                        textAlign: 'center',
                                        color: 'rgba(255, 255, 255, 0.5)'
                                    }}
                                >
                                    <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>‚ú®</div>
                                    <div style={{ fontSize: '1rem', fontWeight: '600', marginBottom: '0.5rem' }}>All caught up!</div>
                                    <div style={{ fontSize: '0.875rem' }}>No active suggestions at the moment</div>
                                </div>
                            ) : (
                                <div style={{ display: 'grid', gap: '1rem' }}>
                                    {filteredSuggestions.map((suggestion, index) => (
                                        <div
                                            key={suggestion.id}
                                            style={{
                                                padding: '1.25rem',
                                                background: 'rgba(255, 255, 255, 0.03)',
                                                border: '1px solid rgba(255, 255, 255, 0.08)',
                                                borderLeft: `4px solid ${suggestion.color}`,
                                                borderRadius: '12px',
                                                transition: 'all 0.2s ease',
                                                animation: `slideUp 0.3s ease-out ${index * 0.05}s both`
                                            }}
                                            onMouseEnter={(e) => {
                                                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.06)';
                                                e.currentTarget.style.transform = 'translateX(4px)';
                                            }}
                                            onMouseLeave={(e) => {
                                                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.03)';
                                                e.currentTarget.style.transform = 'translateX(0)';
                                            }}
                                        >
                                            <div style={{ display: 'flex', gap: '1rem' }}>
                                                {/* Icon */}
                                                <div
                                                    style={{
                                                        width: '48px',
                                                        height: '48px',
                                                        borderRadius: '12px',
                                                        background: `${suggestion.color}20`,
                                                        border: `1px solid ${suggestion.color}40`,
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        justifyContent: 'center',
                                                        fontSize: '1.5rem',
                                                        flexShrink: 0
                                                    }}
                                                >
                                                    {suggestion.icon}
                                                </div>

                                                {/* Content */}
                                                <div style={{ flex: 1, minWidth: 0 }}>
                                                    {/* Title Row */}
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.5rem' }}>
                                                        <h3
                                                            style={{
                                                                margin: 0,
                                                                fontSize: '1rem',
                                                                fontWeight: '700',
                                                                color: '#FFFFFF'
                                                            }}
                                                        >
                                                            {suggestion.title}
                                                        </h3>
                                                        <button
                                                            onClick={() => handleDismiss(suggestion.id)}
                                                            style={{
                                                                padding: '4px 8px',
                                                                background: 'rgba(255, 255, 255, 0.05)',
                                                                border: '1px solid rgba(255, 255, 255, 0.1)',
                                                                borderRadius: '6px',
                                                                color: 'rgba(255, 255, 255, 0.5)',
                                                                fontSize: '0.75rem',
                                                                cursor: 'pointer',
                                                                transition: 'all 0.2s ease'
                                                            }}
                                                            onMouseEnter={(e) => {
                                                                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.1)';
                                                                e.currentTarget.style.color = '#FFFFFF';
                                                            }}
                                                            onMouseLeave={(e) => {
                                                                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';
                                                                e.currentTarget.style.color = 'rgba(255, 255, 255, 0.5)';
                                                            }}
                                                        >
                                                            Dismiss
                                                        </button>
                                                    </div>

                                                    {/* Description */}
                                                    <p
                                                        style={{
                                                            margin: '0 0 0.75rem 0',
                                                            fontSize: '0.875rem',
                                                            color: 'rgba(255, 255, 255, 0.7)',
                                                            lineHeight: '1.5'
                                                        }}
                                                    >
                                                        {suggestion.description}
                                                    </p>

                                                    {/* Metrics */}
                                                    <div style={{ display: 'flex', gap: '1rem', marginBottom: '0.75rem' }}>
                                                        <div
                                                            style={{
                                                                padding: '0.5rem 0.75rem',
                                                                background: `${suggestion.color}15`,
                                                                border: `1px solid ${suggestion.color}30`,
                                                                borderRadius: '8px',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                gap: '0.5rem'
                                                            }}
                                                        >
                                                            <span style={{ fontSize: '0.75rem', color: 'rgba(255, 255, 255, 0.6)' }}>Impact:</span>
                                                            <span style={{ fontSize: '0.875rem', fontWeight: '700', color: suggestion.color }}>{suggestion.impact}</span>
                                                        </div>
                                                        <div
                                                            style={{
                                                                padding: '0.5rem 0.75rem',
                                                                background: 'rgba(255, 255, 255, 0.05)',
                                                                border: '1px solid rgba(255, 255, 255, 0.1)',
                                                                borderRadius: '8px',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                gap: '0.5rem'
                                                            }}
                                                        >
                                                            <span style={{ fontSize: '0.75rem', color: 'rgba(255, 255, 255, 0.6)' }}>Confidence:</span>
                                                            <span style={{ fontSize: '0.875rem', fontWeight: '700', color: '#FFFFFF' }}>{suggestion.confidence}%</span>
                                                        </div>
                                                    </div>

                                                    {/* Actions */}
                                                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                                                        {suggestion.actions.map((action) => (
                                                            <button
                                                                key={action.label}
                                                                onClick={() => handleAction(suggestion, action)}
                                                                style={{
                                                                    padding: '0.5rem 1rem',
                                                                    background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(139, 92, 246, 0.1) 100%)',
                                                                    border: '1.5px solid rgba(139, 92, 246, 0.4)',
                                                                    borderRadius: '8px',
                                                                    color: '#a78bfa',
                                                                    fontSize: '0.8125rem',
                                                                    fontWeight: '600',
                                                                    cursor: 'pointer',
                                                                    transition: 'all 0.2s ease',
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    gap: '0.375rem'
                                                                }}
                                                                onMouseEnter={(e) => {
                                                                    e.currentTarget.style.background = 'linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(139, 92, 246, 0.2) 100%)';
                                                                    e.currentTarget.style.transform = 'translateY(-2px)';
                                                                }}
                                                                onMouseLeave={(e) => {
                                                                    e.currentTarget.style.background = 'linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(139, 92, 246, 0.1) 100%)';
                                                                    e.currentTarget.style.transform = 'translateY(0)';
                                                                }}
                                                            >
                                                                <span>{action.icon}</span>
                                                                {action.label}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        {/* Footer */}
                        <div
                            style={{
                                padding: '1rem 1.5rem',
                                borderTop: '1px solid rgba(255, 255, 255, 0.1)',
                                background: 'rgba(255, 255, 255, 0.03)',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'space-between'
                            }}
                        >
                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.8125rem', color: 'rgba(255, 255, 255, 0.5)' }}>
                                <div
                                    style={{
                                        width: '6px',
                                        height: '6px',
                                        borderRadius: '50%',
                                        background: '#10b981',
                                        animation: 'pulse 2s infinite'
                                    }}
                                />
                                AI analyzing your data in real-time
                            </div>
                            <button
                                style={{
                                    padding: '0.5rem 1rem',
                                    background: 'rgba(255, 255, 255, 0.05)',
                                    border: '1px solid rgba(255, 255, 255, 0.1)',
                                    borderRadius: '8px',
                                    color: 'rgba(255, 255, 255, 0.7)',
                                    fontSize: '0.8125rem',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    transition: 'all 0.2s ease'
                                }}
                                onClick={onClose}
                            >
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // üìä QUICK STATS WIDGET - Floating Dashboard
        const QuickStatsWidget = ({ isOpen, onClose }) => {
            const [expanded, setExpanded] = React.useState(true);

            if (!isOpen) return null;

            const stats = [
                { id: 'revenue', label: 'Today\'s Revenue', value: '$3,247', change: '+12%', trend: 'up', icon: 'üí∞', color: '#10b981' },
                { id: 'orders', label: 'Active Orders', value: '47', change: '+8', trend: 'up', icon: 'üçï', color: '#3b82f6' },
                { id: 'tables', label: 'Tables Occupied', value: '32/45', change: '71%', trend: 'neutral', icon: 'ü™ë', color: '#f59e0b' },
                { id: 'rating', label: 'Avg Rating Today', value: '4.8', change: '+0.2', trend: 'up', icon: '‚≠ê', color: '#FFD700' }
            ];

            return (
                <div
                    style={{
                        position: 'fixed',
                        bottom: expanded ? '2rem' : 'auto',
                        top: expanded ? 'auto' : '50%',
                        left: '2rem',
                        transform: expanded ? 'none' : 'translateY(-50%)',
                        zIndex: 999,
                        transition: 'all 0.3s ease',
                        animation: 'slideUp 0.3s ease-out'
                    }}
                >
                    <div
                        style={{
                            background: 'linear-gradient(135deg, rgba(10, 37, 64, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%)',
                            backdropFilter: 'blur(20px)',
                            border: '2px solid rgba(255, 215, 0, 0.3)',
                            borderRadius: '16px',
                            boxShadow: '0 20px 60px rgba(0, 0, 0, 0.4)',
                            overflow: 'hidden',
                            width: expanded ? '320px' : '60px',
                            transition: 'all 0.3s ease'
                        }}
                    >
                        {/* Header */}
                        <div
                            style={{
                                padding: expanded ? '1rem' : '0.75rem',
                                background: 'linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 165, 0, 0.05) 100%)',
                                borderBottom: expanded ? '1px solid rgba(255, 255, 255, 0.1)' : 'none',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'space-between',
                                cursor: 'pointer',
                                transition: 'all 0.2s ease'
                            }}
                            onClick={() => setExpanded(!expanded)}
                        >
                            {expanded ? (
                                <>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                        <span style={{ fontSize: '1.25rem' }}>üìä</span>
                                        <h3
                                            style={{
                                                margin: 0,
                                                fontSize: '0.875rem',
                                                fontWeight: '700',
                                                background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                                                WebkitBackgroundClip: 'text',
                                                WebkitTextFillColor: 'transparent'
                                            }}
                                        >
                                            Quick Stats
                                        </h3>
                                    </div>
                                    <div style={{ display: 'flex', gap: '0.25rem' }}>
                                        <button
                                            onClick={(e) => { e.stopPropagation(); setExpanded(false); }}
                                            style={{
                                                width: '24px',
                                                height: '24px',
                                                borderRadius: '6px',
                                                background: 'rgba(255, 255, 255, 0.1)',
                                                border: 'none',
                                                color: '#FFFFFF',
                                                fontSize: '0.75rem',
                                                cursor: 'pointer',
                                                transition: 'all 0.2s ease'
                                            }}
                                            title="Minimize"
                                        >
                                            ‚àí
                                        </button>
                                        <button
                                            onClick={(e) => { e.stopPropagation(); onClose(); }}
                                            style={{
                                                width: '24px',
                                                height: '24px',
                                                borderRadius: '6px',
                                                background: 'rgba(255, 255, 255, 0.1)',
                                                border: 'none',
                                                color: '#FFFFFF',
                                                fontSize: '0.75rem',
                                                cursor: 'pointer',
                                                transition: 'all 0.2s ease'
                                            }}
                                            title="Close"
                                        >
                                            ‚úï
                                        </button>
                                    </div>
                                </>
                            ) : (
                                <span style={{ fontSize: '1.5rem' }}>üìä</span>
                            )}
                        </div>

                        {/* Stats Grid */}
                        {expanded && (
                            <div style={{ padding: '1rem' }}>
                                <div style={{ display: 'grid', gap: '0.75rem' }}>
                                    {stats.map((stat, index) => (
                                        <div
                                            key={stat.id}
                                            style={{
                                                padding: '0.875rem',
                                                background: 'rgba(255, 255, 255, 0.03)',
                                                border: `1px solid rgba(255, 255, 255, 0.08)`,
                                                borderLeft: `3px solid ${stat.color}`,
                                                borderRadius: '10px',
                                                cursor: 'pointer',
                                                transition: 'all 0.2s ease',
                                                animation: `slideUp 0.3s ease-out ${index * 0.05}s both`
                                            }}
                                            onMouseEnter={(e) => {
                                                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.06)';
                                                e.currentTarget.style.transform = 'translateX(4px)';
                                            }}
                                            onMouseLeave={(e) => {
                                                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.03)';
                                                e.currentTarget.style.transform = 'translateX(0)';
                                            }}
                                        >
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.5rem' }}>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                                    <span style={{ fontSize: '1.25rem' }}>{stat.icon}</span>
                                                    <span
                                                        style={{
                                                            fontSize: '0.75rem',
                                                            color: 'rgba(255, 255, 255, 0.6)',
                                                            fontWeight: '500'
                                                        }}
                                                    >
                                                        {stat.label}
                                                    </span>
                                                </div>
                                                <span
                                                    style={{
                                                        fontSize: '0.6875rem',
                                                        fontWeight: '700',
                                                        padding: '2px 6px',
                                                        borderRadius: '4px',
                                                        background: stat.trend === 'up' ? 'rgba(16, 185, 129, 0.2)' : 'rgba(148, 163, 184, 0.2)',
                                                        color: stat.trend === 'up' ? '#10b981' : 'rgba(255, 255, 255, 0.6)',
                                                        border: `1px solid ${stat.trend === 'up' ? 'rgba(16, 185, 129, 0.3)' : 'rgba(148, 163, 184, 0.3)'}`
                                                    }}
                                                >
                                                    {stat.change}
                                                </span>
                                            </div>
                                            <div
                                                style={{
                                                    fontSize: '1.5rem',
                                                    fontWeight: '800',
                                                    color: stat.color
                                                }}
                                            >
                                                {stat.value}
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                {/* Update Time */}
                                <div
                                    style={{
                                        marginTop: '0.75rem',
                                        padding: '0.5rem 0.75rem',
                                        background: 'rgba(255, 255, 255, 0.03)',
                                        borderRadius: '8px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        gap: '0.5rem',
                                        fontSize: '0.75rem',
                                        color: 'rgba(255, 255, 255, 0.5)'
                                    }}
                                >
                                    <div
                                        style={{
                                            width: '6px',
                                            height: '6px',
                                            borderRadius: '50%',
                                            background: '#10b981',
                                            animation: 'pulse 2s infinite'
                                        }}
                                    />
                                    Updated 2s ago
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // üì° LIVE ACTIVITY FEED - Real-Time Updates
        const LiveActivityFeed = ({ isOpen, onClose }) => {
            const [activities, setActivities] = React.useState([
                { id: 1, type: 'order', icon: 'üçï', title: 'New order received', description: 'Table 12 ‚Ä¢ $127.50', time: '2m ago', color: '#10b981' },
                { id: 2, type: 'alert', icon: '‚ö†Ô∏è', title: 'Low inventory alert', description: 'Chicken breast - 2 units left', time: '5m ago', color: '#f59e0b' },
                { id: 3, type: 'staff', icon: 'üë§', title: 'Staff checked in', description: 'Sarah Johnson started shift', time: '12m ago', color: '#3b82f6' },
                { id: 4, type: 'revenue', icon: 'üí∞', title: 'Daily revenue milestone', description: 'Hit $2,500 target for today', time: '18m ago', color: '#FFD700' },
                { id: 5, type: 'review', icon: '‚≠ê', title: 'New 5-star review', description: 'Customer praised the service', time: '25m ago', color: '#8b5cf6' },
                { id: 6, type: 'system', icon: 'üîÑ', title: 'Data sync completed', description: 'All locations synced successfully', time: '32m ago', color: '#64748b' },
                { id: 7, type: 'order', icon: '‚úÖ', title: 'Order completed', description: 'Table 8 ‚Ä¢ Order #1247', time: '38m ago', color: '#10b981' },
                { id: 8, type: 'staff', icon: 'üèÜ', title: 'Top performer today', description: 'Mike Chen - 15 tables served', time: '1h ago', color: '#3b82f6' }
            ]);

            if (!isOpen) return null;

            return (
                <div
                    style={{
                        position: 'fixed',
                        top: 0,
                        right: 0,
                        width: '380px',
                        height: '100vh',
                        background: 'linear-gradient(135deg, rgba(10, 37, 64, 0.98) 0%, rgba(15, 23, 42, 0.98) 100%)',
                        borderLeft: '2px solid rgba(255, 215, 0, 0.3)',
                        boxShadow: '-10px 0 40px rgba(0, 0, 0, 0.3)',
                        zIndex: 9998,
                        display: 'flex',
                        flexDirection: 'column',
                        animation: 'slideInRight 0.3s ease-out',
                        overflow: 'hidden'
                    }}
                >
                    {/* Header */}
                    <div
                        style={{
                            padding: '1.5rem',
                            borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
                            background: 'linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 165, 0, 0.05) 100%)'
                        }}
                    >
                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '0.5rem' }}>
                            <h2
                                style={{
                                    margin: 0,
                                    fontSize: '1.25rem',
                                    fontWeight: '800',
                                    background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                                    WebkitBackgroundClip: 'text',
                                    WebkitTextFillColor: 'transparent',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '0.5rem'
                                }}
                            >
                                <span>üì°</span>
                                Live Activity
                            </h2>
                            <button
                                onClick={onClose}
                                style={{
                                    width: '32px',
                                    height: '32px',
                                    borderRadius: '8px',
                                    background: 'rgba(255, 255, 255, 0.1)',
                                    border: 'none',
                                    color: '#FFFFFF',
                                    fontSize: '1rem',
                                    cursor: 'pointer',
                                    transition: 'all 0.2s ease'
                                }}
                                onMouseEnter={(e) => {
                                    e.currentTarget.style.background = 'rgba(239, 68, 68, 0.3)';
                                }}
                                onMouseLeave={(e) => {
                                    e.currentTarget.style.background = 'rgba(255, 255, 255, 0.1)';
                                }}
                            >
                                ‚Üí
                            </button>
                        </div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                            <div
                                style={{
                                    width: '8px',
                                    height: '8px',
                                    borderRadius: '50%',
                                    background: '#10b981',
                                    animation: 'pulse 2s infinite'
                                }}
                            />
                            <p style={{ margin: 0, color: 'rgba(255, 255, 255, 0.7)', fontSize: '0.8125rem' }}>
                                Real-time updates from all locations
                            </p>
                        </div>
                    </div>

                    {/* Filter Tabs */}
                    <div
                        style={{
                            display: 'flex',
                            gap: '0.5rem',
                            padding: '1rem',
                            borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
                            overflowX: 'auto'
                        }}
                    >
                        {['All', 'Orders', 'Alerts', 'Staff', 'System'].map((filter) => (
                            <button
                                key={filter}
                                style={{
                                    padding: '0.375rem 0.875rem',
                                    background: filter === 'All' ? 'rgba(255, 215, 0, 0.2)' : 'rgba(255, 255, 255, 0.05)',
                                    border: `1px solid ${filter === 'All' ? '#FFD700' : 'rgba(255, 255, 255, 0.1)'}`,
                                    borderRadius: '6px',
                                    color: filter === 'All' ? '#FFD700' : 'rgba(255, 255, 255, 0.7)',
                                    fontSize: '0.75rem',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    transition: 'all 0.2s ease',
                                    whiteSpace: 'nowrap'
                                }}
                            >
                                {filter}
                            </button>
                        ))}
                    </div>

                    {/* Activity List */}
                    <div
                        style={{
                            flex: 1,
                            overflowY: 'auto',
                            padding: '0.5rem'
                        }}
                    >
                        {activities.map((activity, index) => (
                            <div
                                key={activity.id}
                                style={{
                                    padding: '1rem',
                                    marginBottom: '0.5rem',
                                    background: 'rgba(255, 255, 255, 0.03)',
                                    border: '1px solid rgba(255, 255, 255, 0.08)',
                                    borderLeft: `3px solid ${activity.color}`,
                                    borderRadius: '10px',
                                    cursor: 'pointer',
                                    transition: 'all 0.2s ease',
                                    animation: `slideInRight 0.3s ease-out ${index * 0.05}s both`
                                }}
                                onMouseEnter={(e) => {
                                    e.currentTarget.style.background = 'rgba(255, 255, 255, 0.06)';
                                    e.currentTarget.style.transform = 'translateX(-4px)';
                                }}
                                onMouseLeave={(e) => {
                                    e.currentTarget.style.background = 'rgba(255, 255, 255, 0.03)';
                                    e.currentTarget.style.transform = 'translateX(0)';
                                }}
                            >
                                <div style={{ display: 'flex', gap: '0.75rem' }}>
                                    <div
                                        style={{
                                            width: '40px',
                                            height: '40px',
                                            borderRadius: '10px',
                                            background: `${activity.color}20`,
                                            border: `1px solid ${activity.color}40`,
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            fontSize: '1.25rem',
                                            flexShrink: 0
                                        }}
                                    >
                                        {activity.icon}
                                    </div>
                                    <div style={{ flex: 1, minWidth: 0 }}>
                                        <div
                                            style={{
                                                fontSize: '0.875rem',
                                                fontWeight: '600',
                                                color: '#FFFFFF',
                                                marginBottom: '0.25rem',
                                                display: 'flex',
                                                justifyContent: 'space-between',
                                                alignItems: 'center'
                                            }}
                                        >
                                            <span>{activity.title}</span>
                                            <span
                                                style={{
                                                    fontSize: '0.6875rem',
                                                    color: 'rgba(255, 255, 255, 0.5)',
                                                    fontWeight: '500'
                                                }}
                                            >
                                                {activity.time}
                                            </span>
                                        </div>
                                        <div
                                            style={{
                                                fontSize: '0.8125rem',
                                                color: 'rgba(255, 255, 255, 0.6)',
                                                lineHeight: '1.4'
                                            }}
                                        >
                                            {activity.description}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Footer Stats */}
                    <div
                        style={{
                            padding: '1rem',
                            borderTop: '1px solid rgba(255, 255, 255, 0.1)',
                            background: 'rgba(255, 255, 255, 0.03)'
                        }}
                    >
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.75rem' }}>
                            <div
                                style={{
                                    padding: '0.75rem',
                                    background: 'rgba(16, 185, 129, 0.1)',
                                    border: '1px solid rgba(16, 185, 129, 0.3)',
                                    borderRadius: '8px',
                                    textAlign: 'center'
                                }}
                            >
                                <div style={{ fontSize: '1.5rem', fontWeight: '800', color: '#10b981', marginBottom: '0.25rem' }}>47</div>
                                <div style={{ fontSize: '0.75rem', color: 'rgba(255, 255, 255, 0.6)' }}>Active Orders</div>
                            </div>
                            <div
                                style={{
                                    padding: '0.75rem',
                                    background: 'rgba(59, 130, 246, 0.1)',
                                    border: '1px solid rgba(59, 130, 246, 0.3)',
                                    borderRadius: '8px',
                                    textAlign: 'center'
                                }}
                            >
                                <div style={{ fontSize: '1.5rem', fontWeight: '800', color: '#3b82f6', marginBottom: '0.25rem' }}>12</div>
                                <div style={{ fontSize: '0.75rem', color: 'rgba(255, 255, 255, 0.6)' }}>Staff Online</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // üéØ ADVANCED COMMAND PALETTE - Ultimate Power User Feature
        const CommandPalette = ({ isOpen, onClose, onNavigate, showToast }) => {
            const [query, setQuery] = React.useState('');
            const [selectedIndex, setSelectedIndex] = React.useState(0);
            const [activeCategory, setActiveCategory] = React.useState('all');
            const inputRef = React.useRef(null);

            React.useEffect(() => {
                if (isOpen) {
                    inputRef.current?.focus();
                    setQuery('');
                    setSelectedIndex(0);
                }
            }, [isOpen]);

            if (!isOpen) return null;

            const commands = [
                // Navigation Commands
                { id: 'nav-command', icon: 'üéØ', label: 'Go to Command Center', category: 'navigation', action: () => onNavigate('command-center'), keywords: ['dashboard', 'home', 'overview'] },
                { id: 'nav-intelligence', icon: 'üß†', label: 'Go to Intelligence Hub', category: 'navigation', action: () => onNavigate('intelligence'), keywords: ['ai', 'predictions', 'smart'] },
                { id: 'nav-staff', icon: 'üë•', label: 'Go to Staff Command', category: 'navigation', action: () => onNavigate('staff-command'), keywords: ['team', 'employees', 'people'] },
                { id: 'nav-financial', icon: 'üí∞', label: 'Go to Financial Intelligence', category: 'navigation', action: () => onNavigate('financial-intelligence'), keywords: ['money', 'revenue', 'profit'] },
                { id: 'nav-menu', icon: 'üçΩÔ∏è', label: 'Go to Menu Intelligence', category: 'navigation', action: () => onNavigate('menu-intelligence'), keywords: ['food', 'dishes', 'items'] },
                { id: 'nav-reports', icon: 'üìä', label: 'Go to Report Center', category: 'navigation', action: () => onNavigate('reports'), keywords: ['analytics', 'data', 'insights'] },
                { id: 'nav-locations', icon: 'üè¢', label: 'Go to Multi-Location', category: 'navigation', action: () => onNavigate('multi-location'), keywords: ['branches', 'stores', 'outlets'] },
                { id: 'nav-settings', icon: '‚öôÔ∏è', label: 'Go to Settings', category: 'navigation', action: () => onNavigate('settings'), keywords: ['config', 'preferences', 'options'] },

                // Action Commands
                { id: 'action-report', icon: 'üìà', label: 'Generate New Report', category: 'actions', action: () => { onNavigate('reports'); showToast('success', 'Opening report generator...', 'Report Center'); }, keywords: ['create', 'new', 'analytics'] },
                { id: 'action-staff', icon: 'üë§', label: 'Add New Staff Member', category: 'actions', action: () => { showToast('info', 'Staff addition form coming soon', 'Staff Management'); }, keywords: ['hire', 'employee', 'team'] },
                { id: 'action-export', icon: 'üíæ', label: 'Export All Data', category: 'actions', action: () => { showToast('info', 'Preparing export...', 'Data Export'); }, keywords: ['download', 'backup', 'save'] },
                { id: 'action-alert', icon: 'üîî', label: 'View All Alerts', category: 'actions', action: () => { showToast('info', 'Opening alerts center...', 'Alerts'); }, keywords: ['notifications', 'warnings', 'messages'] },

                // Data Commands
                { id: 'data-revenue', icon: 'üíµ', label: 'View Revenue Analytics', category: 'data', action: () => { onNavigate('financial-intelligence'); showToast('success', 'Loading revenue data...', 'Financial Intelligence'); }, keywords: ['income', 'sales', 'earnings'] },
                { id: 'data-performance', icon: 'üìä', label: 'Staff Performance Metrics', category: 'data', action: () => { onNavigate('staff-command'); showToast('success', 'Loading performance data...', 'Staff Metrics'); }, keywords: ['employees', 'productivity', 'kpi'] },
                { id: 'data-menu', icon: 'üçï', label: 'Menu Performance Analysis', category: 'data', action: () => { onNavigate('menu-intelligence'); showToast('success', 'Analyzing menu data...', 'Menu Intelligence'); }, keywords: ['dishes', 'items', 'food'] },
                { id: 'data-forecast', icon: 'üîÆ', label: 'Predictive Analytics', category: 'data', action: () => { onNavigate('intelligence'); showToast('success', 'Loading predictions...', 'AI Intelligence'); }, keywords: ['forecast', 'predict', 'future'] },

                // Quick Actions
                { id: 'quick-shortcuts', icon: '‚å®Ô∏è', label: 'Show Keyboard Shortcuts', category: 'help', action: () => { showToast('info', 'Opening shortcuts guide...', 'Help'); }, keywords: ['keys', 'hotkeys', 'commands'] },
                { id: 'quick-theme', icon: 'üåì', label: 'Toggle Theme', category: 'settings', action: () => { showToast('info', 'Theme switching coming soon!', 'Appearance'); }, keywords: ['dark', 'light', 'mode'] },
                { id: 'quick-refresh', icon: 'üîÑ', label: 'Refresh Dashboard Data', category: 'actions', action: () => { showToast('success', 'Refreshing all data...', 'Dashboard'); }, keywords: ['reload', 'update', 'sync'] },
                { id: 'quick-help', icon: '‚ùì', label: 'Get Help & Support', category: 'help', action: () => { showToast('info', 'Help center coming soon!', 'Support'); }, keywords: ['support', 'docs', 'guide'] }
            ];

            const categories = [
                { id: 'all', label: 'All Commands', icon: '‚ö°' },
                { id: 'navigation', label: 'Navigation', icon: 'üß≠' },
                { id: 'actions', label: 'Actions', icon: '‚öôÔ∏è' },
                { id: 'data', label: 'Data & Analytics', icon: 'üìä' },
                { id: 'help', label: 'Help & Settings', icon: '‚ùì' }
            ];

            const filteredCommands = React.useMemo(() => {
                let filtered = commands;

                // Filter by category
                if (activeCategory !== 'all') {
                    filtered = filtered.filter(cmd => cmd.category === activeCategory);
                }

                // Filter by search query
                if (query.trim()) {
                    const searchLower = query.toLowerCase();
                    filtered = filtered.filter(cmd =>
                        cmd.label.toLowerCase().includes(searchLower) ||
                        cmd.keywords?.some(kw => kw.toLowerCase().includes(searchLower))
                    );
                }

                return filtered;
            }, [query, activeCategory]);

            const handleKeyDown = (e) => {
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    setSelectedIndex(prev => (prev + 1) % filteredCommands.length);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    setSelectedIndex(prev => (prev - 1 + filteredCommands.length) % filteredCommands.length);
                } else if (e.key === 'Enter' && filteredCommands[selectedIndex]) {
                    e.preventDefault();
                    executeCommand(filteredCommands[selectedIndex]);
                } else if (e.key === 'Escape') {
                    onClose();
                }
            };

            const executeCommand = (command) => {
                command.action();
                onClose();
            };

            return (
                <div
                    onClick={onClose}
                    style={{
                        position: 'fixed',
                        inset: 0,
                        background: 'rgba(0, 0, 0, 0.8)',
                        backdropFilter: 'blur(12px)',
                        zIndex: 10001,
                        display: 'flex',
                        alignItems: 'flex-start',
                        justifyContent: 'center',
                        padding: '10vh 1rem 1rem 1rem',
                        animation: 'fadeIn 0.15s ease-out'
                    }}
                >
                    <div
                        onClick={(e) => e.stopPropagation()}
                        style={{
                            width: '100%',
                            maxWidth: '640px',
                            background: 'linear-gradient(135deg, rgba(10, 37, 64, 0.98) 0%, rgba(15, 23, 42, 0.98) 100%)',
                            border: '2px solid rgba(255, 215, 0, 0.4)',
                            borderRadius: '20px',
                            boxShadow: '0 25px 80px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 215, 0, 0.1)',
                            overflow: 'hidden',
                            animation: 'slideUp 0.2s ease-out'
                        }}
                    >
                        {/* Search Input */}
                        <div style={{ padding: '1.25rem', borderBottom: '1px solid rgba(255, 255, 255, 0.1)' }}>
                            <div style={{ position: 'relative' }}>
                                <span
                                    style={{
                                        position: 'absolute',
                                        left: '1rem',
                                        top: '50%',
                                        transform: 'translateY(-50%)',
                                        fontSize: '1.25rem',
                                        color: 'rgba(255, 215, 0, 0.8)'
                                    }}
                                >
                                    ‚ö°
                                </span>
                                <input
                                    ref={inputRef}
                                    type="text"
                                    placeholder="Type a command or search..."
                                    value={query}
                                    onChange={(e) => { setQuery(e.target.value); setSelectedIndex(0); }}
                                    onKeyDown={handleKeyDown}
                                    style={{
                                        width: '100%',
                                        padding: '0.875rem 1rem 0.875rem 3rem',
                                        background: 'rgba(255, 255, 255, 0.08)',
                                        border: '2px solid rgba(255, 255, 255, 0.1)',
                                        borderRadius: '12px',
                                        color: '#FFFFFF',
                                        fontSize: '1rem',
                                        fontWeight: '500',
                                        outline: 'none'
                                    }}
                                />
                                <div
                                    style={{
                                        position: 'absolute',
                                        right: '1rem',
                                        top: '50%',
                                        transform: 'translateY(-50%)',
                                        fontSize: '0.75rem',
                                        color: 'rgba(255, 255, 255, 0.4)',
                                        fontFamily: 'monospace',
                                        display: 'flex',
                                        gap: '0.5rem'
                                    }}
                                >
                                    <kbd style={{ padding: '2px 6px', background: 'rgba(255, 255, 255, 0.1)', borderRadius: '4px' }}>Esc</kbd>
                                    to close
                                </div>
                            </div>
                        </div>

                        {/* Category Tabs */}
                        <div
                            style={{
                                display: 'flex',
                                gap: '0.5rem',
                                padding: '1rem',
                                borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
                                overflowX: 'auto'
                            }}
                        >
                            {categories.map((cat) => (
                                <button
                                    key={cat.id}
                                    onClick={() => { setActiveCategory(cat.id); setSelectedIndex(0); }}
                                    style={{
                                        padding: '0.5rem 1rem',
                                        background: activeCategory === cat.id
                                            ? 'linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 165, 0, 0.1) 100%)'
                                            : 'rgba(255, 255, 255, 0.05)',
                                        border: `1.5px solid ${activeCategory === cat.id ? '#FFD700' : 'rgba(255, 255, 255, 0.1)'}`,
                                        borderRadius: '8px',
                                        color: activeCategory === cat.id ? '#FFD700' : 'rgba(255, 255, 255, 0.7)',
                                        fontSize: '0.8125rem',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        transition: 'all 0.2s ease',
                                        whiteSpace: 'nowrap',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.5rem'
                                    }}
                                >
                                    <span>{cat.icon}</span>
                                    {cat.label}
                                </button>
                            ))}
                        </div>

                        {/* Commands List */}
                        <div
                            style={{
                                maxHeight: '400px',
                                overflowY: 'auto',
                                padding: '0.5rem'
                            }}
                        >
                            {filteredCommands.length === 0 ? (
                                <div
                                    style={{
                                        padding: '3rem',
                                        textAlign: 'center',
                                        color: 'rgba(255, 255, 255, 0.5)'
                                    }}
                                >
                                    <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>üîç</div>
                                    <div style={{ fontSize: '1rem', fontWeight: '600', marginBottom: '0.5rem' }}>No commands found</div>
                                    <div style={{ fontSize: '0.875rem' }}>Try a different search term or category</div>
                                </div>
                            ) : (
                                filteredCommands.map((command, index) => (
                                    <button
                                        key={command.id}
                                        onClick={() => executeCommand(command)}
                                        onMouseEnter={() => setSelectedIndex(index)}
                                        style={{
                                            width: '100%',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'space-between',
                                            padding: '0.875rem 1rem',
                                            marginBottom: '0.5rem',
                                            background: selectedIndex === index
                                                ? 'linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 165, 0, 0.1) 100%)'
                                                : 'rgba(255, 255, 255, 0.03)',
                                            border: `1.5px solid ${selectedIndex === index ? 'rgba(255, 215, 0, 0.4)' : 'rgba(255, 255, 255, 0.08)'}`,
                                            borderRadius: '10px',
                                            cursor: 'pointer',
                                            transition: 'all 0.15s ease',
                                            textAlign: 'left'
                                        }}
                                    >
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', flex: 1 }}>
                                            <span style={{ fontSize: '1.5rem' }}>{command.icon}</span>
                                            <span
                                                style={{
                                                    fontSize: '0.875rem',
                                                    fontWeight: '500',
                                                    color: selectedIndex === index ? '#FFD700' : 'rgba(255, 255, 255, 0.9)'
                                                }}
                                            >
                                                {command.label}
                                            </span>
                                        </div>
                                        {selectedIndex === index && (
                                            <kbd
                                                style={{
                                                    padding: '4px 8px',
                                                    background: 'rgba(255, 215, 0, 0.2)',
                                                    border: '1px solid rgba(255, 215, 0, 0.3)',
                                                    borderRadius: '6px',
                                                    fontSize: '0.75rem',
                                                    color: '#FFD700',
                                                    fontFamily: 'monospace',
                                                    fontWeight: '700'
                                                }}
                                            >
                                                ‚Üµ
                                            </kbd>
                                        )}
                                    </button>
                                ))
                            )}
                        </div>

                        {/* Footer */}
                        <div
                            style={{
                                padding: '0.75rem 1rem',
                                borderTop: '1px solid rgba(255, 255, 255, 0.1)',
                                background: 'rgba(255, 255, 255, 0.03)',
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center'
                            }}
                        >
                            <div style={{ display: 'flex', gap: '1rem', fontSize: '0.75rem', color: 'rgba(255, 255, 255, 0.5)' }}>
                                <span style={{ display: 'flex', alignItems: 'center', gap: '0.25rem' }}>
                                    <kbd style={{ padding: '2px 6px', background: 'rgba(255, 255, 255, 0.1)', borderRadius: '4px', fontFamily: 'monospace' }}>‚Üë</kbd>
                                    <kbd style={{ padding: '2px 6px', background: 'rgba(255, 255, 255, 0.1)', borderRadius: '4px', fontFamily: 'monospace' }}>‚Üì</kbd>
                                    navigate
                                </span>
                                <span style={{ display: 'flex', alignItems: 'center', gap: '0.25rem' }}>
                                    <kbd style={{ padding: '2px 6px', background: 'rgba(255, 255, 255, 0.1)', borderRadius: '4px', fontFamily: 'monospace' }}>‚Üµ</kbd>
                                    select
                                </span>
                            </div>
                            <div style={{ fontSize: '0.75rem', color: 'rgba(255, 255, 255, 0.4)' }}>
                                {filteredCommands.length} command{filteredCommands.length !== 1 ? 's' : ''}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // üéâ TOAST NOTIFICATION SYSTEM - User Feedback
        const Toast = ({ toast, onDismiss }) => {
            const [isExiting, setIsExiting] = React.useState(false);

            const types = {
                success: {
                    icon: '‚úì',
                    color: '#10b981',
                    bg: 'rgba(16, 185, 129, 0.1)',
                    border: 'rgba(16, 185, 129, 0.3)'
                },
                error: {
                    icon: '‚úï',
                    color: '#ef4444',
                    bg: 'rgba(239, 68, 68, 0.1)',
                    border: 'rgba(239, 68, 68, 0.3)'
                },
                warning: {
                    icon: '‚ö†',
                    color: '#f59e0b',
                    bg: 'rgba(245, 158, 11, 0.1)',
                    border: 'rgba(245, 158, 11, 0.3)'
                },
                info: {
                    icon: '‚Ñπ',
                    color: '#3b82f6',
                    bg: 'rgba(59, 130, 246, 0.1)',
                    border: 'rgba(59, 130, 246, 0.3)'
                }
            };

            const type = types[toast.type] || types.info;

            const handleDismiss = () => {
                setIsExiting(true);
                setTimeout(() => onDismiss(toast.id), 300);
            };

            React.useEffect(() => {
                if (toast.duration) {
                    const timer = setTimeout(handleDismiss, toast.duration);
                    return () => clearTimeout(timer);
                }
            }, [toast.duration]);

            return (
                <div
                    style={{
                        display: 'flex',
                        alignItems: 'flex-start',
                        gap: '0.75rem',
                        padding: '1rem',
                        background: 'rgba(15, 23, 42, 0.95)',
                        backdropFilter: 'blur(20px)',
                        border: `2px solid ${type.border}`,
                        borderRadius: '12px',
                        boxShadow: `0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px ${type.color}20`,
                        minWidth: '320px',
                        maxWidth: '420px',
                        animation: isExiting ? 'slideOutRight 0.3s ease-out forwards' : 'slideInRight 0.3s ease-out',
                        cursor: 'pointer'
                    }}
                    onClick={handleDismiss}
                >
                    {/* Icon */}
                    <div
                        style={{
                            width: '32px',
                            height: '32px',
                            borderRadius: '8px',
                            background: type.bg,
                            border: `1px solid ${type.border}`,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            fontSize: '1.125rem',
                            color: type.color,
                            fontWeight: '700',
                            flexShrink: 0
                        }}
                    >
                        {type.icon}
                    </div>

                    {/* Content */}
                    <div style={{ flex: 1, minWidth: 0 }}>
                        {toast.title && (
                            <div
                                style={{
                                    fontSize: '0.875rem',
                                    fontWeight: '600',
                                    color: '#FFFFFF',
                                    marginBottom: '0.25rem'
                                }}
                            >
                                {toast.title}
                            </div>
                        )}
                        <div
                            style={{
                                fontSize: '0.8125rem',
                                color: 'rgba(255, 255, 255, 0.8)',
                                lineHeight: '1.4'
                            }}
                        >
                            {toast.message}
                        </div>
                    </div>

                    {/* Close button */}
                    <button
                        onClick={(e) => {
                            e.stopPropagation();
                            handleDismiss();
                        }}
                        style={{
                            width: '24px',
                            height: '24px',
                            borderRadius: '6px',
                            background: 'rgba(255, 255, 255, 0.1)',
                            border: 'none',
                            color: 'rgba(255, 255, 255, 0.6)',
                            fontSize: '0.875rem',
                            cursor: 'pointer',
                            transition: 'all 0.2s ease',
                            flexShrink: 0
                        }}
                        onMouseEnter={(e) => {
                            e.currentTarget.style.background = 'rgba(255, 255, 255, 0.2)';
                            e.currentTarget.style.color = '#FFFFFF';
                        }}
                        onMouseLeave={(e) => {
                            e.currentTarget.style.background = 'rgba(255, 255, 255, 0.1)';
                            e.currentTarget.style.color = 'rgba(255, 255, 255, 0.6)';
                        }}
                    >
                        ‚úï
                    </button>
                </div>
            );
        };

        const ToastContainer = ({ toasts, onDismiss }) => {
            if (toasts.length === 0) return null;

            return (
                <div
                    style={{
                        position: 'fixed',
                        top: '1rem',
                        right: '1rem',
                        zIndex: 10000,
                        display: 'flex',
                        flexDirection: 'column',
                        gap: '0.75rem',
                        pointerEvents: 'none'
                    }}
                >
                    {toasts.map((toast) => (
                        <div key={toast.id} style={{ pointerEvents: 'auto' }}>
                            <Toast toast={toast} onDismiss={onDismiss} />
                        </div>
                    ))}
                </div>
            );
        };

        // ‚å®Ô∏è KEYBOARD SHORTCUTS SYSTEM - Power User Features
        const KeyboardShortcutsModal = ({ isOpen, onClose }) => {
            if (!isOpen) return null;

            const shortcuts = [
                {
                    category: 'Navigation',
                    items: [
                        { keys: ['1'], description: 'Go to Command Center' },
                        { keys: ['2'], description: 'Go to Intelligence Hub' },
                        { keys: ['3'], description: 'Go to Staff Command' },
                        { keys: ['4'], description: 'Go to Financial Intelligence' },
                        { keys: ['5'], description: 'Go to Menu Intelligence' },
                        { keys: ['6'], description: 'Go to Report Center' },
                        { keys: ['7'], description: 'Go to Multi-Location' },
                        { keys: ['8'], description: 'Go to Settings' }
                    ]
                },
                {
                    category: 'Search & Actions',
                    items: [
                        { keys: ['Ctrl', 'P'], description: 'Open Command Palette' },
                        { keys: ['Ctrl', 'K'], description: 'Open global search' },
                        { keys: ['Ctrl', 'N'], description: 'Create new report' },
                        { keys: ['Ctrl', 'E'], description: 'Export data' },
                        { keys: ['Ctrl', '/'], description: 'Toggle sidebar' }
                    ]
                },
                {
                    category: 'General',
                    items: [
                        { keys: ['?'], description: 'Show keyboard shortcuts' },
                        { keys: ['Esc'], description: 'Close modals' },
                        { keys: ['Ctrl', 'Q'], description: 'Quick actions menu' }
                    ]
                }
            ];

            return (
                <div
                    onClick={onClose}
                    style={{
                        position: 'fixed',
                        inset: 0,
                        background: 'rgba(0, 0, 0, 0.7)',
                        backdropFilter: 'blur(8px)',
                        zIndex: 9999,
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        padding: '1rem',
                        animation: 'fadeIn 0.2s ease-out'
                    }}
                >
                    <div
                        onClick={(e) => e.stopPropagation()}
                        style={{
                            background: 'linear-gradient(135deg, rgba(10, 37, 64, 0.98) 0%, rgba(15, 23, 42, 0.98) 100%)',
                            border: '2px solid rgba(255, 215, 0, 0.3)',
                            borderRadius: '20px',
                            maxWidth: '800px',
                            width: '100%',
                            maxHeight: '80vh',
                            overflowY: 'auto',
                            boxShadow: '0 25px 80px rgba(0, 0, 0, 0.5)',
                            animation: 'slideUp 0.3s ease-out'
                        }}
                    >
                        {/* Header */}
                        <div
                            style={{
                                padding: '1.5rem',
                                borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
                                background: 'linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 165, 0, 0.05) 100%)'
                            }}
                        >
                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                                <div>
                                    <h2
                                        style={{
                                            margin: 0,
                                            fontSize: '1.75rem',
                                            fontWeight: '800',
                                            background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                                            WebkitBackgroundClip: 'text',
                                            WebkitTextFillColor: 'transparent',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.75rem'
                                        }}
                                    >
                                        <span>‚å®Ô∏è</span>
                                        Keyboard Shortcuts
                                    </h2>
                                    <p style={{ margin: '0.5rem 0 0 0', color: 'rgba(255, 255, 255, 0.6)', fontSize: '0.875rem' }}>
                                        Master Restalyze like a power user
                                    </p>
                                </div>
                                <button
                                    onClick={onClose}
                                    style={{
                                        width: '40px',
                                        height: '40px',
                                        borderRadius: '10px',
                                        background: 'rgba(255, 255, 255, 0.1)',
                                        border: 'none',
                                        color: '#FFFFFF',
                                        fontSize: '1.25rem',
                                        cursor: 'pointer',
                                        transition: 'all 0.2s ease'
                                    }}
                                    onMouseEnter={(e) => {
                                        e.currentTarget.style.background = 'rgba(239, 68, 68, 0.3)';
                                        e.currentTarget.style.transform = 'scale(1.05)';
                                    }}
                                    onMouseLeave={(e) => {
                                        e.currentTarget.style.background = 'rgba(255, 255, 255, 0.1)';
                                        e.currentTarget.style.transform = 'scale(1)';
                                    }}
                                >
                                    ‚úï
                                </button>
                            </div>
                        </div>

                        {/* Shortcuts List */}
                        <div style={{ padding: '1.5rem' }}>
                            {shortcuts.map((section, sectionIndex) => (
                                <div key={section.category} style={{ marginBottom: sectionIndex < shortcuts.length - 1 ? '2rem' : 0 }}>
                                    <h3
                                        style={{
                                            margin: '0 0 1rem 0',
                                            fontSize: '1rem',
                                            fontWeight: '700',
                                            color: '#FFD700',
                                            textTransform: 'uppercase',
                                            letterSpacing: '0.05em',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.5rem'
                                        }}
                                    >
                                        <span style={{ width: '4px', height: '1rem', background: '#FFD700', borderRadius: '2px' }} />
                                        {section.category}
                                    </h3>
                                    <div style={{ display: 'grid', gap: '0.75rem' }}>
                                        {section.items.map((shortcut, index) => (
                                            <div
                                                key={index}
                                                style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'space-between',
                                                    padding: '1rem',
                                                    background: 'rgba(255, 255, 255, 0.05)',
                                                    border: '1px solid rgba(255, 255, 255, 0.1)',
                                                    borderRadius: '12px',
                                                    transition: 'all 0.2s ease'
                                                }}
                                                onMouseEnter={(e) => {
                                                    e.currentTarget.style.background = 'rgba(255, 255, 255, 0.08)';
                                                    e.currentTarget.style.borderColor = 'rgba(255, 215, 0, 0.3)';
                                                    e.currentTarget.style.transform = 'translateX(4px)';
                                                }}
                                                onMouseLeave={(e) => {
                                                    e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';
                                                    e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                                                    e.currentTarget.style.transform = 'translateX(0)';
                                                }}
                                            >
                                                <span style={{ color: 'rgba(255, 255, 255, 0.9)', fontSize: '0.875rem', fontWeight: '500' }}>
                                                    {shortcut.description}
                                                </span>
                                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                                    {shortcut.keys.map((key, keyIndex) => (
                                                        <React.Fragment key={keyIndex}>
                                                            <kbd
                                                                style={{
                                                                    padding: '0.375rem 0.75rem',
                                                                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.1) 100%)',
                                                                    border: '1px solid rgba(255, 255, 255, 0.2)',
                                                                    borderRadius: '6px',
                                                                    color: '#FFFFFF',
                                                                    fontSize: '0.75rem',
                                                                    fontWeight: '700',
                                                                    fontFamily: 'monospace',
                                                                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.2)',
                                                                    minWidth: '32px',
                                                                    textAlign: 'center'
                                                                }}
                                                            >
                                                                {key}
                                                            </kbd>
                                                            {keyIndex < shortcut.keys.length - 1 && (
                                                                <span style={{ color: 'rgba(255, 255, 255, 0.4)', fontSize: '0.875rem', alignSelf: 'center' }}>+</span>
                                                            )}
                                                        </React.Fragment>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Footer */}
                        <div
                            style={{
                                padding: '1rem 1.5rem',
                                borderTop: '1px solid rgba(255, 255, 255, 0.1)',
                                background: 'rgba(255, 255, 255, 0.03)',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                gap: '0.5rem'
                            }}
                        >
                            <span style={{ fontSize: '1.25rem' }}>üí°</span>
                            <p style={{ margin: 0, color: 'rgba(255, 255, 255, 0.6)', fontSize: '0.875rem' }}>
                                Press <kbd style={{ padding: '2px 8px', background: 'rgba(255, 255, 255, 0.1)', borderRadius: '4px', fontFamily: 'monospace' }}>?</kbd> anytime to view this guide
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // ‚ö° SMART QUICK ACTIONS FAB - Power User Features
        const SmartQuickActionsFAB = ({ onOpenShortcuts, onOpenAI }) => {
            const [isOpen, setIsOpen] = React.useState(false);
            const fabRef = React.useRef(null);

            // Close FAB when clicking outside
            React.useEffect(() => {
                const handleClickOutside = (event) => {
                    if (fabRef.current && !fabRef.current.contains(event.target)) {
                        setIsOpen(false);
                    }
                };

                if (isOpen) {
                    document.addEventListener('mousedown', handleClickOutside);
                }
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, [isOpen]);

            const quickActions = [
                {
                    id: 'report',
                    icon: 'üìä',
                    label: 'Generate Report',
                    color: '#0A2540',
                    description: 'Create new report',
                    action: () => alert('Report generation coming soon!')
                },
                {
                    id: 'staff',
                    icon: 'üë§',
                    label: 'Add Staff',
                    color: '#10b981',
                    description: 'Quick add team member',
                    action: () => alert('Staff addition coming soon!')
                },
                {
                    id: 'alerts',
                    icon: 'üîî',
                    label: 'View Alerts',
                    color: '#f59e0b',
                    description: 'Check smart alerts',
                    action: () => alert('Alerts panel coming soon!')
                },
                {
                    id: 'export',
                    icon: 'üíæ',
                    label: 'Export Data',
                    color: '#0ea5e9',
                    description: 'Download reports',
                    action: () => alert('Export center coming soon!')
                },
                {
                    id: 'ai',
                    icon: 'ü§ñ',
                    label: 'AI Suggestions',
                    color: '#8b5cf6',
                    description: 'Get smart insights',
                    action: () => onOpenAI?.()
                },
                {
                    id: 'shortcuts',
                    icon: '‚å®Ô∏è',
                    label: 'Shortcuts',
                    color: '#64748b',
                    description: 'View keyboard shortcuts',
                    action: () => onOpenShortcuts?.()
                }
            ];

            const handleActionClick = (action) => {
                action.action();
                setIsOpen(false);
            };

            return (
                <div
                    ref={fabRef}
                    style={{
                        position: 'fixed',
                        bottom: '2rem',
                        right: '2rem',
                        zIndex: 1000
                    }}
                >
                    {/* Quick Actions Menu */}
                    {isOpen && (
                        <div
                            style={{
                                position: 'absolute',
                                bottom: '5rem',
                                right: '0',
                                width: '280px',
                                maxHeight: '420px',
                                overflowY: 'auto',
                                background: 'rgba(15, 23, 42, 0.95)',
                                backdropFilter: 'blur(20px)',
                                border: '2px solid rgba(255, 215, 0, 0.3)',
                                borderRadius: '16px',
                                boxShadow: '0 20px 60px rgba(0, 0, 0, 0.4)',
                                animation: 'slideUp 0.3s ease-out both'
                            }}
                        >
                            {/* Header */}
                            <div
                                style={{
                                    padding: '1rem',
                                    borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
                                    background: 'linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 165, 0, 0.05) 100%)'
                                }}
                            >
                                <h3
                                    style={{
                                        margin: 0,
                                        fontSize: '1rem',
                                        fontWeight: '700',
                                        background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                                        WebkitBackgroundClip: 'text',
                                        WebkitTextFillColor: 'transparent',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.5rem'
                                    }}
                                >
                                    <span>‚ö°</span>
                                    Quick Actions
                                </h3>
                                <p
                                    style={{
                                        margin: '0.25rem 0 0 0',
                                        fontSize: '0.75rem',
                                        color: 'rgba(255, 255, 255, 0.6)'
                                    }}
                                >
                                    Access powerful features instantly
                                </p>
                            </div>

                            {/* Action Items */}
                            <div style={{ padding: '0.5rem' }}>
                                {quickActions.map((action, index) => (
                                    <button
                                        key={action.id}
                                        onClick={() => handleActionClick(action)}
                                        style={{
                                            width: '100%',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.75rem',
                                            padding: '0.875rem',
                                            marginBottom: index < quickActions.length - 1 ? '0.5rem' : '0',
                                            background: 'rgba(255, 255, 255, 0.05)',
                                            border: `2px solid ${action.color}30`,
                                            borderRadius: '12px',
                                            cursor: 'pointer',
                                            transition: 'all 0.2s ease',
                                            textAlign: 'left',
                                            animation: `slideUp 0.3s ease-out ${index * 0.05}s both`
                                        }}
                                        onMouseEnter={(e) => {
                                            e.currentTarget.style.transform = 'translateX(-4px)';
                                            e.currentTarget.style.background = `${action.color}20`;
                                            e.currentTarget.style.borderColor = action.color;
                                            e.currentTarget.style.boxShadow = `0 4px 12px ${action.color}40`;
                                        }}
                                        onMouseLeave={(e) => {
                                            e.currentTarget.style.transform = 'translateX(0)';
                                            e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';
                                            e.currentTarget.style.borderColor = `${action.color}30`;
                                            e.currentTarget.style.boxShadow = 'none';
                                        }}
                                    >
                                        <div
                                            style={{
                                                width: '40px',
                                                height: '40px',
                                                display: 'flex',
                                                alignItems: 'center',
                                                justifyContent: 'center',
                                                borderRadius: '10px',
                                                background: `${action.color}20`,
                                                fontSize: '1.25rem',
                                                flexShrink: 0
                                            }}
                                        >
                                            {action.icon}
                                        </div>
                                        <div style={{ flex: 1, minWidth: 0 }}>
                                            <div
                                                style={{
                                                    fontSize: '0.875rem',
                                                    fontWeight: '600',
                                                    color: '#FFFFFF',
                                                    marginBottom: '0.125rem'
                                                }}
                                            >
                                                {action.label}
                                            </div>
                                            <div
                                                style={{
                                                    fontSize: '0.75rem',
                                                    color: 'rgba(255, 255, 255, 0.5)'
                                                }}
                                            >
                                                {action.description}
                                            </div>
                                        </div>
                                        <div style={{ color: action.color, fontSize: '1.125rem', flexShrink: 0 }}>‚Üí</div>
                                    </button>
                                ))}
                            </div>

                            {/* Footer Tip */}
                            <div
                                style={{
                                    padding: '0.75rem',
                                    borderTop: '1px solid rgba(255, 255, 255, 0.1)',
                                    textAlign: 'center'
                                }}
                            >
                                <p
                                    style={{
                                        margin: 0,
                                        fontSize: '0.75rem',
                                        color: 'rgba(255, 255, 255, 0.4)',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        gap: '0.5rem'
                                    }}
                                >
                                    <span>üí°</span>
                                    Press <kbd style={{ padding: '2px 6px', background: 'rgba(255, 255, 255, 0.1)', borderRadius: '4px', fontFamily: 'monospace' }}>Ctrl+K</kbd> for shortcuts
                                </p>
                            </div>
                        </div>
                    )}

                    {/* Main FAB Button */}
                    <button
                        onClick={() => setIsOpen(!isOpen)}
                        style={{
                            width: '64px',
                            height: '64px',
                            borderRadius: '50%',
                            background: isOpen
                                ? 'linear-gradient(135deg, #FFA500 0%, #FFD700 100%)'
                                : 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                            border: 'none',
                            boxShadow: isOpen
                                ? '0 8px 32px rgba(255, 215, 0, 0.5), 0 0 0 4px rgba(255, 215, 0, 0.2)'
                                : '0 8px 24px rgba(255, 215, 0, 0.4)',
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            fontSize: '1.75rem',
                            transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                            transform: isOpen ? 'rotate(135deg) scale(1.05)' : 'rotate(0deg) scale(1)',
                            position: 'relative',
                            overflow: 'visible'
                        }}
                        onMouseEnter={(e) => {
                            if (!isOpen) {
                                e.currentTarget.style.transform = 'scale(1.1)';
                                e.currentTarget.style.boxShadow = '0 12px 32px rgba(255, 215, 0, 0.6)';
                            }
                        }}
                        onMouseLeave={(e) => {
                            if (!isOpen) {
                                e.currentTarget.style.transform = 'scale(1)';
                                e.currentTarget.style.boxShadow = '0 8px 24px rgba(255, 215, 0, 0.4)';
                            }
                        }}
                        aria-label="Quick Actions"
                        title="Quick Actions"
                    >
                        <span
                            style={{
                                display: 'block',
                                transition: 'transform 0.3s ease',
                                transform: isOpen ? 'rotate(-135deg)' : 'rotate(0deg)'
                            }}
                        >
                            {isOpen ? '‚úï' : '‚ö°'}
                        </span>

                        {/* Pulse Animation Ring */}
                        {!isOpen && (
                            <span
                                style={{
                                    position: 'absolute',
                                    inset: '-8px',
                                    borderRadius: '50%',
                                    border: '2px solid #FFD700',
                                    opacity: 0,
                                    animation: 'pulse 2s infinite'
                                }}
                            />
                        )}
                    </button>

                    {/* Tooltip when closed */}
                    {!isOpen && (
                        <div
                            style={{
                                position: 'absolute',
                                bottom: '50%',
                                right: 'calc(100% + 1rem)',
                                transform: 'translateY(50%)',
                                padding: '0.5rem 0.75rem',
                                background: 'rgba(15, 23, 42, 0.95)',
                                backdropFilter: 'blur(10px)',
                                border: '1px solid rgba(255, 215, 0, 0.3)',
                                borderRadius: '8px',
                                whiteSpace: 'nowrap',
                                color: '#FFFFFF',
                                fontSize: '0.875rem',
                                fontWeight: '600',
                                opacity: 0,
                                pointerEvents: 'none',
                                transition: 'opacity 0.2s ease'
                            }}
                            className="fab-tooltip"
                        >
                            Quick Actions ‚ö°
                        </div>
                    )}
                </div>
            );
        };

        // üöÄ ENHANCED: Main App with All New Features
        const MainApp = () => {
            const { user, logout } = useAuth();
            const { selectedRestaurant, setSelectedRestaurant, restaurants, notifications, markNotificationAsRead, markAllNotificationsAsRead } = useData();
            const [activeView, setActiveView] = useState('command-center');
            const [sidebarOpen, setSidebarOpen] = useState(true);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [notificationsOpen, setNotificationsOpen] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [searchOpen, setSearchOpen] = useState(false);
            const [recentViews, setRecentViews] = useState(['command-center', 'intelligence', 'financial-intelligence']);
            const [shortcutsModalOpen, setShortcutsModalOpen] = useState(false);
            const [commandPaletteOpen, setCommandPaletteOpen] = useState(false);
            const [activityFeedOpen, setActivityFeedOpen] = useState(false);
            const [quickStatsOpen, setQuickStatsOpen] = useState(true); // Default to open
            const [aiSuggestionsOpen, setAiSuggestionsOpen] = useState(false);
            const searchInputRef = React.useRef(null);
            const [toasts, setToasts] = useState([]);

            // Toast notification helper
            const showToast = (type, message, title, duration = 4000) => {
                const id = Date.now() + Math.random();
                const toast = { id, type, message, title, duration };
                setToasts(prev => [...prev, toast]);
            };

            const dismissToast = (id) => {
                setToasts(prev => prev.filter(toast => toast.id !== id));
            };

            // üî• RESTALYZE LEGENDARY NAVIGATION - Intelligent, Consolidated Modules
            const navigation = [
                {
                    id: 'command-center',
                    label: 'Command Center',
                    icon: 'üéØ',
                    description: 'Strategic dashboard with real-time insights',
                    badge: 'LIVE',
                    color: '#FFD700'
                },
                {
                    id: 'intelligence',
                    label: 'Intelligence Hub',
                    icon: 'üß†',
                    description: 'AI predictions, recommendations & smart alerts',
                    badge: 'AI',
                    color: '#8b5cf6'
                },
                {
                    id: 'staff-command',
                    label: 'Staff Command',
                    icon: 'üë•',
                    description: 'Team management, performance & scheduling',
                    color: '#10b981'
                },
                {
                    id: 'financial-intelligence',
                    label: 'Financial Intelligence',
                    icon: 'üí∞',
                    description: 'Revenue analytics, profit optimization & forecasts',
                    color: '#0ea5e9'
                },
                {
                    id: 'menu-intelligence',
                    label: 'Menu Intelligence',
                    icon: 'üçΩÔ∏è',
                    description: 'Performance analysis & strategic recommendations',
                    color: '#f59e0b'
                },
                {
                    id: 'reports',
                    label: 'Report Center',
                    icon: 'üìä',
                    description: 'Professional reports & business intelligence',
                    color: '#0A2540'
                },
                {
                    id: 'multi-location',
                    label: 'Multi-Location',
                    icon: 'üè¢',
                    description: 'Branch management & performance comparison',
                    color: '#64748b'
                },
                {
                    id: 'settings',
                    label: 'Settings',
                    icon: '‚öôÔ∏è',
                    description: 'Platform configuration & user preferences',
                    color: '#94a3b8'
                }
            ];

            const unreadNotifications = notifications.filter(n => !n.read).length;

            // Track recent views and show welcome toast
            React.useEffect(() => {
                if (activeView && !recentViews.includes(activeView)) {
                    setRecentViews(prev => [activeView, ...prev.filter(v => v !== activeView).slice(0, 4)]);
                }
            }, [activeView]);

            // Welcome toast on mount
            React.useEffect(() => {
                showToast('success', `Welcome back, ${user?.name}! Your dashboard is ready.`, 'Welcome to Restalyze', 5000);
            }, []);

            // Global search handler
            const handleSearch = (query) => {
                setSearchQuery(query);
                // In a real app, this would search across all modules
                // For now, we'll just filter navigation items
            };

            // Get search results
            const searchResults = React.useMemo(() => {
                if (!searchQuery.trim()) return [];
                const query = searchQuery.toLowerCase();
                return navigation.filter(nav =>
                    nav.label.toLowerCase().includes(query) ||
                    nav.description.toLowerCase().includes(query)
                );
            }, [searchQuery]);

            // ‚å®Ô∏è KEYBOARD SHORTCUTS HANDLER
            React.useEffect(() => {
                const handleKeyDown = (e) => {
                    // Escape key - Close modals
                    if (e.key === 'Escape') {
                        setShortcutsModalOpen(false);
                        setCommandPaletteOpen(false);
                        setSearchOpen(false);
                        setNotificationsOpen(false);
                    }

                    // Ctrl+P or Ctrl+Shift+P - Open Command Palette
                    if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                        e.preventDefault();
                        setCommandPaletteOpen(true);
                    }

                    // ? key - Show shortcuts
                    if (e.key === '?' && !e.ctrlKey && !e.metaKey) {
                        const target = e.target;
                        if (target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA') {
                            e.preventDefault();
                            setShortcutsModalOpen(true);
                        }
                    }

                    // Ctrl+K - Focus search
                    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                        e.preventDefault();
                        searchInputRef.current?.focus();
                        setSearchOpen(true);
                    }

                    // Ctrl+N - New report
                    if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                        e.preventDefault();
                        setActiveView('reports');
                        showToast('success', 'Navigated to Reports', 'Quick Action');
                    }

                    // Ctrl+E - Export
                    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                        e.preventDefault();
                        showToast('info', 'Export feature is under development', 'Coming Soon');
                    }

                    // Ctrl+/ - Toggle sidebar
                    if ((e.ctrlKey || e.metaKey) && e.key === '/') {
                        e.preventDefault();
                        setSidebarOpen(prev => !prev);
                        showToast('success', prev ? 'Sidebar collapsed' : 'Sidebar expanded', 'View Changed');
                    }

                    // Ctrl+Q - Quick actions (placeholder for FAB)
                    if ((e.ctrlKey || e.metaKey) && e.key === 'q') {
                        e.preventDefault();
                        alert('Quick actions shortcut triggered! The FAB will handle this.');
                    }

                    // Number keys 1-8 - Navigate to modules
                    if (!e.ctrlKey && !e.metaKey && !e.altKey) {
                        const target = e.target;
                        if (target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA') {
                            const num = parseInt(e.key);
                            if (num >= 1 && num <= 8) {
                                e.preventDefault();
                                const navItem = navigation[num - 1];
                                if (navItem) {
                                    setActiveView(navItem.id);
                                }
                            }
                        }
                    }
                };

                document.addEventListener('keydown', handleKeyDown);
                return () => document.removeEventListener('keydown', handleKeyDown);
            }, [navigation]);

            // üî• INTELLIGENT MODULE ROUTING
            const renderContent = () => {
                switch (activeView) {
                    // Command Center - Strategic Dashboard
                    case 'command-center':
                        return <CommandCenterDashboard />;

                    // Intelligence Hub - AI + Predictive + Alerts
                    case 'intelligence':
                        return <IntelligenceHub />;

                    // Staff Command - Unified Staff Management
                    case 'staff-command':
                        return <StaffCommandCenter />;

                    // Financial Intelligence - Merged Financial Analytics
                    case 'financial-intelligence':
                        return <FinancialIntelligence />;

                    // Menu Intelligence - Strategic Menu Analysis
                    case 'menu-intelligence':
                        return <MenuIntelligence />;

                    // Report Center - Professional Reports
                    case 'reports':
                        return <AdvancedReportGenerator />;

                    // Multi-Location - Branch Management
                    case 'multi-location':
                        return <MultiLocationManager />;

                    // Settings - Platform Configuration
                    case 'settings':
                        return <PlatformSettings />;

                    // Fallback to Command Center
                    default:
                        return <CommandCenterDashboard />;
                }
            };

            return (
                <div className="min-h-screen flex">
                    {/* Mobile Overlay */}
                    {mobileMenuOpen && (
                        <div 
                            className="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"
                            onClick={() => setMobileMenuOpen(false)}
                        ></div>
                    )}

                    {/* Enhanced Sidebar */}
                    <aside className={`${sidebarOpen ? 'w-64' : 'w-20'} ${mobileMenuOpen ? 'translate-x-0' : '-translate-x-full'} lg:translate-x-0 bg-white/10 backdrop-blur-lg border-r border-white/10 transition-all duration-300 flex flex-col fixed lg:relative h-full z-50 sidebar`}>
                        <div className="p-4 border-b border-white/10">
                            {sidebarOpen ? (
                                <div className="flex items-center space-x-3">
                                    <div className="w-10 h-10 bg-primary rounded-lg flex items-center justify-center text-white font-bold">
                                        N
                                    </div>
                                    <div>
                                        <h1 className="text-brand-gold font-bold text-2xl">Restalyze</h1>
                                        <p className="text-white/60 text-xs">Legendary Edition</p>
                                    </div>
                                </div>
                            ) : (
                                <div className="w-10 h-10 bg-primary rounded-lg flex items-center justify-center text-white font-bold mx-auto">
                                    N
                                </div>
                            )}
                        </div>
                        
                        <div className="flex-1 p-4 overflow-y-auto">
                            <nav className="space-y-1">
                                {navigation.map(item => (
                                    <button
                                        key={item.id}
                                        onClick={() => {
                                            setActiveView(item.id);
                                            setMobileMenuOpen(false);
                                        }}
                                        className={`w-full flex items-center space-x-3 px-3 py-3 rounded-lg transition-all sidebar-item ${
                                            activeView === item.id ? 'active' : ''
                                        }`}
                                        style={{
                                            borderLeft: activeView === item.id ? `4px solid ${item.color || '#FFD700'}` : '4px solid transparent'
                                        }}
                                    >
                                        <span className="text-lg flex-shrink-0">{item.icon}</span>
                                        {sidebarOpen && (
                                            <div className="flex-1 min-w-0 text-left">
                                                <div className="flex items-center justify-between">
                                                    <div className="text-enhanced font-medium">{item.label}</div>
                                                    {item.badge && (
                                                        <span
                                                            style={{
                                                                fontSize: '0.625rem',
                                                                fontWeight: '700',
                                                                padding: '2px 6px',
                                                                borderRadius: '4px',
                                                                backgroundColor: item.color || '#FFD700',
                                                                color: '#FFFFFF',
                                                                letterSpacing: '0.5px'
                                                            }}
                                                        >
                                                            {item.badge}
                                                        </span>
                                                    )}
                                                </div>
                                                <div className="text-secondary text-xs">{item.description}</div>
                                            </div>
                                        )}
                                    </button>
                                ))}
                            </nav>
                        </div>
                        
                        <div className="p-4 border-t border-white/10">
                            <div className="flex items-center space-x-3 mb-4">
                                <img 
                                    src={user?.avatar} 
                                    alt={user?.name}
                                    className="w-10 h-10 rounded-full flex-shrink-0"
                                />
                                {sidebarOpen && (
                                    <div className="flex-1 min-w-0">
                                        <p className="text-enhanced font-medium truncate">{user?.name}</p>
                                        <p className="text-secondary text-xs truncate">{user?.role}</p>
                                    </div>
                                )}
                            </div>
                            
                            <button
                                onClick={logout}
                                className="w-full flex items-center space-x-3 px-3 py-2 sidebar-item"
                            >
                                <span>üö™</span>
                                {sidebarOpen && <span className="text-enhanced">Logout</span>}
                            </button>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <div className="flex-1 flex flex-col lg:ml-0">
                        <header className="bg-white/10 backdrop-blur-lg border-b border-white/10">
                            {/* Top Row - Main Header */}
                            <div className="p-4">
                                <div className="flex items-center justify-between gap-4">
                                    {/* Left: Mobile Menu + Title */}
                                    <div className="flex items-center space-x-4 min-w-0">
                                        <button
                                            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                                            className="text-white p-2 hover:bg-white/10 rounded-lg transition-colors lg:hidden flex-shrink-0"
                                        >
                                            <span>‚â°</span>
                                        </button>

                                        <div className="flex items-center space-x-3 min-w-0 hidden lg:flex">
                                            {selectedRestaurant?.customLogo ? (
                                                <img
                                                    src={selectedRestaurant.customLogo}
                                                    alt={`${selectedRestaurant.name} logo`}
                                                    className="w-10 h-10 rounded-lg object-cover flex-shrink-0"
                                                />
                                            ) : (
                                                <div className="text-2xl flex-shrink-0">{selectedRestaurant?.logo}</div>
                                            )}
                                            <div className="min-w-0">
                                                <h1 className="text-enhanced font-semibold truncate">
                                                    {navigation.find(nav => nav.id === activeView)?.label || 'Dashboard'}
                                                </h1>
                                                <p className="text-secondary text-sm truncate">
                                                    {selectedRestaurant?.name || 'No restaurant selected'}
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Center: Global Search */}
                                    <div className="flex-1 max-w-xl hidden md:block">
                                        <div className="relative">
                                            <div className="relative">
                                                <span
                                                    style={{
                                                        position: 'absolute',
                                                        left: '1rem',
                                                        top: '50%',
                                                        transform: 'translateY(-50%)',
                                                        color: 'rgba(255, 255, 255, 0.5)',
                                                        fontSize: '1.125rem',
                                                        pointerEvents: 'none'
                                                    }}
                                                >
                                                    üîç
                                                </span>
                                                <input
                                                    ref={searchInputRef}
                                                    type="text"
                                                    placeholder="Search modules, features, data... (Ctrl+K)"
                                                    value={searchQuery}
                                                    onChange={(e) => handleSearch(e.target.value)}
                                                    onFocus={() => setSearchOpen(true)}
                                                    style={{
                                                        width: '100%',
                                                        padding: '0.75rem 1rem 0.75rem 3rem',
                                                        background: 'rgba(255, 255, 255, 0.08)',
                                                        border: '2px solid rgba(255, 255, 255, 0.1)',
                                                        borderRadius: '12px',
                                                        color: '#FFFFFF',
                                                        fontSize: '0.875rem',
                                                        outline: 'none',
                                                        transition: 'all 0.2s ease'
                                                    }}
                                                    onFocusCapture={(e) => {
                                                        e.target.style.background = 'rgba(255, 255, 255, 0.12)';
                                                        e.target.style.borderColor = '#FFD700';
                                                        e.target.style.boxShadow = '0 0 0 3px rgba(255, 215, 0, 0.2)';
                                                    }}
                                                    onBlur={(e) => {
                                                        e.target.style.background = 'rgba(255, 255, 255, 0.08)';
                                                        e.target.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                                                        e.target.style.boxShadow = 'none';
                                                        setTimeout(() => setSearchOpen(false), 200);
                                                    }}
                                                />
                                                {searchQuery && (
                                                    <button
                                                        onClick={() => { setSearchQuery(''); setSearchOpen(false); }}
                                                        style={{
                                                            position: 'absolute',
                                                            right: '1rem',
                                                            top: '50%',
                                                            transform: 'translateY(-50%)',
                                                            color: 'rgba(255, 255, 255, 0.5)',
                                                            background: 'none',
                                                            border: 'none',
                                                            cursor: 'pointer',
                                                            fontSize: '1.25rem'
                                                        }}
                                                    >
                                                        ‚úï
                                                    </button>
                                                )}
                                            </div>

                                            {/* Search Results Dropdown */}
                                            {searchOpen && searchResults.length > 0 && (
                                                <div
                                                    style={{
                                                        position: 'absolute',
                                                        top: 'calc(100% + 0.5rem)',
                                                        left: 0,
                                                        right: 0,
                                                        background: 'rgba(15, 23, 42, 0.95)',
                                                        backdropFilter: 'blur(20px)',
                                                        border: '2px solid rgba(255, 215, 0, 0.3)',
                                                        borderRadius: '12px',
                                                        boxShadow: '0 20px 60px rgba(0, 0, 0, 0.4)',
                                                        maxHeight: '400px',
                                                        overflowY: 'auto',
                                                        zIndex: 1000
                                                    }}
                                                >
                                                    <div style={{ padding: '0.5rem' }}>
                                                        {searchResults.map((result) => (
                                                            <button
                                                                key={result.id}
                                                                onClick={() => {
                                                                    setActiveView(result.id);
                                                                    setSearchQuery('');
                                                                    setSearchOpen(false);
                                                                }}
                                                                style={{
                                                                    width: '100%',
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    gap: '0.75rem',
                                                                    padding: '0.875rem',
                                                                    marginBottom: '0.5rem',
                                                                    background: 'rgba(255, 255, 255, 0.05)',
                                                                    border: `2px solid ${result.color}30`,
                                                                    borderRadius: '10px',
                                                                    cursor: 'pointer',
                                                                    transition: 'all 0.2s ease',
                                                                    textAlign: 'left'
                                                                }}
                                                                onMouseEnter={(e) => {
                                                                    e.currentTarget.style.background = `${result.color}20`;
                                                                    e.currentTarget.style.borderColor = result.color;
                                                                    e.currentTarget.style.transform = 'translateX(4px)';
                                                                }}
                                                                onMouseLeave={(e) => {
                                                                    e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';
                                                                    e.currentTarget.style.borderColor = `${result.color}30`;
                                                                    e.currentTarget.style.transform = 'translateX(0)';
                                                                }}
                                                            >
                                                                <span style={{ fontSize: '1.5rem' }}>{result.icon}</span>
                                                                <div style={{ flex: 1 }}>
                                                                    <div style={{ color: '#FFFFFF', fontWeight: '600', marginBottom: '0.125rem' }}>
                                                                        {result.label}
                                                                    </div>
                                                                    <div style={{ color: 'rgba(255, 255, 255, 0.5)', fontSize: '0.75rem' }}>
                                                                        {result.description}
                                                                    </div>
                                                                </div>
                                                                {result.badge && (
                                                                    <span
                                                                        style={{
                                                                            fontSize: '0.625rem',
                                                                            fontWeight: '700',
                                                                            padding: '2px 6px',
                                                                            borderRadius: '4px',
                                                                            backgroundColor: result.color,
                                                                            color: '#FFFFFF'
                                                                        }}
                                                                    >
                                                                        {result.badge}
                                                                    </span>
                                                                )}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Right: Actions */}
                                    <div className="flex items-center space-x-3 flex-shrink-0">
                                        {/* Search Icon for Mobile */}
                                        <button
                                            onClick={() => setSearchOpen(!searchOpen)}
                                            className="p-2 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors md:hidden"
                                        >
                                            <span>üîç</span>
                                        </button>

                                        {/* Restaurant Selector */}
                                        {restaurants.length > 0 && (
                                            <select
                                                value={selectedRestaurant?.id || ''}
                                                onChange={(e) => {
                                                    const restaurant = restaurants.find(r => r.id === e.target.value);
                                                    if (restaurant) setSelectedRestaurant(restaurant);
                                                }}
                                                className="enhanced-dropdown rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50 hidden sm:block"
                                                style={{ maxWidth: '200px' }}
                                            >
                                                <option value="">Select Restaurant</option>
                                                {restaurants.map(restaurant => (
                                                    <option key={restaurant.id} value={restaurant.id}>
                                                        {restaurant.name}
                                                    </option>
                                                ))}
                                            </select>
                                        )}

                                        {/* Activity Feed */}
                                        <button
                                            onClick={() => setActivityFeedOpen(!activityFeedOpen)}
                                            className="relative p-2 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors"
                                            title="Live Activity Feed"
                                        >
                                            <span>üì°</span>
                                            <div
                                                style={{
                                                    position: 'absolute',
                                                    top: '6px',
                                                    right: '6px',
                                                    width: '6px',
                                                    height: '6px',
                                                    borderRadius: '50%',
                                                    background: '#10b981',
                                                    animation: 'pulse 2s infinite'
                                                }}
                                            />
                                        </button>

                                        {/* Notifications */}
                                        <div className="relative">
                                            <button
                                                onClick={() => setNotificationsOpen(!notificationsOpen)}
                                                className="relative p-2 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors"
                                            >
                                                <span>üîî</span>
                                                {unreadNotifications > 0 && (
                                                    <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">
                                                        {unreadNotifications}
                                                    </span>
                                                )}
                                            </button>

                                            {notificationsOpen && (
                                                <div
                                                    style={{
                                                        position: 'absolute',
                                                        right: 0,
                                                        top: '3rem',
                                                        width: '400px',
                                                        maxHeight: '600px',
                                                        background: 'linear-gradient(135deg, rgba(10, 37, 64, 0.98) 0%, rgba(15, 23, 42, 0.98) 100%)',
                                                        backdropFilter: 'blur(20px)',
                                                        border: '2px solid rgba(255, 215, 0, 0.3)',
                                                        borderRadius: '16px',
                                                        boxShadow: '0 20px 60px rgba(0, 0, 0, 0.4)',
                                                        overflow: 'hidden',
                                                        zIndex: 50,
                                                        animation: 'slideUp 0.2s ease-out'
                                                    }}
                                                >
                                                    {/* Header */}
                                                    <div
                                                        style={{
                                                            padding: '1rem',
                                                            borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
                                                            background: 'linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 165, 0, 0.05) 100%)'
                                                        }}
                                                    >
                                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                            <h3
                                                                style={{
                                                                    margin: 0,
                                                                    fontSize: '1rem',
                                                                    fontWeight: '700',
                                                                    color: '#FFFFFF',
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    gap: '0.5rem'
                                                                }}
                                                            >
                                                                üîî Notifications
                                                                {unreadNotifications > 0 && (
                                                                    <span
                                                                        style={{
                                                                            fontSize: '0.75rem',
                                                                            padding: '2px 8px',
                                                                            borderRadius: '10px',
                                                                            background: '#ef4444',
                                                                            color: '#FFFFFF',
                                                                            fontWeight: '700'
                                                                        }}
                                                                    >
                                                                        {unreadNotifications}
                                                                    </span>
                                                                )}
                                                            </h3>
                                                            <button
                                                                onClick={(e) => { e.stopPropagation(); markAllNotificationsAsRead(); }}
                                                                style={{
                                                                    padding: '0.375rem 0.75rem',
                                                                    background: 'rgba(255, 255, 255, 0.1)',
                                                                    border: '1px solid rgba(255, 255, 255, 0.2)',
                                                                    borderRadius: '6px',
                                                                    color: '#FFD700',
                                                                    fontSize: '0.75rem',
                                                                    fontWeight: '600',
                                                                    cursor: 'pointer',
                                                                    transition: 'all 0.2s ease'
                                                                }}
                                                                onMouseEnter={(e) => {
                                                                    e.currentTarget.style.background = 'rgba(255, 215, 0, 0.2)';
                                                                }}
                                                                onMouseLeave={(e) => {
                                                                    e.currentTarget.style.background = 'rgba(255, 255, 255, 0.1)';
                                                                }}
                                                            >
                                                                Mark all read
                                                            </button>
                                                        </div>
                                                    </div>

                                                    {/* Notifications List */}
                                                    <div style={{ maxHeight: '500px', overflowY: 'auto' }}>
                                                        {notifications.slice(0, 5).map((notification, index) => (
                                                            <div
                                                                key={notification.id}
                                                                style={{
                                                                    padding: '1rem',
                                                                    borderBottom: '1px solid rgba(255, 255, 255, 0.08)',
                                                                    background: !notification.read ? 'rgba(255, 215, 0, 0.05)' : 'transparent',
                                                                    borderLeft: !notification.read ? '3px solid #FFD700' : '3px solid transparent',
                                                                    transition: 'all 0.2s ease',
                                                                    animation: `slideUp 0.2s ease-out ${index * 0.05}s both`
                                                                }}
                                                                onMouseEnter={(e) => {
                                                                    e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';
                                                                }}
                                                                onMouseLeave={(e) => {
                                                                    e.currentTarget.style.background = !notification.read ? 'rgba(255, 215, 0, 0.05)' : 'transparent';
                                                                }}
                                                            >
                                                                {/* Notification Header */}
                                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.5rem' }}>
                                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', flex: 1 }}>
                                                                        <span
                                                                            style={{
                                                                                fontSize: '0.875rem',
                                                                                fontWeight: '600',
                                                                                color: '#FFFFFF'
                                                                            }}
                                                                        >
                                                                            {notification.title}
                                                                        </span>
                                                                        {!notification.read && (
                                                                            <span
                                                                                style={{
                                                                                    width: '6px',
                                                                                    height: '6px',
                                                                                    borderRadius: '50%',
                                                                                    background: '#FFD700',
                                                                                    flexShrink: 0
                                                                                }}
                                                                            />
                                                                        )}
                                                                    </div>
                                                                    <span
                                                                        style={{
                                                                            fontSize: '0.6875rem',
                                                                            color: 'rgba(255, 255, 255, 0.5)',
                                                                            whiteSpace: 'nowrap'
                                                                        }}
                                                                    >
                                                                        {new Date(notification.timestamp).toLocaleTimeString()}
                                                                    </span>
                                                                </div>

                                                                {/* Notification Message */}
                                                                <p
                                                                    style={{
                                                                        margin: '0 0 0.75rem 0',
                                                                        fontSize: '0.8125rem',
                                                                        color: 'rgba(255, 255, 255, 0.7)',
                                                                        lineHeight: '1.4'
                                                                    }}
                                                                >
                                                                    {notification.message}
                                                                </p>

                                                                {/* Action Buttons */}
                                                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            markNotificationAsRead(notification.id);
                                                                            showToast('success', 'Opening details...', 'Notification');
                                                                        }}
                                                                        style={{
                                                                            flex: 1,
                                                                            padding: '0.5rem',
                                                                            background: 'linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 165, 0, 0.1) 100%)',
                                                                            border: '1.5px solid rgba(255, 215, 0, 0.3)',
                                                                            borderRadius: '6px',
                                                                            color: '#FFD700',
                                                                            fontSize: '0.75rem',
                                                                            fontWeight: '600',
                                                                            cursor: 'pointer',
                                                                            transition: 'all 0.2s ease'
                                                                        }}
                                                                        onMouseEnter={(e) => {
                                                                            e.currentTarget.style.background = 'linear-gradient(135deg, rgba(255, 215, 0, 0.25) 0%, rgba(255, 165, 0, 0.15) 100%)';
                                                                            e.currentTarget.style.transform = 'translateY(-1px)';
                                                                        }}
                                                                        onMouseLeave={(e) => {
                                                                            e.currentTarget.style.background = 'linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 165, 0, 0.1) 100%)';
                                                                            e.currentTarget.style.transform = 'translateY(0)';
                                                                        }}
                                                                    >
                                                                        View Details ‚Üí
                                                                    </button>
                                                                    {!notification.read && (
                                                                        <button
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                markNotificationAsRead(notification.id);
                                                                            }}
                                                                            style={{
                                                                                padding: '0.5rem 0.75rem',
                                                                                background: 'rgba(255, 255, 255, 0.05)',
                                                                                border: '1px solid rgba(255, 255, 255, 0.1)',
                                                                                borderRadius: '6px',
                                                                                color: 'rgba(255, 255, 255, 0.6)',
                                                                                fontSize: '0.75rem',
                                                                                cursor: 'pointer',
                                                                                transition: 'all 0.2s ease'
                                                                            }}
                                                                            onMouseEnter={(e) => {
                                                                                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.1)';
                                                                                e.currentTarget.style.color = '#FFFFFF';
                                                                            }}
                                                                            onMouseLeave={(e) => {
                                                                                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';
                                                                                e.currentTarget.style.color = 'rgba(255, 255, 255, 0.6)';
                                                                            }}
                                                                            title="Mark as read"
                                                                        >
                                                                            ‚úì
                                                                        </button>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        ))}
                                                        {notifications.length === 0 && (
                                                            <div
                                                                style={{
                                                                    padding: '3rem',
                                                                    textAlign: 'center',
                                                                    color: 'rgba(255, 255, 255, 0.5)'
                                                                }}
                                                            >
                                                                <div style={{ fontSize: '3rem', marginBottom: '0.5rem' }}>‚ú®</div>
                                                                <div style={{ fontSize: '0.875rem' }}>No notifications</div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Bottom Row - Quick Navigation */}
                            <div
                                style={{
                                    padding: '0.75rem 1rem',
                                    borderTop: '1px solid rgba(255, 255, 255, 0.1)',
                                    background: 'rgba(255, 255, 255, 0.03)',
                                    display: 'flex',
                                    gap: '0.75rem',
                                    overflowX: 'auto',
                                    scrollbarWidth: 'thin'
                                }}
                            >
                                {/* Recent Views */}
                                <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                                    <span style={{ color: 'rgba(255, 255, 255, 0.6)', fontSize: '0.75rem', fontWeight: '600', whiteSpace: 'nowrap' }}>
                                        RECENT:
                                    </span>
                                    {recentViews.slice(0, 4).map((viewId) => {
                                        const navItem = navigation.find(n => n.id === viewId);
                                        if (!navItem) return null;
                                        return (
                                            <button
                                                key={viewId}
                                                onClick={() => setActiveView(viewId)}
                                                style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: '0.375rem',
                                                    padding: '0.375rem 0.75rem',
                                                    background: activeView === viewId
                                                        ? `linear-gradient(135deg, ${navItem.color}40 0%, ${navItem.color}20 100%)`
                                                        : 'rgba(255, 255, 255, 0.05)',
                                                    border: `1.5px solid ${activeView === viewId ? navItem.color : 'rgba(255, 255, 255, 0.1)'}`,
                                                    borderRadius: '8px',
                                                    color: '#FFFFFF',
                                                    fontSize: '0.75rem',
                                                    fontWeight: '600',
                                                    cursor: 'pointer',
                                                    transition: 'all 0.2s ease',
                                                    whiteSpace: 'nowrap'
                                                }}
                                                onMouseEnter={(e) => {
                                                    e.currentTarget.style.background = `linear-gradient(135deg, ${navItem.color}40 0%, ${navItem.color}20 100%)`;
                                                    e.currentTarget.style.borderColor = navItem.color;
                                                    e.currentTarget.style.transform = 'translateY(-2px)';
                                                }}
                                                onMouseLeave={(e) => {
                                                    if (activeView !== viewId) {
                                                        e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';
                                                        e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                                                    }
                                                    e.currentTarget.style.transform = 'translateY(0)';
                                                }}
                                            >
                                                <span>{navItem.icon}</span>
                                                <span className="hidden sm:inline">{navItem.label}</span>
                                            </button>
                                        );
                                    })}
                                </div>

                                {/* Divider */}
                                <div style={{ width: '1px', background: 'rgba(255, 255, 255, 0.1)', margin: '0 0.5rem' }} />

                                {/* Quick Actions Chips */}
                                <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                                    <button
                                        onClick={() => setActiveView('reports')}
                                        style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.375rem',
                                            padding: '0.375rem 0.75rem',
                                            background: 'rgba(255, 255, 255, 0.05)',
                                            border: '1.5px solid rgba(255, 255, 255, 0.1)',
                                            borderRadius: '8px',
                                            color: '#FFFFFF',
                                            fontSize: '0.75rem',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            transition: 'all 0.2s ease',
                                            whiteSpace: 'nowrap'
                                        }}
                                        onMouseEnter={(e) => {
                                            e.currentTarget.style.background = 'rgba(255, 215, 0, 0.2)';
                                            e.currentTarget.style.borderColor = '#FFD700';
                                        }}
                                        onMouseLeave={(e) => {
                                            e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';
                                            e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                                        }}
                                    >
                                        <span>üìä</span>
                                        <span className="hidden sm:inline">New Report</span>
                                    </button>

                                    <button
                                        onClick={() => alert('Export feature coming soon!')}
                                        style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.375rem',
                                            padding: '0.375rem 0.75rem',
                                            background: 'rgba(255, 255, 255, 0.05)',
                                            border: '1.5px solid rgba(255, 255, 255, 0.1)',
                                            borderRadius: '8px',
                                            color: '#FFFFFF',
                                            fontSize: '0.75rem',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            transition: 'all 0.2s ease',
                                            whiteSpace: 'nowrap'
                                        }}
                                        onMouseEnter={(e) => {
                                            e.currentTarget.style.background = 'rgba(14, 165, 233, 0.2)';
                                            e.currentTarget.style.borderColor = '#0ea5e9';
                                        }}
                                        onMouseLeave={(e) => {
                                            e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';
                                            e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                                        }}
                                    >
                                        <span>üíæ</span>
                                        <span className="hidden sm:inline">Export</span>
                                    </button>
                                </div>
                            </div>
                        </header>

                        <main className="flex-1 overflow-y-auto">
                            {renderContent()}
                        </main>
                    </div>

                    {/* Smart Quick Actions FAB */}
                    <SmartQuickActionsFAB
                        onOpenShortcuts={() => setShortcutsModalOpen(true)}
                        onOpenAI={() => setAiSuggestionsOpen(true)}
                    />

                    {/* Keyboard Shortcuts Modal */}
                    <KeyboardShortcutsModal
                        isOpen={shortcutsModalOpen}
                        onClose={() => setShortcutsModalOpen(false)}
                    />

                    {/* Command Palette */}
                    <CommandPalette
                        isOpen={commandPaletteOpen}
                        onClose={() => setCommandPaletteOpen(false)}
                        onNavigate={(view) => setActiveView(view)}
                        showToast={showToast}
                    />

                    {/* Live Activity Feed */}
                    <LiveActivityFeed
                        isOpen={activityFeedOpen}
                        onClose={() => setActivityFeedOpen(false)}
                    />

                    {/* Quick Stats Widget */}
                    <QuickStatsWidget
                        isOpen={quickStatsOpen}
                        onClose={() => setQuickStatsOpen(false)}
                    />

                    {/* AI Smart Suggestions Panel */}
                    <SmartSuggestionsPanel
                        isOpen={aiSuggestionsOpen}
                        onClose={() => setAiSuggestionsOpen(false)}
                        showToast={showToast}
                    />

                    {/* Toast Notifications */}
                    <ToastContainer toasts={toasts} onDismiss={dismissToast} />
                </div>
            );
        };

        // Enhanced Login Component
        const LoginScreen = () => {
            const { login } = useAuth();
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                
                try {
                    await login(email, password);
                } catch (err) {
                    setError('Invalid credentials. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="glass-effect rounded-2xl p-8 w-full max-w-md">
                        <div className="text-center mb-8">
                            <h1 className="text-3xl font-bold text-brand-gold mb-2">Restalyze</h1>
                            <p className="text-white/60">Legendary Restaurant Management Platform</p>
                        </div>
                        
                        <form onSubmit={handleSubmit} className="space-y-6">
                            {error && (
                                <div className="bg-red-500/20 border border-red-500/50 text-red-200 px-4 py-3 rounded-lg">
                                    {error}
                                </div>
                            )}
                            
                            <div>
                                <label className="block text-white/80 text-sm font-medium mb-2">
                                    Email Address
                                </label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-primary/50"
                                    placeholder="Enter your email"
                                    required
                                />
                            </div>
                            
                            <div>
                                <label className="block text-white/80 text-sm font-medium mb-2">
                                    Password
                                </label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-primary/50"
                                    placeholder="Enter your password"
                                    required
                                />
                                <div className="text-xs text-white/60 mt-2">
                                    Demo password: {APP_CONFIG.defaultPassword}
                                </div>
                            </div>
                            
                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full bg-primary text-white py-3 px-4 rounded-lg hover:bg-primary/90 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed btn-primary"
                            >
                                {loading ? 'Signing In...' : 'Sign In'}
                            </button>
                        </form>
                        
                        <div className="mt-8 text-center text-white/60 text-sm">
                            <p>Version {APP_CONFIG.version} ‚Ä¢ Legendary Restaurant Analytics</p>
                        </div>
                    </div>
                </div>
            );
        };

        // Root App Component
        // üåü LEGENDARY LANDING PAGE - Product Showcase
        const LandingPage = ({ onGetStarted }) => {
            const [activeFeature, setActiveFeature] = React.useState(0);

            const features = [
                {
                    title: 'Command Center',
                    icon: 'üéØ',
                    description: 'Real-time strategic dashboard with live insights',
                    color: '#FFD700'
                },
                {
                    title: 'Intelligence Hub',
                    icon: 'üß†',
                    description: 'AI-powered predictions and smart recommendations',
                    color: '#8b5cf6'
                },
                {
                    title: 'Financial Intelligence',
                    icon: 'üí∞',
                    description: 'Complete revenue analytics and profit optimization',
                    color: '#0ea5e9'
                },
                {
                    title: 'Staff Command',
                    icon: 'üë•',
                    description: 'Unified team management and performance tracking',
                    color: '#10b981'
                }
            ];

            React.useEffect(() => {
                const interval = setInterval(() => {
                    setActiveFeature(prev => (prev + 1) % features.length);
                }, 3000);
                return () => clearInterval(interval);
            }, []);

            return (
                <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 50%, #0A2540 100%)', overflow: 'hidden', position: 'relative' }}>
                    {/* Animated Background Shapes */}
                    <div style={{ position: 'absolute', top: '10%', left: '5%', width: '300px', height: '300px', borderRadius: '50%', background: 'radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%)', animation: 'float 6s ease-in-out infinite' }}></div>
                    <div style={{ position: 'absolute', bottom: '10%', right: '10%', width: '400px', height: '400px', borderRadius: '50%', background: 'radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%)', animation: 'float 8s ease-in-out infinite', animationDelay: '2s' }}></div>

                    {/* Content */}
                    <div style={{ position: 'relative', zIndex: 10, padding: '2rem' }}>
                        {/* Header */}
                        <header style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '1rem 2rem', maxWidth: '1400px', margin: '0 auto' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                                <span style={{ fontSize: '2.5rem' }}>üçΩÔ∏è</span>
                                <h1 style={{ fontSize: '2rem', fontWeight: '800', background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>
                                    Restalyze
                                </h1>
                            </div>
                            <button
                                onClick={onGetStarted}
                                style={{
                                    padding: '0.75rem 2rem',
                                    background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                                    color: '#0A2540',
                                    fontWeight: '700',
                                    borderRadius: '0.75rem',
                                    border: 'none',
                                    cursor: 'pointer',
                                    fontSize: '1rem',
                                    boxShadow: '0 4px 12px rgba(255, 215, 0, 0.4)',
                                    transition: 'all 0.3s ease'
                                }}
                                onMouseOver={(e) => {
                                    e.currentTarget.style.transform = 'translateY(-2px)';
                                    e.currentTarget.style.boxShadow = '0 6px 20px rgba(255, 215, 0, 0.6)';
                                }}
                                onMouseOut={(e) => {
                                    e.currentTarget.style.transform = 'translateY(0)';
                                    e.currentTarget.style.boxShadow = '0 4px 12px rgba(255, 215, 0, 0.4)';
                                }}
                            >
                                Get Started ‚Üí
                            </button>
                        </header>

                        {/* Hero Section */}
                        <div style={{ maxWidth: '1400px', margin: '4rem auto', padding: '0 2rem' }}>
                            <div style={{ textAlign: 'center', marginBottom: '4rem' }}>
                                <div style={{ fontSize: '0.875rem', fontWeight: '700', letterSpacing: '2px', color: '#FFD700', marginBottom: '1rem', textTransform: 'uppercase' }}>
                                    Professional Edition
                                </div>
                                <h2 style={{ fontSize: 'clamp(2.5rem, 5vw, 4.5rem)', fontWeight: '900', color: '#FFFFFF', marginBottom: '1.5rem', lineHeight: '1.2' }}>
                                    Your Restaurant's
                                    <br />
                                    <span style={{ background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>
                                        Command Center
                                    </span>
                                </h2>
                                <p style={{ fontSize: '1.25rem', color: '#94a3b8', maxWidth: '700px', margin: '0 auto 2rem', lineHeight: '1.8' }}>
                                    Intelligent analytics, AI-powered insights, and strategic intelligence
                                    for modern restaurant owners.
                                </p>
                                <div style={{ display: 'flex', gap: '1rem', justifyContent: 'center', flexWrap: 'wrap' }}>
                                    <button
                                        onClick={onGetStarted}
                                        style={{
                                            padding: '1rem 2.5rem',
                                            background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                                            color: '#0A2540',
                                            fontWeight: '700',
                                            borderRadius: '0.75rem',
                                            border: 'none',
                                            cursor: 'pointer',
                                            fontSize: '1.125rem',
                                            boxShadow: '0 8px 24px rgba(255, 215, 0, 0.4)',
                                            transition: 'all 0.3s ease'
                                        }}
                                    >
                                        Start Free Trial
                                    </button>
                                    <button
                                        style={{
                                            padding: '1rem 2.5rem',
                                            background: 'rgba(255, 255, 255, 0.1)',
                                            color: '#FFFFFF',
                                            fontWeight: '600',
                                            borderRadius: '0.75rem',
                                            border: '2px solid rgba(255, 255, 255, 0.2)',
                                            cursor: 'pointer',
                                            fontSize: '1.125rem',
                                            backdropFilter: 'blur(10px)',
                                            transition: 'all 0.3s ease'
                                        }}
                                    >
                                        Watch Demo
                                    </button>
                                </div>
                            </div>

                            {/* Feature Showcase */}
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '2rem', marginTop: '6rem' }}>
                                {features.map((feature, index) => (
                                    <div
                                        key={index}
                                        onClick={() => setActiveFeature(index)}
                                        style={{
                                            padding: '2rem',
                                            background: activeFeature === index
                                                ? `linear-gradient(135deg, ${feature.color}15 0%, ${feature.color}08 100%)`
                                                : 'rgba(255, 255, 255, 0.03)',
                                            border: activeFeature === index
                                                ? `2px solid ${feature.color}`
                                                : '2px solid rgba(255, 255, 255, 0.1)',
                                            borderRadius: '1rem',
                                            cursor: 'pointer',
                                            transition: 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)',
                                            transform: activeFeature === index ? 'translateY(-8px) scale(1.02)' : 'translateY(0)',
                                            boxShadow: activeFeature === index
                                                ? `0 12px 40px ${feature.color}40`
                                                : '0 4px 12px rgba(0, 0, 0, 0.1)',
                                            backdropFilter: 'blur(10px)'
                                        }}
                                    >
                                        <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>{feature.icon}</div>
                                        <h3 style={{ fontSize: '1.5rem', fontWeight: '700', color: '#FFFFFF', marginBottom: '0.75rem' }}>
                                            {feature.title}
                                        </h3>
                                        <p style={{ color: '#94a3b8', lineHeight: '1.6' }}>
                                            {feature.description}
                                        </p>
                                    </div>
                                ))}
                            </div>

                            {/* Stats Section */}
                            <div style={{ marginTop: '8rem', padding: '4rem', background: 'rgba(255, 255, 255, 0.03)', borderRadius: '2rem', border: '2px solid rgba(255, 215, 0, 0.2)', backdropFilter: 'blur(20px)' }}>
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '3rem', textAlign: 'center' }}>
                                    <div>
                                        <div style={{ fontSize: '3rem', fontWeight: '900', background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', marginBottom: '0.5rem' }}>
                                            10K+
                                        </div>
                                        <div style={{ color: '#94a3b8', fontSize: '1rem' }}>Restaurants</div>
                                    </div>
                                    <div>
                                        <div style={{ fontSize: '3rem', fontWeight: '900', background: 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', marginBottom: '0.5rem' }}>
                                            50M+
                                        </div>
                                        <div style={{ color: '#94a3b8', fontSize: '1rem' }}>Orders Analyzed</div>
                                    </div>
                                    <div>
                                        <div style={{ fontSize: '3rem', fontWeight: '900', background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', marginBottom: '0.5rem' }}>
                                            99.9%
                                        </div>
                                        <div style={{ color: '#94a3b8', fontSize: '1rem' }}>Uptime</div>
                                    </div>
                                    <div>
                                        <div style={{ fontSize: '3rem', fontWeight: '900', background: 'linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', marginBottom: '0.5rem' }}>
                                            24/7
                                        </div>
                                        <div style={{ color: '#94a3b8', fontSize: '1rem' }}>Support</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Footer */}
                        <footer style={{ textAlign: 'center', padding: '3rem 2rem', color: '#64748b', borderTop: '1px solid rgba(255, 255, 255, 0.1)', maxWidth: '1400px', margin: '4rem auto 0' }}>
                            <p style={{ marginBottom: '0.5rem' }}>¬© 2024 Restalyze Technologies Inc. All rights reserved.</p>
                            <p style={{ fontSize: '0.875rem' }}>Powered by AI ‚Ä¢ Built for Excellence ‚Ä¢ Trusted by 10,000+ Restaurants</p>
                        </footer>
                    </div>
                </div>
            );
        };

        // üéì GUIDED ONBOARDING FLOW - Welcome Experience
        const OnboardingFlow = ({ onComplete }) => {
            const [step, setStep] = React.useState(1);
            const totalSteps = 4;

            const steps = [
                {
                    title: 'Welcome to Restalyze',
                    subtitle: 'Your intelligent restaurant command center',
                    icon: 'üëã',
                    description: 'Restalyze helps you make data-driven decisions with AI-powered insights, real-time analytics, and strategic intelligence.',
                    features: [
                        'üéØ Command Center with live insights',
                        'üß† AI-powered recommendations',
                        'üí∞ Financial intelligence & forecasting',
                        'üë• Staff performance tracking'
                    ]
                },
                {
                    title: 'Explore Your Dashboard',
                    subtitle: 'Navigate through intelligent modules',
                    icon: 'üó∫Ô∏è',
                    description: 'Access 8 powerful modules designed to give you complete control over your restaurant operations.',
                    features: [
                        'üìä Professional reports & analytics',
                        'üçΩÔ∏è Menu performance intelligence',
                        'üè¢ Multi-location management',
                        '‚ö° Real-time data updates'
                    ]
                },
                {
                    title: 'AI-Powered Insights',
                    subtitle: 'Let intelligence guide your decisions',
                    icon: 'ü§ñ',
                    description: 'Our AI analyzes your data 24/7 to provide actionable recommendations and predict future trends.',
                    features: [
                        'üìà Revenue forecasting',
                        'üéØ Smart alerts & notifications',
                        'üí° Optimization recommendations',
                        'üîÆ Predictive analytics'
                    ]
                },
                {
                    title: 'You\'re All Set!',
                    subtitle: 'Ready to transform your restaurant',
                    icon: 'üöÄ',
                    description: 'Start exploring Restalyze and discover insights that will help you grow your business.',
                    features: [
                        '‚ú® Sample data loaded',
                        'üìã Reports ready to generate',
                        'üéØ Dashboard configured',
                        'üí™ Ready to scale'
                    ]
                }
            ];

            const currentStep = steps[step - 1];
            const progress = (step / totalSteps) * 100;

            return (
                <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #0A2540 0%, #1a3a5c 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '2rem', position: 'relative', overflow: 'hidden' }}>
                    {/* Background decoration */}
                    <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: '#1a3a5c' }}>
                        <div style={{ height: '100%', width: `${progress}%`, background: 'linear-gradient(90deg, #FFD700 0%, #FFA500 100%)', transition: 'width 0.5s ease' }}></div>
                    </div>

                    <div style={{ maxWidth: '800px', width: '100%', animation: 'slideUp 0.6s ease-out' }}>
                        {/* Main Card */}
                        <div style={{ background: 'rgba(255, 255, 255, 0.05)', borderRadius: '2rem', padding: '3rem', backdropFilter: 'blur(20px)', border: '2px solid rgba(255, 215, 0, 0.2)', boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)' }}>
                            {/* Step indicator */}
                            <div style={{ textAlign: 'center', marginBottom: '2rem' }}>
                                <div style={{ fontSize: '5rem', marginBottom: '1rem' }}>{currentStep.icon}</div>
                                <div style={{ fontSize: '0.875rem', color: '#FFD700', fontWeight: '700', letterSpacing: '2px', marginBottom: '0.5rem' }}>
                                    STEP {step} OF {totalSteps}
                                </div>
                                <h2 style={{ fontSize: '2.5rem', fontWeight: '900', color: '#FFFFFF', marginBottom: '0.75rem', lineHeight: '1.2' }}>
                                    {currentStep.title}
                                </h2>
                                <p style={{ fontSize: '1.125rem', color: '#8b5cf6', fontWeight: '600', marginBottom: '1.5rem' }}>
                                    {currentStep.subtitle}
                                </p>
                                <p style={{ fontSize: '1rem', color: '#94a3b8', lineHeight: '1.7', maxWidth: '600px', margin: '0 auto' }}>
                                    {currentStep.description}
                                </p>
                            </div>

                            {/* Features List */}
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1rem', marginTop: '2rem', marginBottom: '3rem' }}>
                                {currentStep.features.map((feature, index) => (
                                    <div
                                        key={index}
                                        style={{
                                            padding: '1rem',
                                            background: 'rgba(255, 255, 255, 0.03)',
                                            borderRadius: '0.75rem',
                                            border: '1px solid rgba(255, 255, 255, 0.1)',
                                            color: '#FFFFFF',
                                            fontSize: '0.9375rem',
                                            fontWeight: '500',
                                            animation: `slideUp 0.6s ease-out ${index * 0.1}s both`
                                        }}
                                    >
                                        {feature}
                                    </div>
                                ))}
                            </div>

                            {/* Navigation Buttons */}
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: '1rem', flexWrap: 'wrap' }}>
                                <button
                                    onClick={() => step > 1 && setStep(step - 1)}
                                    disabled={step === 1}
                                    style={{
                                        padding: '1rem 2rem',
                                        background: step === 1 ? 'rgba(255, 255, 255, 0.05)' : 'rgba(255, 255, 255, 0.1)',
                                        color: step === 1 ? '#64748b' : '#FFFFFF',
                                        borderRadius: '0.75rem',
                                        border: '2px solid rgba(255, 255, 255, 0.1)',
                                        cursor: step === 1 ? 'not-allowed' : 'pointer',
                                        fontSize: '1rem',
                                        fontWeight: '600',
                                        transition: 'all 0.3s ease'
                                    }}
                                >
                                    ‚Üê Previous
                                </button>

                                {/* Step dots */}
                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                    {[...Array(totalSteps)].map((_, index) => (
                                        <div
                                            key={index}
                                            style={{
                                                width: step === index + 1 ? '32px' : '8px',
                                                height: '8px',
                                                borderRadius: '4px',
                                                background: step === index + 1 ? 'linear-gradient(90deg, #FFD700 0%, #FFA500 100%)' : 'rgba(255, 255, 255, 0.2)',
                                                transition: 'all 0.3s ease'
                                            }}
                                        />
                                    ))}
                                </div>

                                <button
                                    onClick={() => step < totalSteps ? setStep(step + 1) : onComplete()}
                                    style={{
                                        padding: '1rem 2rem',
                                        background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                                        color: '#0A2540',
                                        borderRadius: '0.75rem',
                                        border: 'none',
                                        cursor: 'pointer',
                                        fontSize: '1rem',
                                        fontWeight: '700',
                                        boxShadow: '0 4px 12px rgba(255, 215, 0, 0.4)',
                                        transition: 'all 0.3s ease'
                                    }}
                                    onMouseOver={(e) => {
                                        e.currentTarget.style.transform = 'translateY(-2px)';
                                        e.currentTarget.style.boxShadow = '0 6px 20px rgba(255, 215, 0, 0.6)';
                                    }}
                                    onMouseOut={(e) => {
                                        e.currentTarget.style.transform = 'translateY(0)';
                                        e.currentTarget.style.boxShadow = '0 4px 12px rgba(255, 215, 0, 0.4)';
                                    }}
                                >
                                    {step < totalSteps ? 'Next ‚Üí' : 'Get Started üöÄ'}
                                </button>
                            </div>

                            {/* Skip option */}
                            {step < totalSteps && (
                                <div style={{ textAlign: 'center', marginTop: '1.5rem' }}>
                                    <button
                                        onClick={onComplete}
                                        style={{
                                            background: 'none',
                                            border: 'none',
                                            color: '#64748b',
                                            fontSize: '0.875rem',
                                            cursor: 'pointer',
                                            textDecoration: 'underline'
                                        }}
                                    >
                                        Skip onboarding
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* Branding */}
                        <div style={{ textAlign: 'center', marginTop: '2rem', color: '#64748b', fontSize: '0.875rem' }}>
                            Powered by <span style={{ color: '#FFD700', fontWeight: '700' }}>Restalyze</span> Professional Edition
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const { user, loading } = useAuth();
            const [showLanding, setShowLanding] = React.useState(!sessionStorage.getItem('landing_viewed'));
            const [showOnboarding, setShowOnboarding] = React.useState(false);

            // Check if user needs onboarding (first login)
            React.useEffect(() => {
                if (user && !localStorage.getItem(`onboarding_completed_${user.id}`)) {
                    setShowOnboarding(true);
                }
            }, [user]);

            const completeOnboarding = () => {
                if (user) {
                    localStorage.setItem(`onboarding_completed_${user.id}`, 'true');
                }
                setShowOnboarding(false);
            };

            React.useEffect(() => {
                if (showLanding) {
                    sessionStorage.setItem('landing_viewed', 'true');
                }
            }, [showLanding]);

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center text-white">
                            <div className="animate-spin rounded-full h-16 w-16 border-t-4 border-white border-opacity-50 mx-auto"></div>
                            <p className="mt-4 text-white text-opacity-80">Loading Restalyze Platform...</p>
                        </div>
                    </div>
                );
            }

            // Show landing page first for new visitors
            if (!user && showLanding) {
                return <LandingPage onGetStarted={() => setShowLanding(false)} />;
            }

            // Show onboarding for first-time users
            if (user && showOnboarding) {
                return <OnboardingFlow onComplete={completeOnboarding} />;
            }

            return user ? <MainApp /> : <LoginScreen />;
        };

        // Render App
        const Root = () => (
            <AuthProvider>
                <DataProvider>
                    <App />
                </DataProvider>
            </AuthProvider>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Root />);
    </script>
</body>
</html>